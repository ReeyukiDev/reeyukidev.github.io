(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class R{constructor(e,t){this.fs=e,this.wm=t,this.currentPath=["home","reeyuki"],this.history=[],this.historyIndex=-1,this.username="reeyuki",this.hostname="desktop-os",this.printQueue=Promise.resolve(),this.commands={},this.registerDefaultCommands(),this.pageLoadTime=Date.now()}async print(e,t=null,s=!1,i=null,n=30){const o=document.createElement("div"),r=document.createElement("span");if(s){const a=document.createElement("span");a.textContent=i||this.terminalPrompt.textContent,a.style.color="white",o.appendChild(a),o.appendChild(r)}else t&&(r.style.color=t),o.appendChild(r);this.terminalOutput.appendChild(o);for(let a=0;a<e.length;a++)r.textContent+=e[a],await new Promise(l=>setTimeout(l,n)),this.terminalOutput.parentElement.scrollTop=this.terminalOutput.parentElement.scrollHeight}enqueuePrint(...e){return this.printQueue=this.printQueue.then(()=>this.print(...e)),this.printQueue}setupEventHandlers(){this.terminalInput.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();const t=this.terminalInput.value.trim();if(!t)return;this.history.push(t),this.historyIndex=this.history.length,this.terminalInput.value="",this.executeCommand(t)}else if(e.key==="ArrowUp"&&this.historyIndex>0)e.preventDefault(),this.terminalInput.value=this.history[--this.historyIndex];else if(e.key==="ArrowDown")e.preventDefault(),this.historyIndex=Math.min(this.historyIndex+1,this.history.length),this.terminalInput.value=this.historyIndex<this.history.length?this.history[this.historyIndex]:"";else if(e.key==="Tab")e.preventDefault(),this.handleTabCompletion();else if(e.ctrlKey)if(e.key==="l")e.preventDefault(),this.cmdClear();else if(e.key==="d"){e.preventDefault();const t=document.getElementById("terminal-win");t&&(this.wm.removeFromTaskbar(t.id),t.remove())}else e.key==="c"&&(e.preventDefault(),this.enqueuePrint("^C","white",!0,this.terminalPrompt.textContent),this.terminalInput.value="")}),document.getElementById("terminal-win").addEventListener("click",()=>{this.terminalInput.focus()})}executeCommand(e){this.enqueuePrint(e,null,!0,this.terminalPrompt.textContent);const[t,...s]=e.trim().split(/\s+/),i={help:()=>this.cmdHelp(),clear:()=>this.cmdClear(),ls:()=>this.cmdLs(s),pwd:()=>this.enqueuePrint(this.currentPath.length>0?"/"+this.currentPath.join("/"):"/"),cd:()=>this.cmdCd(s),mkdir:()=>this.cmdFileOp(s,"mkdir","missing operand",()=>this.fs.createFolder(this.currentPath,s[0]),"Created directory"),touch:()=>this.cmdFileOp(s,"touch","missing file operand",()=>this.fs.createFile(this.currentPath,s[0],""),"Created file"),rm:()=>this.cmdFileOp(s,"rm","missing operand",()=>this.fs.deleteItem(this.currentPath,s[0]),"Removed"),cat:()=>this.cmdCat(s),echo:()=>this.enqueuePrint(s.join(" ")),whoami:()=>this.enqueuePrint(this.username),hostname:()=>this.enqueuePrint(this.hostname),date:()=>this.enqueuePrint(new Date().toString()),history:()=>this.history.forEach((n,o)=>this.enqueuePrint(`  ${o+1}  ${n}`)),tree:()=>this.cmdTree(),uname:()=>this.enqueuePrint("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux"),neofetch:()=>this.cmdNeofetch(),ping:()=>this.cmdPing(s),curl:()=>this.cmdCurl(s),ps:()=>this.cmdPs()};i[t]?i[t]():t&&this.enqueuePrint(`bash: ${t}: command not found`),this.updatePrompt()}open(){const e=document.getElementById("terminal-win");if(e)return this.wm.bringToFront(e);const t=this.wm.createWindow("terminal-win","Terminal","700px","500px");Object.assign(t.style,{left:"200px",top:"100px"}),t.innerHTML=`
      <div class="window-header">
        <span>Terminal</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="background:#000; color:white; font-family:monospace; padding:10px; overflow-y:auto; height:calc(100% - 40px);">
        <div id="terminal-output" style="white-space: pre;"></div>
        <div id="terminal-input-line" style="display:flex;">
          <span id="terminal-prompt"></span>
          <input type="text" id="terminal-input" style="flex:1; background:transparent; border:none; color:white; font-family:monospace; outline:none; margin-left:5px;" autocomplete="off">
        </div>
      </div>
    `,desktop.appendChild(t),this.wm.makeDraggable(t),this.wm.makeResizable(t),this.wm.setupWindowControls(t),this.wm.addToTaskbar(t.id,"Terminal","/static/icons/terminal.png"),this.terminalOutput=t.querySelector("#terminal-output"),this.terminalInput=t.querySelector("#terminal-input"),this.terminalPrompt=t.querySelector("#terminal-prompt"),this.updatePrompt(),this.terminalInput.focus(),this.print("Welcome to Reeyuki's silly terminal"),this.print(`Type 'help' for available commands
`),this.setupEventHandlers()}updatePrompt(){const e=this.currentPath.length?"/"+this.currentPath.join("/"):"/";this.terminalPrompt.textContent=`${this.username}@${this.hostname}:${e}$ `}handleTabCompletion(){const e=this.terminalInput.value,t=this.terminalInput.selectionStart,s=e.slice(0,t),i=s.match(/(\S+)$/);if(!i)return;const n=i[1],o=s.slice(0,s.length-n.length);let r,a;if(n.includes("/")){const h=n.split("/");a=h.pop(),r=this.fs.resolvePath(h.join("/"),this.currentPath)}else r=[...this.currentPath],a=n;let l;try{l=Object.keys(this.fs.getFolder(r))}catch{return}const c=l.filter(h=>h.startsWith(a));if(c.length)if(c.length===1){const h=c[0]+(this.fs.isFile(r,c[0])?"":"/");this.terminalInput.value=o+h+e.slice(t),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=o.length+h.length}else{const h=c.reduce((m,p)=>{let u=0;for(;u<m.length&&u<p.length&&m[u]===p[u];)u++;return m.slice(0,u)},c[0]);h.length>a.length?(this.terminalInput.value=o+h+e.slice(t),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=o.length+h.length):this.print(c.join("  "))}}registerCommand(e,t){this.commands[e]=t}registerFileCommand(e,t,s,i){this.registerCommand(e,n=>{if(!n.length)return this.print(`${e}: ${i}`);try{t(this.currentPath,n[0]),this.print(`${s}: ${n[0]}`)}catch(o){this.print(`${e}: cannot process '${n[0]}': ${o.message}`)}})}registerDefaultCommands(){this.registerCommand("help",async()=>{const e=Object.keys(this.commands).sort();await this.print("Available commands:");for(const t of e)await this.print(`  ${t}`)}),this.registerCommand("clear",()=>this.cmdClear()),this.registerCommand("pwd",()=>this.print(this.currentPath.length?"/"+this.currentPath.join("/"):"/")),this.registerCommand("ls",e=>this.cmdLs(e)),this.registerCommand("cd",e=>this.cmdCd(e)),this.registerFileCommand("mkdir",(e,t)=>this.fs.createFolder(e,t),"Created directory","missing operand"),this.registerFileCommand("touch",(e,t)=>this.fs.createFile(e,t,""),"Created file","missing file operand"),this.registerFileCommand("rm",(e,t)=>this.fs.deleteItem(e,t),"Removed","missing operand"),this.registerCommand("cat",e=>this.cmdCat(e)),this.registerCommand("echo",e=>this.print(e.join(" "))),this.registerCommand("whoami",()=>this.print(this.username)),this.registerCommand("hostname",()=>this.print(this.hostname)),this.registerCommand("date",()=>this.print(new Date().toString())),this.registerCommand("history",()=>this.history.forEach((e,t)=>this.print(`  ${t+1}  ${e}`))),this.registerCommand("tree",()=>this.cmdTree()),this.registerCommand("uname",()=>this.print("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux")),this.registerCommand("ping",e=>this.cmdPing(e)),this.registerCommand("curl",e=>this.cmdCurl(e)),this.registerCommand("neofetch",()=>this.cmdNeofetch()),this.registerCommand("ps",()=>this.cmdPs())}cmdClear(){this.terminalOutput.innerHTML=""}cmdLs(e){try{const t=e.length?this.fs.resolvePath(e[0],this.currentPath):this.currentPath;Object.keys(this.fs.getFolder(t)).forEach(s=>{const i=this.fs.isFile(t,s);this.print(s+(i?"":"/"),i?null:"blue")})}catch{this.print(`ls: cannot access '${e[0]}': No such file or directory`)}}cmdCd(e){if(!e.length||e[0]==="~")this.currentPath=["home",this.username];else try{const t=this.fs.resolvePath(e[0],this.currentPath);if(!this.fs.getFolder(t))return this.print(`cd: ${e[0]}: Not a directory`);this.currentPath=t}catch{this.print(`cd: ${e[0]}: No such file or directory`)}}cmdCat(e){if(!e.length)return this.print("cat: missing file operand");const t=e[0];try{if(!this.fs.isFile(this.currentPath,t))return this.print(`cat: ${t}: Is a directory`);this.print(this.fs.getFileContent(this.currentPath,t)||"(empty file)")}catch{this.print(`cat: ${t}: No such file or directory`)}}async cmdPing(e){if(!e.length)return this.print("Usage: ping <host>");const t=e[0].startsWith("http")?e[0]:"https://"+e[0];await this.print(`PING ${e[0]} ...`);const s=performance.now();try{await fetch(t,{method:"HEAD",mode:"no-cors"})}catch{}await this.print(`Reply from ${e[0]}: time=${(performance.now()-s).toFixed(2)}ms`)}async cmdCurl(e){if(!e.length)return this.print("Usage: curl <url>");try{const t=await(await fetch(e[0])).text();await this.print(t.slice(0,1e3))}catch{await this.print(`curl: (6) Could not resolve host: ${e[0]}`)}}async cmdNeofetch(){const e=navigator.userAgent,t=/Firefox\/\d+/.test(e)?"Firefox":/Edg\/\d+/.test(e)?"Edge":/Chrome\/\d+/.test(e)?"Chrome":"Unknown",i=t==="Chrome"||t==="Edge"?"eww a chromium?!":t,n=navigator.hardwareConcurrency||"Unknown",o=n>10?`${n} (WOW ITS SO BIG!)`:n;let r="Unknown";try{const b=document.createElement("canvas"),k=b.getContext("webgl")||b.getContext("experimental-webgl");if(k){const E=k.getExtension("WEBGL_debug_renderer_info");r=E?k.getParameter(E.UNMASKED_RENDERER_WEBGL):k.getParameter(k.RENDERER)}}catch{}const a=Date.now()-this.pageLoadTime,l=Math.floor(a/36e5),c=Math.floor(a%36e5/6e4),h=`${l}h, ${c}m`;let m="Unknown";typeof InstallTrigger<"u"?m="SpiderMonkey":window.chrome&&/Google Inc/.test(navigator.vendor)?m="V8":/Apple/.test(navigator.vendor)&&(m="JavaScriptCore");let p="Unknown";/Windows NT 10/.test(e)?p="Windows 10/11":/Mac OS X/.test(e)?p="macOS":/Linux/.test(e)?p="Linux":/Android/.test(e)?p="Android":/iPhone|iPad/.test(e)&&(p="iOS");const u=p=="Windows 10/11"?"Eww a windows!":p,g=navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",w=navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled",d=["","","                     "+this.username+"@"+this.hostname,`        /\\           OWOS     ${u}`,`       /  \\          KEWNEL   ${m}wu`,`      /\\   \\         CPUWU    Cwpu Cowes: ${o}`,`     / > ω <\\        BROWSEWU  ${i}`,`    /   __   \\       GWAPHU    ${r}`,`   / __|  |__-\\      MEMOWY    ${g}`,`  /_-''    ''-_\\     DoNawtTWACKWU  ${w}`,`                     RESOWUW   ${window.innerWidth}x${window.innerHeight}`,`                     UWUPTIME  ${h}`];for(const b of d)await this.enqueuePrint(b)}cmdPs(){const e=Array.from(document.querySelectorAll(".window"));this.print("  PID   TTY          TIME CMD"),e.length?e.forEach((t,s)=>{const i=t.querySelector(".window-header span")?.textContent||"unknown";this.print(`  ${1e3+s}  pts/0      0:00 ${i}`)}):this.print("  1     pts/0        0:00 idle")}cmdTree(e=this.currentPath,t=""){t||this.print(e.length?"/"+e.join("/"):"/");try{const s=Object.keys(this.fs.getFolder(e));s.forEach((i,n)=>{const o=this.fs.isFile(e,i),r=n===s.length-1;this.print(t+(r?"└── ":"├── ")+i+(o?"":"/")),o||this.cmdTree([...e,i],t+(r?"    ":"│   "))})}catch{this.print("tree: error reading directory")}}cmdHelp(){const e=[["help","Show this help message"],["neofetch","Display system/browser summary"],["clear","Clear the terminal screen"],["ls","List directory contents"],["pwd","Print working directory"],["cd [dir]","Change directory"],["mkdir","Create a new directory"],["touch","Create a new file"],["rm","Remove file or directory"],["cat","Display file contents"],["echo","Display a line of text"],["whoami","Display current user"],["hostname","Display hostname"],["date","Display current date and time"],["history","Show command history"],["tree","Display directory tree"]];this.print("Available commands:"),e.forEach(([t,s])=>this.print(`  ${t.padEnd(10)} - ${s}`))}}const y=document.getElementById("context-menu"),v={IMAGE:"image",TEXT:"text"};class z{constructor(e,t,s){this.fs=e,this.wm=t,this.notepadApp=s,this.currentPath=["home","reeyuki"],this.fileSelectCallback=null,this.open=this.open.bind(this)}open(e=null){if(this.fileSelectCallback=e,document.getElementById("explorer-win")){this.wm.bringToFront(document.getElementById("explorer-win"));return}const t=document.createElement("div");t.className="window",t.id="explorer-win",t.dataset.fullscreen="false",t.innerHTML=`
      <div class="window-header">
        <span>File Explorer</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="explorer-nav">
        <div class="back-btn" id="exp-back">← Back</div>
        <div id="exp-path" style="color:#555"></div>
      </div>
      <div class="explorer-container">
        <div class="explorer-sidebar">
          <div class="start-item" data-path="home/reeyuki/Documents">Documents</div>
          <div class="start-item" data-path="home/reeyuki/Pictures">Pictures</div>
          <div class="start-item" data-path="home/reeyuki/Music">Music</div>
        </div>
        <div class="explorer-main" id="explorer-view"></div>
      </div>
    `,desktop.appendChild(t),document.getElementById("explorer-view").style.width="600px",this.wm.makeDraggable(t),this.wm.makeResizable(t),this.wm.setupWindowControls(t),this.wm.addToTaskbar(t.id,"File Explorer","/static/icons/file.png"),this.setupExplorerControls(t),this.render()}setupExplorerControls(e){e.querySelector("#exp-back").onclick=()=>{this.currentPath.length>1&&(this.currentPath.pop(),this.render())},e.querySelectorAll(".explorer-sidebar .start-item").forEach(s=>{s.onclick=()=>{const i=s.dataset.path.split("/").filter(n=>n);this.navigate(i)}});const t=e.querySelector("#explorer-view");t.addEventListener("contextmenu",s=>{s.target===t&&this.showBackgroundContextMenu(s)})}navigate(e){this.currentPath=[...e],this.render()}renderMusicPage(e){e&&(e.innerHTML=`
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
      <iframe 
        src="https://open.spotify.com/embed/playlist/6oK6F4LglYBr4mYLSRDJOa" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>

      <iframe 
        src="https://open.spotify.com/embed/playlist/1q7zv2ScwtR2jIxaIRj9iG" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>

      <iframe 
        src="https://open.spotify.com/embed/playlist/6q8mgrJZ5L4YxabVQoAZZf" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>
    </div>
  `)}render(){const e=document.getElementById("explorer-view"),t=document.getElementById("exp-path");if(!e)return;if(e.innerHTML="",t.textContent="/"+this.currentPath.join("/"),this.currentPath[2]==="Music"){this.renderMusicPage(document.getElementById("explorer-view"));return}const s=this.fs.getFolder(this.currentPath);Object.keys(s).forEach(i=>{const n=this.fs.isFile(this.currentPath,i),o=document.createElement("div");o.className="file-item";let r;n?this.fs.getFileKind(this.currentPath,i)===v.IMAGE?r=this.fs.getFileContent(this.currentPath,i)||"/static/icons/file.png":r="/static/icons/notepad.webp":r="/static/icons/file.png",o.innerHTML=`
      <img src="${r}" style="width:64px;height:64px;object-fit:cover">
      <span>${i}</span>
    `,o.ondblclick=()=>{if(n)if(this.fileSelectCallback)this.fileSelectCallback(this.currentPath,i),this.fileSelectCallback=null;else{const a=this.fs.getFileContent(this.currentPath,i);this.fs.getFileKind(this.currentPath,i)===v.IMAGE?this.openImageViewer(i,a):this.notepadApp.open(i,a,this.currentPath)}else this.currentPath.push(i),this.render()},o.oncontextmenu=a=>this.showFileContextMenu(a,i,n),e.appendChild(o)})}openImageViewer(e,t){const s=document.createElement("div");s.className="window",Object.assign(s.style,{width:"500px",height:"400px",left:"150px",top:"150px",zIndex:2e3}),s.innerHTML=`
      <div class="window-header">
        <span>${e}</span>
        <div class="window-controls">
          <button class="close-btn">X</button>
        </div>
      </div>
      <div style="display:flex;justify-content:center;align-items:center;height:calc(100% - 30px);background:#222">
        <img src="${t}" style="max-width:100%; max-height:100%">
      </div>
    `,desktop.appendChild(s),this.wm.makeDraggable(s),s.querySelector(".close-btn").onclick=()=>s.remove()}showFileContextMenu(e,t,s){e.preventDefault(),e.stopPropagation(),y.innerHTML="";const i=(a,l)=>{const c=document.createElement("div");return c.textContent=a,c.onclick=l,c},n=s?"Open":"Open Folder",o=()=>{if(y.style.display="none",s){const a=this.fs.getFileContent(this.currentPath,t);this.fs.getFileKind(this.currentPath,t)===v.IMAGE?this.openImageViewer(t,a):this.notepadApp.open(t,a,this.currentPath)}else this.currentPath.push(t),this.render()};if(y.appendChild(i(n,o)),s){y.appendChild(document.createElement("hr"));const a=()=>{y.style.display="none",this.fs.deleteItem(this.currentPath,t),this.render()};y.appendChild(i("Delete",a));const l=()=>{y.style.display="none";const c=prompt("Enter new name:",t);c&&c!==t&&(this.fs.renameItem(this.currentPath,t,c),this.render())};y.appendChild(i("Rename",l))}y.appendChild(document.createElement("hr"));const r=()=>{y.style.display="none",alert(`Name: ${t}
Type: ${s?"File":"Folder"}`)};y.appendChild(i("Properties",r)),Object.assign(y.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}showBackgroundContextMenu(e){e.preventDefault(),e.stopPropagation(),y.innerHTML=`
      <div id="ctx-new-file">New File</div>
      <div id="ctx-new-folder">New Folder</div>
      <hr>
      <div id="ctx-refresh">Refresh</div>
    `,document.getElementById("ctx-new-file").onclick=()=>{y.style.display="none";const t=prompt("Enter file name:","NewFile.txt");t&&(this.fs.createFile(this.currentPath,t),this.render())},document.getElementById("ctx-new-folder").onclick=()=>{y.style.display="none";const t=prompt("Enter folder name:","NewFolder");t&&(this.fs.createFolder(this.currentPath,t),this.render())},document.getElementById("ctx-refresh").onclick=()=>{y.style.display="none",this.render()},Object.assign(y.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}}const P=document.getElementById("window-style");let F=P.parentNode;function D(){P.parentNode&&F.removeChild(P)}function O(){P.parentNode||F.appendChild(P)}class q{constructor(){this.openWindows=new Map,this.zIndexCounter=1e3,this.gameWindowCount=0}updateTransparency(){this.gameWindowCount>0?D():O()}createWindow(e,t,s="80vw",i="80vh",n=!1){const o=document.createElement("div");o.className="window",o.id=e,o.dataset.fullscreen="false";const r=s!=null?String(s):"80vw",a=i!=null?String(i):"80vh",l=r.includes("vw")?window.innerWidth*parseFloat(r)/100:parseInt(r),c=a.includes("vh")?window.innerHeight*parseFloat(a)/100:parseInt(a);return Object.assign(o.style,{width:`${l}px`,height:`${c}px`,left:`${(window.innerWidth-l)/2}px`,top:`${(window.innerHeight-c)/2}px`,position:"absolute",zIndex:this.zIndexCounter++}),n&&this.gameWindowCount++,this.updateTransparency(),o}addToTaskbar(e,t,s){if(document.getElementById(`taskbar-${e}`))return;const i=document.createElement("div");if(i.id=`taskbar-${e}`,i.className="taskbar-item",s){const r=document.createElement("img");r.src=s,i.appendChild(r)}const n=document.createElement("span");n.textContent=t,i.appendChild(n),i.onclick=()=>{const r=document.getElementById(e);r&&(r.style.display==="none"?(r.style.display="block",i.classList.add("active")):this.bringToFront(r))},i.oncontextmenu=r=>{r.preventDefault();const a=document.getElementById("taskbar-context-menu");a&&a.remove();const l=document.createElement("div");l.id="taskbar-context-menu",l.className="kde-menu";const c=document.getElementById(e),h=(g,w)=>{const d=document.createElement("div");d.textContent=g,d.className="kde-item",d.onclick=()=>{w(),l.remove()},l.appendChild(d)};h(c.style.display==="none"?"Restore":"Minimize",()=>{c.style.display==="none"?c.style.display="block":this.minimizeWindow(c),this.bringToFront(c)}),h(c.dataset.fullscreen==="true"?"Restore Size":"Maximize",()=>{this.toggleFullscreen(c),this.bringToFront(c)}),h("Bring to Front",()=>this.bringToFront(c)),h("Properties",()=>{const g=this.openWindows.get(e);if(!g)return;const w=document.getElementById(e);if(!w)return;const d=w.dataset,b=w.getBoundingClientRect(),E=[`Window ID: ${e}`,`Title: ${g.title}`,d.appType?`Type: ${d.appType}`:"",d.appId?`App ID: ${d.appId}`:"",d.swf?`SWF Path: ${d.swf}`:"",d.rom?`ROM: ${d.rom}`:"",d.core?`Core: ${d.core}`:"",d.externalUrl?`URL: ${d.externalUrl}`:"",`Width: ${Math.round(b.width)}px`,`Height: ${Math.round(b.height)}px`,`Left: ${Math.round(b.left)}px`,`Top: ${Math.round(b.top)}px`,`Z-Index: ${w.style.zIndex}`,`Fullscreen: ${d.fullscreen==="true"?"Yes":"No"}`].filter(Boolean).map(W=>`<div style="margin:2px 0;">${W}</div>`).join(""),I=this.createWindow(`${e}-props`,`Properties: ${g.title}`,"40vw","40vh");I.innerHTML=`
          <div class="window-header">
            <span>Properties: ${g.title}</span>
            <div class="window-controls">
              <button class="minimize-btn" title="Minimize">−</button>
              <button class="maximize-btn" title="Maximize">□</button>
              <button class="close-btn" title="Close">X</button>
            </div>
          </div>
          <div class="window-content" style="width:100%; height:100%; overflow:auto; user-select:text;">
            ${E}
          </div>
        `,desktop.appendChild(I),this.makeDraggable(I),this.makeResizable(I),this.setupWindowControls(I)}),h("Close Window",()=>{this.removeFromTaskbar(e),c&&c.remove()}),document.body.appendChild(l);const m=l.getBoundingClientRect();let p=r.pageX,u=window.innerHeight-r.pageY;p+m.width>window.innerWidth&&(p=window.innerWidth-m.width-10),u+m.height>window.innerHeight&&(u=10),l.style.setProperty("--ctx-left",`${p}px`),l.style.setProperty("--ctx-bottom",`${u}px`),document.addEventListener("click",function g(){l.remove(),document.removeEventListener("click",g)})},document.getElementById("taskbar-windows").appendChild(i),this.openWindows.set(e,{taskbarItem:i,title:t})}removeFromTaskbar(e){const t=document.getElementById(`taskbar-${e}`);t&&t.remove(),this.openWindows.delete(e)}bringToFront(e){e.style.zIndex=this.zIndexCounter++}minimizeWindow(e){e.style.display="none";const t=document.getElementById(`taskbar-${e.id}`);t&&(t.style.background="#1a1a1a")}toggleFullscreen(e){const t=e.dataset.fullscreen==="true",s=e.querySelector(".window-header");if(t)document.fullscreenElement===e&&document.exitFullscreen(),Object.assign(e.style,{width:e.dataset.prevWidth,height:e.dataset.prevHeight,left:e.dataset.prevLeft,top:e.dataset.prevTop}),s&&(s.style.display=""),e.dataset.fullscreen="false";else{Object.assign(e.dataset,{prevWidth:e.style.width,prevHeight:e.style.height,prevLeft:e.style.left,prevTop:e.style.top});const i=()=>{Object.assign(e.style,{width:"100vw",height:"100vh",left:"0",top:"0"}),s&&(s.style.display="none")};e.requestFullscreen?e.requestFullscreen().then(i).catch(i):i(),e.dataset.fullscreen="true";const n=()=>{document.fullscreenElement||(s&&(s.style.display=""),e.dataset.fullscreen="false",document.removeEventListener("fullscreenchange",n))};document.addEventListener("fullscreenchange",n)}}setupWindowControls(e){e.querySelector(".close-btn").onclick=()=>{this.removeFromTaskbar(e.id),e.remove(),e.dataset.isGame==="true"&&(this.gameWindowCount=Math.max(0,this.gameWindowCount-1)),this.updateTransparency()},e.querySelector(".minimize-btn").onclick=()=>this.minimizeWindow(e),e.querySelector(".maximize-btn").onclick=()=>this.toggleFullscreen(e),e.addEventListener("mousedown",()=>this.bringToFront(e))}makeDraggable(e){const t=e.querySelector(".window-header");t.onmousedown=s=>{if(s.target.tagName==="BUTTON")return;const i=s.clientX-e.offsetLeft,n=s.clientY-e.offsetTop;document.onmousemove=o=>{e.style.left=`${o.clientX-i}px`,e.style.top=`${o.clientY-n}px`},document.onmouseup=()=>document.onmousemove=null}}makeResizable(e){const s=i=>{const n=e.getBoundingClientRect();let o="";return i.clientY-n.top<10?o+="n":n.bottom-i.clientY<10&&(o+="s"),i.clientX-n.left<10?o+="w":n.right-i.clientX<10&&(o+="e"),o};e.addEventListener("mousemove",i=>{const n=s(i),o={n:"n-resize",s:"s-resize",w:"w-resize",e:"e-resize",nw:"nw-resize",ne:"ne-resize",sw:"sw-resize",se:"se-resize","":"default"};e.style.cursor=o[n]||"default"}),e.addEventListener("mousedown",i=>{const n=s(i);if(!n)return;i.preventDefault();const o=i.clientX,r=i.clientY,a=e.getBoundingClientRect(),l=a.width,c=a.height,h=a.left,m=a.top,p=g=>{let w=l,d=c,b=h,k=m;n.includes("e")&&(w=l+(g.clientX-o)),n.includes("s")&&(d=c+(g.clientY-r)),n.includes("w")&&(w=l-(g.clientX-o),b=h+(g.clientX-o)),n.includes("n")&&(d=c-(g.clientY-r),k=m+(g.clientY-r));const E=300;w>E&&(e.style.width=`${w}px`,e.style.left=`${b}px`),d>E&&(e.style.height=`${d}px`,e.style.top=`${k}px`)},u=()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",u)})}}class j{constructor(e){this.wm=e,this.history=[],this.historyIndex=-1,this.currentURL="https://www.google.com/webhp?igu=1"}open(){if(document.getElementById("browser-win")){this.wm.bringToFront(document.getElementById("browser-win"));return}const e=document.createElement("div");e.className="window",e.id="browser-win",e.dataset.fullscreen="false",e.innerHTML=`
      <div class="window-header">
        <span>Browser</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <nav class="browser-nav">
        <div>
          <button id="back-btn" disabled aria-label="Click to go back" title="Click to go back">
            ←
          </button>
          <button id="forward-btn" disabled aria-label="Click to go forward" title="Click to go forward">
            →
          </button>
          <button id="reload-btn" aria-label="Reload this page" title="Reload this page">
            ⟳
          </button>
        </div>
        <input id="address-bar" type="url" value="${this.currentURL}" aria-label="Address" enterkeyhint="go">
      </nav>
      <nav class="bookmark-bar">
      <button data-url="https://www.google.com/webhp?igu=1">Google</button>
      <button data-url="https://reeyuki.github.io">Reeyuki Site</button>
      <button data-url="https://liventcord.github.io">LiventCord</button>
      <button data-url="https://www.wikipedia.org">Wikipedia</button>
      <button data-url="https://archive.org">Internet Archive</button>
      <button data-url="https://dustinbrett.com/Program%20Files/Browser/dino/index.html">T-Rex Dino</button>
      <button onclick="window.open('https://dn721809.ca.archive.org/0/items/youtube-xvFZjo5PgG0/xvFZjo5PgG0.mp4','_blank')">Click me</button>
      <a href="https://emupedia.net/beta/emuos/">EmuOS</a>

      </nav>
      <iframe id="browser-frame" src="${this.currentURL}" style="width:100%;height:calc(100% - 88px);border:none"></iframe>
    `,desktop.appendChild(e),this.wm.makeDraggable(e),this.wm.makeResizable(e),this.wm.setupWindowControls(e),this.wm.addToTaskbar(e.id,"Browser","/static/icons/chromium.webp"),e.querySelector(".close-btn").onclick=()=>e.remove(),this.frame=e.querySelector("#browser-frame"),this.addressInput=e.querySelector("#address-bar"),this.backBtn=e.querySelector("#back-btn"),this.forwardBtn=e.querySelector("#forward-btn"),this.reloadBtn=e.querySelector("#reload-btn"),e.style.width="70vw",e.style.height="70vh",e.style.left="15vw",e.style.top="15vh",this.setupControls(e)}setupControls(e){this.backBtn.onclick=()=>this.goBack(),this.forwardBtn.onclick=()=>this.goForward(),this.reloadBtn.onclick=()=>this.frame.src=this.currentURL,this.addressInput.addEventListener("keydown",t=>{t.key==="Enter"&&this.navigate(this.addressInput.value)}),e.querySelectorAll(".bookmark-bar button").forEach(t=>{t.addEventListener("click",()=>{this.navigate(t.dataset.url)})})}navigate(e){if(!e){console.error("No url found");return}!e.startsWith("http")&&!e.startsWith("chrome")&&(e="https://"+e),this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push(e),this.historyIndex++,this.updateNavigation()}goBack(){this.historyIndex>0&&(this.historyIndex--,this.updateNavigation())}goForward(){this.historyIndex<this.history.length-1&&(this.historyIndex++,this.updateNavigation())}updateNavigation(){this.currentURL=this.history[this.historyIndex],this.frame.src=this.currentURL,this.addressInput.value=this.currentURL,this.backBtn.disabled=this.historyIndex<=0,this.forwardBtn.disabled=this.historyIndex>=this.history.length-1}}class U{constructor(e,t,s,i,n,o,r,a){this.wm=e,this.fs=t,this.musicPlayer=s,this.explorerApp=i,this.terminalApp=n,this.notepadApp=o,this.browserApp=r,this.cameraApp=a,this.pageLoadTime=Date.now(),this.TRANSPARENCY_ALLOWED_APP_IDS=new Set(["paint","vscode","liventcord"]);const l=this._getAnalyticsBase("hit-page");this.sendAnalytics({...l,event:"start"}),this.appMap={return:{type:"system",action:()=>window.location.href="/"},explorer:{type:"system",action:()=>this.explorerApp.open()},computer:{type:"system",action:()=>this.explorerApp.open()},terminal:{type:"system",action:()=>this.terminalApp.open()},notepad:{type:"system",action:()=>this.notepadApp.open()},browser:{type:"system",action:()=>this.browserApp.open()},cameraApp:{type:"system",action:()=>this.cameraApp.open()},music:{type:"system",action:()=>this.musicPlayer.open(this.wm)},sonic:{type:"swf",swf:"/static/games/swfGames/sonic.swf"},flight:{type:"swf",swf:"/static/games/swfGames/flight.swf"},swarmQueen:{type:"swf",swf:"/static/games/swfGames/swarmQueen.swf"},paint:{type:"game",url:"https://paint.js.org/"},pacman:{type:"game",url:"https://pacman-e281c.firebaseapp.com"},pvz:{type:"game",url:"https://emupedia.net/emupedia-game-pvz"},pvzHybrid:{type:"remote",url:"https://www.miniplay.com/embed/plants-vs-zombies-hybrid-story"},tetris:{type:"game",url:"https://turbowarp.org/embed.html?autoplay#31651654"},roads:{type:"game",url:"https://slowroads.io"},vscode:{type:"game",url:"https://emupedia.net/emupedia-app-vscode"},isaac:{type:"game",url:"https://emupedia.net/emupedia-game-binding-of-isaac"},mario:{type:"game",url:"https://emupedia.net/emupedia-game-mario"},papaGames:{type:"game",url:"https://papasgamesfree.io"},zombieTd:{type:"game",url:"https://www.gamesflow.com/jeux.php?id=2061391"},zombotron:{type:"game",url:"https://www.gameflare.com/embed/zombotron"},zombotron2:{type:"game",url:"https://www.gameflare.com/embed/zombotron-2"},zombotron2Time:{type:"game",url:"https://www.gameflare.com/embed/zombotron-2-time-machine/"},breach:{type:"game",url:"https://www.gameflare.com/embed/the-breach/"},fancyPants:{type:"game",url:"https://www.friv.com/z/games/fancypantsadventure/game.html"},fancyPants2:{type:"game",url:"https://www.friv.com/z/games/fancypantsadventure2/game.html"},fancyPants3:{type:"game",url:"https://www.gameflare.com/embed/fancy-pants-3"},strikeForce:{type:"game",url:"https://www.friv.com/z/games/strikeforcekitty/game.html"},strikeForce2:{type:"game",url:"https://www.friv.com/z/games/strikeforcekitty2/game.html"},baloonsTd5:{type:"game",url:"https://www.gameflare.com/embed/bloons-tower-defense-5"},trinitas:{type:"game",url:"/static/games/trinitas"},jojo:{type:"game",url:"https://www.retrogames.cc/embed/8843-jojos-bizarre-adventure%3A-heritage-for-the-future-jojo-no-kimyou-na-bouken%3A-mirai-e-no-isan-japan-990927-no-cd.html"},gtaVc:{type:"game",url:"/static/vciframe.html"},subwaySurfers:{type:"game",url:"https://g.igroutka.ru/games/164/Xm2W5MIcPqrF1Y90/12/subway_surfers_easter_edinburgh"},mutantFighting:{type:"game",url:"https://www.gameflare.com/embed/mutant-fighting-cup"},mutantFighting2:{type:"game",url:"https://www.gameflare.com/embed/mutant-fighting-cup-2"},finnAndBones:{type:"game",url:"/static/flashpointarchive.html?fpGameName=finnAndBones"},obama:{type:"game",url:"/static/flashpointarchive.html?fpGameName=obama-alien-defense"},intrusion:{type:"game",url:"https://www.friv.com/z/games/intrusion/game.html"},intrusion2:{type:"game",url:"https://files.silvergames.com/flash/ruffle/player.php?id=2278"},dan:{type:"game",url:"https://www.silvergames.com/en/dan-the-man/gameframe"},infectonator:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-5020.swf?v=1373587522"},infectonator2:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-2-13150.swf?v=1373587527"},newyorkShark:{type:"swf",swf:"https://cache.armorgames.com/files/games/new-york-shark-12969.swf?v=1373587527"},swordsSouls:{type:"swf",swf:"https://cache.armorgames.com/files/games/swordssouls-17817.swf?v=1464609285"},corporationInc:{type:"swf",swf:"https://cache.armorgames.com/files/games/corporation-inc-7348.swf?v=1373587524"},aground:{type:"game",url:"https://cache.armorgames.com/files/games/aground-18245/index.html?v=1591832301"},mobyDick:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-the-video--7199.swf?v=1373587524"},mobyDick2:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-2-12662.swf?v=1373587526"},elfStory:{type:"swf",swf:"https://cache.armorgames.com/files/games/elf-story-14680.swf?v=1373587528"},frogDares:{type:"swf",swf:"https://cache.armorgames.com/files/games/frog-dares-12672.swf?v=1373587526"},kamikazePigs:{type:"swf",swf:"https://cache.armorgames.com/files/games/kamikaze-pigs-13545.swf?v=1373587527"},icyFishes:{type:"swf",swf:"https://cache.armorgames.com/files/games/icy-fishes-12977.swf?v=1373587527"},feedUs6:{type:"game",url:"https://www.gameflare.com/embed/feed-us-lost-island"},feedUsPirates:{type:"game",url:"https://www.gameflare.com/embed/feed-us-pirates"},cactusMcCoy:{type:"game",url:"https://papasgamesfree.io/cactus-mccoy-1"},jackSmith:{type:"game",url:"https://papasgamesfree.io/jacksmith"},pokemonEmerald:{type:"gba",url:"pokemon-emerald.gba"},pokemonPlatinum:{type:"nds",url:"pokemon-platinum.nds"},pokemonHeartgold:{type:"nds",url:"pokemon-heartgold.nds"},pokemonWhite:{type:"nds",url:"pokemon-white.nds"},minecraft:{type:"remote",url:"https://eaglercraft.com/play"},liventcord:{type:"game",url:"https://liventcord.github.io"},fnaf:{type:"game",url:"/static/games/fnaf"},geometryDash:{type:"game",url:"https://emupedia.net/emupedia-game-geometry-dash"},cutTheRope:{type:"game",url:"https://emupedia.net/emupedia-game-cut-the-rope2"},game2048:{type:"game",url:"https://emupedia.net/emupedia-game-2048"},pinball:{type:"game",url:"https://emupedia.net/emupedia-game-space-cadet-pinball"},flappyBird:{type:"game",url:"https://emupedia.net/emupedia-game-flappy-bird"},jetpack:{type:"game",url:"https://emupedia.net/emupedia-game-jetpack-joyride"},happyWheels:{type:"game",url:"https://emupedia.net/emupedia-game-happy-wheels/flash"}},N(this)}launch(e){const t=this.appMap[e];if(!t){console.error(`App ${e} not found.`);return}console.error("Starting app : ",e);const s=this._getAnalyticsBase(e);this.sendAnalytics({...s,event:"launch"}),{system:()=>t.action(),swf:()=>this.openRuffleApp(e,t.swf,s),gba:()=>this.openEmulatorApp(e,t.url,"gba",s),nds:()=>this.openEmulatorApp(e,t.url,"nds",s),game:()=>this.openGameApp(e,t.url,s),html:()=>this.openHtmlApp(e,t.html,s,t),remote:()=>this.openRemoteApp(t.url)}[t.type]?.()}_getAnalyticsBase(e){let t="Unknown";try{const a=document.createElement("canvas"),l=a.getContext("webgl")||a.getContext("experimental-webgl");if(l){const c=RENDERER||l.getExtension("WEBGL_debug_renderer_info");t=c?l.getParameter(c.UNMASKED_RENDERER_WEBGL):l.getParameter(l.RENDERER)}}catch{}const s=Date.now()-this.pageLoadTime,i=Math.floor(s/36e5),n=Math.floor(s%36e5/6e4),o=`${i}h, ${n}m`,r=/Brave\//.test(navigator.userAgent)||window.navigator.brave&&typeof window.navigator.brave.isBrave=="function";return{app:e,timestamp:Date.now(),browser:{userAgent:navigator.userAgent,isBrave:r,language:navigator.language,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,uptime:o,gpu:t,ram:navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",cpuCores:navigator.hardwareConcurrency||"Unknown",dnt:navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled"}}}sendAnalytics(e){fetch("https://analytics.liventcord-a60.workers.dev/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}recordUsage(e,t){const s=Date.now(),i=document.getElementById(e),n=()=>{const o=Date.now()-s;this.sendAnalytics({...t,event:"usage",durationMs:o})};i.querySelector(".close-btn").addEventListener("click",n),i.addEventListener("blur",n)}openRemoteApp(e){const t=this._getAnalyticsBase(e);this.sendAnalytics({...t,event:"launch"}),window.open(e,"_blank","noopener,noreferrer")}openHtmlApp(e,t,s){if(document.getElementById(`${e}-win`)){this.wm.bringToFront(document.getElementById(`${e}-win`));return}this.createWindow(e,e.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase()),t,null,e,s)}openRuffleApp(e,t){if(!t)return;const s=t.replace(/[^a-zA-Z0-9]/g,"");if(document.getElementById(`${s}-win`)){this.wm.bringToFront(document.getElementById(`${s}-win`));return}const i=`<embed src="${t}" width="100%" height="100%">`;this.createWindow(s,e.toUpperCase(),i,null,e,{type:"swf",swf:t})}openEmulatorApp(e,t,s){const i=`${s}-${t.replace(/\W/g,"")}-${Date.now()}`;if(document.getElementById(i)){this.wm.bringToFront(document.getElementById(i));return}const n=`/static/emulatorjs.html?rom=${encodeURIComponent(t)}&core=${encodeURIComponent(s)}&color=%230064ff`,o=`<iframe src="${n}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`,r=t.replace(/\..+$/,"");this.createWindow(i,r,o,n,e,{type:s,rom:t,core:s})}openGameApp(e,t){if(document.getElementById(`${e}-win`)){this.wm.bringToFront(document.getElementById(`${e}-win`));return}const s=`<iframe src="${t}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`,i=e.replace(/([A-Z])/g," $1").replace(/^./,n=>n.toUpperCase());this.createWindow(e,i,s,t,e,{type:"game"})}isTransparencyBlocked(e,t){return!(t.type==="system"||this.TRANSPARENCY_ALLOWED_APP_IDS.has(e))}createWindow(e,t,s,i=null,n=null,o={}){const r=this.isTransparencyBlocked(n,o),a=this.wm.createWindow(`${e}-win`,t,"80vw","80vh",r);a.dataset.appType=o.type||"",a.dataset.externalUrl=i||"",a.dataset.appId=n||"",a.dataset.swf=o.swf||"",a.dataset.isGame=r,a.dataset.rom=o.rom||"",a.dataset.core=o.core||"",a.innerHTML=`
      <div class="window-header">
        <span>${t}</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          ${i?'<button class="external-btn" title="Open in External">↗</button>':""}
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="width:100%; height:100%;">
        ${s}
      </div>
    `,desktop.appendChild(a),this.wm.makeDraggable(a),this.wm.makeResizable(a),this.wm.setupWindowControls(a),i&&a.querySelector(".external-btn").addEventListener("click",()=>this.openRemoteApp(i));const l=H(n||e);this.wm.addToTaskbar(a.id,t,l),this.recordUsage(`${e}-win`)}}function H(f){try{return document.querySelector(`#desktop div[data-app="${f}"]`)?.querySelector("img")?.src||null}catch{return null}}function N(f){const e={system:document.querySelector('.kde-page[data-page="system"]'),apps:document.querySelector('.kde-page[data-page="apps"]'),games:document.querySelector('.kde-page[data-page="games"]'),favorites:document.querySelector('.kde-page[data-page="favorites"]')};["system","apps","games"].forEach(t=>{e[t]&&(e[t].innerHTML="")}),Object.entries(f.appMap).forEach(([t,s])=>{const i=document.createElement("div");i.classList.add("kde-item"),i.dataset.app=t;const n=t.charAt(0).toUpperCase()+t.slice(1);i.textContent=n,i.addEventListener("click",()=>f.launch(t)),s.type==="system"?e.system?.appendChild(i):s.type==="game"||s.type==="swf"?e.games?.appendChild(i):e.apps?.appendChild(i)})}class G{constructor(e,t){this.fs=e,this.wm=t}setExplorer(e){this.explorerApp=e}open(e="Untitled",t="",s=null){const i=`notepad-${e.replace(/\s/g,"")}`;if(document.getElementById(i)){this.wm.bringToFront(document.getElementById(i));return}const n=this.wm.createWindow(i,`${e} - Notepad`,"600px","400px");Object.assign(n.style,{left:"250px",top:"150px"}),n.innerHTML=`
      <div class="window-header">
        <span>${e} - Notepad</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="notepad-menu">
        <button class="notepad-btn" data-action="save">Save</button>
        <button class="notepad-btn" data-action="saveAs">Save As</button>
        <button class="notepad-btn" data-action="open">Open</button>
      </div>
      <div class="window-content">
        <textarea class="notepad-textarea" style="width:100%; height:calc(100% - 40px); border:none; padding:10px; font-family:monospace;">${t}</textarea>
      </div>
    `,desktop.appendChild(n),this.wm.makeDraggable(n),this.wm.makeResizable(n),this.wm.setupWindowControls(n),this.wm.addToTaskbar(n.id,`${e} - Notepad`,"/static/icons/music.png"),this.setupNotepadControls(n,e,s)}setupNotepadControls(e,t,s){const i=e.querySelector(".notepad-textarea");e.querySelectorAll(".notepad-btn").forEach(o=>{o.onclick=()=>{const r=o.dataset.action;r==="save"?this.saveFile(e,i,t,s):r==="saveAs"?this.saveAsFile(i):r==="open"&&this.openFileDialog()}})}saveFile(e,t,s,i){if(!i){this.saveAsFile(t);return}const n=t.value;this.fs.updateFile(i,s,n),alert(`File saved: ${s}`)}saveAsFile(e){const t=prompt("Enter file name:","NewFile.txt");if(!t)return;const s=prompt("Enter path (e.g., home/reeyuki/Documents):","home/reeyuki/Documents");if(!s)return;const i=s.split("/").filter(o=>o),n=e.value;try{this.fs.createFile(i,t,n),alert(`File saved: ${t} at /${s}`)}catch{alert("Error saving file. Please check the path.")}}openFileDialog(){this.explorerApp.open((e,t)=>{const s=this.fs.getFileContent(e,t);this.open(t,s,e)})}}class _{constructor(e){this.wm=e,this.stream=null,this.mediaRecorder=null,this.recordedChunks=[],this.recordings=[],this.recordingInterval=null,this.historyWin=null}open(){if(document.getElementById("camera-win")){this.wm.bringToFront(document.getElementById("camera-win"));return}const e=document.createElement("div");e.className="window",e.id="camera-win",e.dataset.fullscreen="false",e.innerHTML=`
      <div class="window-header">
        <span>Camera</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div style="padding:10px; display:flex; flex-direction:column; align-items:center; position:relative;">
        <div style="position:relative; width:100%; max-width:600px;">
          <video id="camera-video" autoplay playsinline style="width:100%; border:1px solid #ccc; border-radius:8px;"></video>
          <span id="recording-icon" style="position:absolute; top:10px; left:10px; width:15px; height:15px; border-radius:50%; background:red; display:none;"></span>
          <span id="recording-timer" style="position:absolute; top:10px; right:10px; font-weight:bold;"></span>
        </div>
        <div style="margin-top:10px; display:flex; gap:10px;">
          <button id="take-photo-btn" style="padding:5px 15px;">Take Photo</button>
          <button id="start-record-btn" style="padding:5px 15px;">Start Recording</button>
          <button id="stop-record-btn" style="padding:5px 15px;" disabled>Stop Recording</button>
          <button id="open-history-btn" style="padding:5px 15px;">History</button>
        </div>
        <a id="download-link" style="display:none; margin-top:10px;"></a>
      </div>
    `,desktop.appendChild(e),this.wm.makeDraggable(e),this.wm.makeResizable(e),this.wm.setupWindowControls(e),this.wm.addToTaskbar(e.id,"Camera","/static/icons/camera.webp"),e.querySelector(".close-btn").onclick=()=>{this.stopCamera(),e.remove(),this.historyWin&&this.historyWin.remove()},this.video=e.querySelector("#camera-video"),this.takePhotoBtn=e.querySelector("#take-photo-btn"),this.startRecordBtn=e.querySelector("#start-record-btn"),this.stopRecordBtn=e.querySelector("#stop-record-btn"),this.downloadLink=e.querySelector("#download-link"),this.recordingIcon=e.querySelector("#recording-icon"),this.recordingTimer=e.querySelector("#recording-timer"),this.historyBtn=e.querySelector("#open-history-btn"),e.style.width="50vw",e.style.height="70vh",e.style.left="25vw",e.style.top="15vh",this.startCamera(),this.takePhotoBtn.onclick=()=>this.takePhoto(),this.startRecordBtn.onclick=()=>this.startRecording(),this.stopRecordBtn.onclick=()=>this.stopRecording(),this.historyBtn.onclick=()=>this.openHistoryWindow()}async startCamera(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.video.srcObject=this.stream}catch(e){alert("Camera access denied or not available."),console.error(e)}}takePhoto(){const e=document.createElement("canvas");e.width=this.video.videoWidth,e.height=this.video.videoHeight,e.getContext("2d").drawImage(this.video,0,0);const t=e.toDataURL("image/png");this.downloadLink.href=t,this.downloadLink.download="photo.png",this.downloadLink.textContent="Download Photo",this.downloadLink.style.display="block"}startRecording(){this.stream&&(this.recordedChunks=[],this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onstop=()=>{const e=new Blob(this.recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e);this.addRecording(t),this.downloadLink.href=t,this.downloadLink.download=`video-${Date.now()}.webm`,this.downloadLink.textContent="Download Video",this.downloadLink.style.display="block",this.historyWin&&this.renderHistory()},this.mediaRecorder.start(),this.startRecordBtn.disabled=!0,this.stopRecordBtn.disabled=!1,this.recordingIcon.style.display="block",this.startTimer())}stopRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.startRecordBtn.disabled=!1,this.stopRecordBtn.disabled=!0,this.recordingIcon.style.display="none",this.stopTimer())}startTimer(){let e=0;this.recordingTimer.textContent="00:00",this.recordingInterval=setInterval(()=>{e++;const t=String(Math.floor(e/60)).padStart(2,"0"),s=String(e%60).padStart(2,"0");this.recordingTimer.textContent=`${t}:${s}`},1e3)}stopTimer(){clearInterval(this.recordingInterval),this.recordingTimer.textContent=""}addRecording(e){this.recordings.unshift(e),this.recordings.length>5&&this.recordings.pop()}openHistoryWindow(){if(this.historyWin){this.wm.bringToFront(this.historyWin);return}this.historyWin=document.createElement("div"),this.historyWin.className="window",this.historyWin.id="history-win",this.historyWin.innerHTML=`
      <div class="window-header">
        <span>Recordings History</span>
        <div class="window-controls">
          <button class="close-btn">X</button>
        </div>
      </div>
      <div id="history-list" style="padding:10px; display:flex; flex-direction:column; gap:5px; overflow-y:auto; height:calc(100% - 30px);"></div>
    `,desktop.appendChild(this.historyWin),this.wm.makeDraggable(this.historyWin),this.wm.makeResizable(this.historyWin),this.wm.setupWindowControls(this.historyWin),this.wm.bringToFront(this.historyWin),this.historyWin.querySelector(".close-btn").onclick=()=>{this.historyWin.remove(),this.historyWin=null},this.historyWin.style.width="30vw",this.historyWin.style.height="50vh",this.historyWin.style.left="60vw",this.historyWin.style.top="20vh",this.renderHistory()}renderHistory(){if(!this.historyWin)return;const e=this.historyWin.querySelector("#history-list");e.innerHTML="",this.recordings.forEach((t,s)=>{const i=document.createElement("div");i.textContent=`Recording ${this.recordings.length-s}`,i.style.cursor="pointer",i.style.padding="5px",i.style.borderBottom="1px solid #ccc",i.onclick=()=>this.playRecording(t),e.appendChild(i)})}playRecording(e){const t=document.createElement("div");t.className="window",t.innerHTML=`
      <div class="window-header">
        <span>Playback</span>
        <div class="window-controls">
          <button class="close-btn">X</button>
        </div>
      </div>
      <video controls autoplay style="width:100%; height:90%;"></video>
    `,desktop.appendChild(t),this.wm.makeDraggable(t),this.wm.makeResizable(t),this.wm.bringToFront(t),t.querySelector(".close-btn").onclick=()=>t.remove();const s=t.querySelector("video");s.src=e,t.style.width="50vw",t.style.height="50vh",t.style.left="30vw",t.style.top="25vh"}stopCamera(){this.stream&&this.stream.getTracks().forEach(e=>e.stop())}}const B={home:{reeyuki:{Documents:{"INFO.txt":{type:"file",content:"Files you saved in notepad gets saved in your browser session.",kind:v.TEXT}},Pictures:{"wallpaper1.webp":{type:"file",content:"/static/wallpapers/wallpaper1.webp",kind:v.IMAGE},"wallpaper2.webp":{type:"file",content:"/static/wallpapers/wallpaper2.webp",kind:v.IMAGE},"wallpaper3.webp":{type:"file",content:"/static/wallpapers/wallpaper3.webp",kind:v.IMAGE},"wallpaper4.webp":{type:"file",content:"/static/wallpapers/wallpaper4.webp",kind:v.IMAGE},"wallpaper5.webp":{type:"file",content:"/static/wallpapers/wallpaper5.webp",kind:v.IMAGE},"wallpaper6.webp":{type:"file",content:"/static/wallpapers/wallpaper6.webp",kind:v.IMAGE}},Music:{}}}},$={STORAGE_KEY:"desktopOS_fileSystem"};class X{constructor(){this.loadFromStorage()}loadFromStorage(){const e=localStorage.getItem($.STORAGE_KEY);this.fileSystem=e?JSON.parse(e):B}saveToStorage(){localStorage.setItem($.STORAGE_KEY,JSON.stringify(this.fileSystem))}normalizePath(e){return typeof e=="string"?e.split("/").filter(t=>t):Array.isArray(e)?e.filter(t=>t):[]}resolvePath(e,t=[]){if(typeof e=="string"){if(e.startsWith("/"))return this.normalizePath(e);const s=[...t];return e.split("/").filter(i=>i).forEach(i=>{i===".."?s.pop():i!=="."&&s.push(i)}),s}return this.normalizePath(e)}getFolder(e){return this.normalizePath(e).reduce((s,i)=>{if(!s||typeof s!="object")throw new Error(`Invalid path: cannot access ${i}`);return s[i]},this.fileSystem)}inferKind(e){const t=e.split(".").pop().toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(t)?v.IMAGE:["txt","js","json","md","html","css"].includes(t)?v.TEXT:"generic"}createFile(e,t,s=""){const i=this.getFolder(e),n=this.inferKind(t);i[t]={type:"file",content:s,kind:n},this.saveToStorage()}createFolder(e,t){const s=this.getFolder(e);s[t]={},this.saveToStorage()}deleteItem(e,t){const s=this.getFolder(e);delete s[t],this.saveToStorage()}renameItem(e,t,s){const i=this.getFolder(e);i[s]=i[t],delete i[t],this.saveToStorage()}updateFile(e,t,s){const i=this.getFolder(e),n=i[t];if(n&&n.type==="file")n.content=s;else{const o=this.inferKind(t);i[t]={type:"file",content:s,kind:o}}this.saveToStorage()}getFileContent(e,t){const i=this.getFolder(e)[t];return i&&i.type==="file"&&i.content||""}getFileKind(e,t){const i=this.getFolder(e)[t];return console.log(i),i&&i.type==="file"?i.kind||"generic":null}isFile(e,t){const i=this.getFolder(e)[t];return i&&i.type==="file"}}class Y{constructor(){}open(e){if(document.getElementById("music-win")){console.log("bringing window to front"),e.bringToFront(document.getElementById("music-win"));return}console.log("Creating window");const t=e.createWindow("music-win","MUSIC");t.innerHTML=`
  <div class="window-header">
    <span>MUSIC</span>
    <div class="window-controls">
      <button class="minimize-btn" title="Minimize">−</button>
      <button class="maximize-btn" title="Maximize">□</button>
      <button class="close-btn" title="Close">X</button>
    </div>
  </div>
  <div class="window-content" style="width:100%; height:100%;">
    <div id="player-container" style="display:flex; flex-direction:column; align-items:center; gap:10px; padding:10px;"></div>
    </div>
  </div>`,Z.appendChild(t),x.renderMusicPage(document.getElementById("player-container")),e.makeDraggable(t),e.makeResizable(t),e.setupWindowControls(t),e.addToTaskbar(t.id,"MUSIC","/static/icons/music.png")}}class K{constructor(e){this.appLauncher=e,this.desktop=document.getElementById("desktop"),this.startButton=document.getElementById("start-button"),this.startMenu=document.getElementById("start-menu"),this.contextMenu=document.getElementById("context-menu"),this.selectionBox=document.getElementById("selection-box"),this.setupEventListeners()}setupEventListeners(){this.startButton.addEventListener("click",e=>{e.stopPropagation(),this.startMenu.style.display=this.startMenu.style.display==="flex"?"none":"flex"}),this.startMenu.addEventListener("click",e=>{e.stopPropagation()}),document.addEventListener("click",()=>{this.startMenu.style.display="none",this.contextMenu.style.display="none"}),this.desktop.addEventListener("contextmenu",e=>{e.target===this.desktop&&(e.preventDefault(),this.showDesktopContextMenu(e))}),this.setupIconHandlers(),this.setupSelectionBox(),this.setupStartMenu()}setupIconHandlers(){document.querySelectorAll(".icon.selectable").forEach(e=>{Object.assign(e.style,{userSelect:"none",webkitUserDrag:"none"}),e.draggable=!1,e.addEventListener("dblclick",t=>{t.stopPropagation();const s=e.dataset.app;s&&this.appLauncher.launch(s,e)}),e.addEventListener("mousedown",t=>{t.stopPropagation()})})}showDesktopContextMenu(e){this.contextMenu.innerHTML=`
      <div id="ctx-new-notepad">New Notepad</div>
      <div id="ctx-open-explorer">Open File Explorer</div>
      <hr>
      <div id="ctx-refresh">Refresh</div>
    `,document.getElementById("ctx-new-notepad").onclick=()=>{this.contextMenu.style.display="none",T.open()},document.getElementById("ctx-open-explorer").onclick=()=>{this.contextMenu.style.display="none",x.open()},document.getElementById("ctx-refresh").onclick=()=>{this.contextMenu.style.display="none",location.reload()},Object.assign(this.contextMenu.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}setupSelectionBox(){const e=document.querySelectorAll(".selectable");let t,s;this.desktop.addEventListener("mousedown",i=>{if(i.target!==this.desktop)return;t=i.pageX,s=i.pageY,Object.assign(this.selectionBox.style,{left:`${t}px`,top:`${s}px`,width:"0px",height:"0px",display:"block"}),e.forEach(r=>r.classList.remove("selected"));const n=r=>{const a=Math.abs(r.pageX-t),l=Math.abs(r.pageY-s),c=Math.min(r.pageX,t),h=Math.min(r.pageY,s);Object.assign(this.selectionBox.style,{width:`${a}px`,height:`${l}px`,left:`${c}px`,top:`${h}px`});const m=this.selectionBox.getBoundingClientRect();e.forEach(p=>{const u=p.getBoundingClientRect();!(u.right<m.left||u.left>m.right||u.bottom<m.top||u.top>m.bottom)?p.classList.add("selected"):p.classList.remove("selected")})},o=()=>{this.selectionBox.style.display="none",document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)})}setupStartMenu(){this.startMenu.querySelectorAll(".start-item").forEach(e=>{e.onclick=t=>{t.stopPropagation();const s=e.dataset.app;s==="documents"?(x.open(),x.navigate(["home","reeyuki","Documents"])):s==="pictures"?(x.open(),x.navigate(["home","reeyuki","Pictures"])):s==="notes"&&T.open(),this.startMenu.style.display="none"}})}}class L{static startClock(){const e=()=>{const t=new Date;document.getElementById("clock").textContent=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),document.getElementById("date").textContent=t.toLocaleDateString()};setInterval(e,1e3),e()}static setRandomWallpaper(){const e=B.home.reeyuki.Pictures,t=Object.values(e).filter(i=>i.kind==="image").map(i=>i.content);if(!t.length)return;const s=t[Math.floor(Math.random()*t.length)];document.body.style.background=`url('${s}') no-repeat center center fixed`,document.body.style.backgroundSize="cover"}}const Z=document.getElementById("desktop"),S=new X,C=new q,T=new G(S,C,null),x=new z(S,C,T),V=new j(C);T.setExplorer(x);const Q=new R(S,C),J=new Y,ee=new _(C),A=new U(C,S,J,x,Q,T,V,ee);new K(A);L.startClock();L.setRandomWallpaper();const te=window.location.search,ie=new URLSearchParams(te),M=ie.get("game");M&&setTimeout(()=>{A.launch(M)},100);console.log("Howdy, devtools user! the source of this site is available at: https://github.com/Reeyuki/reeyuki.github.io");
