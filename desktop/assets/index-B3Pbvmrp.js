(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))y(v);new MutationObserver(v=>{for(const g of v)if(g.type==="childList")for(const x of g.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&y(x)}).observe(document,{childList:!0,subtree:!0});function p(v){const g={};return v.integrity&&(g.integrity=v.integrity),v.referrerPolicy&&(g.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?g.credentials="include":v.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function y(v){if(v.ep)return;v.ep=!0;const g=p(v);fetch(v.href,g)}})();class Rs{constructor(l,p){this.fs=l,this.wm=p,this.currentPath=["home","reeyuki"],this.history=[],this.historyIndex=-1,this.username="reeyuki",this.hostname="desktop-os",this.printQueue=Promise.resolve(),this.commands={},this.registerDefaultCommands(),this.pageLoadTime=Date.now()}async print(l,p=null,y=!1,v=null,g=30){const x=document.createElement("div"),b=document.createElement("span");if(y){const F=document.createElement("span");F.textContent=v||this.terminalPrompt.textContent,F.style.color="white",x.appendChild(F),x.appendChild(b)}else p&&(b.style.color=p),x.appendChild(b);this.terminalOutput.appendChild(x);for(let F=0;F<l.length;F++)b.textContent+=l[F],await new Promise(S=>setTimeout(S,g)),this.terminalOutput.parentElement.scrollTop=this.terminalOutput.parentElement.scrollHeight}enqueuePrint(...l){return this.printQueue=this.printQueue.then(()=>this.print(...l)),this.printQueue}setupEventHandlers(){this.terminalInput.addEventListener("keydown",l=>{if(l.key==="Enter"){l.preventDefault();const p=this.terminalInput.value.trim();if(!p)return;this.history.push(p),this.historyIndex=this.history.length,this.terminalInput.value="",this.executeCommand(p)}else if(l.key==="ArrowUp"&&this.historyIndex>0)l.preventDefault(),this.terminalInput.value=this.history[--this.historyIndex];else if(l.key==="ArrowDown")l.preventDefault(),this.historyIndex=Math.min(this.historyIndex+1,this.history.length),this.terminalInput.value=this.historyIndex<this.history.length?this.history[this.historyIndex]:"";else if(l.key==="Tab")l.preventDefault(),this.handleTabCompletion();else if(l.ctrlKey)if(l.key==="l")l.preventDefault(),this.cmdClear();else if(l.key==="d"){l.preventDefault();const p=document.getElementById("terminal-win");p&&(this.wm.removeFromTaskbar(p.id),p.remove())}else l.key==="c"&&(l.preventDefault(),this.enqueuePrint("^C","white",!0,this.terminalPrompt.textContent),this.terminalInput.value="")}),document.getElementById("terminal-win").addEventListener("click",()=>{this.terminalInput.focus()})}executeCommand(l){this.enqueuePrint(l,null,!0,this.terminalPrompt.textContent);const[p,...y]=l.trim().split(/\s+/),v={help:()=>this.cmdHelp(),clear:()=>this.cmdClear(),ls:()=>this.cmdLs(y),pwd:()=>this.enqueuePrint(this.currentPath.length>0?"/"+this.currentPath.join("/"):"/"),cd:()=>this.cmdCd(y),mkdir:()=>this.cmdFileOp(y,"mkdir","missing operand",()=>this.fs.createFolder(this.currentPath,y[0]),"Created directory"),touch:()=>this.cmdFileOp(y,"touch","missing file operand",()=>this.fs.createFile(this.currentPath,y[0],""),"Created file"),rm:()=>this.cmdFileOp(y,"rm","missing operand",()=>this.fs.deleteItem(this.currentPath,y[0]),"Removed"),cat:()=>this.cmdCat(y),echo:()=>this.enqueuePrint(y.join(" ")),whoami:()=>this.enqueuePrint(this.username),hostname:()=>this.enqueuePrint(this.hostname),date:()=>this.enqueuePrint(new Date().toString()),history:()=>this.history.forEach((g,x)=>this.enqueuePrint(`  ${x+1}  ${g}`)),tree:()=>this.cmdTree(),uname:()=>this.enqueuePrint("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux"),neofetch:()=>this.cmdNeofetch(),ping:()=>this.cmdPing(y),curl:()=>this.cmdCurl(y),ps:()=>this.cmdPs()};v[p]?v[p]():p&&this.enqueuePrint(`bash: ${p}: command not found`),this.updatePrompt()}open(){const l=document.getElementById("terminal-win");if(l)return this.wm.bringToFront(l);const p=this.wm.createWindow("terminal-win","Terminal","700px","500px");Object.assign(p.style,{left:"200px",top:"100px"}),p.innerHTML=`
      <div class="window-header">
        <span>Terminal</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="background:#000; color:white; font-family:monospace; padding:10px; overflow-y:auto; height:calc(100% - 40px);">
        <div id="terminal-output" style="white-space: pre;"></div>
        <div id="terminal-input-line" style="display:flex;">
          <span id="terminal-prompt"></span>
          <input type="text" id="terminal-input" style="flex:1; background:transparent; border:none; color:white; font-family:monospace; outline:none; margin-left:5px;" autocomplete="off">
        </div>
      </div>
    `,desktop.appendChild(p),this.wm.makeDraggable(p),this.wm.makeResizable(p),this.wm.setupWindowControls(p),this.wm.addToTaskbar(p.id,"Terminal","/static/icons/terminal.png"),this.terminalOutput=p.querySelector("#terminal-output"),this.terminalInput=p.querySelector("#terminal-input"),this.terminalPrompt=p.querySelector("#terminal-prompt"),this.updatePrompt(),this.terminalInput.focus(),this.print("Welcome to Reeyuki's silly terminal"),this.print(`Type 'help' for available commands
`),this.setupEventHandlers()}updatePrompt(){const l=this.currentPath.length?"/"+this.currentPath.join("/"):"/";this.terminalPrompt.textContent=`${this.username}@${this.hostname}:${l}$ `}handleTabCompletion(){const l=this.terminalInput.value,p=this.terminalInput.selectionStart,y=l.slice(0,p),v=y.match(/(\S+)$/);if(!v)return;const g=v[1],x=y.slice(0,y.length-g.length);let b,F;if(g.includes("/")){const a=g.split("/");F=a.pop(),b=this.fs.resolvePath(a.join("/"),this.currentPath)}else b=[...this.currentPath],F=g;let S;try{S=Object.keys(this.fs.getFolder(b))}catch{return}const m=S.filter(a=>a.startsWith(F));if(m.length)if(m.length===1){const a=m[0]+(this.fs.isFile(b,m[0])?"":"/");this.terminalInput.value=x+a+l.slice(p),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=x.length+a.length}else{const a=m.reduce((_,u)=>{let D=0;for(;D<_.length&&D<u.length&&_[D]===u[D];)D++;return _.slice(0,D)},m[0]);a.length>F.length?(this.terminalInput.value=x+a+l.slice(p),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=x.length+a.length):this.print(m.join("  "))}}registerCommand(l,p){this.commands[l]=p}registerFileCommand(l,p,y,v){this.registerCommand(l,g=>{if(!g.length)return this.print(`${l}: ${v}`);try{p(this.currentPath,g[0]),this.print(`${y}: ${g[0]}`)}catch(x){this.print(`${l}: cannot process '${g[0]}': ${x.message}`)}})}registerDefaultCommands(){this.registerCommand("help",async()=>{const l=Object.keys(this.commands).sort();await this.print("Available commands:");for(const p of l)await this.print(`  ${p}`)}),this.registerCommand("clear",()=>this.cmdClear()),this.registerCommand("pwd",()=>this.print(this.currentPath.length?"/"+this.currentPath.join("/"):"/")),this.registerCommand("ls",l=>this.cmdLs(l)),this.registerCommand("cd",l=>this.cmdCd(l)),this.registerFileCommand("mkdir",(l,p)=>this.fs.createFolder(l,p),"Created directory","missing operand"),this.registerFileCommand("touch",(l,p)=>this.fs.createFile(l,p,""),"Created file","missing file operand"),this.registerFileCommand("rm",(l,p)=>this.fs.deleteItem(l,p),"Removed","missing operand"),this.registerCommand("cat",l=>this.cmdCat(l)),this.registerCommand("echo",l=>this.print(l.join(" "))),this.registerCommand("whoami",()=>this.print(this.username)),this.registerCommand("hostname",()=>this.print(this.hostname)),this.registerCommand("date",()=>this.print(new Date().toString())),this.registerCommand("history",()=>this.history.forEach((l,p)=>this.print(`  ${p+1}  ${l}`))),this.registerCommand("tree",()=>this.cmdTree()),this.registerCommand("uname",()=>this.print("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux")),this.registerCommand("ping",l=>this.cmdPing(l)),this.registerCommand("curl",l=>this.cmdCurl(l)),this.registerCommand("neofetch",()=>this.cmdNeofetch()),this.registerCommand("ps",()=>this.cmdPs())}cmdClear(){this.terminalOutput.innerHTML=""}cmdLs(l){try{const p=l.length?this.fs.resolvePath(l[0],this.currentPath):this.currentPath;Object.keys(this.fs.getFolder(p)).forEach(y=>{const v=this.fs.isFile(p,y);this.print(y+(v?"":"/"),v?null:"blue")})}catch{this.print(`ls: cannot access '${l[0]}': No such file or directory`)}}cmdCd(l){if(!l.length||l[0]==="~")this.currentPath=["home",this.username];else try{const p=this.fs.resolvePath(l[0],this.currentPath);if(!this.fs.getFolder(p))return this.print(`cd: ${l[0]}: Not a directory`);this.currentPath=p}catch{this.print(`cd: ${l[0]}: No such file or directory`)}}cmdCat(l){if(!l.length)return this.print("cat: missing file operand");const p=l[0];try{if(!this.fs.isFile(this.currentPath,p))return this.print(`cat: ${p}: Is a directory`);this.print(this.fs.getFileContent(this.currentPath,p)||"(empty file)")}catch{this.print(`cat: ${p}: No such file or directory`)}}async cmdPing(l){if(!l.length)return this.print("Usage: ping <host>");const p=l[0].startsWith("http")?l[0]:"https://"+l[0];await this.print(`PING ${l[0]} ...`);const y=performance.now();try{await fetch(p,{method:"HEAD",mode:"no-cors"})}catch{}await this.print(`Reply from ${l[0]}: time=${(performance.now()-y).toFixed(2)}ms`)}async cmdCurl(l){if(!l.length)return this.print("Usage: curl <url>");try{const p=await(await fetch(l[0])).text();await this.print(p.slice(0,1e3))}catch{await this.print(`curl: (6) Could not resolve host: ${l[0]}`)}}async cmdNeofetch(){const l=navigator.userAgent,p=/Firefox\/\d+/.test(l)?"Firefox":/Edg\/\d+/.test(l)?"Edge":/Chrome\/\d+/.test(l)?"Chrome":"Unknown",v=p==="Chrome"||p==="Edge"?"eww a chromium?!":p,g=navigator.hardwareConcurrency||"Unknown",x=g>10?`${g} (WOW ITS SO BIG!)`:g;let b="Unknown";try{const A=document.createElement("canvas"),K=A.getContext("webgl")||A.getContext("experimental-webgl");if(K){const B=K.getExtension("WEBGL_debug_renderer_info");b=B?K.getParameter(B.UNMASKED_RENDERER_WEBGL):K.getParameter(K.RENDERER)}}catch{}const F=Date.now()-this.pageLoadTime,S=Math.floor(F/36e5),m=Math.floor(F%36e5/6e4),a=`${S}h, ${m}m`;let _="Unknown";typeof InstallTrigger<"u"?_="SpiderMonkey":window.chrome&&/Google Inc/.test(navigator.vendor)?_="V8":/Apple/.test(navigator.vendor)&&(_="JavaScriptCore");let u="Unknown";/Windows NT 10/.test(l)?u="Windows 10/11":/Mac OS X/.test(l)?u="macOS":/Linux/.test(l)?u="Linux":/Android/.test(l)?u="Android":/iPhone|iPad/.test(l)&&(u="iOS");const D=u=="Windows 10/11"?"Eww a windows!":u,L=navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",O=navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled",C=["","","                     "+this.username+"@"+this.hostname,`        /\\           OWOS     ${D}`,`       /  \\          KEWNEL   ${_}wu`,`      /\\   \\         CPUWU    Cwpu Cowes: ${x}`,`     / > ω <\\        BROWSEWU  ${v}`,`    /   __   \\       GWAPHU    ${b}`,`   / __|  |__-\\      MEMOWY    ${L}`,`  /_-''    ''-_\\     DoNawtTWACKWU  ${O}`,`                     RESOWUW   ${window.innerWidth}x${window.innerHeight}`,`                     UWUPTIME  ${a}`];for(const A of C)await this.enqueuePrint(A)}cmdPs(){const l=Array.from(document.querySelectorAll(".window"));this.print("  PID   TTY          TIME CMD"),l.length?l.forEach((p,y)=>{const v=p.querySelector(".window-header span")?.textContent||"unknown";this.print(`  ${1e3+y}  pts/0      0:00 ${v}`)}):this.print("  1     pts/0        0:00 idle")}cmdTree(l=this.currentPath,p=""){p||this.print(l.length?"/"+l.join("/"):"/");try{const y=Object.keys(this.fs.getFolder(l));y.forEach((v,g)=>{const x=this.fs.isFile(l,v),b=g===y.length-1;this.print(p+(b?"└── ":"├── ")+v+(x?"":"/")),x||this.cmdTree([...l,v],p+(b?"    ":"│   "))})}catch{this.print("tree: error reading directory")}}cmdHelp(){const l=[["help","Show this help message"],["neofetch","Display system/browser summary"],["clear","Clear the terminal screen"],["ls","List directory contents"],["pwd","Print working directory"],["cd [dir]","Change directory"],["mkdir","Create a new directory"],["touch","Create a new file"],["rm","Remove file or directory"],["cat","Display file contents"],["echo","Display a line of text"],["whoami","Display current user"],["hostname","Display hostname"],["date","Display current date and time"],["history","Show command history"],["tree","Display directory tree"]];this.print("Available commands:"),l.forEach(([p,y])=>this.print(`  ${p.padEnd(10)} - ${y}`))}}function Os(rt){return rt&&rt.__esModule&&Object.prototype.hasOwnProperty.call(rt,"default")?rt.default:rt}var Wn={exports:{}},Ns=Wn.exports,br;function Ds(){return br||(br=1,(function(rt,l){(function(y,v){rt.exports=v()})(Ns,function(){return(function(p){var y={};function v(g){if(y[g])return y[g].exports;var x=y[g]={exports:{},id:g,loaded:!1};return p[g].call(x.exports,x,x.exports,v),x.loaded=!0,x.exports}return v.m=p,v.c=y,v.p="",v(0)})([function(p,y,v){(function(g,x,b,F){Object.defineProperty(y,"__esModule",{value:!0});var S=v(2),m=v(9),a;(function(i){i[i.EPERM=1]="EPERM",i[i.ENOENT=2]="ENOENT",i[i.EIO=5]="EIO",i[i.EBADF=9]="EBADF",i[i.EACCES=13]="EACCES",i[i.EBUSY=16]="EBUSY",i[i.EEXIST=17]="EEXIST",i[i.ENOTDIR=20]="ENOTDIR",i[i.EISDIR=21]="EISDIR",i[i.EINVAL=22]="EINVAL",i[i.EFBIG=27]="EFBIG",i[i.ENOSPC=28]="ENOSPC",i[i.EROFS=30]="EROFS",i[i.ENOTEMPTY=39]="ENOTEMPTY",i[i.ENOTSUP=95]="ENOTSUP"})(a||(a={}));var _={};_[a.EPERM]="Operation not permitted.",_[a.ENOENT]="No such file or directory.",_[a.EIO]="Input/output error.",_[a.EBADF]="Bad file descriptor.",_[a.EACCES]="Permission denied.",_[a.EBUSY]="Resource busy or locked.",_[a.EEXIST]="File exists.",_[a.ENOTDIR]="File is not a directory.",_[a.EISDIR]="File is a directory.",_[a.EINVAL]="Invalid argument.",_[a.EFBIG]="File is too big.",_[a.ENOSPC]="No space left on disk.",_[a.EROFS]="Cannot modify a read-only file system.",_[a.ENOTEMPTY]="Directory is not empty.",_[a.ENOTSUP]="Operation is not supported.";var u=(function(i){function t(n,e,r){e===void 0&&(e=_[n]),i.call(this,e),this.syscall="",this.errno=n,this.code=a[n],this.path=r,this.stack=new i().stack,this.message="Error: "+this.code+": "+e+(this.path?", '"+this.path+"'":"")}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.fromJSON=function(e){var r=new t(0);return r.errno=e.errno,r.code=e.code,r.path=e.path,r.stack=e.stack,r.message=e.message,r},t.fromBuffer=function(e,r){return r===void 0&&(r=0),t.fromJSON(JSON.parse(e.toString("utf8",r+4,r+4+e.readUInt32LE(r))))},t.FileError=function(e,r){return new t(e,_[e],r)},t.ENOENT=function(e){return this.FileError(a.ENOENT,e)},t.EEXIST=function(e){return this.FileError(a.EEXIST,e)},t.EISDIR=function(e){return this.FileError(a.EISDIR,e)},t.ENOTDIR=function(e){return this.FileError(a.ENOTDIR,e)},t.EPERM=function(e){return this.FileError(a.EPERM,e)},t.ENOTEMPTY=function(e){return this.FileError(a.ENOTEMPTY,e)},t.prototype.toString=function(){return this.message},t.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},t.prototype.writeToBuffer=function(e,r){e===void 0&&(e=g.alloc(this.bufferSize())),r===void 0&&(r=0);var o=e.write(JSON.stringify(this.toJSON()),r+4);return e.writeUInt32LE(o,r),e},t.prototype.bufferSize=function(){return 4+g.byteLength(JSON.stringify(this.toJSON()))},t})(Error),D=Object.freeze({get ErrorCode(){return a},ErrorStrings:_,ApiError:u}),L;(function(i){i[i.NOP=0]="NOP",i[i.THROW_EXCEPTION=1]="THROW_EXCEPTION",i[i.TRUNCATE_FILE=2]="TRUNCATE_FILE",i[i.CREATE_FILE=3]="CREATE_FILE"})(L||(L={}));var O=function i(t){if(this.flagStr=t,i.validFlagStrs.indexOf(t)<0)throw new u(a.EINVAL,"Invalid flag: "+t)};O.getFileFlag=function(t){return O.flagCache.hasOwnProperty(t)?O.flagCache[t]:O.flagCache[t]=new O(t)},O.prototype.getFlagString=function(){return this.flagStr},O.prototype.isReadable=function(){return this.flagStr.indexOf("r")!==-1||this.flagStr.indexOf("+")!==-1},O.prototype.isWriteable=function(){return this.flagStr.indexOf("w")!==-1||this.flagStr.indexOf("a")!==-1||this.flagStr.indexOf("+")!==-1},O.prototype.isTruncating=function(){return this.flagStr.indexOf("w")!==-1},O.prototype.isAppendable=function(){return this.flagStr.indexOf("a")!==-1},O.prototype.isSynchronous=function(){return this.flagStr.indexOf("s")!==-1},O.prototype.isExclusive=function(){return this.flagStr.indexOf("x")!==-1},O.prototype.pathExistsAction=function(){return this.isExclusive()?L.THROW_EXCEPTION:this.isTruncating()?L.TRUNCATE_FILE:L.NOP},O.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&this.flagStr!=="r+"?L.CREATE_FILE:L.THROW_EXCEPTION},O.flagCache={},O.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"];var C;(function(i){i[i.FILE=32768]="FILE",i[i.DIRECTORY=16384]="DIRECTORY",i[i.SYMLINK=40960]="SYMLINK"})(C||(C={}));var A=function(t,n,e,r,o,s){if(r===void 0&&(r=new Date),o===void 0&&(o=new Date),s===void 0&&(s=new Date),this.size=n,this.atime=r,this.mtime=o,this.ctime=s,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.fileData=null,e)this.mode=e;else switch(t){case C.FILE:this.mode=420;break;case C.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(n/512),this.mode<4096&&(this.mode|=t)};A.fromBuffer=function(t){var n=t.readUInt32LE(0),e=t.readUInt32LE(4),r=t.readDoubleLE(8),o=t.readDoubleLE(16),s=t.readDoubleLE(24);return new A(e&61440,n,e&4095,new Date(r),new Date(o),new Date(s))},A.prototype.toBuffer=function(){var t=g.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t},A.prototype.clone=function(){return new A(this.mode&61440,this.size,this.mode&4095,this.atime,this.mtime,this.ctime)},A.prototype.isFile=function(){return(this.mode&61440)===C.FILE},A.prototype.isDirectory=function(){return(this.mode&61440)===C.DIRECTORY},A.prototype.isSymbolicLink=function(){return(this.mode&61440)===C.SYMLINK},A.prototype.chmod=function(t){this.mode=this.mode&61440|t},A.prototype.isSocket=function(){return!1},A.prototype.isBlockDevice=function(){return!1},A.prototype.isCharacterDevice=function(){return!1},A.prototype.isFIFO=function(){return!1};var K=function(i,t){return i};function B(i){if(i)return i;throw new u(a.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function H(i,t){switch(typeof i){case"number":return i;case"string":var n=parseInt(i,8);return isNaN(n)?t:n;default:return t}}function St(i){if(i instanceof Date)return i;if(typeof i=="number")return new Date(i*1e3);throw new u(a.EINVAL,"Invalid time.")}function tt(i){if(i.indexOf("\0")>=0)throw new u(a.EINVAL,"Path must be a string without null bytes.");if(i==="")throw new u(a.EINVAL,"Path must not be empty.");return m.resolve(i)}function kt(i,t,n,e){switch(typeof i){case"object":return{encoding:typeof i.encoding<"u"?i.encoding:t,flag:typeof i.flag<"u"?i.flag:n,mode:H(i.mode,e)};case"string":return{encoding:i,flag:n,mode:e};default:return{encoding:t,flag:n,mode:e}}}function dt(){}var U=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};U.prototype.initialize=function(t){if(!t.constructor.isAvailable())throw new u(a.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t},U.prototype._toUnixTimestamp=function(t){if(typeof t=="number")return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)},U.prototype.getRootFS=function(){return this.root?this.root:null},U.prototype.rename=function(t,n,e){e===void 0&&(e=dt);var r=K(e,1);try{B(this.root).rename(tt(t),tt(n),r)}catch(o){r(o)}},U.prototype.renameSync=function(t,n){B(this.root).renameSync(tt(t),tt(n))},U.prototype.exists=function(t,n){n===void 0&&(n=dt);var e=K(n,1);try{return B(this.root).exists(tt(t),e)}catch{return e(!1)}},U.prototype.existsSync=function(t){try{return B(this.root).existsSync(tt(t))}catch{return!1}},U.prototype.stat=function(t,n){n===void 0&&(n=dt);var e=K(n,2);try{return B(this.root).stat(tt(t),!1,e)}catch(r){return e(r)}},U.prototype.statSync=function(t){return B(this.root).statSync(tt(t),!1)},U.prototype.lstat=function(t,n){n===void 0&&(n=dt);var e=K(n,2);try{return B(this.root).stat(tt(t),!0,e)}catch(r){return e(r)}},U.prototype.lstatSync=function(t){return B(this.root).statSync(tt(t),!0)},U.prototype.truncate=function(t,n,e){n===void 0&&(n=0),e===void 0&&(e=dt);var r=0;typeof n=="function"?e=n:typeof n=="number"&&(r=n);var o=K(e,1);try{if(r<0)throw new u(a.EINVAL);return B(this.root).truncate(tt(t),r,o)}catch(s){return o(s)}},U.prototype.truncateSync=function(t,n){if(n===void 0&&(n=0),n<0)throw new u(a.EINVAL);return B(this.root).truncateSync(tt(t),n)},U.prototype.unlink=function(t,n){n===void 0&&(n=dt);var e=K(n,1);try{return B(this.root).unlink(tt(t),e)}catch(r){return e(r)}},U.prototype.unlinkSync=function(t){return B(this.root).unlinkSync(tt(t))},U.prototype.open=function(t,n,e,r){var o=this;r===void 0&&(r=dt);var s=H(e,420);r=typeof e=="function"?e:r;var c=K(r,2);try{B(this.root).open(tt(t),O.getFileFlag(n),s,function(d,w){w?c(d,o.getFdForFile(w)):c(d)})}catch(d){c(d)}},U.prototype.openSync=function(t,n,e){return e===void 0&&(e=420),this.getFdForFile(B(this.root).openSync(tt(t),O.getFileFlag(n),H(e,420)))},U.prototype.readFile=function(t,n,e){n===void 0&&(n={}),e===void 0&&(e=dt);var r=kt(n,null,"r",null);e=typeof n=="function"?n:e;var o=K(e,2);try{var s=O.getFileFlag(r.flag);return s.isReadable()?B(this.root).readFile(tt(t),r.encoding,s,o):o(new u(a.EINVAL,"Flag passed to readFile must allow for reading."))}catch(c){return o(c)}},U.prototype.readFileSync=function(t,n){n===void 0&&(n={});var e=kt(n,null,"r",null),r=O.getFileFlag(e.flag);if(!r.isReadable())throw new u(a.EINVAL,"Flag passed to readFile must allow for reading.");return B(this.root).readFileSync(tt(t),e.encoding,r)},U.prototype.writeFile=function(t,n,e,r){e===void 0&&(e={}),r===void 0&&(r=dt);var o=kt(e,"utf8","w",420);r=typeof e=="function"?e:r;var s=K(r,1);try{var c=O.getFileFlag(o.flag);return c.isWriteable()?B(this.root).writeFile(tt(t),n,o.encoding,c,o.mode,s):s(new u(a.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(d){return s(d)}},U.prototype.writeFileSync=function(t,n,e){var r=kt(e,"utf8","w",420),o=O.getFileFlag(r.flag);if(!o.isWriteable())throw new u(a.EINVAL,"Flag passed to writeFile must allow for writing.");return B(this.root).writeFileSync(tt(t),n,r.encoding,o,r.mode)},U.prototype.appendFile=function(t,n,e,r){r===void 0&&(r=dt);var o=kt(e,"utf8","a",420);r=typeof e=="function"?e:r;var s=K(r,1);try{var c=O.getFileFlag(o.flag);if(!c.isAppendable())return s(new u(a.EINVAL,"Flag passed to appendFile must allow for appending."));B(this.root).appendFile(tt(t),n,o.encoding,c,o.mode,s)}catch(d){s(d)}},U.prototype.appendFileSync=function(t,n,e){var r=kt(e,"utf8","a",420),o=O.getFileFlag(r.flag);if(!o.isAppendable())throw new u(a.EINVAL,"Flag passed to appendFile must allow for appending.");return B(this.root).appendFileSync(tt(t),n,r.encoding,o,r.mode)},U.prototype.fstat=function(t,n){n===void 0&&(n=dt);var e=K(n,2);try{var r=this.fd2file(t);r.stat(e)}catch(o){e(o)}},U.prototype.fstatSync=function(t){return this.fd2file(t).statSync()},U.prototype.close=function(t,n){var e=this;n===void 0&&(n=dt);var r=K(n,1);try{this.fd2file(t).close(function(o){o||e.closeFd(t),r(o)})}catch(o){r(o)}},U.prototype.closeSync=function(t){this.fd2file(t).closeSync(),this.closeFd(t)},U.prototype.ftruncate=function(t,n,e){e===void 0&&(e=dt);var r=typeof n=="number"?n:0;e=typeof n=="function"?n:e;var o=K(e,1);try{var s=this.fd2file(t);if(r<0)throw new u(a.EINVAL);s.truncate(r,o)}catch(c){o(c)}},U.prototype.ftruncateSync=function(t,n){n===void 0&&(n=0);var e=this.fd2file(t);if(n<0)throw new u(a.EINVAL);e.truncateSync(n)},U.prototype.fsync=function(t,n){n===void 0&&(n=dt);var e=K(n,1);try{this.fd2file(t).sync(e)}catch(r){e(r)}},U.prototype.fsyncSync=function(t){this.fd2file(t).syncSync()},U.prototype.fdatasync=function(t,n){n===void 0&&(n=dt);var e=K(n,1);try{this.fd2file(t).datasync(e)}catch(r){e(r)}},U.prototype.fdatasyncSync=function(t){this.fd2file(t).datasyncSync()},U.prototype.write=function(t,n,e,r,o,s){s===void 0&&(s=dt);var c,d,w,N=null;if(typeof n=="string"){var M="utf8";switch(typeof e){case"function":s=e;break;case"number":N=e,M=typeof r=="string"?r:"utf8",s=typeof o=="function"?o:s;break;default:return s=typeof r=="function"?r:typeof o=="function"?o:s,s(new u(a.EINVAL,"Invalid arguments."))}c=g.from(n,M),d=0,w=c.length}else c=n,d=e,w=r,N=typeof o=="number"?o:null,s=typeof o=="function"?o:s;var q=K(s,3);try{var $=this.fd2file(t);N==null&&(N=$.getPos()),$.write(c,d,w,N,q)}catch(nt){q(nt)}},U.prototype.writeSync=function(t,n,e,r,o){var s,c=0,d,w;if(typeof n=="string"){w=typeof e=="number"?e:null;var N=typeof r=="string"?r:"utf8";c=0,s=g.from(n,N),d=s.length}else s=n,c=e,d=r,w=typeof o=="number"?o:null;var M=this.fd2file(t);return w==null&&(w=M.getPos()),M.writeSync(s,c,d,w)},U.prototype.read=function(t,n,e,r,o,s){s===void 0&&(s=dt);var c,d,w,N,M;if(typeof n=="number"){w=n,c=e;var q=r;s=typeof o=="function"?o:s,d=0,N=g.alloc(w),M=K(function(nt,ut,yt){if(nt)return s(nt);s(nt,yt.toString(q),ut)},3)}else N=n,d=e,w=r,c=o,M=K(s,3);try{var $=this.fd2file(t);c==null&&(c=$.getPos()),$.read(N,d,w,c,M)}catch(nt){M(nt)}},U.prototype.readSync=function(t,n,e,r,o){var s=!1,c,d,w,N,M="utf8";typeof n=="number"?(w=n,N=e,M=r,d=0,c=g.alloc(w),s=!0):(c=n,d=e,w=r,N=o);var q=this.fd2file(t);N==null&&(N=q.getPos());var $=q.readSync(c,d,w,N);return s?[c.toString(M),$]:$},U.prototype.fchown=function(t,n,e,r){r===void 0&&(r=dt);var o=K(r,1);try{this.fd2file(t).chown(n,e,o)}catch(s){o(s)}},U.prototype.fchownSync=function(t,n,e){this.fd2file(t).chownSync(n,e)},U.prototype.fchmod=function(t,n,e){var r=K(e,1);try{var o=typeof n=="string"?parseInt(n,8):n;this.fd2file(t).chmod(o,r)}catch(s){r(s)}},U.prototype.fchmodSync=function(t,n){var e=typeof n=="string"?parseInt(n,8):n;this.fd2file(t).chmodSync(e)},U.prototype.futimes=function(t,n,e,r){r===void 0&&(r=dt);var o=K(r,1);try{var s=this.fd2file(t);typeof n=="number"&&(n=new Date(n*1e3)),typeof e=="number"&&(e=new Date(e*1e3)),s.utimes(n,e,o)}catch(c){o(c)}},U.prototype.futimesSync=function(t,n,e){this.fd2file(t).utimesSync(St(n),St(e))},U.prototype.rmdir=function(t,n){n===void 0&&(n=dt);var e=K(n,1);try{t=tt(t),B(this.root).rmdir(t,e)}catch(r){e(r)}},U.prototype.rmdirSync=function(t){return t=tt(t),B(this.root).rmdirSync(t)},U.prototype.mkdir=function(t,n,e){e===void 0&&(e=dt),typeof n=="function"&&(e=n,n=511);var r=K(e,1);try{t=tt(t),B(this.root).mkdir(t,n,r)}catch(o){r(o)}},U.prototype.mkdirSync=function(t,n){B(this.root).mkdirSync(tt(t),H(n,511))},U.prototype.readdir=function(t,n){n===void 0&&(n=dt);var e=K(n,2);try{t=tt(t),B(this.root).readdir(t,e)}catch(r){e(r)}},U.prototype.readdirSync=function(t){return t=tt(t),B(this.root).readdirSync(t)},U.prototype.link=function(t,n,e){e===void 0&&(e=dt);var r=K(e,1);try{t=tt(t),n=tt(n),B(this.root).link(t,n,r)}catch(o){r(o)}},U.prototype.linkSync=function(t,n){return t=tt(t),n=tt(n),B(this.root).linkSync(t,n)},U.prototype.symlink=function(t,n,e,r){r===void 0&&(r=dt);var o=typeof e=="string"?e:"file";r=typeof e=="function"?e:r;var s=K(r,1);try{if(o!=="file"&&o!=="dir")return s(new u(a.EINVAL,"Invalid type: "+o));t=tt(t),n=tt(n),B(this.root).symlink(t,n,o,s)}catch(c){s(c)}},U.prototype.symlinkSync=function(t,n,e){if(!e)e="file";else if(e!=="file"&&e!=="dir")throw new u(a.EINVAL,"Invalid type: "+e);return t=tt(t),n=tt(n),B(this.root).symlinkSync(t,n,e)},U.prototype.readlink=function(t,n){n===void 0&&(n=dt);var e=K(n,2);try{t=tt(t),B(this.root).readlink(t,e)}catch(r){e(r)}},U.prototype.readlinkSync=function(t){return t=tt(t),B(this.root).readlinkSync(t)},U.prototype.chown=function(t,n,e,r){r===void 0&&(r=dt);var o=K(r,1);try{t=tt(t),B(this.root).chown(t,!1,n,e,o)}catch(s){o(s)}},U.prototype.chownSync=function(t,n,e){t=tt(t),B(this.root).chownSync(t,!1,n,e)},U.prototype.lchown=function(t,n,e,r){r===void 0&&(r=dt);var o=K(r,1);try{t=tt(t),B(this.root).chown(t,!0,n,e,o)}catch(s){o(s)}},U.prototype.lchownSync=function(t,n,e){t=tt(t),B(this.root).chownSync(t,!0,n,e)},U.prototype.chmod=function(t,n,e){e===void 0&&(e=dt);var r=K(e,1);try{var o=H(n,-1);if(o<0)throw new u(a.EINVAL,"Invalid mode.");B(this.root).chmod(tt(t),!1,o,r)}catch(s){r(s)}},U.prototype.chmodSync=function(t,n){var e=H(n,-1);if(e<0)throw new u(a.EINVAL,"Invalid mode.");t=tt(t),B(this.root).chmodSync(t,!1,e)},U.prototype.lchmod=function(t,n,e){e===void 0&&(e=dt);var r=K(e,1);try{var o=H(n,-1);if(o<0)throw new u(a.EINVAL,"Invalid mode.");B(this.root).chmod(tt(t),!0,o,r)}catch(s){r(s)}},U.prototype.lchmodSync=function(t,n){var e=H(n,-1);if(e<1)throw new u(a.EINVAL,"Invalid mode.");B(this.root).chmodSync(tt(t),!0,e)},U.prototype.utimes=function(t,n,e,r){r===void 0&&(r=dt);var o=K(r,1);try{B(this.root).utimes(tt(t),St(n),St(e),o)}catch(s){o(s)}},U.prototype.utimesSync=function(t,n,e){B(this.root).utimesSync(tt(t),St(n),St(e))},U.prototype.realpath=function(t,n,e){e===void 0&&(e=dt);var r=typeof n=="object"?n:{};e=typeof n=="function"?n:dt;var o=K(e,2);try{t=tt(t),B(this.root).realpath(t,r,o)}catch(s){o(s)}},U.prototype.realpathSync=function(t,n){return n===void 0&&(n={}),t=tt(t),B(this.root).realpathSync(t,n)},U.prototype.watchFile=function(t,n,e){throw new u(a.ENOTSUP)},U.prototype.unwatchFile=function(t,n){throw new u(a.ENOTSUP)},U.prototype.watch=function(t,n,e){throw new u(a.ENOTSUP)},U.prototype.access=function(t,n,e){throw new u(a.ENOTSUP)},U.prototype.accessSync=function(t,n){throw new u(a.ENOTSUP)},U.prototype.createReadStream=function(t,n){throw new u(a.ENOTSUP)},U.prototype.createWriteStream=function(t,n){throw new u(a.ENOTSUP)},U.prototype.wrapCallbacks=function(t){K=t},U.prototype.getFdForFile=function(t){var n=this.nextFd++;return this.fdMap[n]=t,n},U.prototype.fd2file=function(t){var n=this.fdMap[t];if(n)return n;throw new u(a.EBADF,"Invalid file descriptor.")},U.prototype.closeFd=function(t){delete this.fdMap[t]},U.Stats=A;var et=new U,lt={},xt=U.prototype;Object.keys(xt).forEach(function(i){typeof et[i]=="function"?lt[i]=function(){return et[i].apply(et,arguments)}:lt[i]=et[i]}),lt.changeFSModule=function(i){et=i},lt.getFSModule=function(){return et},lt.FS=U;function mt(i,t,n,e,r){return i<t||n<t?i>n?n+1:i+1:e===r?t:t+1}function Ct(i,t){if(i===t)return 0;if(i.length>t.length){var n=i;i=t,t=n}for(var e=i.length,r=t.length;e>0&&i.charCodeAt(e-1)===t.charCodeAt(r-1);)e--,r--;for(var o=0;o<e&&i.charCodeAt(o)===t.charCodeAt(o);)o++;if(e-=o,r-=o,e===0||r===1)return r;for(var s=new Array(e<<1),c=0;c<e;)s[e+c]=i.charCodeAt(o+c),s[c]=++c;var d,w,N,M,q;for(d=0;d+3<r;)for(var $=t.charCodeAt(o+(w=d)),nt=t.charCodeAt(o+(N=d+1)),ut=t.charCodeAt(o+(M=d+2)),yt=t.charCodeAt(o+(q=d+3)),It=d+=4,Gt=0;Gt<e;){var ae=s[e+Gt],xe=s[Gt];w=mt(xe,w,N,$,ae),N=mt(w,N,M,nt,ae),M=mt(N,M,q,ut,ae),It=mt(M,q,It,yt,ae),s[Gt++]=It,q=M,M=N,N=w,w=xe}for(var Re=0;d<r;){var cn=t.charCodeAt(o+(w=d));Re=++d;for(var Ae=0;Ae<e;Ae++){var Me=s[Ae];s[Ae]=Re=Me<w||Re<w?Me>Re?Re+1:Me+1:cn===s[e+Ae]?w:w+1,w=Me}}return Re}function Lt(i,t,n){i&&console.warn("["+t+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '"+t+".Create("+JSON.stringify(n)+", callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")}var Et=typeof navigator<"u"&&!!(/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||navigator.userAgent.indexOf("Trident")!==-1),Zt=typeof window>"u";function j(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function z(i,t,n){n.existsSync(i)||(z(m.dirname(i),t,n),n.mkdirSync(i,t))}function J(i){var t=ft(i),n=t.byteOffset,e=t.byteLength;return n===0&&e===t.buffer.byteLength?t.buffer:t.buffer.slice(n,n+e)}function ft(i){return i instanceof Uint8Array?i:new Uint8Array(i)}function Ft(i){return i instanceof g?i:i instanceof Uint8Array?gt(i):g.from(i)}function gt(i){return i instanceof g?i:i.byteOffset===0&&i.byteLength===i.buffer.byteLength?_t(i.buffer):g.from(i.buffer,i.byteOffset,i.byteLength)}function _t(i){return g.from(i)}function Rt(i,t,n){if(t===void 0&&(t=0),n===void 0&&(n=i.length),t<0||n<0||n>i.length||t>n)throw new TypeError("Invalid slice bounds on buffer of length "+i.length+": ["+t+", "+n+"]");if(i.length===0)return Mt();var e=ft(i),r=i[0],o=(r+1)%255;return i[0]=o,e[0]===o?(e[0]=r,gt(e.slice(t,n))):(i[0]=r,gt(e.subarray(t,n)))}var Wt=null;function Mt(){return Wt||(Wt=g.alloc(0))}function T(i,t){g.isBuffer(i)?t():t(new u(a.EINVAL,"option must be a Buffer."))}function R(i,t,n){var e=i.Options,r=i.Name,o=0,s=!1,c=!1;function d(q){s||(q&&(s=!0,n(q)),o--,o===0&&c&&n())}var w=function(q){if(e.hasOwnProperty(q)){var $=e[q],nt=t[q];if(nt==null){if(!$.optional){var ut=Object.keys(t).filter(function(It){return!(It in e)}).map(function(It){return{str:It,distance:Ct(q,It)}}).filter(function(It){return It.distance<5}).sort(function(It,Gt){return It.distance-Gt.distance});return s?{}:(s=!0,{v:n(new u(a.EINVAL,"["+r+"] Required option '"+q+"' not provided."+(ut.length>0?" You provided unrecognized option '"+ut[0].str+"'; perhaps you meant to type '"+q+"'.":"")+`
Option description: `+$.description))})}}else{var yt=!1;if(Array.isArray($.type)?yt=$.type.indexOf(typeof nt)!==-1:yt=typeof nt===$.type,yt)$.validator&&(o++,$.validator(nt,d));else return s?{}:(s=!0,{v:n(new u(a.EINVAL,"["+r+"] Value provided for option "+q+" is not the proper type. Expected "+(Array.isArray($.type)?"one of {"+$.type.join(", ")+"}":$.type)+", but received "+typeof nt+`
Option description: `+$.description))})}}};for(var N in e){var M=w(N);if(M)return M.v}c=!0,o===0&&!s&&n()}var Z=Object.freeze({deprecationMessage:Lt,isIE:Et,isWebWorker:Zt,fail:j,mkdirpSync:z,buffer2ArrayBuffer:J,buffer2Uint8array:ft,arrayish2Buffer:Ft,uint8Array2Buffer:gt,arrayBuffer2Buffer:_t,copyingSlice:Rt,emptyBuffer:Mt,bufferValidator:T,checkOptions:R}),it=function(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()};it.prototype.open=function(t){var n=this.fs.realPath(t.node),e=this.FS;try{e.isFile(t.node.mode)&&(t.nfd=this.nodefs.openSync(n,this.fs.flagsToPermissionString(t.flags)))}catch(r){throw r.code?new e.ErrnoError(this.ERRNO_CODES[r.code]):r}},it.prototype.close=function(t){var n=this.FS;try{n.isFile(t.node.mode)&&t.nfd&&this.nodefs.closeSync(t.nfd)}catch(e){throw e.code?new n.ErrnoError(this.ERRNO_CODES[e.code]):e}},it.prototype.read=function(t,n,e,r,o){try{return this.nodefs.readSync(t.nfd,gt(n),e,r,o)}catch(s){throw new this.FS.ErrnoError(this.ERRNO_CODES[s.code])}},it.prototype.write=function(t,n,e,r,o){try{return this.nodefs.writeSync(t.nfd,gt(n),e,r,o)}catch(s){throw new this.FS.ErrnoError(this.ERRNO_CODES[s.code])}},it.prototype.llseek=function(t,n,e){var r=n;if(e===1)r+=t.position;else if(e===2&&this.FS.isFile(t.node.mode))try{var o=this.nodefs.fstatSync(t.nfd);r+=o.size}catch(s){throw new this.FS.ErrnoError(this.ERRNO_CODES[s.code])}if(r<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return t.position=r,r};var pt=function(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()};pt.prototype.getattr=function(t){var n=this.fs.realPath(t),e;try{e=this.nodefs.lstatSync(n)}catch(r){throw r.code?new this.FS.ErrnoError(this.ERRNO_CODES[r.code]):r}return{dev:e.dev,ino:e.ino,mode:e.mode,nlink:e.nlink,uid:e.uid,gid:e.gid,rdev:e.rdev,size:e.size,atime:e.atime,mtime:e.mtime,ctime:e.ctime,blksize:e.blksize,blocks:e.blocks}},pt.prototype.setattr=function(t,n){var e=this.fs.realPath(t);try{if(n.mode!==void 0&&(this.nodefs.chmodSync(e,n.mode),t.mode=n.mode),n.timestamp!==void 0){var r=new Date(n.timestamp);this.nodefs.utimesSync(e,r,r)}}catch(o){if(!o.code)throw o;if(o.code!=="ENOTSUP")throw new this.FS.ErrnoError(this.ERRNO_CODES[o.code])}if(n.size!==void 0)try{this.nodefs.truncateSync(e,n.size)}catch(o){throw o.code?new this.FS.ErrnoError(this.ERRNO_CODES[o.code]):o}},pt.prototype.lookup=function(t,n){var e=this.PATH.join2(this.fs.realPath(t),n),r=this.fs.getMode(e);return this.fs.createNode(t,n,r)},pt.prototype.mknod=function(t,n,e,r){var o=this.fs.createNode(t,n,e,r),s=this.fs.realPath(o);try{this.FS.isDir(o.mode)?this.nodefs.mkdirSync(s,o.mode):this.nodefs.writeFileSync(s,"",{mode:o.mode})}catch(c){throw c.code?new this.FS.ErrnoError(this.ERRNO_CODES[c.code]):c}return o},pt.prototype.rename=function(t,n,e){var r=this.fs.realPath(t),o=this.PATH.join2(this.fs.realPath(n),e);try{this.nodefs.renameSync(r,o),t.name=e,t.parent=n}catch(s){throw s.code?new this.FS.ErrnoError(this.ERRNO_CODES[s.code]):s}},pt.prototype.unlink=function(t,n){var e=this.PATH.join2(this.fs.realPath(t),n);try{this.nodefs.unlinkSync(e)}catch(r){throw r.code?new this.FS.ErrnoError(this.ERRNO_CODES[r.code]):r}},pt.prototype.rmdir=function(t,n){var e=this.PATH.join2(this.fs.realPath(t),n);try{this.nodefs.rmdirSync(e)}catch(r){throw r.code?new this.FS.ErrnoError(this.ERRNO_CODES[r.code]):r}},pt.prototype.readdir=function(t){var n=this.fs.realPath(t);try{var e=this.nodefs.readdirSync(n);return e.push(".",".."),e}catch(r){throw r.code?new this.FS.ErrnoError(this.ERRNO_CODES[r.code]):r}},pt.prototype.symlink=function(t,n,e){var r=this.PATH.join2(this.fs.realPath(t),n);try{this.nodefs.symlinkSync(e,r)}catch(o){throw o.code?new this.FS.ErrnoError(this.ERRNO_CODES[o.code]):o}},pt.prototype.readlink=function(t){var n=this.fs.realPath(t);try{return this.nodefs.readlinkSync(n)}catch(e){throw e.code?new this.FS.ErrnoError(this.ERRNO_CODES[e.code]):e}};var bt=function(t,n,e,r){t===void 0&&(t=self.FS),n===void 0&&(n=self.PATH),e===void 0&&(e=self.ERRNO_CODES),r===void 0&&(r=lt),this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=r,this.FS=t,this.PATH=n,this.ERRNO_CODES=e,this.node_ops=new pt(this),this.stream_ops=new it(this)};bt.prototype.mount=function(t){return this.createNode(null,"/",this.getMode(t.opts.root),0)},bt.prototype.createNode=function(t,n,e,r){var o=this.FS;if(!o.isDir(e)&&!o.isFile(e)&&!o.isLink(e))throw new o.ErrnoError(this.ERRNO_CODES.EINVAL);var s=o.createNode(t,n,e);return s.node_ops=this.node_ops,s.stream_ops=this.stream_ops,s},bt.prototype.getMode=function(t){var n;try{n=this.nodefs.lstatSync(t)}catch(e){throw e.code?new this.FS.ErrnoError(this.ERRNO_CODES[e.code]):e}return n.mode},bt.prototype.realPath=function(t){for(var n=[];t.parent!==t;)n.push(t.name),t=t.parent;return n.push(t.mount.opts.root),n.reverse(),this.PATH.join.apply(null,n)},bt.prototype.flagsToPermissionString=function(t){var n=typeof t=="string"?parseInt(t,10):t;return n&=8191,n in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[n]:t},bt.prototype.getNodeFS=function(){return this.nodefs},bt.prototype.getFS=function(){return this.FS},bt.prototype.getPATH=function(){return this.PATH},bt.prototype.getERRNO_CODES=function(){return this.ERRNO_CODES};var Q=function(){};Q.prototype.supportsLinks=function(){return!1},Q.prototype.diskSpace=function(t,n){n(0,0)},Q.prototype.openFile=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.createFile=function(t,n,e,r){throw new u(a.ENOTSUP)},Q.prototype.open=function(t,n,e,r){var o=this,s=function(c,d){if(c)switch(n.pathNotExistsAction()){case L.CREATE_FILE:return o.stat(m.dirname(t),!1,function(w,N){w?r(w):N&&!N.isDirectory()?r(u.ENOTDIR(m.dirname(t))):o.createFile(t,n,e,r)});case L.THROW_EXCEPTION:return r(u.ENOENT(t));default:return r(new u(a.EINVAL,"Invalid FileFlag object."))}else{if(d&&d.isDirectory())return r(u.EISDIR(t));switch(n.pathExistsAction()){case L.THROW_EXCEPTION:return r(u.EEXIST(t));case L.TRUNCATE_FILE:return o.openFile(t,n,function(w,N){w?r(w):N?N.truncate(0,function(){N.sync(function(){r(null,N)})}):j()});case L.NOP:return o.openFile(t,n,r);default:return r(new u(a.EINVAL,"Invalid FileFlag object."))}}};this.stat(t,!1,s)},Q.prototype.rename=function(t,n,e){e(new u(a.ENOTSUP))},Q.prototype.renameSync=function(t,n){throw new u(a.ENOTSUP)},Q.prototype.stat=function(t,n,e){e(new u(a.ENOTSUP))},Q.prototype.statSync=function(t,n){throw new u(a.ENOTSUP)},Q.prototype.openFileSync=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.createFileSync=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.openSync=function(t,n,e){var r;try{r=this.statSync(t,!1)}catch{switch(n.pathNotExistsAction()){case L.CREATE_FILE:var o=this.statSync(m.dirname(t),!1);if(!o.isDirectory())throw u.ENOTDIR(m.dirname(t));return this.createFileSync(t,n,e);case L.THROW_EXCEPTION:throw u.ENOENT(t);default:throw new u(a.EINVAL,"Invalid FileFlag object.")}}if(r.isDirectory())throw u.EISDIR(t);switch(n.pathExistsAction()){case L.THROW_EXCEPTION:throw u.EEXIST(t);case L.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,n,r.mode);case L.NOP:return this.openFileSync(t,n,e);default:throw new u(a.EINVAL,"Invalid FileFlag object.")}},Q.prototype.unlink=function(t,n){n(new u(a.ENOTSUP))},Q.prototype.unlinkSync=function(t){throw new u(a.ENOTSUP)},Q.prototype.rmdir=function(t,n){n(new u(a.ENOTSUP))},Q.prototype.rmdirSync=function(t){throw new u(a.ENOTSUP)},Q.prototype.mkdir=function(t,n,e){e(new u(a.ENOTSUP))},Q.prototype.mkdirSync=function(t,n){throw new u(a.ENOTSUP)},Q.prototype.readdir=function(t,n){n(new u(a.ENOTSUP))},Q.prototype.readdirSync=function(t){throw new u(a.ENOTSUP)},Q.prototype.exists=function(t,n){this.stat(t,null,function(e){n(!e)})},Q.prototype.existsSync=function(t){try{return this.statSync(t,!0),!0}catch{return!1}},Q.prototype.realpath=function(t,n,e){if(this.supportsLinks())for(var r=t.split(m.sep),o=0;o<r.length;o++){var s=r.slice(0,o+1);r[o]=m.join.apply(null,s)}else this.exists(t,function(c){c?e(null,t):e(u.ENOENT(t))})},Q.prototype.realpathSync=function(t,n){if(this.supportsLinks()){for(var e=t.split(m.sep),r=0;r<e.length;r++){var o=e.slice(0,r+1);e[r]=m.join.apply(m,o)}return e.join(m.sep)}else{if(this.existsSync(t))return t;throw u.ENOENT(t)}},Q.prototype.truncate=function(t,n,e){this.open(t,O.getFileFlag("r+"),420,(function(r,o){if(r)return e(r);o.truncate(n,(function(s){o.close((function(c){e(s||c)}))}))}))},Q.prototype.truncateSync=function(t,n){var e=this.openSync(t,O.getFileFlag("r+"),420);try{e.truncateSync(n)}catch(r){throw r}finally{e.closeSync()}},Q.prototype.readFile=function(t,n,e,r){var o=r;this.open(t,e,420,function(s,c){if(s)return r(s);r=function(d,w){c.close(function(N){return d||(d=N),o(d,w)})},c.stat(function(d,w){if(d)return r(d);var N=g.alloc(w.size);c.read(N,0,w.size,0,function(M){if(M)return r(M);if(n===null)return r(M,N);try{r(null,N.toString(n))}catch(q){r(q)}})})})},Q.prototype.readFileSync=function(t,n,e){var r=this.openSync(t,e,420);try{var o=r.statSync(),s=g.alloc(o.size);return r.readSync(s,0,o.size,0),r.closeSync(),n===null?s:s.toString(n)}finally{r.closeSync()}},Q.prototype.writeFile=function(t,n,e,r,o,s){var c=s;this.open(t,r,420,function(d,w){if(d)return s(d);s=function(N){w.close(function(M){c(N||M)})};try{typeof n=="string"&&(n=g.from(n,e))}catch(N){return s(N)}w.write(n,0,n.length,0,s)})},Q.prototype.writeFileSync=function(t,n,e,r,o){var s=this.openSync(t,r,o);try{typeof n=="string"&&(n=g.from(n,e)),s.writeSync(n,0,n.length,0)}finally{s.closeSync()}},Q.prototype.appendFile=function(t,n,e,r,o,s){var c=s;this.open(t,r,o,function(d,w){if(d)return s(d);s=function(N){w.close(function(M){c(N||M)})},typeof n=="string"&&(n=g.from(n,e)),w.write(n,0,n.length,null,s)})},Q.prototype.appendFileSync=function(t,n,e,r,o){var s=this.openSync(t,r,o);try{typeof n=="string"&&(n=g.from(n,e)),s.writeSync(n,0,n.length,null)}finally{s.closeSync()}},Q.prototype.chmod=function(t,n,e,r){r(new u(a.ENOTSUP))},Q.prototype.chmodSync=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.chown=function(t,n,e,r,o){o(new u(a.ENOTSUP))},Q.prototype.chownSync=function(t,n,e,r){throw new u(a.ENOTSUP)},Q.prototype.utimes=function(t,n,e,r){r(new u(a.ENOTSUP))},Q.prototype.utimesSync=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.link=function(t,n,e){e(new u(a.ENOTSUP))},Q.prototype.linkSync=function(t,n){throw new u(a.ENOTSUP)},Q.prototype.symlink=function(t,n,e,r){r(new u(a.ENOTSUP))},Q.prototype.symlinkSync=function(t,n,e){throw new u(a.ENOTSUP)},Q.prototype.readlink=function(t,n){n(new u(a.ENOTSUP))},Q.prototype.readlinkSync=function(t){throw new u(a.ENOTSUP)};var ne=(function(i){function t(){i.apply(this,arguments)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.supportsSynch=function(){return!0},t.prototype.rename=function(e,r,o){try{this.renameSync(e,r),o()}catch(s){o(s)}},t.prototype.stat=function(e,r,o){try{o(null,this.statSync(e,r))}catch(s){o(s)}},t.prototype.open=function(e,r,o,s){try{s(null,this.openSync(e,r,o))}catch(c){s(c)}},t.prototype.unlink=function(e,r){try{this.unlinkSync(e),r()}catch(o){r(o)}},t.prototype.rmdir=function(e,r){try{this.rmdirSync(e),r()}catch(o){r(o)}},t.prototype.mkdir=function(e,r,o){try{this.mkdirSync(e,r),o()}catch(s){o(s)}},t.prototype.readdir=function(e,r){try{r(null,this.readdirSync(e))}catch(o){r(o)}},t.prototype.chmod=function(e,r,o,s){try{this.chmodSync(e,r,o),s()}catch(c){s(c)}},t.prototype.chown=function(e,r,o,s,c){try{this.chownSync(e,r,o,s),c()}catch(d){c(d)}},t.prototype.utimes=function(e,r,o,s){try{this.utimesSync(e,r,o),s()}catch(c){s(c)}},t.prototype.link=function(e,r,o){try{this.linkSync(e,r),o()}catch(s){o(s)}},t.prototype.symlink=function(e,r,o,s){try{this.symlinkSync(e,r,o),s()}catch(c){s(c)}},t.prototype.readlink=function(e,r){try{r(null,this.readlinkSync(e))}catch(o){r(o)}},t})(Q),vt=function(){};vt.prototype.sync=function(t){t(new u(a.ENOTSUP))},vt.prototype.syncSync=function(){throw new u(a.ENOTSUP)},vt.prototype.datasync=function(t){this.sync(t)},vt.prototype.datasyncSync=function(){return this.syncSync()},vt.prototype.chown=function(t,n,e){e(new u(a.ENOTSUP))},vt.prototype.chownSync=function(t,n){throw new u(a.ENOTSUP)},vt.prototype.chmod=function(t,n){n(new u(a.ENOTSUP))},vt.prototype.chmodSync=function(t){throw new u(a.ENOTSUP)},vt.prototype.utimes=function(t,n,e){e(new u(a.ENOTSUP))},vt.prototype.utimesSync=function(t,n){throw new u(a.ENOTSUP)};var oe=(function(i){function t(n,e,r,o,s){if(i.call(this),this._pos=0,this._dirty=!1,this._fs=n,this._path=e,this._flag=r,this._stat=o,s?this._buffer=s:this._buffer=Mt(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStats=function(){return this._stat},t.prototype.getFlag=function(){return this._flag},t.prototype.getPath=function(){return this._path},t.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},t.prototype.advancePos=function(e){return this._pos+=e},t.prototype.setPos=function(e){return this._pos=e},t.prototype.sync=function(e){try{this.syncSync(),e()}catch(r){e(r)}},t.prototype.syncSync=function(){throw new u(a.ENOTSUP)},t.prototype.close=function(e){try{this.closeSync(),e()}catch(r){e(r)}},t.prototype.closeSync=function(){throw new u(a.ENOTSUP)},t.prototype.stat=function(e){try{e(null,this._stat.clone())}catch(r){e(r)}},t.prototype.statSync=function(){return this._stat.clone()},t.prototype.truncate=function(e,r){try{this.truncateSync(e),this._flag.isSynchronous()&&!lt.getRootFS().supportsSynch()&&this.sync(r),r()}catch(o){return r(o)}},t.prototype.truncateSync=function(e){if(this._dirty=!0,!this._flag.isWriteable())throw new u(a.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,e>this._buffer.length){var r=g.alloc(e-this._buffer.length,0);this.writeSync(r,0,r.length,this._buffer.length),this._flag.isSynchronous()&&lt.getRootFS().supportsSynch()&&this.syncSync();return}this._stat.size=e;var o=g.alloc(e);this._buffer.copy(o,0,0,e),this._buffer=o,this._flag.isSynchronous()&&lt.getRootFS().supportsSynch()&&this.syncSync()},t.prototype.write=function(e,r,o,s,c){try{c(null,this.writeSync(e,r,o,s),e)}catch(d){c(d)}},t.prototype.writeSync=function(e,r,o,s){if(this._dirty=!0,s==null&&(s=this.getPos()),!this._flag.isWriteable())throw new u(a.EPERM,"File not opened with a writeable mode.");var c=s+o;if(c>this._stat.size&&(this._stat.size=c,c>this._buffer.length)){var d=g.alloc(c);this._buffer.copy(d),this._buffer=d}var w=e.copy(this._buffer,s,r,r+o);return this._stat.mtime=new Date,this._flag.isSynchronous()?(this.syncSync(),w):(this.setPos(s+w),w)},t.prototype.read=function(e,r,o,s,c){try{c(null,this.readSync(e,r,o,s),e)}catch(d){c(d)}},t.prototype.readSync=function(e,r,o,s){if(!this._flag.isReadable())throw new u(a.EPERM,"File not opened with a readable mode.");s==null&&(s=this.getPos());var c=s+o;c>this._stat.size&&(o=this._stat.size-s);var d=this._buffer.copy(e,r,s,s+o);return this._stat.atime=new Date,this._pos=s+o,d},t.prototype.chmod=function(e,r){try{this.chmodSync(e),r()}catch(o){r(o)}},t.prototype.chmodSync=function(e){if(!this._fs.supportsProps())throw new u(a.ENOTSUP);this._dirty=!0,this._stat.chmod(e),this.syncSync()},t.prototype.isDirty=function(){return this._dirty},t.prototype.resetDirty=function(){this._dirty=!1},t})(vt),le=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){e()},t.prototype.syncSync=function(){},t.prototype.close=function(e){e()},t.prototype.closeSync=function(){},t})(oe),be=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},t.prototype.closeSync=function(){this.syncSync()},t})(oe),k=(function(i){function t(n,e,r){if(r===void 0&&(r=!0),i.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=n,this._async=e,!n.supportsSynch())throw new Error("The first argument to AsyncMirror needs to be a synchronous file system.");Lt(r,t.Name,{sync:"sync file system instance",async:"async file system instance"})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){try{var o=new t(e.sync,e.async,!1);o.initialize(function(s){s?r(s):r(null,o)},!1)}catch(s){r(s)}},t.isAvailable=function(){return!0},t.prototype.getName=function(){return t.Name},t.prototype._syncSync=function(e){this._sync.writeFileSync(e.getPath(),e.getBuffer(),null,O.getFileFlag("w"),e.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[e.getPath(),e.getBuffer(),null,e.getFlag(),e.getStats().mode]})},t.prototype.initialize=function(e,r){var o=this;r===void 0&&(r=!0),r&&console.warn("[AsyncMirror] AsyncMirror.initialize() is deprecated and will be removed in the next major version. Please use 'AsyncMirror.Create({ sync: (sync file system instance), async: (async file system instance)}, cb)' to create and initialize AsyncMirror instances.");var s=this._initializeCallbacks,c=function(M){o._isInitialized=!M,o._initializeCallbacks=[],s.forEach(function(q){return q(M)})};if(this._isInitialized)e();else if(s.push(e)===1){var d=function(M,q,$){M!=="/"&&o._sync.mkdirSync(M,q),o._async.readdir(M,function(nt,ut){var yt=0;function It(Gt){Gt?$(Gt):yt<ut.length?(N(m.join(M,ut[yt]),It),yt++):$()}nt?$(nt):It()})},w=function(M,q,$){o._async.readFile(M,null,O.getFileFlag("r"),function(nt,ut){if(nt)$(nt);else try{o._sync.writeFileSync(M,ut,null,O.getFileFlag("w"),q)}catch(yt){nt=yt}finally{$(nt)}})},N=function(M,q){o._async.stat(M,!1,function($,nt){$?q($):nt.isDirectory()?d(M,nt.mode,q):w(M,nt.mode,q)})};d("/",0,c)}},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},t.prototype.renameSync=function(e,r){this.checkInitialized(),this._sync.renameSync(e,r),this.enqueueOp({apiMethod:"rename",arguments:[e,r]})},t.prototype.statSync=function(e,r){return this.checkInitialized(),this._sync.statSync(e,r)},t.prototype.openSync=function(e,r,o){this.checkInitialized();var s=this._sync.openSync(e,r,o);return s.closeSync(),new be(this,e,r,this._sync.statSync(e,!1),this._sync.readFileSync(e,null,O.getFileFlag("r")))},t.prototype.unlinkSync=function(e){this.checkInitialized(),this._sync.unlinkSync(e),this.enqueueOp({apiMethod:"unlink",arguments:[e]})},t.prototype.rmdirSync=function(e){this.checkInitialized(),this._sync.rmdirSync(e),this.enqueueOp({apiMethod:"rmdir",arguments:[e]})},t.prototype.mkdirSync=function(e,r){this.checkInitialized(),this._sync.mkdirSync(e,r),this.enqueueOp({apiMethod:"mkdir",arguments:[e,r]})},t.prototype.readdirSync=function(e){return this.checkInitialized(),this._sync.readdirSync(e)},t.prototype.existsSync=function(e){return this.checkInitialized(),this._sync.existsSync(e)},t.prototype.chmodSync=function(e,r,o){this.checkInitialized(),this._sync.chmodSync(e,r,o),this.enqueueOp({apiMethod:"chmod",arguments:[e,r,o]})},t.prototype.chownSync=function(e,r,o,s){this.checkInitialized(),this._sync.chownSync(e,r,o,s),this.enqueueOp({apiMethod:"chown",arguments:[e,r,o,s]})},t.prototype.utimesSync=function(e,r,o){this.checkInitialized(),this._sync.utimesSync(e,r,o),this.enqueueOp({apiMethod:"utimes",arguments:[e,r,o]})},t.prototype.checkInitialized=function(){if(!this._isInitialized)throw new u(a.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")},t.prototype.enqueueOp=function(e){var r=this;if(this._queue.push(e),!this._queueRunning){this._queueRunning=!0;var o=function(s){if(s&&console.error("WARNING: File system has desynchronized. Received following error: "+s+`
$`),r._queue.length>0){var c=r._queue.shift(),d=c.arguments;d.push(o),r._async[c.apiMethod].apply(r._async,d)}else r._queueRunning=!1};o()}},t})(ne);k.Name="AsyncMirror",k.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};function f(i,t,n){switch(n.length){case 0:return i.call(t);case 1:return i.call(t,n[0]);case 2:return i.call(t,n[0],n[1]);case 3:return i.call(t,n[0],n[1],n[2])}return i.apply(t,n)}var h=Math.max;function I(i,t,n){return t=h(t===void 0?i.length-1:t,0),function(){for(var e=arguments,r=-1,o=h(e.length-t,0),s=Array(o);++r<o;)s[r]=e[t+r];r=-1;for(var c=Array(t+1);++r<t;)c[r]=e[r];return c[t]=n(s),f(i,this,c)}}function P(i){return i}function G(i,t){return I(i,t,P)}var V=function(i){return G(function(t){var n=t.pop();i.call(this,t,n)})};function Tt(i){return G(function(t,n){var e=V(function(r,o){var s=this;return i(t,function(c,d){c.apply(s,r.concat(d))},o)});return n.length?e.apply(this,n):e})}var Dt=typeof x=="object"&&x&&x.Object===Object&&x,Pt=typeof self=="object"&&self&&self.Object===Object&&self,Vt=Dt||Pt||Function("return this")(),At=Vt.Symbol,ke=Object.prototype,Je=ke.hasOwnProperty,Ue=ke.toString,je=At?At.toStringTag:void 0;function Xn(i){var t=Je.call(i,je),n=i[je];try{i[je]=void 0;var e=!0}catch{}var r=Ue.call(i);return e&&(t?i[je]=n:delete i[je]),r}var Yn=Object.prototype,Zn=Yn.toString;function W(i){return Zn.call(i)}var st="[object Null]",E="[object Undefined]",ct=At?At.toStringTag:void 0;function Bt(i){return i==null?i===void 0?E:st:ct&&ct in Object(i)?Xn(i):W(i)}function ot(i){var t=typeof i;return i!=null&&(t=="object"||t=="function")}var fe="[object AsyncFunction]",at="[object Function]",Kt="[object GeneratorFunction]",Y="[object Proxy]";function X(i){if(!ot(i))return!1;var t=Bt(i);return t==at||t==Kt||t==fe||t==Y}var Qe=9007199254740991;function zt(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Qe}function ht(i){return i!=null&&zt(i.length)&&!X(i)}var We={};function Oe(){}function Ht(i){return function(){if(i!==null){var t=i;i=null,t.apply(this,arguments)}}}var Ot=typeof Symbol=="function"&&Symbol.iterator,ie=function(i){return Ot&&i[Ot]&&i[Ot]()};function ue(i,t){for(var n=-1,e=Array(i);++n<i;)e[n]=t(n);return e}function re(i){return i!=null&&typeof i=="object"}var $e="[object Arguments]";function He(i){return re(i)&&Bt(i)==$e}var Xt=Object.prototype,he=Xt.hasOwnProperty,te=Xt.propertyIsEnumerable,Ie=He((function(){return arguments})())?He:function(i){return re(i)&&he.call(i,"callee")&&!te.call(i,"callee")},Se=Array.isArray;function kn(){return!1}var hi=typeof y=="object"&&y&&!y.nodeType&&y,pi=hi&&typeof b=="object"&&b&&!b.nodeType&&b,Mr=pi&&pi.exports===hi,di=Mr?Vt.Buffer:void 0,Pr=di?di.isBuffer:void 0,Br=Pr||kn,zr=9007199254740991,Ur=/^(?:0|[1-9]\d*)$/;function jr(i,t){return t=t??zr,!!t&&(typeof i=="number"||Ur.test(i))&&i>-1&&i%1==0&&i<t}var Wr="[object Arguments]",Hr="[object Array]",qr="[object Boolean]",Gr="[object Date]",Xr="[object Error]",Yr="[object Function]",Zr="[object Map]",Vr="[object Number]",Kr="[object Object]",Jr="[object RegExp]",Qr="[object Set]",$r="[object String]",to="[object WeakMap]",eo="[object ArrayBuffer]",no="[object DataView]",io="[object Float32Array]",ro="[object Float64Array]",oo="[object Int8Array]",so="[object Int16Array]",ao="[object Int32Array]",co="[object Uint8Array]",lo="[object Uint8ClampedArray]",uo="[object Uint16Array]",fo="[object Uint32Array]",Ut={};Ut[io]=Ut[ro]=Ut[oo]=Ut[so]=Ut[ao]=Ut[co]=Ut[lo]=Ut[uo]=Ut[fo]=!0,Ut[Wr]=Ut[Hr]=Ut[eo]=Ut[qr]=Ut[no]=Ut[Gr]=Ut[Xr]=Ut[Yr]=Ut[Zr]=Ut[Vr]=Ut[Kr]=Ut[Jr]=Ut[Qr]=Ut[$r]=Ut[to]=!1;function ho(i){return re(i)&&zt(i.length)&&!!Ut[Bt(i)]}function po(i){return function(t){return i(t)}}var yi=typeof y=="object"&&y&&!y.nodeType&&y,mi=yi&&typeof b=="object"&&b&&!b.nodeType&&b,yo=mi&&mi.exports===yi,Vn=yo&&Dt.process,vi=(function(){try{return Vn&&Vn.binding&&Vn.binding("util")}catch{}})(),gi=vi&&vi.isTypedArray,mo=gi?po(gi):ho,vo=Object.prototype,go=vo.hasOwnProperty;function wo(i,t){var n=Se(i),e=!n&&Ie(i),r=!n&&!e&&Br(i),o=!n&&!e&&!r&&mo(i),s=n||e||r||o,c=s?ue(i.length,String):[],d=c.length;for(var w in i)go.call(i,w)&&!(s&&(w=="length"||r&&(w=="offset"||w=="parent")||o&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||jr(w,d)))&&c.push(w);return c}var So=Object.prototype;function Eo(i){var t=i&&i.constructor,n=typeof t=="function"&&t.prototype||So;return i===n}function _o(i,t){return function(n){return i(t(n))}}var bo=_o(Object.keys,Object),ko=Object.prototype,Io=ko.hasOwnProperty;function Fo(i){if(!Eo(i))return bo(i);var t=[];for(var n in Object(i))Io.call(i,n)&&n!="constructor"&&t.push(n);return t}function Lo(i){return ht(i)?wo(i):Fo(i)}function To(i){var t=-1,n=i.length;return function(){return++t<n?{value:i[t],key:t}:null}}function xo(i){var t=-1;return function(){var e=i.next();return e.done?null:(t++,{value:e.value,key:t})}}function Ro(i){var t=Lo(i),n=-1,e=t.length;return function(){var o=t[++n];return n<e?{value:i[o],key:o}:null}}function Oo(i){if(ht(i))return To(i);var t=ie(i);return t?xo(t):Ro(i)}function wi(i){return function(){if(i===null)throw new Error("Callback was already called.");var t=i;i=null,t.apply(this,arguments)}}function Si(i){return function(t,n,e){if(e=Ht(e||Oe),i<=0||!t)return e(null);var r=Oo(t),o=!1,s=0;function c(w,N){if(s-=1,w)o=!0,e(w);else{if(N===We||o&&s<=0)return o=!0,e(null);d()}}function d(){for(;s<i&&!o;){var w=r();if(w===null){o=!0,s<=0&&e(null);return}s+=1,n(w.value,w.key,wi(c))}}d()}}function Ei(i,t,n,e){Si(t)(i,n,e)}function Kn(i,t){return function(n,e,r){return i(n,t,e,r)}}function No(i,t,n){n=Ht(n||Oe);var e=0,r=0,o=i.length;o===0&&n(null);function s(c,d){c?n(c):(++r===o||d===We)&&n(null)}for(;e<o;e++)t(i[e],e,wi(s))}var Do=Kn(Ei,1/0),_i=function(i,t,n){var e=ht(i)?No:Do;e(i,t,n)};function Co(i){return function(t,n,e){return i(_i,t,n,e)}}function bi(i,t,n,e){e=e||Oe,t=t||[];var r=[],o=0;i(t,function(s,c,d){var w=o++;n(s,function(N,M){r[w]=M,d(N)})},function(s){e(s,r)})}var Ao=Co(bi);Tt(Ao);function Mo(i){return function(t,n,e,r){return i(Si(n),t,e,r)}}var Po=Mo(bi),Bo=Kn(Po,1);Tt(Bo),G(function(i,t){return G(function(n){return i.apply(null,t.concat(n))})});function zo(i,t){for(var n=-1,e=i==null?0:i.length;++n<e&&t(i[n],n,i)!==!1;);return i}var ki=typeof setImmediate=="function"&&setImmediate,Ii=typeof F=="object"&&typeof F.nextTick=="function";function Fi(i){setTimeout(i,0)}function Li(i){return G(function(t,n){i(function(){t.apply(null,n)})})}var In;ki?In=setImmediate:Ii?In=F.nextTick:In=Fi,Li(In);var Uo=Kn(Ei,1);function jo(i,t,n,e){e=Ht(e||Oe),Uo(i,function(r,o,s){n(t,r,function(c,d){t=d,s(c)})},function(r){e(r,t)})}var Wo=G(function(t){return G(function(n){var e=this,r=n[n.length-1];typeof r=="function"?n.pop():r=Oe,jo(t,n,function(o,s,c){s.apply(e,o.concat(G(function(d,w){c(d,w)})))},function(o,s){r.apply(e,[o].concat(s))})})});G(function(i){return Wo.apply(null,i.reverse())}),G(function(i){var t=[null].concat(i);return V(function(n,e){return e.apply(this,t)})});function Ti(i){return G(function(t,n){t.apply(null,n.concat(G(function(e,r){typeof console=="object"&&(e?console.error&&console.error(e):console[i]&&zo(r,function(o){console[i](o)}))})))})}Ti("dir");function Ho(i){return function(t,n,e){return i(t,e)}}function xi(i,t,n){_i(i,Ho(t),n)}Ti("log");var Fn;Ii?Fn=F.nextTick:ki?Fn=setImmediate:Fn=Fi,Li(Fn);var pe;function qo(){pe||(pe={},pe[Dropbox.ApiError.NETWORK_ERROR]=a.EIO,pe[Dropbox.ApiError.INVALID_PARAM]=a.EINVAL,pe[Dropbox.ApiError.INVALID_TOKEN]=a.EPERM,pe[Dropbox.ApiError.OAUTH_ERROR]=a.EPERM,pe[Dropbox.ApiError.NOT_FOUND]=a.ENOENT,pe[Dropbox.ApiError.INVALID_METHOD]=a.EINVAL,pe[Dropbox.ApiError.NOT_ACCEPTABLE]=a.EINVAL,pe[Dropbox.ApiError.CONFLICT]=a.EINVAL,pe[Dropbox.ApiError.RATE_LIMITED]=a.EBUSY,pe[Dropbox.ApiError.SERVER_ERROR]=a.EBUSY,pe[Dropbox.ApiError.OVER_QUOTA]=a.ENOSPC)}function Go(i){return i&&i.stat.isFile}function Xo(i){return i&&i.stat.isFolder}function Yo(i){return i==null||typeof i=="object"&&typeof i.byteLength=="number"}var se=function(t){this._cache={},this._client=t};se.prototype.readdir=function(t,n){var e=this,r=this.getCachedDirInfo(t);this._wrap(function(o){r!==null&&r.contents?e._client.readdir(t,{contentHash:r.stat.contentHash},o):e._client.readdir(t,o)},function(o,s,c,d){o?o.status===Dropbox.ApiError.NO_CONTENT&&r!==null?n(null,r.contents.slice(0)):n(o):(e.updateCachedDirInfo(t,c,s.slice(0)),d.forEach(function(w){e.updateCachedInfo(m.join(t,w.name),w)}),n(null,s))})},se.prototype.remove=function(t,n){var e=this;this._wrap(function(r){e._client.remove(t,r)},function(r,o){r||e.updateCachedInfo(t,o),n(r)})},se.prototype.move=function(t,n,e){var r=this;this._wrap(function(o){r._client.move(t,n,o)},function(o,s){o||(r.deleteCachedInfo(t),r.updateCachedInfo(n,s)),e(o)})},se.prototype.stat=function(t,n){var e=this;this._wrap(function(r){e._client.stat(t,r)},function(r,o){r||e.updateCachedInfo(t,o),n(r,o)})},se.prototype.readFile=function(t,n){var e=this,r=this.getCachedFileInfo(t);r!==null&&r.contents!==null?this.stat(t,function(o,s){o?n(o):s.contentHash===r.stat.contentHash?n(o,r.contents.slice(0),r.stat):e.readFile(t,n)}):this._wrap(function(o){e._client.readFile(t,{arrayBuffer:!0},o)},function(o,s,c){o||e.updateCachedInfo(t,c,s.slice(0)),n(o,s,c)})},se.prototype.writeFile=function(t,n,e){var r=this;this._wrap(function(o){r._client.writeFile(t,n,o)},function(o,s){o||r.updateCachedInfo(t,s,n.slice(0)),e(o,s)})},se.prototype.mkdir=function(t,n){var e=this;this._wrap(function(r){e._client.mkdir(t,r)},function(r,o){r||e.updateCachedInfo(t,o,[]),n(r)})},se.prototype._wrap=function(t,n){var e=0,r=function(o){var s=2;if(o&&3>++e)switch(o.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout(function(){t(r)},s*1e3);break;default:n.apply(null,arguments);break}else n.apply(null,arguments)};t(r)},se.prototype.getCachedInfo=function(t){return this._cache[t.toLowerCase()]},se.prototype.putCachedInfo=function(t,n){this._cache[t.toLowerCase()]=n},se.prototype.deleteCachedInfo=function(t){delete this._cache[t.toLowerCase()]},se.prototype.getCachedDirInfo=function(t){var n=this.getCachedInfo(t);return Xo(n)?n:null},se.prototype.getCachedFileInfo=function(t){var n=this.getCachedInfo(t);return Go(n)?n:null},se.prototype.updateCachedDirInfo=function(t,n,e){e===void 0&&(e=null);var r=this.getCachedInfo(t);n.contentHash!==null&&(r===void 0||r.stat.contentHash!==n.contentHash)&&this.putCachedInfo(t,{stat:n,contents:e})},se.prototype.updateCachedFileInfo=function(t,n,e){e===void 0&&(e=null);var r=this.getCachedInfo(t);n.versionTag!==null&&(r===void 0||r.stat.versionTag!==n.versionTag)&&this.putCachedInfo(t,{stat:n,contents:e})},se.prototype.updateCachedInfo=function(t,n,e){e===void 0&&(e=null),n.isFile&&Yo(e)?this.updateCachedFileInfo(t,n,e):n.isFolder&&Array.isArray(e)&&this.updateCachedDirInfo(t,n,e)};var Zo=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var r=this;if(this.isDirty()){var o=this.getBuffer(),s=J(o);this._fs._writeFileStrict(this.getPath(),s,function(c){c||r.resetDirty(),e(c)})}else e()},t.prototype.close=function(e){this.sync(e)},t})(oe),Ln=(function(i){function t(n,e){e===void 0&&(e=!0),i.call(this),this._client=new se(n),Lt(e,t.Name,{client:"authenticated dropbox client instance"}),qo()}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){r(null,new t(e.client,!1))},t.isAvailable=function(){return typeof Dropbox<"u"},t.prototype.getName=function(){return t.Name},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!1},t.prototype.empty=function(e){var r=this;this._client.readdir("/",function(o,s){if(o)e(r.convert(o,"/"));else{var c=function(w,N){var M=m.join("/",w);r._client.remove(M,function(q){N(q?r.convert(q,M):null)})},d=function(w){w?e(w):e()};xi(s,c,d)}})},t.prototype.rename=function(e,r,o){var s=this;this._client.move(e,r,function(c){c?s._client.stat(r,function(d,w){if(d||w.isFolder){var N=c.response.error.indexOf(e)>-1?e:r;o(s.convert(c,N))}else s._client.remove(r,function(M){M?o(s.convert(M,r)):s.rename(e,r,o)})}):o()})},t.prototype.stat=function(e,r,o){var s=this;this._client.stat(e,function(c,d){if(c)o(s.convert(c,e));else if(d&&d.isRemoved)o(u.FileError(a.ENOENT,e));else{var w=new A(s._statType(d),d.size);return o(null,w)}})},t.prototype.open=function(e,r,o,s){var c=this;this._client.readFile(e,function(d,w,N){if(d)if(r.isReadable())s(c.convert(d,e));else if(d.status===Dropbox.ApiError.NOT_FOUND){var M=new ArrayBuffer(0);return c._writeFileStrict(e,M,function(nt,ut){if(nt)s(nt);else{var yt=c._makeFile(e,r,ut,_t(M));s(null,yt)}})}else return s(c.convert(d,e));else{var q;w===null?q=Mt():q=_t(w);var $=c._makeFile(e,r,N,q);return s(null,$)}})},t.prototype._writeFileStrict=function(e,r,o){var s=this,c=m.dirname(e);this.stat(c,!1,function(d,w){d?o(u.FileError(a.ENOENT,c)):s._client.writeFile(e,r,function(N,M){N?o(s.convert(N,e)):o(null,M)})})},t.prototype._statType=function(e){return e.isFile?C.FILE:C.DIRECTORY},t.prototype._makeFile=function(e,r,o,s){var c=this._statType(o),d=new A(c,o.size);return new Zo(this,e,r,d,s)},t.prototype._remove=function(e,r,o){var s=this;this._client.stat(e,function(c,d){c?r(s.convert(c,e)):d.isFile&&!o?r(u.FileError(a.ENOTDIR,e)):!d.isFile&&o?r(u.FileError(a.EISDIR,e)):s._client.remove(e,function(w){r(w?s.convert(w,e):null)})})},t.prototype.unlink=function(e,r){this._remove(e,r,!0)},t.prototype.rmdir=function(e,r){this._remove(e,r,!1)},t.prototype.mkdir=function(e,r,o){var s=this,c=m.dirname(e);this._client.stat(c,function(d,w){d?o(s.convert(d,c)):s._client.mkdir(e,function(N){o(N?u.FileError(a.EEXIST,e):null)})})},t.prototype.readdir=function(e,r){var o=this;this._client.readdir(e,function(s,c){return s?r(o.convert(s)):r(null,c)})},t.prototype.convert=function(e,r){r===void 0&&(r=null);var o=pe[e.status];return o===void 0&&(o=a.EIO),r?u.FileError(o,r):new u(o)},t})(Q);Ln.Name="Dropbox",Ln.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(i,t){i.isAuthenticated&&i.isAuthenticated()?t():t(new u(a.EINVAL,"'client' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}};function Yt(i,t){t===void 0&&(t="");for(var n=i.errno,e=i.node,r=[];e&&(r.unshift(e.name),e!==e.parent);)e=e.parent;return new u(n,_[n],r.length>0?"/"+r.join("/"):t)}var Vo=(function(i){function t(n,e,r,o){i.call(this),this._fs=n,this._FS=e,this._path=r,this._stream=o}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.getPos=function(){},t.prototype.close=function(e){var r=null;try{this.closeSync()}catch(o){r=o}finally{e(r)}},t.prototype.closeSync=function(){try{this._FS.close(this._stream)}catch(e){throw Yt(e,this._path)}},t.prototype.stat=function(e){try{e(null,this.statSync())}catch(r){e(r)}},t.prototype.statSync=function(){try{return this._fs.statSync(this._path,!1)}catch(e){throw Yt(e,this._path)}},t.prototype.truncate=function(e,r){var o=null;try{this.truncateSync(e)}catch(s){o=s}finally{r(o)}},t.prototype.truncateSync=function(e){try{this._FS.ftruncate(this._stream.fd,e)}catch(r){throw Yt(r,this._path)}},t.prototype.write=function(e,r,o,s,c){try{c(null,this.writeSync(e,r,o,s),e)}catch(d){c(d)}},t.prototype.writeSync=function(e,r,o,s){try{var c=ft(e),d=s===null?void 0:s;return this._FS.write(this._stream,c,r,o,d)}catch(w){throw Yt(w,this._path)}},t.prototype.read=function(e,r,o,s,c){try{c(null,this.readSync(e,r,o,s),e)}catch(d){c(d)}},t.prototype.readSync=function(e,r,o,s){try{var c=ft(e),d=s===null?void 0:s;return this._FS.read(this._stream,c,r,o,d)}catch(w){throw Yt(w,this._path)}},t.prototype.sync=function(e){e()},t.prototype.syncSync=function(){},t.prototype.chown=function(e,r,o){var s=null;try{this.chownSync(e,r)}catch(c){s=c}finally{o(s)}},t.prototype.chownSync=function(e,r){try{this._FS.fchown(this._stream.fd,e,r)}catch(o){throw Yt(o,this._path)}},t.prototype.chmod=function(e,r){var o=null;try{this.chmodSync(e)}catch(s){o=s}finally{r(o)}},t.prototype.chmodSync=function(e){try{this._FS.fchmod(this._stream.fd,e)}catch(r){throw Yt(r,this._path)}},t.prototype.utimes=function(e,r,o){var s=null;try{this.utimesSync(e,r)}catch(c){s=c}finally{o(s)}},t.prototype.utimesSync=function(e,r){this._fs.utimesSync(this._path,e,r)},t})(vt),Tn=(function(i){function t(n){i.call(this),this._FS=n}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){r(null,new t(e.FS))},t.isAvailable=function(){return!0},t.prototype.getName=function(){return this._FS.DB_NAME()},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsLinks=function(){return!0},t.prototype.supportsProps=function(){return!0},t.prototype.supportsSynch=function(){return!0},t.prototype.renameSync=function(e,r){try{this._FS.rename(e,r)}catch(o){throw o.errno===a.ENOENT?Yt(o,this.existsSync(e)?r:e):Yt(o)}},t.prototype.statSync=function(e,r){try{var o=r?this._FS.lstat(e):this._FS.stat(e),s=this.modeToFileType(o.mode);return new A(s,o.size,o.mode,o.atime,o.mtime,o.ctime)}catch(c){throw Yt(c,e)}},t.prototype.openSync=function(e,r,o){try{var s=this._FS.open(e,r.getFlagString(),o);if(this._FS.isDir(s.node.mode))throw this._FS.close(s),u.EISDIR(e);return new Vo(this,this._FS,e,s)}catch(c){throw Yt(c,e)}},t.prototype.unlinkSync=function(e){try{this._FS.unlink(e)}catch(r){throw Yt(r,e)}},t.prototype.rmdirSync=function(e){try{this._FS.rmdir(e)}catch(r){throw Yt(r,e)}},t.prototype.mkdirSync=function(e,r){try{this._FS.mkdir(e,r)}catch(o){throw Yt(o,e)}},t.prototype.readdirSync=function(e){try{return this._FS.readdir(e).filter(function(r){return r!=="."&&r!==".."})}catch(r){throw Yt(r,e)}},t.prototype.truncateSync=function(e,r){try{this._FS.truncate(e,r)}catch(o){throw Yt(o,e)}},t.prototype.readFileSync=function(e,r,o){try{var s=this._FS.readFile(e,{flags:o.getFlagString()}),c=gt(s);return r?c.toString(r):c}catch(d){throw Yt(d,e)}},t.prototype.writeFileSync=function(e,r,o,s,c){try{o&&(r=g.from(r,o));var d=ft(r);this._FS.writeFile(e,d,{flags:s.getFlagString(),encoding:"binary"}),this._FS.chmod(e,c)}catch(w){throw Yt(w,e)}},t.prototype.chmodSync=function(e,r,o){try{r?this._FS.lchmod(e,o):this._FS.chmod(e,o)}catch(s){throw Yt(s,e)}},t.prototype.chownSync=function(e,r,o,s){try{r?this._FS.lchown(e,o,s):this._FS.chown(e,o,s)}catch(c){throw Yt(c,e)}},t.prototype.symlinkSync=function(e,r,o){try{this._FS.symlink(e,r)}catch(s){throw Yt(s)}},t.prototype.readlinkSync=function(e){try{return this._FS.readlink(e)}catch(r){throw Yt(r,e)}},t.prototype.utimesSync=function(e,r,o){try{this._FS.utime(e,r.getTime(),o.getTime())}catch(s){throw Yt(s,e)}},t.prototype.modeToFileType=function(e){if(this._FS.isDir(e))return C.DIRECTORY;if(this._FS.isFile(e))return C.FILE;if(this._FS.isLink(e))return C.SYMLINK;throw u.EPERM("Invalid mode: "+e)},t})(ne);Tn.Name="EmscriptenFileSystem",Tn.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var tn=(function(i){function t(n,e){i.call(this),this._folder=n,this._wrapped=e}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){r(null,new t(e.folder,e.wrapped))},t.isAvailable=function(){return!0},t.prototype.initialize=function(e){var r=this;this._wrapped.exists(this._folder,function(o){o?e():r._wrapped.isReadOnly()?e(u.ENOENT(r._folder)):r._wrapped.mkdir(r._folder,511,e)})},t.prototype.getName=function(){return this._wrapped.getName()},t.prototype.isReadOnly=function(){return this._wrapped.isReadOnly()},t.prototype.supportsProps=function(){return this._wrapped.supportsProps()},t.prototype.supportsSynch=function(){return this._wrapped.supportsSynch()},t.prototype.supportsLinks=function(){return!1},t})(Q);tn.Name="FolderAdapter",tn.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}};function Ri(i,t){if(t!==null&&typeof t=="object"){var n=t,e=n.path;e&&(e="/"+m.relative(i,e),n.message=n.message.replace(n.path,e),n.path=e)}return t}function Ko(i,t){return typeof t=="function"?function(n){arguments.length>0&&(arguments[0]=Ri(i,n)),t.apply(null,arguments)}:t}function Oi(i,t,n){return i.slice(i.length-4)!=="Sync"?function(){return arguments.length>0&&(arguments[0]=m.join(this._folder,arguments[0]),n&&(arguments[1]=m.join(this._folder,arguments[1])),arguments[arguments.length-1]=Ko(this._folder,arguments[arguments.length-1])),this._wrapped[i].apply(this._wrapped,arguments)}:function(){try{return t&&(arguments[0]=m.join(this._folder,arguments[0])),n&&(arguments[1]=m.join(this._folder,arguments[1])),this._wrapped[i].apply(this._wrapped,arguments)}catch(e){throw Ri(this._folder,e)}}}["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(function(i){tn.prototype[i]=Oi(i,!0,!1)}),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(function(i){tn.prototype[i]=Oi(i,!0,!0)});var xn;typeof window<"u"?xn=window:typeof self<"u"?xn=self:xn=x;var Jt=xn;function Jo(i){return i.isDirectory}var Jn=Jt.webkitRequestFileSystem||Jt.requestFileSystem||null;function Qo(i,t,n,e){if(typeof navigator.webkitPersistentStorage<"u")switch(i){case Jt.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(t,n,e);break;case Jt.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(t,n,e);break;default:e(new TypeError("Invalid storage type: "+i));break}else Jt.webkitStorageInfo.requestQuota(i,t,n,e)}function $o(i){return Array.prototype.slice.call(i||[],0)}function Fe(i,t,n){switch(i.name){case"PathExistsError":return u.EEXIST(t);case"QuotaExceededError":return u.FileError(a.ENOSPC,t);case"NotFoundError":return u.ENOENT(t);case"SecurityError":return u.FileError(a.EACCES,t);case"InvalidModificationError":return u.FileError(a.EPERM,t);case"TypeMismatchError":return u.FileError(n?a.ENOTDIR:a.EISDIR,t);default:return u.FileError(a.EINVAL,t)}}var ts=(function(i){function t(n,e,r,o,s,c){i.call(this,n,r,o,s,c),this._entry=e}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var r=this;if(!this.isDirty())return e();this._entry.createWriter(function(o){var s=r.getBuffer(),c=new Blob([J(s)]),d=c.size;o.onwriteend=function(w){o.onwriteend=null,o.onerror=null,o.truncate(d),r.resetDirty(),e()},o.onerror=function(w){e(Fe(w,r.getPath(),!1))},o.write(c)})},t.prototype.close=function(e){this.sync(e)},t})(oe),Rn=(function(i){function t(n,e,r){n===void 0&&(n=5),e===void 0&&(e=Jt.PERSISTENT),r===void 0&&(r=!0),i.call(this),this.size=1024*1024*n,this.type=e,Lt(r,t.Name,{size:n,type:e})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){var o=new t(e.size,e.type,!1);o.allocate(function(s){return s?r(s):r(null,o)},!1)},t.isAvailable=function(){return!!Jn},t.prototype.getName=function(){return t.Name},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!1},t.prototype.allocate=function(e,r){var o=this;e===void 0&&(e=function(){}),r===void 0&&(r=!0),r&&console.warn("[HTML5FS] HTML5FS.allocate() is deprecated and will be removed in the next major release. Please use 'HTML5FS.Create({type: "+this.type+", size: "+this.size+"}, cb)' to create and allocate HTML5FS instances.");var s=function(d){o.fs=d,e()},c=function(d){e(Fe(d,"/",!0))};this.type===Jt.PERSISTENT?Qo(this.type,this.size,function(d){Jn(o.type,d,s,c)},c):Jn(this.type,this.size,s,c)},t.prototype.empty=function(e){this._readdir("/",function(r,o){if(r)console.error("Failed to empty FS"),e(r);else{var s=function(d){r?(console.error("Failed to empty FS"),e(r)):e()},c=function(d,w){var N=function(){w()},M=function(q){w(Fe(q,d.fullPath,!d.isDirectory))};Jo(d)?d.removeRecursively(N,M):d.remove(N,M)};xi(o,c,s)}})},t.prototype.rename=function(e,r,o){var s=this,c=2,d=0,w=this.fs.root,N=e,M=function($){--c<=0&&o(Fe($,N,!1))},q=function($){if(++d===2)return o(new u(a.EINVAL,"Something was identified as both a file and a directory. This should never happen."));if(e===r)return o();N=m.dirname(r),w.getDirectory(N,{},function(nt){N=m.basename(r),$.moveTo(nt,N,function(ut){o()},function(ut){$.isDirectory?(N=r,s.unlink(r,function(yt){yt?M(ut):s.rename(e,r,o)})):M(ut)})},M)};w.getFile(e,{},q,M),w.getDirectory(e,{},q,M)},t.prototype.stat=function(e,r,o){var s=this,c={create:!1},d=function(q){var $=function(nt){var ut=new A(C.FILE,nt.size);o(null,ut)};q.file($,N)},w=function(q){var $=4096,nt=new A(C.DIRECTORY,$);o(null,nt)},N=function(q){o(Fe(q,e,!1))},M=function(){s.fs.root.getDirectory(e,c,w,N)};this.fs.root.getFile(e,c,d,M)},t.prototype.open=function(e,r,o,s){var c=this,d=function(w){w.name==="InvalidModificationError"&&r.isExclusive()?s(u.EEXIST(e)):s(Fe(w,e,!1))};this.fs.root.getFile(e,{create:r.pathNotExistsAction()===L.CREATE_FILE,exclusive:r.isExclusive()},function(w){w.file(function(N){var M=new FileReader;M.onloadend=function(q){var $=c._makeFile(e,w,r,N,M.result);s(null,$)},M.onerror=function(q){d(M.error)},M.readAsArrayBuffer(N)},d)},d)},t.prototype.unlink=function(e,r){this._remove(e,r,!0)},t.prototype.rmdir=function(e,r){var o=this;this.readdir(e,function(s,c){s?r(s):c.length>0?r(u.ENOTEMPTY(e)):o._remove(e,r,!1)})},t.prototype.mkdir=function(e,r,o){var s={create:!0,exclusive:!0},c=function(w){o()},d=function(w){o(Fe(w,e,!0))};this.fs.root.getDirectory(e,s,c,d)},t.prototype.readdir=function(e,r){this._readdir(e,function(o,s){if(s){for(var c=[],d=0,w=s;d<w.length;d+=1){var N=w[d];c.push(N.name)}r(null,c)}else return r(o)})},t.prototype._makeFile=function(e,r,o,s,c){c===void 0&&(c=new ArrayBuffer(0));var d=new A(C.FILE,s.size),w=_t(c);return new ts(this,r,e,o,d,w)},t.prototype._readdir=function(e,r){var o=function(s){r(Fe(s,e,!0))};this.fs.root.getDirectory(e,{create:!1},function(s){var c=s.createReader(),d=[],w=function(){c.readEntries((function(N){N.length?(d=d.concat($o(N)),w()):r(null,d)}),o)};w()},o)},t.prototype._remove=function(e,r,o){var s=function(w){var N=function(){r()},M=function(q){r(Fe(q,e,!o))};w.remove(N,M)},c=function(w){r(Fe(w,e,!o))},d={create:!1};o?this.fs.root.getFile(e,d,s,c):this.fs.root.getDirectory(e,d,s,c)},t})(Q);Rn.Name="HTML5FS",Rn.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var de=function(t,n,e,r,o,s){this.id=t,this.size=n,this.mode=e,this.atime=r,this.mtime=o,this.ctime=s};de.fromBuffer=function(t){if(t===void 0)throw new Error("NO");return new de(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))},de.prototype.toStats=function(){return new A((this.mode&61440)===C.DIRECTORY?C.DIRECTORY:C.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},de.prototype.getSize=function(){return 30+this.id.length},de.prototype.toBuffer=function(t){return t===void 0&&(t=g.alloc(this.getSize())),t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t},de.prototype.update=function(t){var n=!1;this.size!==t.size&&(this.size=t.size,n=!0),this.mode!==t.mode&&(this.mode=t.mode,n=!0);var e=t.atime.getTime();this.atime!==e&&(this.atime=e,n=!0);var r=t.mtime.getTime();this.mtime!==r&&(this.mtime=r,n=!0);var o=t.ctime.getTime();return this.ctime!==o&&(this.ctime=o,n=!0),n},de.prototype.isFile=function(){return(this.mode&61440)===C.FILE},de.prototype.isDirectory=function(){return(this.mode&61440)===C.DIRECTORY};var Pe="/",Qn=null;function Ni(){return Qn||(Qn=g.from("{}"))}function On(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=Math.random()*16|0,n=i==="x"?t:t&3|8;return n.toString(16)})}function ve(i,t){return i?(t(i),!1):!0}function $t(i,t,n){return i?(t.abort(function(){n(i)}),!1):!0}var Ne=function(t){this.store=t,this.originalData={},this.modifiedKeys=[]};Ne.prototype.get=function(t){var n=this.store.get(t);return this.stashOldValue(t,n),n},Ne.prototype.put=function(t,n,e){return this.markModified(t),this.store.put(t,n,e)},Ne.prototype.del=function(t){this.markModified(t),this.store.del(t)},Ne.prototype.commit=function(){},Ne.prototype.abort=function(){for(var t=this,n=0,e=t.modifiedKeys;n<e.length;n+=1){var r=e[n],o=t.originalData[r];o?t.store.put(r,o,!0):t.store.del(r)}},Ne.prototype.stashOldValue=function(t,n){this.originalData.hasOwnProperty(t)||(this.originalData[t]=n)},Ne.prototype.markModified=function(t){this.modifiedKeys.indexOf(t)===-1&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))};var Di=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},t.prototype.closeSync=function(){this.syncSync()},t})(oe),Ci=(function(i){function t(n){i.call(this),this.store=n.store,this.makeRootDirectory()}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.isAvailable=function(){return!0},t.prototype.getName=function(){return this.store.name()},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},t.prototype.renameSync=function(e,r){var o=this.store.beginTransaction("readwrite"),s=m.dirname(e),c=m.basename(e),d=m.dirname(r),w=m.basename(r),N=this.findINode(o,s),M=this.getDirListing(o,s,N);if(!M[c])throw u.ENOENT(e);var q=M[c];if(delete M[c],(d+"/").indexOf(e+"/")===0)throw new u(a.EBUSY,s);var $,nt;if(d===s?($=N,nt=M):($=this.findINode(o,d),nt=this.getDirListing(o,d,$)),nt[w]){var ut=this.getINode(o,r,nt[w]);if(ut.isFile())try{o.del(ut.id),o.del(nt[w])}catch(yt){throw o.abort(),yt}else throw u.EPERM(r)}nt[w]=q;try{o.put(N.id,g.from(JSON.stringify(M)),!0),o.put($.id,g.from(JSON.stringify(nt)),!0)}catch(yt){throw o.abort(),yt}o.commit()},t.prototype.statSync=function(e,r){return this.findINode(this.store.beginTransaction("readonly"),e).toStats()},t.prototype.createFileSync=function(e,r,o){var s=this.store.beginTransaction("readwrite"),c=Mt(),d=this.commitNewFile(s,e,C.FILE,o,c);return new Di(this,e,r,d.toStats(),c)},t.prototype.openFileSync=function(e,r){var o=this.store.beginTransaction("readonly"),s=this.findINode(o,e),c=o.get(s.id);if(c===void 0)throw u.ENOENT(e);return new Di(this,e,r,s.toStats(),c)},t.prototype.unlinkSync=function(e){this.removeEntry(e,!1)},t.prototype.rmdirSync=function(e){if(this.readdirSync(e).length>0)throw u.ENOTEMPTY(e);this.removeEntry(e,!0)},t.prototype.mkdirSync=function(e,r){var o=this.store.beginTransaction("readwrite"),s=g.from("{}");this.commitNewFile(o,e,C.DIRECTORY,r,s)},t.prototype.readdirSync=function(e){var r=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(r,e,this.findINode(r,e)))},t.prototype._syncSync=function(e,r,o){var s=this.store.beginTransaction("readwrite"),c=this._findINode(s,m.dirname(e),m.basename(e)),d=this.getINode(s,e,c),w=d.update(o);try{s.put(d.id,r,!0),w&&s.put(c,d.toBuffer(),!0)}catch(N){throw s.abort(),N}s.commit()},t.prototype.makeRootDirectory=function(){var e=this.store.beginTransaction("readwrite");if(e.get(Pe)===void 0){var r=new Date().getTime(),o=new de(On(),4096,511|C.DIRECTORY,r,r,r);e.put(o.id,Ni(),!1),e.put(Pe,o.toBuffer(),!1),e.commit()}},t.prototype._findINode=function(e,r,o){var s=this,c=function(d){var w=s.getDirListing(e,r,d);if(w[o])return w[o];throw u.ENOENT(m.resolve(r,o))};return r==="/"?o===""?Pe:c(this.getINode(e,r,Pe)):c(this.getINode(e,r+m.sep+o,this._findINode(e,m.dirname(r),m.basename(r))))},t.prototype.findINode=function(e,r){return this.getINode(e,r,this._findINode(e,m.dirname(r),m.basename(r)))},t.prototype.getINode=function(e,r,o){var s=e.get(o);if(s===void 0)throw u.ENOENT(r);return de.fromBuffer(s)},t.prototype.getDirListing=function(e,r,o){if(!o.isDirectory())throw u.ENOTDIR(r);var s=e.get(o.id);if(s===void 0)throw u.ENOENT(r);return JSON.parse(s.toString())},t.prototype.addNewNode=function(e,r){for(var o=0,s;o<5;)try{return s=On(),e.put(s,r,!1),s}catch{}throw new u(a.EIO,"Unable to commit data to key-value store.")},t.prototype.commitNewFile=function(e,r,o,s,c){var d=m.dirname(r),w=m.basename(r),N=this.findINode(e,d),M=this.getDirListing(e,d,N),q=new Date().getTime();if(r==="/"||M[w])throw u.EEXIST(r);var $;try{var nt=this.addNewNode(e,c);$=new de(nt,c.length,s|o,q,q,q);var ut=this.addNewNode(e,$.toBuffer());M[w]=ut,e.put(N.id,g.from(JSON.stringify(M)),!0)}catch(yt){throw e.abort(),yt}return e.commit(),$},t.prototype.removeEntry=function(e,r){var o=this.store.beginTransaction("readwrite"),s=m.dirname(e),c=this.findINode(o,s),d=this.getDirListing(o,s,c),w=m.basename(e);if(!d[w])throw u.ENOENT(e);var N=d[w];delete d[w];var M=this.getINode(o,e,N);if(!r&&M.isDirectory())throw u.EISDIR(e);if(r&&!M.isDirectory())throw u.ENOTDIR(e);try{o.del(M.id),o.del(N),o.put(c.id,g.from(JSON.stringify(d)),!0)}catch(q){throw o.abort(),q}o.commit()},t})(ne),Ai=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var r=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(o){o||r.resetDirty(),e(o)}):e()},t.prototype.close=function(e){this.sync(e)},t})(oe),es=(function(i){function t(){i.apply(this,arguments)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.isAvailable=function(){return!0},t.prototype.init=function(e,r){this.store=e,this.makeRootDirectory(r)},t.prototype.getName=function(){return this.store.name()},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!1},t.prototype.empty=function(e){var r=this;this.store.clear(function(o){ve(o,e)&&r.makeRootDirectory(e)})},t.prototype.rename=function(e,r,o){var s=this,c=this.store.beginTransaction("readwrite"),d=m.dirname(e),w=m.basename(e),N=m.dirname(r),M=m.basename(r),q={},$={},nt=!1;if((N+"/").indexOf(e+"/")===0)return o(new u(a.EBUSY,d));var ut=function(){if(!(nt||!$.hasOwnProperty(d)||!$.hasOwnProperty(N))){var It=$[d],Gt=q[d],ae=$[N],xe=q[N];if(!It[w])o(u.ENOENT(e));else{var Re=It[w];delete It[w];var cn=function(){ae[M]=Re,c.put(Gt.id,g.from(JSON.stringify(It)),!0,function(Ae){$t(Ae,c,o)&&(d===N?c.commit(o):c.put(xe.id,g.from(JSON.stringify(ae)),!0,function(Me){$t(Me,c,o)&&c.commit(o)}))})};ae[M]?s.getINode(c,r,ae[M],function(Ae,Me){$t(Ae,c,o)&&(Me.isFile()?c.del(Me.id,function(_r){$t(_r,c,o)&&c.del(ae[M],function(xs){$t(xs,c,o)&&cn()})}):c.abort(function(_r){o(u.EPERM(r))}))}):cn()}}},yt=function(It){s.findINodeAndDirListing(c,It,function(Gt,ae,xe){Gt?nt||(nt=!0,c.abort(function(){o(Gt)})):(q[It]=ae,$[It]=xe,ut())})};yt(d),d!==N&&yt(N)},t.prototype.stat=function(e,r,o){var s=this.store.beginTransaction("readonly");this.findINode(s,e,function(c,d){ve(c,o)&&o(null,d.toStats())})},t.prototype.createFile=function(e,r,o,s){var c=this,d=this.store.beginTransaction("readwrite"),w=Mt();this.commitNewFile(d,e,C.FILE,o,w,function(N,M){ve(N,s)&&s(null,new Ai(c,e,r,M.toStats(),w))})},t.prototype.openFile=function(e,r,o){var s=this,c=this.store.beginTransaction("readonly");this.findINode(c,e,function(d,w){ve(d,o)&&c.get(w.id,function(N,M){ve(N,o)&&(M===void 0?o(u.ENOENT(e)):o(null,new Ai(s,e,r,w.toStats(),M)))})})},t.prototype.unlink=function(e,r){this.removeEntry(e,!1,r)},t.prototype.rmdir=function(e,r){var o=this;this.readdir(e,function(s,c){s?r(s):c.length>0?r(u.ENOTEMPTY(e)):o.removeEntry(e,!0,r)})},t.prototype.mkdir=function(e,r,o){var s=this.store.beginTransaction("readwrite"),c=g.from("{}");this.commitNewFile(s,e,C.DIRECTORY,r,c,o)},t.prototype.readdir=function(e,r){var o=this,s=this.store.beginTransaction("readonly");this.findINode(s,e,function(c,d){ve(c,r)&&o.getDirListing(s,e,d,function(w,N){ve(w,r)&&r(null,Object.keys(N))})})},t.prototype._sync=function(e,r,o,s){var c=this,d=this.store.beginTransaction("readwrite");this._findINode(d,m.dirname(e),m.basename(e),function(w,N){$t(w,d,s)&&c.getINode(d,e,N,function(M,q){if($t(M,d,s)){var $=q.update(o);d.put(q.id,r,!0,function(nt){$t(nt,d,s)&&($?d.put(N,q.toBuffer(),!0,function(ut){$t(ut,d,s)&&d.commit(s)}):d.commit(s))})}})})},t.prototype.makeRootDirectory=function(e){var r=this.store.beginTransaction("readwrite");r.get(Pe,function(o,s){if(o||s===void 0){var c=new Date().getTime(),d=new de(On(),4096,511|C.DIRECTORY,c,c,c);r.put(d.id,Ni(),!1,function(w){$t(w,r,e)&&r.put(Pe,d.toBuffer(),!1,function(N){N?r.abort(function(){e(N)}):r.commit(e)})})}else r.commit(e)})},t.prototype._findINode=function(e,r,o,s){var c=this,d=function(w,N,M){w?s(w):M[o]?s(null,M[o]):s(u.ENOENT(m.resolve(r,o)))};r==="/"?o===""?s(null,Pe):this.getINode(e,r,Pe,function(w,N){ve(w,s)&&c.getDirListing(e,r,N,function(M,q){d(M,N,q)})}):this.findINodeAndDirListing(e,r,d)},t.prototype.findINode=function(e,r,o){var s=this;this._findINode(e,m.dirname(r),m.basename(r),function(c,d){ve(c,o)&&s.getINode(e,r,d,o)})},t.prototype.getINode=function(e,r,o,s){e.get(o,function(c,d){ve(c,s)&&(d===void 0?s(u.ENOENT(r)):s(null,de.fromBuffer(d)))})},t.prototype.getDirListing=function(e,r,o,s){o.isDirectory()?e.get(o.id,function(c,d){if(ve(c,s))try{s(null,JSON.parse(d.toString()))}catch{s(u.ENOENT(r))}}):s(u.ENOTDIR(r))},t.prototype.findINodeAndDirListing=function(e,r,o){var s=this;this.findINode(e,r,function(c,d){ve(c,o)&&s.getDirListing(e,r,d,function(w,N){ve(w,o)&&o(null,d,N)})})},t.prototype.addNewNode=function(e,r,o){var s=0,c,d=function(){++s===5?o(new u(a.EIO,"Unable to commit data to key-value store.")):(c=On(),e.put(c,r,!1,function(w,N){w||!N?d():o(null,c)}))};d()},t.prototype.commitNewFile=function(e,r,o,s,c,d){var w=this,N=m.dirname(r),M=m.basename(r),q=new Date().getTime();if(r==="/")return d(u.EEXIST(r));this.findINodeAndDirListing(e,N,function($,nt,ut){$t($,e,d)&&(ut[M]?e.abort(function(){d(u.EEXIST(r))}):w.addNewNode(e,c,function(yt,It){if($t(yt,e,d)){var Gt=new de(It,c.length,s|o,q,q,q);w.addNewNode(e,Gt.toBuffer(),function(ae,xe){$t(ae,e,d)&&(ut[M]=xe,e.put(nt.id,g.from(JSON.stringify(ut)),!0,function(Re){$t(Re,e,d)&&e.commit(function(cn){$t(cn,e,d)&&d(null,Gt)})}))})}}))})},t.prototype.removeEntry=function(e,r,o){var s=this,c=this.store.beginTransaction("readwrite"),d=m.dirname(e),w=m.basename(e);this.findINodeAndDirListing(c,d,function(N,M,q){if($t(N,c,o))if(!q[w])c.abort(function(){o(u.ENOENT(e))});else{var $=q[w];delete q[w],s.getINode(c,e,$,function(nt,ut){$t(nt,c,o)&&(!r&&ut.isDirectory()?c.abort(function(){o(u.EISDIR(e))}):r&&!ut.isDirectory()?c.abort(function(){o(u.ENOTDIR(e))}):c.del(ut.id,function(yt){$t(yt,c,o)&&c.del($,function(It){$t(It,c,o)&&c.put(M.id,g.from(JSON.stringify(q)),!0,function(Gt){$t(Gt,c,o)&&c.commit(o)})})}))})}})},t})(Q),qe=function(){this.store={}};qe.prototype.name=function(){return en.Name},qe.prototype.clear=function(){this.store={}},qe.prototype.beginTransaction=function(t){return new Ne(this)},qe.prototype.get=function(t){return this.store[t]},qe.prototype.put=function(t,n,e){return!e&&this.store.hasOwnProperty(t)?!1:(this.store[t]=n,!0)},qe.prototype.del=function(t){delete this.store[t]};var en=(function(i){function t(){i.call(this,{store:new qe})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){r(null,new t)},t})(Ci);en.Name="InMemory",en.Options={};var $n=Jt.indexedDB||Jt.mozIndexedDB||Jt.webkitIndexedDB||Jt.msIndexedDB;function fn(i,t){switch(t===void 0&&(t=i.toString()),i.name){case"NotFoundError":return new u(a.ENOENT,t);case"QuotaExceededError":return new u(a.ENOSPC,t);default:return new u(a.EIO,t)}}function hn(i,t,n){return t===void 0&&(t=a.EIO),n===void 0&&(n=null),function(e){e.preventDefault(),i(new u(t,n!==null?n:void 0))}}var ti=function(t,n){this.tx=t,this.store=n};ti.prototype.get=function(t,n){try{var e=this.store.get(t);e.onerror=hn(n),e.onsuccess=function(r){var o=r.target.result;o===void 0?n(null,o):n(null,_t(o))}}catch(r){n(fn(r))}};var ns=(function(i){function t(n,e){i.call(this,n,e)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.put=function(e,r,o,s){try{var c=J(r),d;o?d=this.store.put(c,e):d=this.store.add(c,e),d.onerror=hn(s),d.onsuccess=function(w){s(null,!0)}}catch(w){s(fn(w))}},t.prototype.del=function(e,r){try{var o=this.store.delete(e);o.onerror=hn(r),o.onsuccess=function(s){r()}}catch(s){r(fn(s))}},t.prototype.commit=function(e){setTimeout(e,0)},t.prototype.abort=function(e){var r=null;try{this.tx.abort()}catch(o){r=fn(o)}finally{e(r)}},t})(ti),Nn=function(t,n){var e=this;n===void 0&&(n="browserfs"),this.storeName=n;var r=$n.open(this.storeName,1);r.onupgradeneeded=function(o){var s=o.target.result;s.objectStoreNames.contains(e.storeName)&&s.deleteObjectStore(e.storeName),s.createObjectStore(e.storeName)},r.onsuccess=function(o){e.db=o.target.result,t(null,e)},r.onerror=hn(t,a.EACCES)};Nn.prototype.name=function(){return pn.Name+" - "+this.storeName},Nn.prototype.clear=function(t){try{var n=this.db.transaction(this.storeName,"readwrite"),e=n.objectStore(this.storeName),r=e.clear();r.onsuccess=function(o){setTimeout(t,0)},r.onerror=hn(t)}catch(o){t(fn(o))}},Nn.prototype.beginTransaction=function(t){t===void 0&&(t="readonly");var n=this.db.transaction(this.storeName,t),e=n.objectStore(this.storeName);if(t==="readwrite")return new ns(n,e);if(t==="readonly")return new ti(n,e);throw new u(a.EINVAL,"Invalid transaction type.")};var pn=(function(i){function t(n,e,r){var o=this;r===void 0&&(r=!0),i.call(this),this.store=new Nn(function(s){s?n(s):o.init(o.store,function(c){n(c,o)})},e),Lt(r,t.Name,{storeName:e})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){new t(r,e.storeName,!1)},t.isAvailable=function(){try{return typeof $n<"u"&&$n.open("__browserfs_test__")!==null}catch{return!1}},t})(es);pn.Name="IndexedDB",pn.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var ei=!1,dn;try{Jt.localStorage.setItem("__test__","\uD800"),ei=Jt.localStorage.getItem("__test__")==="\uD800"}catch{ei=!1}dn=ei?"binary_string":"binary_string_ie",g.isEncoding(dn)||(dn="base64");var Ge=function(){};Ge.prototype.name=function(){return yn.Name},Ge.prototype.clear=function(){Jt.localStorage.clear()},Ge.prototype.beginTransaction=function(t){return new Ne(this)},Ge.prototype.get=function(t){try{var n=Jt.localStorage.getItem(t);if(n!==null)return g.from(n,dn)}catch{}},Ge.prototype.put=function(t,n,e){try{return!e&&Jt.localStorage.getItem(t)!==null?!1:(Jt.localStorage.setItem(t,n.toString(dn)),!0)}catch{throw new u(a.ENOSPC,"LocalStorage is full.")}},Ge.prototype.del=function(t){try{Jt.localStorage.removeItem(t)}catch(n){throw new u(a.EIO,"Unable to delete key "+t+": "+n)}};var yn=(function(i){function t(){i.call(this,{store:new Ge})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){r(null,new t)},t.isAvailable=function(){return typeof Jt.localStorage<"u"},t})(Ci);yn.Name="LocalStorage",yn.Options={};var nn=(function(i){function t(){i.call(this),this.mountList=[],this.mntMap={},this.rootFs=new en}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){var o=new t;Object.keys(e).forEach(function(s){o.mount(s,e[s])}),r(null,o)},t.isAvailable=function(){return!0},t.prototype.mount=function(e,r){if(e[0]!=="/"&&(e="/"+e),e=m.resolve(e),this.mntMap[e])throw new u(a.EINVAL,"Mount point "+e+" is already taken.");z(e,511,this.rootFs),this.mntMap[e]=r,this.mountList.push(e),this.mountList=this.mountList.sort(function(o,s){return s.length-o.length})},t.prototype.umount=function(e){var r=this;if(e[0]!=="/"&&(e="/"+e),e=m.resolve(e),!this.mntMap[e])throw new u(a.EINVAL,"Mount point "+e+" is already unmounted.");for(delete this.mntMap[e],this.mountList.splice(this.mountList.indexOf(e),1);e!=="/"&&r.rootFs.readdirSync(e).length===0;)r.rootFs.rmdirSync(e),e=m.dirname(e)},t.prototype._getFs=function(e){for(var r=this,o=this.mountList,s=o.length,c=0;c<s;c++){var d=o[c];if(d.length<=e.length&&e.indexOf(d)===0)return e=e.substr(d.length>1?d.length:0),e===""&&(e="/"),{fs:r.mntMap[d],path:e}}return{fs:this.rootFs,path:e}},t.prototype.getName=function(){return t.Name},t.prototype.diskSpace=function(e,r){r(0,0)},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.standardizeError=function(e,r,o){var s=e.message.indexOf(r);return s!==-1&&(e.message=e.message.substr(0,s)+o+e.message.substr(s+r.length),e.path=o),e},t.prototype.rename=function(e,r,o){var s=this,c=this._getFs(e),d=this._getFs(r);return c.fs===d.fs?c.fs.rename(c.path,d.path,function(w){w&&s.standardizeError(s.standardizeError(w,c.path,e),d.path,r),o(w)}):lt.readFile(e,function(w,N){if(w)return o(w);lt.writeFile(r,N,function(M){if(M)return o(M);lt.unlink(e,o)})})},t.prototype.renameSync=function(e,r){var o=this._getFs(e),s=this._getFs(r);if(o.fs===s.fs)try{return o.fs.renameSync(o.path,s.path)}catch(d){throw this.standardizeError(this.standardizeError(d,o.path,e),s.path,r),d}var c=lt.readFileSync(e);return lt.writeFileSync(r,c),lt.unlinkSync(e)},t.prototype.readdirSync=function(e){var r=this._getFs(e),o=null;if(r.fs!==this.rootFs)try{o=this.rootFs.readdirSync(e)}catch{}try{var s=r.fs.readdirSync(r.path);return o===null?s:s.concat(o.filter(function(c){return s.indexOf(c)===-1}))}catch(c){if(o===null)throw this.standardizeError(c,r.path,e);return o}},t.prototype.readdir=function(e,r){var o=this,s=this._getFs(e);s.fs.readdir(s.path,function(c,d){if(s.fs!==o.rootFs)try{var w=o.rootFs.readdirSync(e);d?d=d.concat(w.filter(function(N){return d.indexOf(N)===-1})):d=w}catch{if(c)return r(o.standardizeError(c,s.path,e))}else if(c)return r(o.standardizeError(c,s.path,e));r(null,d)})},t.prototype.rmdirSync=function(e){var r=this._getFs(e);if(this._containsMountPt(e))throw u.ENOTEMPTY(e);try{r.fs.rmdirSync(r.path)}catch(o){throw this.standardizeError(o,r.path,e)}},t.prototype.rmdir=function(e,r){var o=this,s=this._getFs(e);this._containsMountPt(e)?r(u.ENOTEMPTY(e)):s.fs.rmdir(s.path,function(c){r(c?o.standardizeError(c,s.path,e):null)})},t.prototype._containsMountPt=function(e){for(var r=this.mountList,o=r.length,s=0;s<o;s++){var c=r[s];if(c.length>=e.length&&c.slice(0,e.length)===e)return!0}return!1},t})(Q);nn.Name="MountableFileSystem",nn.Options={};function Mi(i,t,n){return t?function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];var o=e[0],s=this._getFs(o);e[0]=s.path;try{return s.fs[i].apply(s.fs,e)}catch(c){throw this.standardizeError(c,s.path,o),c}}:function(){for(var e=this,r=[],o=arguments.length;o--;)r[o]=arguments[o];var s=r[0],c=this._getFs(s);if(r[0]=c.path,typeof r[r.length-1]=="function"){var d=r[r.length-1];r[r.length-1]=function(){for(var w=[],N=arguments.length;N--;)w[N]=arguments[N];w.length>0&&w[0]instanceof u&&e.standardizeError(w[0],c.path,s),d.apply(null,w)}}return c.fs[i].apply(c.fs,r)}}for(var Pi=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],ni=0;ni<Pi.length;ni++)for(var is=Pi[ni],ii=0,Bi=is;ii<Bi.length;ii+=1){var Dn=Bi[ii];nn.prototype[Dn]=Mi(Dn,!1),nn.prototype[Dn+"Sync"]=Mi(Dn+"Sync",!0)}var mn;if(typeof setImmediate<"u")mn=setImmediate;else{var Ee=Jt,rn=[],zi="zero-timeout-message",rs=function(){if(typeof Ee.importScripts<"u"||!Ee.postMessage)return!1;var i=!0,t=Ee.onmessage;return Ee.onmessage=function(){i=!1},Ee.postMessage("","*"),Ee.onmessage=t,i};if(rs()){mn=function(i){rn.push(i),Ee.postMessage(zi,"*")};var Ui=function(i){if(i.source===self&&i.data===zi&&(i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,rn.length>0)){var t=rn.shift();return t()}};Ee.addEventListener?Ee.addEventListener("message",Ui,!0):Ee.attachEvent("onmessage",Ui)}else if(Ee.MessageChannel){var ji=new Ee.MessageChannel;ji.port1.onmessage=function(i){if(rn.length>0)return rn.shift()()},mn=function(i){rn.push(i),ji.port2.postMessage("")}}else mn=function(i){return setTimeout(i,0)}}var ri=mn,vn=function(){this._locked=!1,this._waiters=[]};vn.prototype.lock=function(t){if(this._locked){this._waiters.push(t);return}this._locked=!0,t()},vn.prototype.unlock=function(){if(!this._locked)throw new Error("unlock of a non-locked mutex");var t=this._waiters.shift();if(t){ri(t);return}this._locked=!1},vn.prototype.tryLock=function(){return this._locked?!1:(this._locked=!0,!0)},vn.prototype.isLocked=function(){return this._locked};var wt=function(t){this._fs=t,this._mu=new vn};wt.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},wt.prototype.getFSUnlocked=function(){return this._fs},wt.prototype.initialize=function(t){this._fs.initialize(t)},wt.prototype.diskSpace=function(t,n){this._fs.diskSpace(t,n)},wt.prototype.isReadOnly=function(){return this._fs.isReadOnly()},wt.prototype.supportsLinks=function(){return this._fs.supportsLinks()},wt.prototype.supportsProps=function(){return this._fs.supportsProps()},wt.prototype.supportsSynch=function(){return this._fs.supportsSynch()},wt.prototype.rename=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.rename(t,n,function(o){r._mu.unlock(),e(o)})})},wt.prototype.renameSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,n)},wt.prototype.stat=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.stat(t,n,function(o,s){r._mu.unlock(),e(o,s)})})},wt.prototype.statSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,n)},wt.prototype.open=function(t,n,e,r){var o=this;this._mu.lock(function(){o._fs.open(t,n,e,function(s,c){o._mu.unlock(),r(s,c)})})},wt.prototype.openSync=function(t,n,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,n,e)},wt.prototype.unlink=function(t,n){var e=this;this._mu.lock(function(){e._fs.unlink(t,function(r){e._mu.unlock(),n(r)})})},wt.prototype.unlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)},wt.prototype.rmdir=function(t,n){var e=this;this._mu.lock(function(){e._fs.rmdir(t,function(r){e._mu.unlock(),n(r)})})},wt.prototype.rmdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)},wt.prototype.mkdir=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.mkdir(t,n,function(o){r._mu.unlock(),e(o)})})},wt.prototype.mkdirSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,n)},wt.prototype.readdir=function(t,n){var e=this;this._mu.lock(function(){e._fs.readdir(t,function(r,o){e._mu.unlock(),n(r,o)})})},wt.prototype.readdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)},wt.prototype.exists=function(t,n){var e=this;this._mu.lock(function(){e._fs.exists(t,function(r){e._mu.unlock(),n(r)})})},wt.prototype.existsSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)},wt.prototype.realpath=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.realpath(t,n,function(o,s){r._mu.unlock(),e(o,s)})})},wt.prototype.realpathSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,n)},wt.prototype.truncate=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.truncate(t,n,function(o){r._mu.unlock(),e(o)})})},wt.prototype.truncateSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,n)},wt.prototype.readFile=function(t,n,e,r){var o=this;this._mu.lock(function(){o._fs.readFile(t,n,e,function(s,c){o._mu.unlock(),r(s,c)})})},wt.prototype.readFileSync=function(t,n,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,n,e)},wt.prototype.writeFile=function(t,n,e,r,o,s){var c=this;this._mu.lock(function(){c._fs.writeFile(t,n,e,r,o,function(d){c._mu.unlock(),s(d)})})},wt.prototype.writeFileSync=function(t,n,e,r,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,n,e,r,o)},wt.prototype.appendFile=function(t,n,e,r,o,s){var c=this;this._mu.lock(function(){c._fs.appendFile(t,n,e,r,o,function(d){c._mu.unlock(),s(d)})})},wt.prototype.appendFileSync=function(t,n,e,r,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,n,e,r,o)},wt.prototype.chmod=function(t,n,e,r){var o=this;this._mu.lock(function(){o._fs.chmod(t,n,e,function(s){o._mu.unlock(),r(s)})})},wt.prototype.chmodSync=function(t,n,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,n,e)},wt.prototype.chown=function(t,n,e,r,o){var s=this;this._mu.lock(function(){s._fs.chown(t,n,e,r,function(c){s._mu.unlock(),o(c)})})},wt.prototype.chownSync=function(t,n,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,n,e,r)},wt.prototype.utimes=function(t,n,e,r){var o=this;this._mu.lock(function(){o._fs.utimes(t,n,e,function(s){o._mu.unlock(),r(s)})})},wt.prototype.utimesSync=function(t,n,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,n,e)},wt.prototype.link=function(t,n,e){var r=this;this._mu.lock(function(){r._fs.link(t,n,function(o){r._mu.unlock(),e(o)})})},wt.prototype.linkSync=function(t,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,n)},wt.prototype.symlink=function(t,n,e,r){var o=this;this._mu.lock(function(){o._fs.symlink(t,n,e,function(s){o._mu.unlock(),r(s)})})},wt.prototype.symlinkSync=function(t,n,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,n,e)},wt.prototype.readlink=function(t,n){var e=this;this._mu.lock(function(){e._fs.readlink(t,function(r,o){e._mu.unlock(),n(r,o)})})},wt.prototype.readlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)};var De="/.deletedFiles.log";function Wi(i){return 146|i}function ge(i){return O.getFileFlag(i)}var Hi=(function(i){function t(n,e,r,o,s){i.call(this,n,e,r,o,s)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var r=this;if(!this.isDirty()){e(null);return}this._fs._syncAsync(this,function(o){r.resetDirty(),e(o)})},t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},t.prototype.close=function(e){this.sync(e)},t.prototype.closeSync=function(){this.syncSync()},t})(oe),qi=(function(i){function t(n,e){if(i.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=n,this._readable=e,this._writable.isReadOnly())throw new u(a.EINVAL,"Writable file system must be writable.")}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.isAvailable=function(){return!0},t.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},t.prototype._syncAsync=function(e,r){var o=this;this.createParentDirectoriesAsync(e.getPath(),function(s){if(s)return r(s);o._writable.writeFile(e.getPath(),e.getBuffer(),null,ge("w"),e.getStats().mode,r)})},t.prototype._syncSync=function(e){this.createParentDirectories(e.getPath()),this._writable.writeFileSync(e.getPath(),e.getBuffer(),null,ge("w"),e.getStats().mode)},t.prototype.getName=function(){return gn.Name},t.prototype.initialize=function(e){var r=this,o=this._initializeCallbacks,s=function(c){r._isInitialized=!c,r._initializeCallbacks=[],o.forEach((function(d){return d(c)}))};if(this._isInitialized)return e();o.push(e),o.length===1&&this._writable.readFile(De,"utf8",ge("r"),function(c,d){if(c){if(c.errno!==a.ENOENT)return s(c)}else r._deleteLog=d;r._reparseDeletionLog(),s()})},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},t.prototype.getDeletionLog=function(){return this._deleteLog},t.prototype.restoreDeletionLog=function(e){this._deleteLog=e,this._reparseDeletionLog(),this.updateLog("")},t.prototype.rename=function(e,r,o){var s=this;if(!(!this.checkInitAsync(o)||this.checkPathAsync(e,o)||this.checkPathAsync(r,o))){if(e===De||r===De)return o(u.EPERM("Cannot rename deletion log."));if(e===r)return o();this.stat(e,!1,function(c,d){return c?o(c):s.stat(r,!1,function(w,N){var M=s;function q(nt){var ut=nt.shift();if(!ut)return o();var yt=m.resolve(e,ut),It=m.resolve(r,ut);M.rename(yt,It,function(Gt){if(Gt)return o(Gt);q(nt)})}var $=511;if(d.isDirectory()){if(w)return w.errno!==a.ENOENT?o(w):s._writable.exists(e,function(nt){if(nt)return s._writable.rename(e,r,o);s._writable.mkdir(r,$,function(ut){if(ut)return o(ut);s._readable.readdir(e,function(yt,It){if(yt)return o();q(It)})})});if($=N.mode,!N.isDirectory())return o(u.ENOTDIR(r));s.readdir(r,function(nt,ut){if(ut&&ut.length)return o(u.ENOTEMPTY(r));s._readable.readdir(e,function(yt,It){if(yt)return o();q(It)})})}if(N&&N.isDirectory())return o(u.EISDIR(r));s.readFile(e,null,ge("r"),function(nt,ut){return nt?o(nt):s.writeFile(r,ut,null,ge("w"),d.mode,function(yt){return yt?o(yt):s.unlink(e,o)})})})})}},t.prototype.renameSync=function(e,r){var o=this;if(this.checkInitialized(),this.checkPath(e),this.checkPath(r),e===De||r===De)throw u.EPERM("Cannot rename deletion log.");var s=this.statSync(e,!1);if(s.isDirectory()){if(e===r)return;var c=511;if(this.existsSync(r)){var d=this.statSync(r,!1);if(c=d.mode,d.isDirectory()){if(this.readdirSync(r).length>0)throw u.ENOTEMPTY(r)}else throw u.ENOTDIR(r)}this._writable.existsSync(e)?this._writable.renameSync(e,r):this._writable.existsSync(r)||this._writable.mkdirSync(r,c),this._readable.existsSync(e)&&this._readable.readdirSync(e).forEach(function(w){o.renameSync(m.resolve(e,w),m.resolve(r,w))})}else{if(this.existsSync(r)&&this.statSync(r,!1).isDirectory())throw u.EISDIR(r);this.writeFileSync(r,this.readFileSync(e,null,ge("r")),null,ge("w"),s.mode)}e!==r&&this.existsSync(e)&&this.unlinkSync(e)},t.prototype.stat=function(e,r,o){var s=this;this.checkInitAsync(o)&&this._writable.stat(e,r,function(c,d){c&&c.errno===a.ENOENT?(s._deletedFiles[e]&&o(u.ENOENT(e)),s._readable.stat(e,r,function(w,N){N&&(N=N.clone(),N.mode=Wi(N.mode)),o(w,N)})):o(c,d)})},t.prototype.statSync=function(e,r){this.checkInitialized();try{return this._writable.statSync(e,r)}catch{if(this._deletedFiles[e])throw u.ENOENT(e);var o=this._readable.statSync(e,r).clone();return o.mode=Wi(o.mode),o}},t.prototype.open=function(e,r,o,s){var c=this;!this.checkInitAsync(s)||this.checkPathAsync(e,s)||this.stat(e,!1,function(d,w){if(w)switch(r.pathExistsAction()){case L.TRUNCATE_FILE:return c.createParentDirectoriesAsync(e,function(N){if(N)return s(N);c._writable.open(e,r,o,s)});case L.NOP:return c._writable.exists(e,function(N){N?c._writable.open(e,r,o,s):(w=w.clone(),w.mode=o,c._readable.readFile(e,null,ge("r"),function(M,q){if(M)return s(M);w.size===-1&&(w.size=q.length);var $=new Hi(c,e,r,w,q);s(null,$)}))});default:return s(u.EEXIST(e))}else return r.pathNotExistsAction()===L.CREATE_FILE?c.createParentDirectoriesAsync(e,function(N){return N?s(N):c._writable.open(e,r,o,s)}):s(u.ENOENT(e))})},t.prototype.openSync=function(e,r,o){if(this.checkInitialized(),this.checkPath(e),e===De)throw u.EPERM("Cannot open deletion log.");if(this.existsSync(e))switch(r.pathExistsAction()){case L.TRUNCATE_FILE:return this.createParentDirectories(e),this._writable.openSync(e,r,o);case L.NOP:if(this._writable.existsSync(e))return this._writable.openSync(e,r,o);var s=this._readable.readFileSync(e,null,ge("r")),c=this._readable.statSync(e,!1).clone();return c.mode=o,new Hi(this,e,r,c,s);default:throw u.EEXIST(e)}else{if(r.pathNotExistsAction()===L.CREATE_FILE)return this.createParentDirectories(e),this._writable.openSync(e,r,o);throw u.ENOENT(e)}},t.prototype.unlink=function(e,r){var o=this;!this.checkInitAsync(r)||this.checkPathAsync(e,r)||this.exists(e,function(s){if(!s)return r(u.ENOENT(e));o._writable.exists(e,function(c){if(c)return o._writable.unlink(e,function(d){if(d)return r(d);o.exists(e,function(w){w&&o.deletePath(e),r(null)})});o.deletePath(e),r(null)})})},t.prototype.unlinkSync=function(e){if(this.checkInitialized(),this.checkPath(e),this.existsSync(e))this._writable.existsSync(e)&&this._writable.unlinkSync(e),this.existsSync(e)&&this.deletePath(e);else throw u.ENOENT(e)},t.prototype.rmdir=function(e,r){var o=this;if(this.checkInitAsync(r)){var s=function(){o.readdir(e,function(c,d){if(c)return r(c);if(d.length)return r(u.ENOTEMPTY(e));o.deletePath(e),r(null)})};this.exists(e,function(c){if(!c)return r(u.ENOENT(e));o._writable.exists(e,function(d){d?o._writable.rmdir(e,function(w){if(w)return r(w);o._readable.exists(e,function(N){N?s():r()})}):s()})})}},t.prototype.rmdirSync=function(e){if(this.checkInitialized(),this.existsSync(e)){if(this._writable.existsSync(e)&&this._writable.rmdirSync(e),this.existsSync(e)){if(this.readdirSync(e).length>0)throw u.ENOTEMPTY(e);this.deletePath(e)}}else throw u.ENOENT(e)},t.prototype.mkdir=function(e,r,o){var s=this;this.checkInitAsync(o)&&this.exists(e,function(c){if(c)return o(u.EEXIST(e));s.createParentDirectoriesAsync(e,function(d){if(d)return o(d);s._writable.mkdir(e,r,o)})})},t.prototype.mkdirSync=function(e,r){if(this.checkInitialized(),this.existsSync(e))throw u.EEXIST(e);this.createParentDirectories(e),this._writable.mkdirSync(e,r)},t.prototype.readdir=function(e,r){var o=this;this.checkInitAsync(r)&&this.stat(e,!1,function(s,c){if(s)return r(s);if(!c.isDirectory())return r(u.ENOTDIR(e));o._writable.readdir(e,function(d,w){if(d&&d.code!=="ENOENT")return r(d);(d||!w)&&(w=[]),o._readable.readdir(e,function(N,M){(N||!M)&&(M=[]);var q={},$=w.concat(M.filter(function(nt){return!o._deletedFiles[e+"/"+nt]})).filter(function(nt){var ut=!q[nt];return q[nt]=!0,ut});r(null,$)})})})},t.prototype.readdirSync=function(e){var r=this;this.checkInitialized();var o=this.statSync(e,!1);if(!o.isDirectory())throw u.ENOTDIR(e);var s=[];try{s=s.concat(this._writable.readdirSync(e))}catch{}try{s=s.concat(this._readable.readdirSync(e).filter(function(d){return!r._deletedFiles[e+"/"+d]}))}catch{}var c={};return s.filter(function(d){var w=!c[d];return c[d]=!0,w})},t.prototype.exists=function(e,r){var o=this;this.checkInitialized(),this._writable.exists(e,function(s){if(s)return r(!0);o._readable.exists(e,function(c){r(c&&o._deletedFiles[e]!==!0)})})},t.prototype.existsSync=function(e){return this.checkInitialized(),this._writable.existsSync(e)||this._readable.existsSync(e)&&this._deletedFiles[e]!==!0},t.prototype.chmod=function(e,r,o,s){var c=this;this.checkInitAsync(s)&&this.operateOnWritableAsync(e,function(d){if(d)return s(d);c._writable.chmod(e,r,o,s)})},t.prototype.chmodSync=function(e,r,o){var s=this;this.checkInitialized(),this.operateOnWritable(e,function(){s._writable.chmodSync(e,r,o)})},t.prototype.chown=function(e,r,o,s,c){var d=this;this.checkInitAsync(c)&&this.operateOnWritableAsync(e,function(w){if(w)return c(w);d._writable.chown(e,r,o,s,c)})},t.prototype.chownSync=function(e,r,o,s){var c=this;this.checkInitialized(),this.operateOnWritable(e,function(){c._writable.chownSync(e,r,o,s)})},t.prototype.utimes=function(e,r,o,s){var c=this;this.checkInitAsync(s)&&this.operateOnWritableAsync(e,function(d){if(d)return s(d);c._writable.utimes(e,r,o,s)})},t.prototype.utimesSync=function(e,r,o){var s=this;this.checkInitialized(),this.operateOnWritable(e,function(){s._writable.utimesSync(e,r,o)})},t.prototype.deletePath=function(e){this._deletedFiles[e]=!0,this.updateLog("d"+e+`
`)},t.prototype.updateLog=function(e){var r=this;this._deleteLog+=e,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(De,this._deleteLog,"utf8",O.getFileFlag("w"),420,function(o){r._deleteLogUpdatePending=!1,o?r._deleteLogError=o:r._deleteLogUpdateNeeded&&(r._deleteLogUpdateNeeded=!1,r.updateLog(""))}))},t.prototype._reparseDeletionLog=function(){var e=this;this._deletedFiles={},this._deleteLog.split(`
`).forEach(function(r){e._deletedFiles[r.slice(1)]=r.slice(0,1)==="d"})},t.prototype.checkInitialized=function(){if(this._isInitialized){if(this._deleteLogError!==null){var e=this._deleteLogError;throw this._deleteLogError=null,e}}else throw new u(a.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")},t.prototype.checkInitAsync=function(e){if(this._isInitialized){if(this._deleteLogError!==null){var r=this._deleteLogError;return this._deleteLogError=null,e(r),!1}}else return e(new u(a.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;return!0},t.prototype.checkPath=function(e){if(e===De)throw u.EPERM(e)},t.prototype.checkPathAsync=function(e,r){return e===De?(r(u.EPERM(e)),!0):!1},t.prototype.createParentDirectoriesAsync=function(e,r){var o=m.dirname(e),s=[],c=this;this._writable.stat(o,!1,d);function d(N,M){N?(s.push(o),o=m.dirname(o),c._writable.stat(o,!1,d)):w()}function w(){if(!s.length)return r();var N=s.pop();c._readable.stat(N,!1,function(M,q){if(!q)return r();c._writable.mkdir(N,q.mode,function($){if($)return r($);w()})})}},t.prototype.createParentDirectories=function(e){for(var r=this,o=m.dirname(e),s=[];!this._writable.existsSync(o);)s.push(o),o=m.dirname(o);s=s.reverse(),s.forEach(function(c){r._writable.mkdirSync(c,r.statSync(c,!1).mode)})},t.prototype.operateOnWritable=function(e,r){if(this.existsSync(e))this._writable.existsSync(e)||this.copyToWritable(e),r();else throw u.ENOENT(e)},t.prototype.operateOnWritableAsync=function(e,r){var o=this;this.exists(e,function(s){if(!s)return r(u.ENOENT(e));o._writable.exists(e,function(c){if(c)r();else return o.copyToWritableAsync(e,r)})})},t.prototype.copyToWritable=function(e){var r=this.statSync(e,!1);r.isDirectory()?this._writable.mkdirSync(e,r.mode):this.writeFileSync(e,this._readable.readFileSync(e,null,ge("r")),null,ge("w"),this.statSync(e,!1).mode)},t.prototype.copyToWritableAsync=function(e,r){var o=this;this.stat(e,!1,function(s,c){if(s)return r(s);if(c.isDirectory())return o._writable.mkdir(e,c.mode,r);o._readable.readFile(e,null,ge("r"),function(d,w){if(d)return r(d);o.writeFile(e,w,null,ge("w"),c.mode,r)})})},t})(Q),gn=(function(i){function t(n,e,r){r===void 0&&(r=!0),i.call(this,new qi(n,e)),Lt(r,t.Name,{readable:"readable file system",writable:"writable file system"})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){try{var o=new t(e.writable,e.readable,!1);o.initialize(function(s){r(s,o)},!1)}catch(s){r(s)}},t.isAvailable=function(){return qi.isAvailable()},t.prototype.initialize=function(e,r){r===void 0&&(r=!0),r&&console.warn("[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use 'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)' to create and initialize OverlayFS instances."),i.prototype.initialize.call(this,e)},t.prototype.getOverlayedFileSystems=function(){return i.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},t.prototype.unwrap=function(){return i.prototype.getFSUnlocked.call(this)},t})(wt);gn.Name="OverlayFS",gn.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}};var qt;(function(i){i[i.CB=0]="CB",i[i.FD=1]="FD",i[i.API_ERROR=2]="API_ERROR",i[i.STATS=3]="STATS",i[i.PROBE=4]="PROBE",i[i.FILEFLAG=5]="FILEFLAG",i[i.BUFFER=6]="BUFFER",i[i.ERROR=7]="ERROR"})(qt||(qt={}));var oi=function(){this._callbacks={},this._nextId=0};oi.prototype.toRemoteArg=function(t){var n=this._nextId++;return this._callbacks[n]=t,{type:qt.CB,id:n}},oi.prototype.toLocalArg=function(t){var n=this._callbacks[t];return delete this._callbacks[t],n};var Cn=function(){this._fileDescriptors={},this._nextId=0};Cn.prototype.toRemoteArg=function(t,n,e,r){var o=this._nextId++,s,c;this._fileDescriptors[o]=t,t.stat(function(d,w){d?r(d):(c=Xe(w.toBuffer()),e.isReadable()?t.read(g.alloc(w.size),0,w.size,0,function(N,M,q){N?r(N):(s=Xe(q),r(null,{type:qt.FD,id:o,data:s,stat:c,path:n,flag:e.getFlagString()}))}):r(null,{type:qt.FD,id:o,data:new ArrayBuffer(0),stat:c,path:n,flag:e.getFlagString()}))})},Cn.prototype.applyFdAPIRequest=function(t,n){var e=this,r=t.args[0];this._applyFdChanges(r,function(o,s){o?n(o):s[t.method](function(c){t.method==="close"&&delete e._fileDescriptors[r.id],n(c)})})},Cn.prototype._applyFdChanges=function(t,n){var e=this._fileDescriptors[t.id],r=Ye(t.data),o=A.fromBuffer(Ye(t.stat)),s=O.getFileFlag(t.flag);s.isWriteable()?e.write(r,0,r.length,s.isAppendable()?e.getPos():0,function(c){function d(){e.stat(function(w,N){w?n(w):N.mode!==o.mode?e.chmod(o.mode,function(M){n(M,e)}):n(w,e)})}c?n(c):s.isAppendable()?d():e.truncate(r.length,function(){d()})}):n(null,e)};function An(i){return{type:qt.API_ERROR,errorData:Xe(i.writeToBuffer())}}function Gi(i){return u.fromBuffer(Ye(i.errorData))}function Xi(i){return{type:qt.ERROR,name:i.name,message:i.message,stack:i.stack}}function Yi(i){var t=Jt[i.name];typeof t!="function"&&(t=Error);var n=new t(i.message);return n.stack=i.stack,n}function Zi(i){return{type:qt.STATS,statsData:Xe(i.toBuffer())}}function Vi(i){return A.fromBuffer(Ye(i.statsData))}function Ki(i){return{type:qt.FILEFLAG,flagStr:i.getFlagString()}}function Ji(i){return O.getFileFlag(i.flagStr)}function Xe(i){return J(i)}function Ye(i){return _t(i)}function Qi(i){return{type:qt.BUFFER,data:Xe(i)}}function $i(i){return Ye(i.data)}function os(i){return i&&typeof i=="object"&&i.hasOwnProperty("browserfsMessage")&&i.browserfsMessage}function ss(i){return i&&typeof i=="object"&&i.hasOwnProperty("browserfsMessage")&&i.browserfsMessage}var tr=(function(i){function t(n,e,r,o,s,c){i.call(this,n,e,r,o,c),this._remoteFdId=s}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.getRemoteFdId=function(){return this._remoteFdId},t.prototype.toRemoteArg=function(){return{type:qt.FD,id:this._remoteFdId,data:Xe(this.getBuffer()),stat:Xe(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}},t.prototype.sync=function(e){this._syncClose("sync",e)},t.prototype.close=function(e){this._syncClose("close",e)},t.prototype._syncClose=function(e,r){var o=this;this.isDirty()?this._fs.syncClose(e,this,function(s){s||o.resetDirty(),r(s)}):r()},t})(oe),Mn=(function(i){function t(n,e){var r=this;e===void 0&&(e=!0),i.call(this),this._callbackConverter=new oi,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=n,Lt(e,t.Name,{worker:"Web Worker instance"}),this._worker.addEventListener("message",function(o){var s=o.data;if(ss(s)){var c,d=s.args,w=new Array(d.length);for(c=0;c<w.length;c++)w[c]=r._argRemote2Local(d[c]);r._callbackConverter.toLocalArg(s.cbId).apply(null,w)}})}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){var o=new t(e.worker,!1);o.initialize(function(){r(null,o)})},t.isAvailable=function(){return typeof importScripts<"u"||typeof Worker<"u"},t.attachRemoteListener=function(e){var r=new Cn;function o(c,d,w){typeof c==="object"?c instanceof A?w(null,Zi(c)):c instanceof u?w(null,An(c)):c instanceof vt?w(null,r.toRemoteArg(c,d[0],d[1],w)):c instanceof O?w(null,Ki(c)):c instanceof g?w(null,Qi(c)):c instanceof Error?w(null,Xi(c)):w(null,c):w(null,c)}function s(c,d){if(!c)return c;switch(typeof c){case"object":if(typeof c.type=="number"){var w=c;switch(w.type){case qt.CB:var N=c.id;return function(){var M=arguments,q,$=new Array(arguments.length),nt,ut=arguments.length;function yt(It){ut>0&&(ut=-1,nt={browserfsMessage:!0,cbId:N,args:[An(It)]},e.postMessage(nt))}for(q=0;q<arguments.length;q++)(function(It,Gt){o(Gt,d,function(ae,xe){$[It]=xe,ae?yt(ae):--ut===0&&(nt={browserfsMessage:!0,cbId:N,args:$},e.postMessage(nt))})})(q,M[q]);arguments.length===0&&(nt={browserfsMessage:!0,cbId:N,args:$},e.postMessage(nt))};case qt.API_ERROR:return Gi(w);case qt.STATS:return Vi(w);case qt.FILEFLAG:return Ji(w);case qt.BUFFER:return $i(w);case qt.ERROR:return Yi(w);default:return c}}else return c;default:return c}}e.addEventListener("message",function(c){var d=c.data;if(os(d)){var w=d.args,N=new Array(w.length);switch(d.method){case"close":case"sync":(function(){var $=w[1];r.applyFdAPIRequest(d,function(nt){var ut={browserfsMessage:!0,cbId:$.id,args:nt?[An(nt)]:[]};e.postMessage(ut)})})();break;case"probe":(function(){var $=lt.getRootFS(),nt=w[1],ut={type:qt.PROBE,isReadOnly:$.isReadOnly(),supportsLinks:$.supportsLinks(),supportsProps:$.supportsProps()},yt={browserfsMessage:!0,cbId:nt.id,args:[ut]};e.postMessage(yt)})();break;default:for(var M=0;M<w.length;M++)N[M]=s(w[M],N);var q=lt.getRootFS();q[d.method].apply(q,N);break}}})},t.prototype.getName=function(){return t.Name},t.prototype.initialize=function(e){var r=this;if(this._isInitialized)e();else{var o={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(Mt()),this._callbackConverter.toRemoteArg(function(s){r._isInitialized=!0,r._isReadOnly=s.isReadOnly,r._supportLinks=s.supportsLinks,r._supportProps=s.supportsProps,e()})]};this._worker.postMessage(o)}},t.prototype.isReadOnly=function(){return this._isReadOnly},t.prototype.supportsSynch=function(){return!1},t.prototype.supportsLinks=function(){return this._supportLinks},t.prototype.supportsProps=function(){return this._supportProps},t.prototype.rename=function(e,r,o){this._rpc("rename",arguments)},t.prototype.stat=function(e,r,o){this._rpc("stat",arguments)},t.prototype.open=function(e,r,o,s){this._rpc("open",arguments)},t.prototype.unlink=function(e,r){this._rpc("unlink",arguments)},t.prototype.rmdir=function(e,r){this._rpc("rmdir",arguments)},t.prototype.mkdir=function(e,r,o){this._rpc("mkdir",arguments)},t.prototype.readdir=function(e,r){this._rpc("readdir",arguments)},t.prototype.exists=function(e,r){this._rpc("exists",arguments)},t.prototype.realpath=function(e,r,o){this._rpc("realpath",arguments)},t.prototype.truncate=function(e,r,o){this._rpc("truncate",arguments)},t.prototype.readFile=function(e,r,o,s){this._rpc("readFile",arguments)},t.prototype.writeFile=function(e,r,o,s,c,d){this._rpc("writeFile",arguments)},t.prototype.appendFile=function(e,r,o,s,c,d){this._rpc("appendFile",arguments)},t.prototype.chmod=function(e,r,o,s){this._rpc("chmod",arguments)},t.prototype.chown=function(e,r,o,s,c){this._rpc("chown",arguments)},t.prototype.utimes=function(e,r,o,s){this._rpc("utimes",arguments)},t.prototype.link=function(e,r,o){this._rpc("link",arguments)},t.prototype.symlink=function(e,r,o,s){this._rpc("symlink",arguments)},t.prototype.readlink=function(e,r){this._rpc("readlink",arguments)},t.prototype.syncClose=function(e,r,o){this._worker.postMessage({browserfsMessage:!0,method:e,args:[r.toRemoteArg(),this._callbackConverter.toRemoteArg(o)]})},t.prototype._argRemote2Local=function(e){if(!e)return e;switch(typeof e){case"object":if(typeof e.type=="number"){var r=e;switch(r.type){case qt.API_ERROR:return Gi(r);case qt.FD:var o=r;return new tr(this,o.path,O.getFileFlag(o.flag),A.fromBuffer(Ye(o.stat)),o.id,Ye(o.data));case qt.STATS:return Vi(r);case qt.FILEFLAG:return Ji(r);case qt.BUFFER:return $i(r);case qt.ERROR:return Yi(r);default:return e}}else return e;default:return e}},t.prototype._rpc=function(e,r){for(var o=this,s=new Array(r.length),c=0;c<r.length;c++)s[c]=o._argLocal2Remote(r[c]);var d={browserfsMessage:!0,method:e,args:s};this._worker.postMessage(d)},t.prototype._argLocal2Remote=function(e){if(!e)return e;switch(typeof e){case"object":return e instanceof A?Zi(e):e instanceof u?An(e):e instanceof tr?e.toRemoteArg():e instanceof O?Ki(e):e instanceof g?Qi(e):e instanceof Error?Xi(e):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(e);default:return e}},t})(Q);Mn.Name="WorkerFS",Mn.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(i,t){i.postMessage?t():t(new u(a.EINVAL,"option must be a Web Worker instance."))}}};function as(i,t,n){var e=new XMLHttpRequest;e.open("GET",i,!0);var r=!0;switch(t){case"buffer":e.responseType="arraybuffer";break;case"json":try{e.responseType="json",r=e.responseType==="json"}catch{r=!1}break;default:return n(new u(a.EINVAL,"Invalid download type: "+t))}e.onreadystatechange=function(o){if(e.readyState===4)if(e.status===200)switch(t){case"buffer":return n(null,e.response?g.from(e.response):Mt());case"json":return r?n(null,e.response):n(null,JSON.parse(e.responseText))}else return n(new u(e.status,"XHR error."))},e.send()}function cs(i,t){var n=new XMLHttpRequest;n.open("GET",i,!1);var e=null,r=null;if(n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(o){if(n.readyState===4)if(n.status===200)switch(t){case"buffer":var s=n.responseText;e=g.alloc(s.length);for(var c=0;c<s.length;c++)e[c]=s.charCodeAt(c);return;case"json":e=JSON.parse(n.responseText);return}else{r=new u(n.status,"XHR error.");return}},n.send(),r)throw r;return e}function ls(i,t){var n=new XMLHttpRequest;switch(n.open("GET",i,!1),t){case"buffer":n.responseType="arraybuffer";break;case"json":break;default:throw new u(a.EINVAL,"Invalid download type: "+t)}var e,r;if(n.onreadystatechange=function(o){if(n.readyState===4)if(n.status===200)switch(t){case"buffer":e=g.from(n.response);break;case"json":e=JSON.parse(n.response);break}else r=new u(n.status,"XHR error.")},n.send(),r)throw r;return e}function er(i,t,n){var e=new XMLHttpRequest;e.open("HEAD",t,i),e.onreadystatechange=function(r){if(e.readyState===4)if(e.status===200)try{return n(null,parseInt(e.getResponseHeader("Content-Length")||"-1",10))}catch{return n(new u(a.EIO,"XHR HEAD error: Could not read content-length."))}else return n(new u(e.status,"XHR HEAD error."))},e.send()}var nr=as,us=Et&&typeof Blob<"u"?ls:cs;function fs(i){var t=-1;return er(!1,i,function(n,e){if(n)throw n;t=e}),t}function hs(i,t){er(!0,i,t)}var _e=function(){this._index={},this.addPath("/",new ye)};_e.fromListing=function(t){var n=new _e,e=new ye;n._index["/"]=e;for(var r=[["",t,e]];r.length>0;){var o=void 0,s=r.pop(),c=s[0],d=s[1],w=s[2];for(var N in d)if(d.hasOwnProperty(N)){var M=d[N],q=c+"/"+N;M?(n._index[q]=o=new ye,r.push([q,M,o])):o=new on(new A(C.FILE,-1,365)),w&&(w._ls[N]=o)}}return n},_e.prototype.fileIterator=function(t){var n=this;for(var e in n._index)if(n._index.hasOwnProperty(e))for(var r=n._index[e],o=r.getListing(),s=0,c=o;s<c.length;s+=1){var d=c[s],w=r.getItem(d);Ce(w)&&t(w.getData())}},_e.prototype.addPath=function(t,n){if(!n)throw new Error("Inode must be specified");if(t[0]!=="/")throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===n;var e=this._split_path(t),r=e[0],o=e[1],s=this._index[r];return s===void 0&&t!=="/"&&(s=new ye,!this.addPath(r,s))||t!=="/"&&!s.addItem(o,n)?!1:(Be(n)&&(this._index[t]=n),!0)},_e.prototype.addPathFast=function(t,n){var e=t.lastIndexOf("/"),r=e===0?"/":t.substring(0,e),o=t.substring(e+1),s=this._index[r];return s===void 0&&(s=new ye,this.addPathFast(r,s)),s.addItem(o,n)?(n.isDir()&&(this._index[t]=n),!0):!1},_e.prototype.removePath=function(t){var n=this,e=this._split_path(t),r=e[0],o=e[1],s=this._index[r];if(s===void 0)return null;var c=s.remItem(o);if(c===null)return null;if(Be(c)){for(var d=c.getListing(),w=0,N=d;w<N.length;w+=1){var M=N[w];n.removePath(t+"/"+M)}t!=="/"&&delete this._index[t]}return c},_e.prototype.ls=function(t){var n=this._index[t];return n===void 0?null:n.getListing()},_e.prototype.getInode=function(t){var n=this._split_path(t),e=n[0],r=n[1],o=this._index[e];return o===void 0?null:e===t?o:o.getItem(r)},_e.prototype._split_path=function(t){var n=m.dirname(t),e=t.substr(n.length+(n==="/"?0:1));return[n,e]};var on=function(t){this.data=t};on.prototype.isFile=function(){return!0},on.prototype.isDir=function(){return!1},on.prototype.getData=function(){return this.data},on.prototype.setData=function(t){this.data=t};var ye=function(t){t===void 0&&(t=null),this.data=t,this._ls={}};ye.prototype.isFile=function(){return!1},ye.prototype.isDir=function(){return!0},ye.prototype.getData=function(){return this.data},ye.prototype.getStats=function(){return new A(C.DIRECTORY,4096,365)},ye.prototype.getListing=function(){return Object.keys(this._ls)},ye.prototype.getItem=function(t){var n=this._ls[t];return n||null},ye.prototype.addItem=function(t,n){return t in this._ls?!1:(this._ls[t]=n,!0)},ye.prototype.remItem=function(t){var n=this._ls[t];return n===void 0?null:(delete this._ls[t],n)};function Ce(i){return!!i&&i.isFile()}function Be(i){return!!i&&i.isDir()}function ps(i,t,n){try{n(null,i.toString(t))}catch(e){n(e)}}var Pn=(function(i){function t(n,e,r){e===void 0&&(e=""),r===void 0&&(r=!0),i.call(this),n||(n="index.json"),e.length>0&&e.charAt(e.length-1)!=="/"&&(e=e+"/"),this.prefixUrl=e;var o=null;if(typeof n=="string"){if(o=this._requestFileSync(n,"json"),!o)throw new Error("Unable to find listing at URL: ${listingUrlOrObj}")}else o=n;Lt(r,t.Name,{index:typeof n=="string"?n:"file index as an object",baseUrl:e}),this._index=_e.fromListing(o)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){e.index===void 0&&(e.index="index.json"),typeof e.index=="string"?t.FromURL(e.index,r,e.baseUrl,!1):r(null,new t(e.index,e.baseUrl,!1))},t.isAvailable=function(){return typeof XMLHttpRequest<"u"&&XMLHttpRequest!==null},t.FromURL=function(e,r,o,s){o===void 0&&(o=e.slice(0,e.lastIndexOf("/")+1)),s===void 0&&(s=!0),s&&console.warn(`[XmlHttpRequest] XmlHttpRequest.FromURL() is deprecated and will be removed in the next major release. Please use 'XmlHttpRequest.Create({ index: "`+e+'", baseUrl: "'+o+`" }, cb)' instead.`),nr(e,"json",function(c,d){c?r(c):r(null,new t(d,o,!1))})},t.prototype.empty=function(){this._index.fileIterator(function(e){e.fileData=null})},t.prototype.getName=function(){return t.Name},t.prototype.diskSpace=function(e,r){r(0,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.preloadFile=function(e,r){var o=this._index.getInode(e);if(Ce(o)){if(o===null)throw u.ENOENT(e);var s=o.getData();s.size=r.length,s.fileData=r}else throw u.EISDIR(e)},t.prototype.stat=function(e,r,o){var s=this._index.getInode(e);if(s===null)return o(u.ENOENT(e));var c;Ce(s)?(c=s.getData(),c.size<0?this._requestFileSizeAsync(e,function(d,w){if(d)return o(d);c.size=w,o(null,c.clone())}):o(null,c.clone())):Be(s)?(c=s.getStats(),o(null,c)):o(u.FileError(a.EINVAL,e))},t.prototype.statSync=function(e,r){var o=this._index.getInode(e);if(o===null)throw u.ENOENT(e);var s;if(Ce(o))s=o.getData(),s.size<0&&(s.size=this._requestFileSizeSync(e));else if(Be(o))s=o.getStats();else throw u.FileError(a.EINVAL,e);return s},t.prototype.open=function(e,r,o,s){if(r.isWriteable())return s(new u(a.EPERM,e));var c=this,d=this._index.getInode(e);if(d===null)return s(u.ENOENT(e));if(Ce(d)){var w=d.getData();switch(r.pathExistsAction()){case L.THROW_EXCEPTION:case L.TRUNCATE_FILE:return s(u.EEXIST(e));case L.NOP:if(w.fileData)return s(null,new le(c,e,r,w.clone(),w.fileData));this._requestFileAsync(e,"buffer",function(N,M){return N?s(N):(w.size=M.length,w.fileData=M,s(null,new le(c,e,r,w.clone(),M)))});break;default:return s(new u(a.EINVAL,"Invalid FileMode object."))}}else return s(u.EISDIR(e))},t.prototype.openSync=function(e,r,o){if(r.isWriteable())throw new u(a.EPERM,e);var s=this._index.getInode(e);if(s===null)throw u.ENOENT(e);if(Ce(s)){var c=s.getData();switch(r.pathExistsAction()){case L.THROW_EXCEPTION:case L.TRUNCATE_FILE:throw u.EEXIST(e);case L.NOP:if(c.fileData)return new le(this,e,r,c.clone(),c.fileData);var d=this._requestFileSync(e,"buffer");return c.size=d.length,c.fileData=d,new le(this,e,r,c.clone(),d);default:throw new u(a.EINVAL,"Invalid FileMode object.")}}else throw u.EISDIR(e)},t.prototype.readdir=function(e,r){try{r(null,this.readdirSync(e))}catch(o){r(o)}},t.prototype.readdirSync=function(e){var r=this._index.getInode(e);if(r===null)throw u.ENOENT(e);if(Be(r))return r.getListing();throw u.ENOTDIR(e)},t.prototype.readFile=function(e,r,o,s){var c=s;this.open(e,o,420,function(d,w){if(d)return s(d);s=function(q,$){w.close(function(nt){return q||(q=nt),c(q,$)})};var N=w,M=N.getBuffer();r===null?s(d,Rt(M)):ps(M,r,s)})},t.prototype.readFileSync=function(e,r,o){var s=this.openSync(e,o,420);try{var c=s,d=c.getBuffer();return r===null?Rt(d):d.toString(r)}finally{s.closeSync()}},t.prototype.getXhrPath=function(e){return e.charAt(0)==="/"&&(e=e.slice(1)),this.prefixUrl+e},t.prototype._requestFileAsync=function(e,r,o){nr(this.getXhrPath(e),r,o)},t.prototype._requestFileSync=function(e,r){return us(this.getXhrPath(e),r)},t.prototype._requestFileSizeAsync=function(e,r){hs(this.getXhrPath(e),r)},t.prototype._requestFileSizeSync=function(e){return fs(this.getXhrPath(e))},t})(Q);Pn.Name="XmlHttpRequest",Pn.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var Ze=function(){};Ze.str2byte=function(t,n){for(var e=t.length>n.length?n.length:t.length,r=0;r<e;r++){var o=t.charCodeAt(r);if(o>127){var s=Ze.extendedChars.indexOf(t.charAt(r));s>-1&&(o=s+128)}n[o]=r}return e},Ze.byte2str=function(t){for(var n=new Array(t.length),e=0;e<t.length;e++){var r=t[e];r>127?n[e]=Ze.extendedChars[r-128]:n[e]=String.fromCharCode(r)}return n.join("")},Ze.byteLength=function(t){return t.length},Ze.extendedChars=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];var ds=v(31).inflateRaw,ir={},rr;(function(i){i[i.MSDOS=0]="MSDOS",i[i.AMIGA=1]="AMIGA",i[i.OPENVMS=2]="OPENVMS",i[i.UNIX=3]="UNIX",i[i.VM_CMS=4]="VM_CMS",i[i.ATARI_ST=5]="ATARI_ST",i[i.OS2_HPFS=6]="OS2_HPFS",i[i.MAC=7]="MAC",i[i.Z_SYSTEM=8]="Z_SYSTEM",i[i.CP_M=9]="CP_M",i[i.NTFS=10]="NTFS",i[i.MVS=11]="MVS",i[i.VSE=12]="VSE",i[i.ACORN_RISC=13]="ACORN_RISC",i[i.VFAT=14]="VFAT",i[i.ALT_MVS=15]="ALT_MVS",i[i.BEOS=16]="BEOS",i[i.TANDEM=17]="TANDEM",i[i.OS_400=18]="OS_400",i[i.OSX=19]="OSX"})(rr||(rr={}));var sn;(function(i){i[i.STORED=0]="STORED",i[i.SHRUNK=1]="SHRUNK",i[i.REDUCED_1=2]="REDUCED_1",i[i.REDUCED_2=3]="REDUCED_2",i[i.REDUCED_3=4]="REDUCED_3",i[i.REDUCED_4=5]="REDUCED_4",i[i.IMPLODE=6]="IMPLODE",i[i.DEFLATE=8]="DEFLATE",i[i.DEFLATE64=9]="DEFLATE64",i[i.TERSE_OLD=10]="TERSE_OLD",i[i.BZIP2=12]="BZIP2",i[i.LZMA=14]="LZMA",i[i.TERSE_NEW=18]="TERSE_NEW",i[i.LZ77=19]="LZ77",i[i.WAVPACK=97]="WAVPACK",i[i.PPMD=98]="PPMD"})(sn||(sn={}));function or(i,t){var n=t&31,e=(t>>5&15)-1,r=(t>>9)+1980,o=i&31,s=i>>5&63,c=i>>11;return new Date(r,e,n,c,s,o)}function Bn(i,t,n,e){return e===0?"":t?i.toString("utf8",n,n+e):Ze.byte2str(i.slice(n,n+e))}var we=function(t){if(this.data=t,t.readUInt32LE(0)!==67324752)throw new u(a.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))};we.prototype.versionNeeded=function(){return this.data.readUInt16LE(4)},we.prototype.flags=function(){return this.data.readUInt16LE(6)},we.prototype.compressionMethod=function(){return this.data.readUInt16LE(8)},we.prototype.lastModFileTime=function(){return or(this.data.readUInt16LE(10),this.data.readUInt16LE(12))},we.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(10)},we.prototype.crc32=function(){return this.data.readUInt32LE(14)},we.prototype.fileNameLength=function(){return this.data.readUInt16LE(26)},we.prototype.extraFieldLength=function(){return this.data.readUInt16LE(28)},we.prototype.fileName=function(){return Bn(this.data,this.useUTF8(),30,this.fileNameLength())},we.prototype.extraField=function(){var t=30+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())},we.prototype.totalSize=function(){return 30+this.fileNameLength()+this.extraFieldLength()},we.prototype.useUTF8=function(){return(this.flags()&2048)===2048};var wn=function(t,n,e){this.header=t,this.record=n,this.data=e};wn.prototype.decompress=function(){var t=this.header.compressionMethod(),n=ir[t];if(n)return n(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());var e=sn[t];throw e||(e="Unknown: "+t),new u(a.EINVAL,"Invalid compression method on file '"+this.header.fileName()+"': "+e)},wn.prototype.getHeader=function(){return this.header},wn.prototype.getRecord=function(){return this.record},wn.prototype.getRawData=function(){return this.data};var Nt=function(t,n){if(this.zipData=t,this.data=n,this.data.readUInt32LE(0)!==33639248)throw new u(a.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0));this._filename=this.produceFilename()};Nt.prototype.versionMadeBy=function(){return this.data.readUInt16LE(4)},Nt.prototype.versionNeeded=function(){return this.data.readUInt16LE(6)},Nt.prototype.flag=function(){return this.data.readUInt16LE(8)},Nt.prototype.compressionMethod=function(){return this.data.readUInt16LE(10)},Nt.prototype.lastModFileTime=function(){return or(this.data.readUInt16LE(12),this.data.readUInt16LE(14))},Nt.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(12)},Nt.prototype.crc32=function(){return this.data.readUInt32LE(16)},Nt.prototype.compressedSize=function(){return this.data.readUInt32LE(20)},Nt.prototype.uncompressedSize=function(){return this.data.readUInt32LE(24)},Nt.prototype.fileNameLength=function(){return this.data.readUInt16LE(28)},Nt.prototype.extraFieldLength=function(){return this.data.readUInt16LE(30)},Nt.prototype.fileCommentLength=function(){return this.data.readUInt16LE(32)},Nt.prototype.diskNumberStart=function(){return this.data.readUInt16LE(34)},Nt.prototype.internalAttributes=function(){return this.data.readUInt16LE(36)},Nt.prototype.externalAttributes=function(){return this.data.readUInt32LE(38)},Nt.prototype.headerRelativeOffset=function(){return this.data.readUInt32LE(42)},Nt.prototype.produceFilename=function(){var t=Bn(this.data,this.useUTF8(),46,this.fileNameLength());return t.replace(/\\/g,"/")},Nt.prototype.fileName=function(){return this._filename},Nt.prototype.rawFileName=function(){return this.data.slice(46,46+this.fileNameLength())},Nt.prototype.extraField=function(){var t=44+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())},Nt.prototype.fileComment=function(){var t=46+this.fileNameLength()+this.extraFieldLength();return Bn(this.data,this.useUTF8(),t,this.fileCommentLength())},Nt.prototype.rawFileComment=function(){var t=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(t,t+this.fileCommentLength())},Nt.prototype.totalSize=function(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()},Nt.prototype.isDirectory=function(){var t=this.fileName();return!!(this.externalAttributes()&16)||t.charAt(t.length-1)==="/"},Nt.prototype.isFile=function(){return!this.isDirectory()},Nt.prototype.useUTF8=function(){return(this.flag()&2048)===2048},Nt.prototype.isEncrypted=function(){return(this.flag()&1)===1},Nt.prototype.getFileData=function(){var t=this.headerRelativeOffset(),n=new we(this.zipData.slice(t));return new wn(n,this,this.zipData.slice(t+n.totalSize()))},Nt.prototype.getData=function(){return this.getFileData().decompress()},Nt.prototype.getRawData=function(){return this.getFileData().getRawData()},Nt.prototype.getStats=function(){return new A(C.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var Le=function(t){if(this.data=t,this.data.readUInt32LE(0)!==101010256)throw new u(a.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))};Le.prototype.diskNumber=function(){return this.data.readUInt16LE(4)},Le.prototype.cdDiskNumber=function(){return this.data.readUInt16LE(6)},Le.prototype.cdDiskEntryCount=function(){return this.data.readUInt16LE(8)},Le.prototype.cdTotalEntryCount=function(){return this.data.readUInt16LE(10)},Le.prototype.cdSize=function(){return this.data.readUInt32LE(12)},Le.prototype.cdOffset=function(){return this.data.readUInt32LE(16)},Le.prototype.cdZipCommentLength=function(){return this.data.readUInt16LE(20)},Le.prototype.cdZipComment=function(){return Bn(this.data,!0,22,this.cdZipCommentLength())},Le.prototype.rawCdZipComment=function(){return this.data.slice(22,22+this.cdZipCommentLength())};var sr=function(t,n,e,r){this.index=t,this.directoryEntries=n,this.eocd=e,this.data=r},Ve=(function(i){function t(n,e,r){e===void 0&&(e=""),r===void 0&&(r=!0),i.call(this),this.name=e,this._index=new _e,this._directoryEntries=[],this._eocd=null,Lt(r,t.Name,{zipData:"zip data as a Buffer",name:e}),n instanceof sr?(this._index=n.index,this._directoryEntries=n.directoryEntries,this._eocd=n.eocd,this.data=n.data):(this.data=n,this.populateIndex())}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){try{t.computeIndex(e.zipData,function(o){var s=new t(o,e.name,!1);r(null,s)},!1)}catch(o){r(o)}},t.isAvailable=function(){return!0},t.RegisterDecompressionMethod=function(e,r){ir[e]=r},t.computeIndex=function(e,r,o){o===void 0&&(o=!0),o&&console.warn("[ZipFS] ZipFS.computeIndex is now deprecated, and will be removed in the next major release. Please update your code to use 'ZipFS.Create({ zipData: zip file as a Buffer}, cb)' instead.");var s=new _e,c=t.getEOCD(e);if(c.diskNumber()!==c.cdDiskNumber())throw new u(a.EINVAL,"ZipFS does not support spanned zip files.");var d=c.cdOffset();if(d===4294967295)throw new u(a.EINVAL,"ZipFS does not support Zip64.");var w=d+c.cdSize();t.computeIndexResponsive(e,s,d,w,r,[],c)},t.getEOCD=function(e){for(var r=22,o=Math.min(r+65535,e.length-1),s=r;s<o;s++)if(e.readUInt32LE(e.length-s)===101010256)return new Le(e.slice(e.length-s));throw new u(a.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")},t.addToIndex=function(e,r){var o=e.fileName();if(o.charAt(0)==="/")throw new Error("WHY IS THIS ABSOLUTE");o.charAt(o.length-1)==="/"&&(o=o.substr(0,o.length-1)),e.isDirectory()?r.addPathFast("/"+o,new ye(e)):r.addPathFast("/"+o,new on(e))},t.computeIndexResponsive=function(e,r,o,s,c,d,w){if(o<s){for(var N=0;N++<200&&o<s;){var M=new Nt(e,e.slice(o));t.addToIndex(M,r),o+=M.totalSize(),d.push(M)}ri(function(){t.computeIndexResponsive(e,r,o,s,c,d,w)})}else c(new sr(r,d,w,e))},t.prototype.getName=function(){return t.Name+(this.name!==""?" "+this.name:"")},t.prototype.getCentralDirectoryEntry=function(e){var r=this._index.getInode(e);if(r===null)throw u.ENOENT(e);if(Ce(r))return r.getData();if(Be(r))return r.getData();throw u.EPERM("Invalid inode: "+r)},t.prototype.getCentralDirectoryEntryAt=function(e){var r=this._directoryEntries[e];if(!r)throw new RangeError("Invalid directory index: "+e+".");return r},t.prototype.getNumberOfCentralDirectoryEntries=function(){return this._directoryEntries.length},t.prototype.getEndOfCentralDirectory=function(){return this._eocd},t.prototype.diskSpace=function(e,r){r(this.data.length,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.statSync=function(e,r){var o=this._index.getInode(e);if(o===null)throw u.ENOENT(e);var s;if(Ce(o))s=o.getData().getStats();else if(Be(o))s=o.getStats();else throw new u(a.EINVAL,"Invalid inode.");return s},t.prototype.openSync=function(e,r,o){if(r.isWriteable())throw new u(a.EPERM,e);var s=this._index.getInode(e);if(s)if(Ce(s)){var c=s.getData(),d=c.getStats();switch(r.pathExistsAction()){case L.THROW_EXCEPTION:case L.TRUNCATE_FILE:throw u.EEXIST(e);case L.NOP:return new le(this,e,r,d,c.getData());default:throw new u(a.EINVAL,"Invalid FileMode object.")}}else throw u.EISDIR(e);else throw u.ENOENT(e)},t.prototype.readdirSync=function(e){var r=this._index.getInode(e);if(r){if(Be(r))return r.getListing();throw u.ENOTDIR(e)}else throw u.ENOENT(e)},t.prototype.readFileSync=function(e,r,o){var s=this.openSync(e,o,420);try{var c=s,d=c.getBuffer();return r===null?Rt(d):d.toString(r)}finally{s.closeSync()}},t.prototype.populateIndex=function(){var e=this,r=this._eocd=t.getEOCD(this.data);if(r.diskNumber()!==r.cdDiskNumber())throw new u(a.EINVAL,"ZipFS does not support spanned zip files.");var o=r.cdOffset();if(o===4294967295)throw new u(a.EINVAL,"ZipFS does not support Zip64.");for(var s=o+r.cdSize();o<s;){var c=new Nt(e.data,e.data.slice(o));o+=c.totalSize(),t.addToIndex(c,e._index),e._directoryEntries.push(c)}},t})(ne);Ve.Name="ZipFS",Ve.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:T},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},Ve.CompressionMethod=sn,Ve.RegisterDecompressionMethod(sn.DEFLATE,function(i,t,n){return Ft(ds(i.slice(0,t),{chunkSize:n}))}),Ve.RegisterDecompressionMethod(sn.STORED,function(i,t,n){return Rt(i,0,n)});var ys="IEEE_P1282";function me(i,t,n){return i.toString("ascii",t,t+n).trim()}function si(i,t,n){if(n===1)return String.fromCharCode(i[t]);for(var e=Math.floor(n/2),r=new Array(e),o=0;o<e;o++){var s=t+(o<<1);r[o]=String.fromCharCode(i[s+1]|i[s]<<8)}return r.join("")}function Te(i,t){var n=parseInt(me(i,t,4),10),e=parseInt(me(i,t+4,2),10),r=parseInt(me(i,t+6,2),10),o=parseInt(me(i,t+8,2),10),s=parseInt(me(i,t+10,2),10),c=parseInt(me(i,t+12,2),10),d=parseInt(me(i,t+14,2),10);return new Date(n,e,r,o,s,c,d*100)}function Ke(i,t){var n=i[t],e=i[t+1],r=i[t+2],o=i[t+3],s=i[t+4],c=i[t+5];return new Date(n,e-1,r,o,s,c)}function ms(i,t){var n=i.slice(t),e=new Qt(n);switch(e.signatureWord()){case 17221:return new fr(n);case 20548:return new ws(n);case 21328:return new hr(n);case 21332:return new pr(n);case 17746:return new dr(n);case 17747:return new Ss(n);case 20568:return new mr(n);case 20558:return new Es(n);case 21324:return new ai(n);case 20045:return new vr(n);case 17228:return new ci(n);case 20556:return new _s(n);case 21061:return new gr(n);case 21574:return new wr(n);case 21318:return new bs(n);case 21074:return new yr(n);default:return e}}function ar(i,t,n,e){n=n-4;for(var r=new Array;t<n;){var o=ms(i,t),s=o.length();if(s===0)return r;if(t+=s,o instanceof pr)break;o instanceof fr?r=r.concat(o.getEntries(e)):r.push(o)}return r}var an=function(t){this._data=t};an.prototype.type=function(){return this._data[0]},an.prototype.standardIdentifier=function(){return me(this._data,1,5)},an.prototype.version=function(){return this._data[6]},an.prototype.data=function(){return this._data.slice(7,2048)};var cr=(function(i){function t(n){i.call(this,n),this._root=null}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.systemIdentifier=function(){return this._getString32(8)},t.prototype.volumeIdentifier=function(){return this._getString32(40)},t.prototype.volumeSpaceSize=function(){return this._data.readUInt32LE(80)},t.prototype.volumeSetSize=function(){return this._data.readUInt16LE(120)},t.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(124)},t.prototype.logicalBlockSize=function(){return this._data.readUInt16LE(128)},t.prototype.pathTableSize=function(){return this._data.readUInt32LE(132)},t.prototype.locationOfTypeLPathTable=function(){return this._data.readUInt32LE(140)},t.prototype.locationOfOptionalTypeLPathTable=function(){return this._data.readUInt32LE(144)},t.prototype.locationOfTypeMPathTable=function(){return this._data.readUInt32BE(148)},t.prototype.locationOfOptionalTypeMPathTable=function(){return this._data.readUInt32BE(152)},t.prototype.rootDirectoryEntry=function(e){return this._root===null&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(e)),this._root},t.prototype.volumeSetIdentifier=function(){return this._getString(190,128)},t.prototype.publisherIdentifier=function(){return this._getString(318,128)},t.prototype.dataPreparerIdentifier=function(){return this._getString(446,128)},t.prototype.applicationIdentifier=function(){return this._getString(574,128)},t.prototype.copyrightFileIdentifier=function(){return this._getString(702,38)},t.prototype.abstractFileIdentifier=function(){return this._getString(740,36)},t.prototype.bibliographicFileIdentifier=function(){return this._getString(776,37)},t.prototype.volumeCreationDate=function(){return Te(this._data,813)},t.prototype.volumeModificationDate=function(){return Te(this._data,830)},t.prototype.volumeExpirationDate=function(){return Te(this._data,847)},t.prototype.volumeEffectiveDate=function(){return Te(this._data,864)},t.prototype.fileStructureVersion=function(){return this._data[881]},t.prototype.applicationUsed=function(){return this._data.slice(883,1395)},t.prototype.reserved=function(){return this._data.slice(1395,2048)},t.prototype._getString32=function(e){return this._getString(e,32)},t})(an),vs=(function(i){function t(n){if(i.call(this,n),this.type()!==1)throw new u(a.EIO,"Invalid primary volume descriptor.")}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.name=function(){return"ISO9660"},t.prototype._constructRootDirectoryRecord=function(e){return new lr(e,-1)},t.prototype._getString=function(e,r){return this._getString(e,r)},t})(cr),gs=(function(i){function t(n){if(i.call(this,n),this.type()!==2)throw new u(a.EIO,"Invalid supplementary volume descriptor.");var e=this.escapeSequence(),r=e[2];if(e[0]!==37||e[1]!==47||r!==64&&r!==67&&r!==69)throw new u(a.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+e.toString())}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.name=function(){return"Joliet"},t.prototype.escapeSequence=function(){return this._data.slice(88,120)},t.prototype._constructRootDirectoryRecord=function(e){return new ur(e,-1)},t.prototype._getString=function(e,r){return si(this._data,e,r)},t})(cr),jt=function(t,n){this._suEntries=null,this._fileOrDir=null,this._data=t,this._rockRidgeOffset=n};jt.prototype.hasRockRidge=function(){return this._rockRidgeOffset>-1},jt.prototype.getRockRidgeOffset=function(){return this._rockRidgeOffset},jt.prototype.rootCheckForRockRidge=function(t){var n=this.getDirectory(t);this._rockRidgeOffset=n.getDotEntry(t)._getRockRidgeOffset(t),this._rockRidgeOffset>-1&&(this._fileOrDir=null)},jt.prototype.length=function(){return this._data[0]},jt.prototype.extendedAttributeRecordLength=function(){return this._data[1]},jt.prototype.lba=function(){return this._data.readUInt32LE(2)*2048},jt.prototype.dataLength=function(){return this._data.readUInt32LE(10)},jt.prototype.recordingDate=function(){return Ke(this._data,18)},jt.prototype.fileFlags=function(){return this._data[25]},jt.prototype.fileUnitSize=function(){return this._data[26]},jt.prototype.interleaveGapSize=function(){return this._data[27]},jt.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(28)},jt.prototype.identifier=function(){return this._getString(33,this._data[32])},jt.prototype.fileName=function(t){if(this.hasRockRidge()){var n=this._rockRidgeFilename(t);if(n!==null)return n}var e=this.identifier();if(this.isDirectory(t))return e;var r=e.indexOf(";");return r===-1?e:e[r-1]==="."?e.slice(0,r-1):e.slice(0,r)},jt.prototype.isDirectory=function(t){var n=!!(this.fileFlags()&2);return!n&&this.hasRockRidge()&&(n=this.getSUEntries(t).filter(function(e){return e instanceof ci}).length>0),n},jt.prototype.isSymlink=function(t){return this.hasRockRidge()&&this.getSUEntries(t).filter(function(n){return n instanceof ai}).length>0},jt.prototype.getSymlinkPath=function(t){for(var n="",e=this.getSUEntries(t),r=this._getGetString(),o=0,s=e;o<s.length;o+=1){var c=s[o];if(c instanceof ai){for(var d=c.componentRecords(),w=0,N=d;w<N.length;w+=1){var M=N[w],q=M.flags();q&2?n+="./":q&4?n+="../":q&8?n+="/":(n+=M.content(r),q&1||(n+="/"))}if(!c.continueFlag())break}}return n.length>1&&n[n.length-1]==="/"?n.slice(0,n.length-1):n},jt.prototype.getFile=function(t){if(this.isDirectory(t))throw new Error("Tried to get a File from a directory.");return this._fileOrDir===null&&(this._fileOrDir=t.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir},jt.prototype.getDirectory=function(t){if(!this.isDirectory(t))throw new Error("Tried to get a Directory from a file.");return this._fileOrDir===null&&(this._fileOrDir=this._constructDirectory(t)),this._fileOrDir},jt.prototype.getSUEntries=function(t){return this._suEntries||this._constructSUEntries(t),this._suEntries},jt.prototype._rockRidgeFilename=function(t){var n=this.getSUEntries(t).filter(function(d){return d instanceof vr});if(n.length===0||n[0].flags()&6)return null;for(var e="",r=this._getGetString(),o=0,s=n;o<s.length;o+=1){var c=s[o];if(e+=c.name(r),!(c.flags()&1))break}return e},jt.prototype._constructSUEntries=function(t){var n=33+this._data[32];n%2===1&&n++,n+=this._rockRidgeOffset,this._suEntries=ar(this._data,n,this.length(),t)},jt.prototype._getRockRidgeOffset=function(t){this._rockRidgeOffset=0;var n=this.getSUEntries(t);if(n.length>0){var e=n[0];if(e instanceof hr&&e.checkBytesPass())for(var r=1;r<n.length;r++){var o=n[r];if(o instanceof yr||o instanceof dr&&o.extensionIdentifier()===ys)return e.bytesSkipped()}}return this._rockRidgeOffset=-1,-1};var lr=(function(i){function t(n,e){i.call(this,n,e)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype._getString=function(e,r){return me(this._data,e,r)},t.prototype._constructDirectory=function(e){return new ks(this,e)},t.prototype._getGetString=function(){return me},t})(jt),ur=(function(i){function t(n,e){i.call(this,n,e)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype._getString=function(e,r){return si(this._data,e,r)},t.prototype._constructDirectory=function(e){return new Is(this,e)},t.prototype._getGetString=function(){return si},t})(jt),Qt=function(t){this._data=t};Qt.prototype.signatureWord=function(){return this._data.readUInt16BE(0)},Qt.prototype.signatureWordString=function(){return me(this._data,0,2)},Qt.prototype.length=function(){return this._data[2]},Qt.prototype.suVersion=function(){return this._data[3]};var fr=(function(i){function t(n){i.call(this,n),this._entries=null}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.continuationLba=function(){return this._data.readUInt32LE(4)},t.prototype.continuationLbaOffset=function(){return this._data.readUInt32LE(12)},t.prototype.continuationLength=function(){return this._data.readUInt32LE(20)},t.prototype.getEntries=function(e){if(!this._entries){var r=this.continuationLba()*2048+this.continuationLbaOffset();this._entries=ar(e,r,this.continuationLength(),e)}return this._entries},t})(Qt),ws=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t})(Qt),hr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.checkBytesPass=function(){return this._data[4]===190&&this._data[5]===239},t.prototype.bytesSkipped=function(){return this._data[6]},t})(Qt),pr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t})(Qt),dr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.identifierLength=function(){return this._data[4]},t.prototype.descriptorLength=function(){return this._data[5]},t.prototype.sourceLength=function(){return this._data[6]},t.prototype.extensionVersion=function(){return this._data[7]},t.prototype.extensionIdentifier=function(){return me(this._data,8,this.identifierLength())},t.prototype.extensionDescriptor=function(){return me(this._data,8+this.identifierLength(),this.descriptorLength())},t.prototype.extensionSource=function(){return me(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())},t})(Qt),Ss=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.extensionSequence=function(){return this._data[4]},t})(Qt),yr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t})(Qt),mr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.mode=function(){return this._data.readUInt32LE(4)},t.prototype.fileLinks=function(){return this._data.readUInt32LE(12)},t.prototype.uid=function(){return this._data.readUInt32LE(20)},t.prototype.gid=function(){return this._data.readUInt32LE(28)},t.prototype.inode=function(){return this._data.readUInt32LE(36)},t})(Qt),Es=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.devTHigh=function(){return this._data.readUInt32LE(4)},t.prototype.devTLow=function(){return this._data.readUInt32LE(12)},t})(Qt),ai=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.continueFlag=function(){return this.flags()&1},t.prototype.componentRecords=function(){for(var e=this,r=new Array,o=5;o<this.length();){var s=new Sn(e._data.slice(o));r.push(s),o+=s.length()}return r},t})(Qt),Sn=function(t){this._data=t};Sn.prototype.flags=function(){return this._data[0]},Sn.prototype.length=function(){return 2+this.componentLength()},Sn.prototype.componentLength=function(){return this._data[1]},Sn.prototype.content=function(t){return t(this._data,2,this.componentLength())};var vr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.name=function(e){return e(this._data,5,this.length()-5)},t})(Qt),ci=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.childDirectoryLba=function(){return this._data.readUInt32LE(4)},t})(Qt),_s=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.parentDirectoryLba=function(){return this._data.readUInt32LE(4)},t})(Qt),gr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t})(Qt),wr=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.creation=function(){return this.flags()&1?this._longFormDates()?Te(this._data,5):Ke(this._data,5):null},t.prototype.modify=function(){if(this.flags()&2){var e=this.flags()&1?1:0;return this._longFormDates?Te(this._data,5+e*17):Ke(this._data,5+e*7)}else return null},t.prototype.access=function(){if(this.flags()&4){var e=this.flags()&1?1:0;return e+=this.flags()&2?1:0,this._longFormDates?Te(this._data,5+e*17):Ke(this._data,5+e*7)}else return null},t.prototype.backup=function(){if(this.flags()&16){var e=this.flags()&1?1:0;return e+=this.flags()&2?1:0,e+=this.flags()&4?1:0,this._longFormDates?Te(this._data,5+e*17):Ke(this._data,5+e*7)}else return null},t.prototype.expiration=function(){if(this.flags()&32){var e=this.flags()&1?1:0;return e+=this.flags()&2?1:0,e+=this.flags()&4?1:0,e+=this.flags()&16?1:0,this._longFormDates?Te(this._data,5+e*17):Ke(this._data,5+e*7)}else return null},t.prototype.effective=function(){if(this.flags()&64){var e=this.flags()&1?1:0;return e+=this.flags()&2?1:0,e+=this.flags()&4?1:0,e+=this.flags()&16?1:0,e+=this.flags()&32?1:0,this._longFormDates?Te(this._data,5+e*17):Ke(this._data,5+e*7)}else return null},t.prototype._longFormDates=function(){return!!this.flags()},t})(Qt),bs=(function(i){function t(n){i.call(this,n)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.virtualSizeHigh=function(){return this._data.readUInt32LE(4)},t.prototype.virtualSizeLow=function(){return this._data.readUInt32LE(12)},t.prototype.tableDepth=function(){return this._data[20]},t})(Qt),En=function(t,n){var e=this;this._fileList=[],this._fileMap={},this._record=t;var r=t.lba(),o=r+t.dataLength();if(!(t.fileFlags()&2)){var s=t.getSUEntries(n).filter(function(N){return N instanceof ci})[0];r=s.childDirectoryLba()*2048,o=1/0}for(;r<o;){var c=n[r];if(c===0){r++;continue}var d=e._constructDirectoryRecord(n.slice(r)),w=d.fileName(n);w!=="\0"&&w!==""?(!d.hasRockRidge()||d.getSUEntries(n).filter(function(N){return N instanceof gr}).length===0)&&(e._fileMap[w]=d,e._fileList.push(w)):o===1/0&&(o=r+d.dataLength()),r+=d.length()}};En.prototype.getRecord=function(t){return this._fileMap[t]},En.prototype.getFileList=function(){return this._fileList},En.prototype.getDotEntry=function(t){return this._constructDirectoryRecord(t.slice(this._record.lba()))};var ks=(function(i){function t(n,e){i.call(this,n,e)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype._constructDirectoryRecord=function(e){return new lr(e,this._record.getRockRidgeOffset())},t})(En),Is=(function(i){function t(n,e){i.call(this,n,e)}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype._constructDirectoryRecord=function(e){return new ur(e,this._record.getRockRidgeOffset())},t})(En),zn=(function(i){function t(n,e,r){var o=this;e===void 0&&(e=""),r===void 0&&(r=!0),i.call(this),this._data=n,Lt(r,t.Name,{data:"ISO data as a Buffer",name:e});for(var s=!1,c=16*2048,d=new Array;!s;){var w=n.slice(c),N=new an(w);switch(N.type()){case 1:d.push(new vs(w));break;case 2:d.push(new gs(w));break;case 255:s=!0;break}c+=2048}if(d.length===0)throw new u(a.EIO,"Unable to find a suitable volume descriptor.");d.forEach(function(M){(!o._pvd||o._pvd.type()!==2)&&(o._pvd=M)}),this._root=this._pvd.rootDirectoryEntry(n),this._name=e}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.Create=function(e,r){var o,s;try{o=new t(e.data,e.name,!1)}catch(c){c=c}finally{r(s,o)}},t.isAvailable=function(){return!0},t.prototype.getName=function(){var e="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(e+="-RockRidge"),e},t.prototype.diskSpace=function(e,r){r(this._data.length,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.statSync=function(e,r){var o=this._getDirectoryRecord(e);if(o===null)throw u.ENOENT(e);return this._getStats(e,o)},t.prototype.openSync=function(e,r,o){if(r.isWriteable())throw new u(a.EPERM,e);var s=this._getDirectoryRecord(e);if(s){if(s.isSymlink(this._data))return this.openSync(m.resolve(e,s.getSymlinkPath(this._data)),r,o);if(s.isDirectory(this._data))throw u.EISDIR(e);var c=s.getFile(this._data),d=this._getStats(e,s);switch(r.pathExistsAction()){case L.THROW_EXCEPTION:case L.TRUNCATE_FILE:throw u.EEXIST(e);case L.NOP:return new le(this,e,r,d,c);default:throw new u(a.EINVAL,"Invalid FileMode object.")}}else throw u.ENOENT(e)},t.prototype.readdirSync=function(e){var r=this._getDirectoryRecord(e);if(r){if(r.isDirectory(this._data))return r.getDirectory(this._data).getFileList().slice(0);throw u.ENOTDIR(e)}else throw u.ENOENT(e)},t.prototype.readFileSync=function(e,r,o){var s=this.openSync(e,o,420);try{var c=s,d=c.getBuffer();return r===null?Rt(d):d.toString(r)}finally{s.closeSync()}},t.prototype._getDirectoryRecord=function(e){var r=this;if(e==="/")return this._root;for(var o=e.split("/").slice(1),s=this._root,c=0,d=o;c<d.length;c+=1){var w=d[c];if(s.isDirectory(r._data)){if(s=s.getDirectory(r._data).getRecord(w),!s)return null}else return null}return s},t.prototype._getStats=function(e,r){if(r.isSymlink(this._data)){var o=m.resolve(e,r.getSymlinkPath(this._data)),s=this._getDirectoryRecord(o);return s?this._getStats(o,s):null}else{var c=r.dataLength(),d=365,w=r.recordingDate(),N=w,M=w,q=w;if(r.hasRockRidge())for(var $=r.getSUEntries(this._data),nt=0,ut=$;nt<ut.length;nt+=1){var yt=ut[nt];if(yt instanceof mr)d=yt.mode();else if(yt instanceof wr){var It=yt.flags();It&4&&(N=yt.access()),It&2&&(M=yt.modify()),It&1&&(q=yt.creation())}}return d=d&365,new A(r.isDirectory(this._data)?C.DIRECTORY:C.FILE,c,d,N,M,q)}},t})(ne);zn.Name="IsoFS",zn.Options={data:{type:"object",description:"The ISO file in a buffer",validator:T}},[k,Ln,Tn,tn,Rn,en,pn,zn,yn,nn,gn,Mn,Pn,Ve].forEach(function(i){var t=i.Create;i.Create=function(n,e){var r=typeof n=="function",o=r?n:e,s=r?{}:n;function c(d){d?o(d):t.call(i,s,o)}R(i,s,c)}});var Un={AsyncMirror:k,Dropbox:Ln,Emscripten:Tn,FolderAdapter:tn,HTML5FS:Rn,InMemory:en,IndexedDB:pn,IsoFS:zn,LocalStorage:yn,MountableFileSystem:nn,OverlayFS:gn,WorkerFS:Mn,XmlHttpRequest:Pn,ZipFS:Ve};F.initializeTTYs&&F.initializeTTYs();function Fs(i){i.Buffer=g,i.process=F;var t=i.require?i.require:null;i.require=function(n){var e=Sr(n);return e||t.apply(null,Array.prototype.slice.call(arguments,0))}}function Ls(i,t){Un[i]=t}function Sr(i){switch(i){case"fs":return lt;case"path":return m;case"buffer":return S;case"process":return F;case"bfs_utils":return Z;default:return Un[i]}}function Er(i){return lt.initialize(i)}function Ts(i,t){li(i,function(n,e){e?(Er(e),t()):t(n)})}function li(i,t){var n=i.fs;if(!n)return t(new u(a.EPERM,'Missing "fs" property on configuration object.'));var e=i.options,r=0,o=!1;function s(){if(!o){o=!0;var w=Un[n];w?w.Create(e,t):t(new u(a.EPERM,"File system "+n+" is not available in BrowserFS."))}}if(e!==null&&typeof e=="object"){var c=!1,d=Object.keys(e).filter(function(w){return w!=="fs"});d.forEach(function(w){var N=e[w];N!==null&&typeof N=="object"&&N.fs&&(r++,li(N,function(M,q){if(r--,M){if(o)return;o=!0,t(M)}else e[w]=q,r===0&&c&&s()}))}),c=!0}r===0&&s()}"ab".substr(-1)!=="b"&&(String.prototype.substr=(function(i){return function(t,n){return t<0&&(t=this.length+t),i.call(this,t,n)}})(String.prototype.substr)),typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&(Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(i,t){i===void 0&&(i=0),t===void 0&&(t=this.length);var n=this;return i<0&&(i=this.length+i,i<0&&(i=0)),t<0&&(t=this.length+t,t<0&&(t=0)),t<i&&(t=i),new Uint8Array(n.buffer,n.byteOffset+i,t-i)})),y.install=Fs,y.registerFileSystem=Ls,y.BFSRequire=Sr,y.initialize=Er,y.configure=Ts,y.getFileSystem=li,y.EmscriptenFS=bt,y.FileSystem=Un,y.Errors=D,y.setImmediate=ri}).call(y,v(1),(function(){return this})(),v(5)(p),v(6))},function(p,y,v){p.exports=v(2).Buffer},function(p,y,v){(function(a){var x=v(3),b=v(4);y.Buffer=a,y.SlowBuffer=H,y.INSPECT_MAX_BYTES=50;var F=2147483647;y.kMaxLength=F,a.TYPED_ARRAY_SUPPORT=S(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function S(){try{var k=new Uint8Array(1);return k.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},k.foo()===42}catch{return!1}}function m(k){if(k>F)throw new RangeError("Invalid typed array length");var f=new Uint8Array(k);return f.__proto__=a.prototype,f}function a(k,f,h){if(typeof k=="number"){if(typeof f=="string")throw new Error("If encoding is specified then the first argument must be a string");return L(k)}return _(k,f,h)}typeof Symbol<"u"&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192;function _(k,f,h){if(typeof k=="number")throw new TypeError('"value" argument must not be a number');return oe(k)?A(k,f,h):typeof k=="string"?O(k,f):K(k)}a.from=function(k,f,h){return _(k,f,h)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array;function u(k){if(typeof k!="number")throw new TypeError('"size" argument must be a number');if(k<0)throw new RangeError('"size" argument must not be negative')}function D(k,f,h){return u(k),k<=0?m(k):f!==void 0?typeof h=="string"?m(k).fill(f,h):m(k).fill(f):m(k)}a.alloc=function(k,f,h){return D(k,f,h)};function L(k){return u(k),m(k<0?0:B(k)|0)}a.allocUnsafe=function(k){return L(k)},a.allocUnsafeSlow=function(k){return L(k)};function O(k,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError('"encoding" must be a valid string encoding');var h=St(k,f)|0,I=m(h),P=I.write(k,f);return P!==h&&(I=I.slice(0,P)),I}function C(k){for(var f=k.length<0?0:B(k.length)|0,h=m(f),I=0;I<f;I+=1)h[I]=k[I]&255;return h}function A(k,f,h){if(f<0||k.byteLength<f)throw new RangeError("'offset' is out of bounds");if(k.byteLength<f+(h||0))throw new RangeError("'length' is out of bounds");var I;return f===void 0&&h===void 0?I=new Uint8Array(k):h===void 0?I=new Uint8Array(k,f):I=new Uint8Array(k,f,h),I.__proto__=a.prototype,I}function K(k){if(a.isBuffer(k)){var f=B(k.length)|0,h=m(f);return h.length===0||k.copy(h,0,0,f),h}if(k){if(le(k)||"length"in k)return typeof k.length!="number"||be(k.length)?m(0):C(k);if(k.type==="Buffer"&&Array.isArray(k.data))return C(k.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function B(k){if(k>=F)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+F.toString(16)+" bytes");return k|0}function H(k){return+k!=k&&(k=0),a.alloc(+k)}a.isBuffer=function(f){return f!=null&&f._isBuffer===!0},a.compare=function(f,h){if(!a.isBuffer(f)||!a.isBuffer(h))throw new TypeError("Arguments must be Buffers");if(f===h)return 0;for(var I=f.length,P=h.length,G=0,V=Math.min(I,P);G<V;++G)if(f[G]!==h[G]){I=f[G],P=h[G];break}return I<P?-1:P<I?1:0},a.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(f,h){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return a.alloc(0);var I;if(h===void 0)for(h=0,I=0;I<f.length;++I)h+=f[I].length;var P=a.allocUnsafe(h),G=0;for(I=0;I<f.length;++I){var V=f[I];if(!a.isBuffer(V))throw new TypeError('"list" argument must be an Array of Buffers');V.copy(P,G),G+=V.length}return P};function St(k,f){if(a.isBuffer(k))return k.length;if(le(k)||oe(k))return k.byteLength;typeof k!="string"&&(k=""+k);var h=k.length;if(h===0)return 0;for(var I=!1;;)switch(f){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":case void 0:return pt(k).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return ne(k).length;default:if(I)return pt(k).length;f=(""+f).toLowerCase(),I=!0}}a.byteLength=St;function tt(k,f,h){var I=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,f>>>=0,h<=f))return"";for(k||(k="utf8");;)switch(k){case"hex":return Ft(this,f,h);case"utf8":case"utf-8":return Zt(this,f,h);case"ascii":return J(this,f,h);case"latin1":case"binary":return ft(this,f,h);case"base64":return Et(this,f,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gt(this,f,h);default:if(I)throw new TypeError("Unknown encoding: "+k);k=(k+"").toLowerCase(),I=!0}}a.prototype._isBuffer=!0;function kt(k,f,h){var I=k[f];k[f]=k[h],k[h]=I}a.prototype.swap16=function(){var f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<f;h+=2)kt(this,h,h+1);return this},a.prototype.swap32=function(){var f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<f;h+=4)kt(this,h,h+3),kt(this,h+1,h+2);return this},a.prototype.swap64=function(){var f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<f;h+=8)kt(this,h,h+7),kt(this,h+1,h+6),kt(this,h+2,h+5),kt(this,h+3,h+4);return this},a.prototype.toString=function(){var f=this.length;return f===0?"":arguments.length===0?Zt(this,0,f):tt.apply(this,arguments)},a.prototype.equals=function(f){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:a.compare(this,f)===0},a.prototype.inspect=function(){var f="",h=y.INSPECT_MAX_BYTES;return this.length>0&&(f=this.toString("hex",0,h).match(/.{2}/g).join(" "),this.length>h&&(f+=" ... ")),"<Buffer "+f+">"},a.prototype.compare=function(f,h,I,P,G){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");if(h===void 0&&(h=0),I===void 0&&(I=f?f.length:0),P===void 0&&(P=0),G===void 0&&(G=this.length),h<0||I>f.length||P<0||G>this.length)throw new RangeError("out of range index");if(P>=G&&h>=I)return 0;if(P>=G)return-1;if(h>=I)return 1;if(h>>>=0,I>>>=0,P>>>=0,G>>>=0,this===f)return 0;for(var V=G-P,Tt=I-h,Dt=Math.min(V,Tt),Pt=this.slice(P,G),Vt=f.slice(h,I),At=0;At<Dt;++At)if(Pt[At]!==Vt[At]){V=Pt[At],Tt=Vt[At];break}return V<Tt?-1:Tt<V?1:0};function dt(k,f,h,I,P){if(k.length===0)return-1;if(typeof h=="string"?(I=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,be(h)&&(h=P?0:k.length-1),h<0&&(h=k.length+h),h>=k.length){if(P)return-1;h=k.length-1}else if(h<0)if(P)h=0;else return-1;if(typeof f=="string"&&(f=a.from(f,I)),a.isBuffer(f))return f.length===0?-1:U(k,f,h,I,P);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(k,f,h):Uint8Array.prototype.lastIndexOf.call(k,f,h):U(k,[f],h,I,P);throw new TypeError("val must be string, number or Buffer")}function U(k,f,h,I,P){var G=1,V=k.length,Tt=f.length;if(I!==void 0&&(I=String(I).toLowerCase(),I==="ucs2"||I==="ucs-2"||I==="utf16le"||I==="utf-16le")){if(k.length<2||f.length<2)return-1;G=2,V/=2,Tt/=2,h/=2}function Dt(Je,Ue){return G===1?Je[Ue]:Je.readUInt16BE(Ue*G)}var Pt;if(P){var Vt=-1;for(Pt=h;Pt<V;Pt++)if(Dt(k,Pt)===Dt(f,Vt===-1?0:Pt-Vt)){if(Vt===-1&&(Vt=Pt),Pt-Vt+1===Tt)return Vt*G}else Vt!==-1&&(Pt-=Pt-Vt),Vt=-1}else for(h+Tt>V&&(h=V-Tt),Pt=h;Pt>=0;Pt--){for(var At=!0,ke=0;ke<Tt;ke++)if(Dt(k,Pt+ke)!==Dt(f,ke)){At=!1;break}if(At)return Pt}return-1}a.prototype.includes=function(f,h,I){return this.indexOf(f,h,I)!==-1},a.prototype.indexOf=function(f,h,I){return dt(this,f,h,I,!0)},a.prototype.lastIndexOf=function(f,h,I){return dt(this,f,h,I,!1)};function et(k,f,h,I){h=Number(h)||0;var P=k.length-h;I?(I=Number(I),I>P&&(I=P)):I=P;var G=f.length;if(G%2!==0)throw new TypeError("Invalid hex string");I>G/2&&(I=G/2);for(var V=0;V<I;++V){var Tt=parseInt(f.substr(V*2,2),16);if(be(Tt))return V;k[h+V]=Tt}return V}function lt(k,f,h,I){return vt(pt(f,k.length-h),k,h,I)}function xt(k,f,h,I){return vt(bt(f),k,h,I)}function mt(k,f,h,I){return xt(k,f,h,I)}function Ct(k,f,h,I){return vt(ne(f),k,h,I)}function Lt(k,f,h,I){return vt(Q(f,k.length-h),k,h,I)}a.prototype.write=function(f,h,I,P){if(h===void 0)P="utf8",I=this.length,h=0;else if(I===void 0&&typeof h=="string")P=h,I=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(I)?(I=I>>>0,P===void 0&&(P="utf8")):(P=I,I=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var G=this.length-h;if((I===void 0||I>G)&&(I=G),f.length>0&&(I<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");for(var V=!1;;)switch(P){case"hex":return et(this,f,h,I);case"utf8":case"utf-8":return lt(this,f,h,I);case"ascii":return xt(this,f,h,I);case"latin1":case"binary":return mt(this,f,h,I);case"base64":return Ct(this,f,h,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Lt(this,f,h,I);default:if(V)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),V=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Et(k,f,h){return f===0&&h===k.length?x.fromByteArray(k):x.fromByteArray(k.slice(f,h))}function Zt(k,f,h){h=Math.min(k.length,h);for(var I=[],P=f;P<h;){var G=k[P],V=null,Tt=G>239?4:G>223?3:G>191?2:1;if(P+Tt<=h){var Dt,Pt,Vt,At;switch(Tt){case 1:G<128&&(V=G);break;case 2:Dt=k[P+1],(Dt&192)===128&&(At=(G&31)<<6|Dt&63,At>127&&(V=At));break;case 3:Dt=k[P+1],Pt=k[P+2],(Dt&192)===128&&(Pt&192)===128&&(At=(G&15)<<12|(Dt&63)<<6|Pt&63,At>2047&&(At<55296||At>57343)&&(V=At));break;case 4:Dt=k[P+1],Pt=k[P+2],Vt=k[P+3],(Dt&192)===128&&(Pt&192)===128&&(Vt&192)===128&&(At=(G&15)<<18|(Dt&63)<<12|(Pt&63)<<6|Vt&63,At>65535&&At<1114112&&(V=At))}}V===null?(V=65533,Tt=1):V>65535&&(V-=65536,I.push(V>>>10&1023|55296),V=56320|V&1023),I.push(V),P+=Tt}return z(I)}var j=4096;function z(k){var f=k.length;if(f<=j)return String.fromCharCode.apply(String,k);for(var h="",I=0;I<f;)h+=String.fromCharCode.apply(String,k.slice(I,I+=j));return h}function J(k,f,h){var I="";h=Math.min(k.length,h);for(var P=f;P<h;++P)I+=String.fromCharCode(k[P]&127);return I}function ft(k,f,h){var I="";h=Math.min(k.length,h);for(var P=f;P<h;++P)I+=String.fromCharCode(k[P]);return I}function Ft(k,f,h){var I=k.length;(!f||f<0)&&(f=0),(!h||h<0||h>I)&&(h=I);for(var P="",G=f;G<h;++G)P+=it(k[G]);return P}function gt(k,f,h){for(var I=k.slice(f,h),P="",G=0;G<I.length;G+=2)P+=String.fromCharCode(I[G]+I[G+1]*256);return P}a.prototype.slice=function(f,h){var I=this.length;f=~~f,h=h===void 0?I:~~h,f<0?(f+=I,f<0&&(f=0)):f>I&&(f=I),h<0?(h+=I,h<0&&(h=0)):h>I&&(h=I),h<f&&(h=f);var P=this.subarray(f,h);return P.__proto__=a.prototype,P};function _t(k,f,h){if(k%1!==0||k<0)throw new RangeError("offset is not uint");if(k+f>h)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUIntLE=function(f,h,I){f=f>>>0,h=h>>>0,I||_t(f,h,this.length);for(var P=this[f],G=1,V=0;++V<h&&(G*=256);)P+=this[f+V]*G;return P},a.prototype.readUIntBE=function(f,h,I){f=f>>>0,h=h>>>0,I||_t(f,h,this.length);for(var P=this[f+--h],G=1;h>0&&(G*=256);)P+=this[f+--h]*G;return P},a.prototype.readUInt8=function(f,h){return f=f>>>0,h||_t(f,1,this.length),this[f]},a.prototype.readUInt16LE=function(f,h){return f=f>>>0,h||_t(f,2,this.length),this[f]|this[f+1]<<8},a.prototype.readUInt16BE=function(f,h){return f=f>>>0,h||_t(f,2,this.length),this[f]<<8|this[f+1]},a.prototype.readUInt32LE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},a.prototype.readUInt32BE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},a.prototype.readIntLE=function(f,h,I){f=f>>>0,h=h>>>0,I||_t(f,h,this.length);for(var P=this[f],G=1,V=0;++V<h&&(G*=256);)P+=this[f+V]*G;return G*=128,P>=G&&(P-=Math.pow(2,8*h)),P},a.prototype.readIntBE=function(f,h,I){f=f>>>0,h=h>>>0,I||_t(f,h,this.length);for(var P=h,G=1,V=this[f+--P];P>0&&(G*=256);)V+=this[f+--P]*G;return G*=128,V>=G&&(V-=Math.pow(2,8*h)),V},a.prototype.readInt8=function(f,h){return f=f>>>0,h||_t(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},a.prototype.readInt16LE=function(f,h){f=f>>>0,h||_t(f,2,this.length);var I=this[f]|this[f+1]<<8;return I&32768?I|4294901760:I},a.prototype.readInt16BE=function(f,h){f=f>>>0,h||_t(f,2,this.length);var I=this[f+1]|this[f]<<8;return I&32768?I|4294901760:I},a.prototype.readInt32LE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},a.prototype.readInt32BE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},a.prototype.readFloatLE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),b.read(this,f,!0,23,4)},a.prototype.readFloatBE=function(f,h){return f=f>>>0,h||_t(f,4,this.length),b.read(this,f,!1,23,4)},a.prototype.readDoubleLE=function(f,h){return f=f>>>0,h||_t(f,8,this.length),b.read(this,f,!0,52,8)},a.prototype.readDoubleBE=function(f,h){return f=f>>>0,h||_t(f,8,this.length),b.read(this,f,!1,52,8)};function Rt(k,f,h,I,P,G){if(!a.isBuffer(k))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>P||f<G)throw new RangeError('"value" argument is out of bounds');if(h+I>k.length)throw new RangeError("Index out of range")}a.prototype.writeUIntLE=function(f,h,I,P){if(f=+f,h=h>>>0,I=I>>>0,!P){var G=Math.pow(2,8*I)-1;Rt(this,f,h,I,G,0)}var V=1,Tt=0;for(this[h]=f&255;++Tt<I&&(V*=256);)this[h+Tt]=f/V&255;return h+I},a.prototype.writeUIntBE=function(f,h,I,P){if(f=+f,h=h>>>0,I=I>>>0,!P){var G=Math.pow(2,8*I)-1;Rt(this,f,h,I,G,0)}var V=I-1,Tt=1;for(this[h+V]=f&255;--V>=0&&(Tt*=256);)this[h+V]=f/Tt&255;return h+I},a.prototype.writeUInt8=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,1,255,0),this[h]=f&255,h+1},a.prototype.writeUInt16LE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,2,65535,0),this[h]=f&255,this[h+1]=f>>>8,h+2},a.prototype.writeUInt16BE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,2,65535,0),this[h]=f>>>8,this[h+1]=f&255,h+2},a.prototype.writeUInt32LE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,4,4294967295,0),this[h+3]=f>>>24,this[h+2]=f>>>16,this[h+1]=f>>>8,this[h]=f&255,h+4},a.prototype.writeUInt32BE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,4,4294967295,0),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4},a.prototype.writeIntLE=function(f,h,I,P){if(f=+f,h=h>>>0,!P){var G=Math.pow(2,8*I-1);Rt(this,f,h,I,G-1,-G)}var V=0,Tt=1,Dt=0;for(this[h]=f&255;++V<I&&(Tt*=256);)f<0&&Dt===0&&this[h+V-1]!==0&&(Dt=1),this[h+V]=(f/Tt>>0)-Dt&255;return h+I},a.prototype.writeIntBE=function(f,h,I,P){if(f=+f,h=h>>>0,!P){var G=Math.pow(2,8*I-1);Rt(this,f,h,I,G-1,-G)}var V=I-1,Tt=1,Dt=0;for(this[h+V]=f&255;--V>=0&&(Tt*=256);)f<0&&Dt===0&&this[h+V+1]!==0&&(Dt=1),this[h+V]=(f/Tt>>0)-Dt&255;return h+I},a.prototype.writeInt8=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,1,127,-128),f<0&&(f=255+f+1),this[h]=f&255,h+1},a.prototype.writeInt16LE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,2,32767,-32768),this[h]=f&255,this[h+1]=f>>>8,h+2},a.prototype.writeInt16BE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,2,32767,-32768),this[h]=f>>>8,this[h+1]=f&255,h+2},a.prototype.writeInt32LE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,4,2147483647,-2147483648),this[h]=f&255,this[h+1]=f>>>8,this[h+2]=f>>>16,this[h+3]=f>>>24,h+4},a.prototype.writeInt32BE=function(f,h,I){return f=+f,h=h>>>0,I||Rt(this,f,h,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[h]=f>>>24,this[h+1]=f>>>16,this[h+2]=f>>>8,this[h+3]=f&255,h+4};function Wt(k,f,h,I,P,G){if(h+I>k.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function Mt(k,f,h,I,P){return f=+f,h=h>>>0,P||Wt(k,f,h,4),b.write(k,f,h,I,23,4),h+4}a.prototype.writeFloatLE=function(f,h,I){return Mt(this,f,h,!0,I)},a.prototype.writeFloatBE=function(f,h,I){return Mt(this,f,h,!1,I)};function T(k,f,h,I,P){return f=+f,h=h>>>0,P||Wt(k,f,h,8),b.write(k,f,h,I,52,8),h+8}a.prototype.writeDoubleLE=function(f,h,I){return T(this,f,h,!0,I)},a.prototype.writeDoubleBE=function(f,h,I){return T(this,f,h,!1,I)},a.prototype.copy=function(f,h,I,P){if(I||(I=0),!P&&P!==0&&(P=this.length),h>=f.length&&(h=f.length),h||(h=0),P>0&&P<I&&(P=I),P===I||f.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("sourceStart out of bounds");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),f.length-h<P-I&&(P=f.length-h+I);var G=P-I,V;if(this===f&&I<h&&h<P)for(V=G-1;V>=0;--V)f[V+h]=this[V+I];else if(G<1e3)for(V=0;V<G;++V)f[V+h]=this[V+I];else Uint8Array.prototype.set.call(f,this.subarray(I,I+G),h);return G},a.prototype.fill=function(f,h,I,P){if(typeof f=="string"){if(typeof h=="string"?(P=h,h=0,I=this.length):typeof I=="string"&&(P=I,I=this.length),f.length===1){var G=f.charCodeAt(0);G<256&&(f=G)}if(P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!a.isEncoding(P))throw new TypeError("Unknown encoding: "+P)}else typeof f=="number"&&(f=f&255);if(h<0||this.length<h||this.length<I)throw new RangeError("Out of range index");if(I<=h)return this;h=h>>>0,I=I===void 0?this.length:I>>>0,f||(f=0);var V;if(typeof f=="number")for(V=h;V<I;++V)this[V]=f;else{var Tt=a.isBuffer(f)?f:new a(f,P),Dt=Tt.length;for(V=0;V<I-h;++V)this[V+h]=Tt[V%Dt]}return this};var R=/[^+/0-9A-Za-z-_]/g;function Z(k){if(k=k.trim().replace(R,""),k.length<2)return"";for(;k.length%4!==0;)k=k+"=";return k}function it(k){return k<16?"0"+k.toString(16):k.toString(16)}function pt(k,f){f=f||1/0;for(var h,I=k.length,P=null,G=[],V=0;V<I;++V){if(h=k.charCodeAt(V),h>55295&&h<57344){if(!P){if(h>56319){(f-=3)>-1&&G.push(239,191,189);continue}else if(V+1===I){(f-=3)>-1&&G.push(239,191,189);continue}P=h;continue}if(h<56320){(f-=3)>-1&&G.push(239,191,189),P=h;continue}h=(P-55296<<10|h-56320)+65536}else P&&(f-=3)>-1&&G.push(239,191,189);if(P=null,h<128){if((f-=1)<0)break;G.push(h)}else if(h<2048){if((f-=2)<0)break;G.push(h>>6|192,h&63|128)}else if(h<65536){if((f-=3)<0)break;G.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((f-=4)<0)break;G.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return G}function bt(k){for(var f=[],h=0;h<k.length;++h)f.push(k.charCodeAt(h)&255);return f}function Q(k,f){for(var h,I,P,G=[],V=0;V<k.length&&!((f-=2)<0);++V)h=k.charCodeAt(V),I=h>>8,P=h%256,G.push(P),G.push(I);return G}function ne(k){return x.toByteArray(Z(k))}function vt(k,f,h,I){for(var P=0;P<I&&!(P+h>=f.length||P>=k.length);++P)f[P+h]=k[P];return P}function oe(k){return k instanceof ArrayBuffer||k!=null&&k.constructor!=null&&k.constructor.name==="ArrayBuffer"&&typeof k.byteLength=="number"}function le(k){return typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(k)}function be(k){return k!==k}}).call(y,v(1))},function(p,y){y.byteLength=a,y.toByteArray=_,y.fromByteArray=L;for(var v=[],g=[],x=typeof Uint8Array<"u"?Uint8Array:Array,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=0,S=b.length;F<S;++F)v[F]=b[F],g[b.charCodeAt(F)]=F;g[45]=62,g[95]=63;function m(O){var C=O.length;if(C%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return O[C-2]==="="?2:O[C-1]==="="?1:0}function a(O){return O.length*3/4-m(O)}function _(O){var C,A,K,B,H,St,tt=O.length;H=m(O),St=new x(tt*3/4-H),K=H>0?tt-4:tt;var kt=0;for(C=0,A=0;C<K;C+=4,A+=3)B=g[O.charCodeAt(C)]<<18|g[O.charCodeAt(C+1)]<<12|g[O.charCodeAt(C+2)]<<6|g[O.charCodeAt(C+3)],St[kt++]=B>>16&255,St[kt++]=B>>8&255,St[kt++]=B&255;return H===2?(B=g[O.charCodeAt(C)]<<2|g[O.charCodeAt(C+1)]>>4,St[kt++]=B&255):H===1&&(B=g[O.charCodeAt(C)]<<10|g[O.charCodeAt(C+1)]<<4|g[O.charCodeAt(C+2)]>>2,St[kt++]=B>>8&255,St[kt++]=B&255),St}function u(O){return v[O>>18&63]+v[O>>12&63]+v[O>>6&63]+v[O&63]}function D(O,C,A){for(var K,B=[],H=C;H<A;H+=3)K=(O[H]<<16)+(O[H+1]<<8)+O[H+2],B.push(u(K));return B.join("")}function L(O){for(var C,A=O.length,K=A%3,B="",H=[],St=16383,tt=0,kt=A-K;tt<kt;tt+=St)H.push(D(O,tt,tt+St>kt?kt:tt+St));return K===1?(C=O[A-1],B+=v[C>>2],B+=v[C<<4&63],B+="=="):K===2&&(C=(O[A-2]<<8)+O[A-1],B+=v[C>>10],B+=v[C>>4&63],B+=v[C<<2&63],B+="="),H.push(B),H.join("")}},function(p,y){y.read=function(v,g,x,b,F){var S,m,a=F*8-b-1,_=(1<<a)-1,u=_>>1,D=-7,L=x?F-1:0,O=x?-1:1,C=v[g+L];for(L+=O,S=C&(1<<-D)-1,C>>=-D,D+=a;D>0;S=S*256+v[g+L],L+=O,D-=8);for(m=S&(1<<-D)-1,S>>=-D,D+=b;D>0;m=m*256+v[g+L],L+=O,D-=8);if(S===0)S=1-u;else{if(S===_)return m?NaN:(C?-1:1)*(1/0);m=m+Math.pow(2,b),S=S-u}return(C?-1:1)*m*Math.pow(2,S-b)},y.write=function(v,g,x,b,F,S){var m,a,_,u=S*8-F-1,D=(1<<u)-1,L=D>>1,O=F===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=b?0:S-1,A=b?1:-1,K=g<0||g===0&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(a=isNaN(g)?1:0,m=D):(m=Math.floor(Math.log(g)/Math.LN2),g*(_=Math.pow(2,-m))<1&&(m--,_*=2),m+L>=1?g+=O/_:g+=O*Math.pow(2,1-L),g*_>=2&&(m++,_/=2),m+L>=D?(a=0,m=D):m+L>=1?(a=(g*_-1)*Math.pow(2,F),m=m+L):(a=g*Math.pow(2,L-1)*Math.pow(2,F),m=0));F>=8;v[x+C]=a&255,C+=A,a/=256,F-=8);for(m=m<<F|a,u+=F;u>0;v[x+C]=m&255,C+=A,m/=256,u-=8);v[x+C-A]|=K*128}},function(p,y){p.exports=function(v){return v.webpackPolyfill||(v.deprecate=function(){},v.paths=[],v.children=[],v.webpackPolyfill=1),v}},function(p,y,v){var g=v(7),x=new g,b={};function F(m){b[m]||(typeof x[m]=="function"?b[m]=function(){return x[m].apply(x,arguments)}:b[m]=x[m])}for(var S in x)F(S);b.initializeTTYs=function(){x.stdin===null&&(x.initializeTTYs(),b.stdin=x.stdin,b.stdout=x.stdout,b.stderr=x.stderr)},x.nextTick(function(){b.initializeTTYs()}),p.exports=b},function(p,y,v){(function(g){var x=this&&this.__extends||function(_,u){for(var D in u)u.hasOwnProperty(D)&&(_[D]=u[D]);function L(){this.constructor=_}_.prototype=u===null?Object.create(u):(L.prototype=u.prototype,new L)},b=v(8),F=null,S=(function(){function _(u,D){this.fun=u,this.array=D}return _.prototype.run=function(){this.fun.apply(null,this.array)},_})(),m=(function(){function _(){this._queue=[],this._draining=!1,this._currentQueue=null,this._queueIndex=-1}return _.prototype.push=function(u){var D=this;this._queue.push(u)===1&&!this._draining&&setTimeout(function(){return D._drainQueue()},0)},_.prototype._cleanUpNextTick=function(){this._draining=!1,this._currentQueue&&this._currentQueue.length?this._queue=this._currentQueue.concat(this._queue):this._queueIndex=-1,this._queue.length&&this._drainQueue()},_.prototype._drainQueue=function(){var u=this;if(!this._draining){var D=setTimeout(function(){return u._cleanUpNextTick()});this._draining=!0;for(var L=this._queue.length;L;){for(this._currentQueue=this._queue,this._queue=[];++this._queueIndex<L;)this._currentQueue&&this._currentQueue[this._queueIndex].run();this._queueIndex=-1,L=this._queue.length}this._currentQueue=null,this._draining=!1,clearTimeout(D)}},_})(),a=(function(_){x(u,_);function u(){_.apply(this,arguments),this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.execArgv=[],this.stdout=null,this.stderr=null,this.stdin=null,this.domain=null,this._queue=new m,this.execPath=g,this.env={},this.exitCode=0,this._gid=1,this._uid=1,this.version="v5.0",this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"},this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:!1,node_install_waf:!1,node_prefix:"",node_shared_cares:!1,node_shared_http_parser:!1,node_shared_libuv:!1,node_shared_zlib:!1,node_shared_v8:!1,node_use_dtrace:!1,node_use_etw:!1,node_use_openssl:!1,node_shared_openssl:!1,strict_aliasing:!1,target_arch:"x32",v8_use_snapshot:!1,v8_no_strict_aliasing:0,visibility:""}},this.pid=Math.random()*1e3|0,this.title="node",this.arch="x32",this._mask=18,this.connected=void 0}return u.prototype.chdir=function(D){F===null&&(F=v(9)),this._cwd=F.resolve(D)},u.prototype.cwd=function(){return this._cwd},u.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},u.prototype.nextTick=function(D){for(var L=[],O=1;O<arguments.length;O++)L[O-1]=arguments[O];this._queue.push(new S(D,L))},u.prototype.abort=function(){this.emit("abort")},u.prototype.exit=function(D){this.exitCode=D,this.emit("exit",[D])},u.prototype.getgid=function(){return this._gid},u.prototype.setgid=function(D){typeof D=="number"?this._gid=D:this._gid=1},u.prototype.getuid=function(){return this._uid},u.prototype.setuid=function(D){typeof D=="number"?this._uid=D:this._uid=1},u.prototype.kill=function(D,L){this.emit("kill",[D,L])},u.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}},u.prototype.umask=function(D){D===void 0&&(D=this._mask);var L=this._mask;return this._mask=D,this.emit("umask",[D]),L},u.prototype.hrtime=function(){var D;typeof performance<"u"?D=performance.now():Date.now?D=Date.now():D=new Date().getTime();var L=D/1e3|0;return D-=L*1e3,D=D*1e6|0,[L,D]},u.prototype.initializeTTYs=function(){if(this.stdout===null){var D=v(10);this.stdout=new D,this.stderr=new D,this.stdin=new D}},u.prototype.disconnect=function(){},u})(b.EventEmitter);p.exports=a}).call(y,"/")},function(p,y){function v(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}p.exports=v,v.EventEmitter=v,v.prototype._events=void 0,v.prototype._maxListeners=void 0,v.defaultMaxListeners=10,v.prototype.setMaxListeners=function(S){if(!x(S)||S<0||isNaN(S))throw TypeError("n must be a positive number");return this._maxListeners=S,this},v.prototype.emit=function(S){var m,a,_,u,D,L;if(this._events||(this._events={}),S==="error"&&(!this._events.error||b(this._events.error)&&!this._events.error.length)){if(m=arguments[1],m instanceof Error)throw m;var O=new Error('Uncaught, unspecified "error" event. ('+m+")");throw O.context=m,O}if(a=this._events[S],F(a))return!1;if(g(a))switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),a.apply(this,u)}else if(b(a))for(u=Array.prototype.slice.call(arguments,1),L=a.slice(),_=L.length,D=0;D<_;D++)L[D].apply(this,u);return!0},v.prototype.addListener=function(S,m){var a;if(!g(m))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",S,g(m.listener)?m.listener:m),this._events[S]?b(this._events[S])?this._events[S].push(m):this._events[S]=[this._events[S],m]:this._events[S]=m,b(this._events[S])&&!this._events[S].warned&&(F(this._maxListeners)?a=v.defaultMaxListeners:a=this._maxListeners,a&&a>0&&this._events[S].length>a&&(this._events[S].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[S].length),typeof console.trace=="function"&&console.trace())),this},v.prototype.on=v.prototype.addListener,v.prototype.once=function(S,m){if(!g(m))throw TypeError("listener must be a function");var a=!1;function _(){this.removeListener(S,_),a||(a=!0,m.apply(this,arguments))}return _.listener=m,this.on(S,_),this},v.prototype.removeListener=function(S,m){var a,_,u,D;if(!g(m))throw TypeError("listener must be a function");if(!this._events||!this._events[S])return this;if(a=this._events[S],u=a.length,_=-1,a===m||g(a.listener)&&a.listener===m)delete this._events[S],this._events.removeListener&&this.emit("removeListener",S,m);else if(b(a)){for(D=u;D-- >0;)if(a[D]===m||a[D].listener&&a[D].listener===m){_=D;break}if(_<0)return this;a.length===1?(a.length=0,delete this._events[S]):a.splice(_,1),this._events.removeListener&&this.emit("removeListener",S,m)}return this},v.prototype.removeAllListeners=function(S){var m,a;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[S]&&delete this._events[S],this;if(arguments.length===0){for(m in this._events)m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events={},this}if(a=this._events[S],g(a))this.removeListener(S,a);else if(a)for(;a.length;)this.removeListener(S,a[a.length-1]);return delete this._events[S],this},v.prototype.listeners=function(S){var m;return!this._events||!this._events[S]?m=[]:g(this._events[S])?m=[this._events[S]]:m=this._events[S].slice(),m},v.prototype.listenerCount=function(S){if(this._events){var m=this._events[S];if(g(m))return 1;if(m)return m.length}return 0},v.listenerCount=function(S,m){return S.listenerCount(m)};function g(S){return typeof S=="function"}function x(S){return typeof S=="number"}function b(S){return typeof S=="object"&&S!==null}function F(S){return S===void 0}},function(p,y,v){(function(g){var x=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;function b(S){var m=x.exec(S);return m.shift(),m}var F=(function(){function S(){}return S.normalize=function(m){m===""&&(m=".");var a=m.charAt(0)===S.sep;m=S._removeDuplicateSeps(m);for(var _=m.split(S.sep),u=[],D=0;D<_.length;D++){var L=_[D];L!=="."&&(L===".."&&(a||!a&&u.length>0&&u[0]!=="..")?u.pop():u.push(L))}return!a&&u.length<2&&(u.length===1?u[0]===""&&u.unshift("."):u.push(".")),m=u.join(S.sep),a&&m.charAt(0)!==S.sep&&(m=S.sep+m),m},S.join=function(){for(var m=[],a=0;a<arguments.length;a++)m[a-0]=arguments[a];for(var _=[],u=0;u<m.length;u++){var D=m[u];if(typeof D!="string")throw new TypeError("Invalid argument type to path.join: "+typeof D);D!==""&&_.push(D)}return S.normalize(_.join(S.sep))},S.resolve=function(){for(var m=[],a=0;a<arguments.length;a++)m[a-0]=arguments[a];for(var _=[],u=0;u<m.length;u++){var D=m[u];if(typeof D!="string")throw new TypeError("Invalid argument type to path.join: "+typeof D);D!==""&&(D.charAt(0)===S.sep&&(_=[]),_.push(D))}var L=S.normalize(_.join(S.sep));if(L.length>1&&L.charAt(L.length-1)===S.sep)return L.substr(0,L.length-1);if(L.charAt(0)!==S.sep){L.charAt(0)==="."&&(L.length===1||L.charAt(1)===S.sep)&&(L=L.length===1?"":L.substr(2));var O=g.cwd();L!==""?L=this.normalize(O+(O!=="/"?S.sep:"")+L):L=O}return L},S.relative=function(m,a){var _;m=S.resolve(m),a=S.resolve(a);var u=m.split(S.sep),D=a.split(S.sep);D.shift(),u.shift();var L=0,O=[];for(_=0;_<u.length;_++){var C=u[_];if(C!==D[_]){L=u.length-_;break}}O=D.slice(_),u.length===1&&u[0]===""&&(L=0),L>u.length&&(L=u.length);var A="";for(_=0;_<L;_++)A+="../";return A+=O.join(S.sep),A.length>1&&A.charAt(A.length-1)===S.sep&&(A=A.substr(0,A.length-1)),A},S.dirname=function(m){m=S._removeDuplicateSeps(m);var a=m.charAt(0)===S.sep,_=m.split(S.sep);return _.pop()===""&&_.length>0&&_.pop(),_.length>1||_.length===1&&!a?_.join(S.sep):a?S.sep:"."},S.basename=function(m,a){if(a===void 0&&(a=""),m==="")return m;m=S.normalize(m);var _=m.split(S.sep),u=_[_.length-1];if(u===""&&_.length>1)return _[_.length-2];if(a.length>0){var D=u.substr(u.length-a.length);if(D===a)return u.substr(0,u.length-a.length)}return u},S.extname=function(m){m=S.normalize(m);var a=m.split(S.sep);if(m=a.pop(),m===""&&a.length>0&&(m=a.pop()),m==="..")return"";var _=m.lastIndexOf(".");return _===-1||_===0?"":m.substr(_)},S.isAbsolute=function(m){return m.length>0&&m.charAt(0)===S.sep},S._makeLong=function(m){return m},S.parse=function(m){var a=b(m);return{root:a[0],dir:a[0]+a[1].slice(0,-1),base:a[2],ext:a[3],name:a[2].slice(0,a[2].length-a[3].length)}},S.format=function(m){if(m===null||typeof m!="object")throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof m);var a=m.root||"";if(typeof a!="string")throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof m.root);var _=m.dir?m.dir+S.sep:"",u=m.base||"";return _+u},S._removeDuplicateSeps=function(m){return m=m.replace(this._replaceRegex,this.sep),m},S.sep="/",S._replaceRegex=new RegExp("//+","g"),S.delimiter=":",S.posix=S,S.win32=S,S})();p.exports=F}).call(y,v(6))},function(p,y,v){(function(g){var x=this&&this.__extends||function(S,m){for(var a in m)m.hasOwnProperty(a)&&(S[a]=m[a]);function _(){this.constructor=S}S.prototype=m===null?Object.create(m):(_.prototype=m.prototype,new _)},b=v(11),F=(function(S){x(m,S);function m(){S.call(this),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0,this._bufferedWrites=[],this._waitingForWrites=!1}return m.prototype.setRawMode=function(a){this.isRaw!==a&&(this.isRaw=a,this.emit("modeChange"))},m.prototype.changeColumns=function(a){a!==this.columns&&(this.columns=a,this.emit("resize"))},m.prototype.changeRows=function(a){a!==this.rows&&(this.rows=a,this.emit("resize"))},m.isatty=function(a){return a&&a instanceof m},m.prototype._write=function(a,_,u){var D;try{var L;typeof a=="string"?L=new g(a,_):L=a,this._bufferedWrites.push(L),this._waitingForWrites&&this._read(1024)}catch(O){D=O}finally{u(D)}},m.prototype._read=function(a){if(this._bufferedWrites.length===0)this._waitingForWrites=!0;else for(;this._bufferedWrites.length>0&&(this._waitingForWrites=this.push(this._bufferedWrites.shift()),!!this._waitingForWrites););},m})(b.Duplex);p.exports=F}).call(y,v(1))},function(p,y,v){p.exports=b;var g=v(8).EventEmitter,x=v(12);x(b,g),b.Readable=v(13),b.Writable=v(27),b.Duplex=v(28),b.Transform=v(29),b.PassThrough=v(30),b.Stream=b;function b(){g.call(this)}b.prototype.pipe=function(F,S){var m=this;function a(A){F.writable&&F.write(A)===!1&&m.pause&&m.pause()}m.on("data",a);function _(){m.readable&&m.resume&&m.resume()}F.on("drain",_),!F._isStdio&&(!S||S.end!==!1)&&(m.on("end",D),m.on("close",L));var u=!1;function D(){u||(u=!0,F.end())}function L(){u||(u=!0,typeof F.destroy=="function"&&F.destroy())}function O(A){if(C(),g.listenerCount(this,"error")===0)throw A}m.on("error",O),F.on("error",O);function C(){m.removeListener("data",a),F.removeListener("drain",_),m.removeListener("end",D),m.removeListener("close",L),m.removeListener("error",O),F.removeListener("error",O),m.removeListener("end",C),m.removeListener("close",C),F.removeListener("close",C)}return m.on("end",C),m.on("close",C),F.on("close",C),F.emit("pipe",m),F}},function(p,y){typeof Object.create=="function"?p.exports=function(g,x){g.super_=x,g.prototype=Object.create(x.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:p.exports=function(g,x){g.super_=x;var b=function(){};b.prototype=x.prototype,g.prototype=new b,g.prototype.constructor=g}},function(p,y,v){(function(g){var x=(function(){try{return v(11)}catch{}})();y=p.exports=v(14),y.Stream=x||y,y.Readable=y,y.Writable=v(22),y.Duplex=v(21),y.Transform=v(25),y.PassThrough=v(26),!g.browser&&g.env.READABLE_STREAM==="disable"&&x&&(p.exports=x)}).call(y,v(6))},function(p,y,v){(function(g){p.exports=B;var x=v(15),b=v(16),F;B.ReadableState=K,v(8).EventEmitter;var S=function(T,R){return T.listeners(R).length},m;(function(){try{m=v(11)}catch{}finally{m||(m=v(8).EventEmitter)}})();var a=v(2).Buffer,_=v(17),u=v(18);u.inherits=v(12);var D=v(19),L=void 0;D&&D.debuglog?L=D.debuglog("stream"):L=function(){};var O=v(20),C;u.inherits(B,m);function A(T,R,Z){if(typeof T.prependListener=="function")return T.prependListener(R,Z);!T._events||!T._events[R]?T.on(R,Z):b(T._events[R])?T._events[R].unshift(Z):T._events[R]=[Z,T._events[R]]}function K(T,R){F=F||v(21),T=T||{},this.objectMode=!!T.objectMode,R instanceof F&&(this.objectMode=this.objectMode||!!T.readableObjectMode);var Z=T.highWaterMark,it=this.objectMode?16:16*1024;this.highWaterMark=Z||Z===0?Z:it,this.highWaterMark=~~this.highWaterMark,this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=T.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,T.encoding&&(C||(C=v(24).StringDecoder),this.decoder=new C(T.encoding),this.encoding=T.encoding)}function B(T){if(F=F||v(21),!(this instanceof B))return new B(T);this._readableState=new K(T,this),this.readable=!0,T&&typeof T.read=="function"&&(this._read=T.read),m.call(this)}B.prototype.push=function(T,R){var Z=this._readableState;return!Z.objectMode&&typeof T=="string"&&(R=R||Z.defaultEncoding,R!==Z.encoding&&(T=_.from(T,R),R="")),H(this,Z,T,R,!1)},B.prototype.unshift=function(T){var R=this._readableState;return H(this,R,T,"",!0)},B.prototype.isPaused=function(){return this._readableState.flowing===!1};function H(T,R,Z,it,pt){var bt=U(R,Z);if(bt)T.emit("error",bt);else if(Z===null)R.reading=!1,et(T,R);else if(R.objectMode||Z&&Z.length>0)if(R.ended&&!pt){var Q=new Error("stream.push() after EOF");T.emit("error",Q)}else if(R.endEmitted&&pt){var ne=new Error("stream.unshift() after end event");T.emit("error",ne)}else{var vt;R.decoder&&!pt&&!it&&(Z=R.decoder.write(Z),vt=!R.objectMode&&Z.length===0),pt||(R.reading=!1),vt||(R.flowing&&R.length===0&&!R.sync?(T.emit("data",Z),T.read(0)):(R.length+=R.objectMode?1:Z.length,pt?R.buffer.unshift(Z):R.buffer.push(Z),R.needReadable&&lt(T))),mt(T,R)}else pt||(R.reading=!1);return St(R)}function St(T){return!T.ended&&(T.needReadable||T.length<T.highWaterMark||T.length===0)}B.prototype.setEncoding=function(T){return C||(C=v(24).StringDecoder),this._readableState.decoder=new C(T),this._readableState.encoding=T,this};var tt=8388608;function kt(T){return T>=tt?T=tt:(T--,T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,T|=T>>>16,T++),T}function dt(T,R){return T<=0||R.length===0&&R.ended?0:R.objectMode?1:T!==T?R.flowing&&R.length?R.buffer.head.data.length:R.length:(T>R.highWaterMark&&(R.highWaterMark=kt(T)),T<=R.length?T:R.ended?R.length:(R.needReadable=!0,0))}B.prototype.read=function(T){L("read",T),T=parseInt(T,10);var R=this._readableState,Z=T;if(T!==0&&(R.emittedReadable=!1),T===0&&R.needReadable&&(R.length>=R.highWaterMark||R.ended))return L("read: emitReadable",R.length,R.ended),R.length===0&&R.ended?_t(this):lt(this),null;if(T=dt(T,R),T===0&&R.ended)return R.length===0&&_t(this),null;var it=R.needReadable;L("need readable",it),(R.length===0||R.length-T<R.highWaterMark)&&(it=!0,L("length less than watermark",it)),R.ended||R.reading?(it=!1,L("reading or ended",it)):it&&(L("do read"),R.reading=!0,R.sync=!0,R.length===0&&(R.needReadable=!0),this._read(R.highWaterMark),R.sync=!1,R.reading||(T=dt(Z,R)));var pt;return T>0?pt=J(T,R):pt=null,pt===null?(R.needReadable=!0,T=0):R.length-=T,R.length===0&&(R.ended||(R.needReadable=!0),Z!==T&&R.ended&&_t(this)),pt!==null&&this.emit("data",pt),pt};function U(T,R){var Z=null;return!a.isBuffer(R)&&typeof R!="string"&&R!==null&&R!==void 0&&!T.objectMode&&(Z=new TypeError("Invalid non-string/buffer chunk")),Z}function et(T,R){if(!R.ended){if(R.decoder){var Z=R.decoder.end();Z&&Z.length&&(R.buffer.push(Z),R.length+=R.objectMode?1:Z.length)}R.ended=!0,lt(T)}}function lt(T){var R=T._readableState;R.needReadable=!1,R.emittedReadable||(L("emitReadable",R.flowing),R.emittedReadable=!0,R.sync?x(xt,T):xt(T))}function xt(T){L("emit readable"),T.emit("readable"),z(T)}function mt(T,R){R.readingMore||(R.readingMore=!0,x(Ct,T,R))}function Ct(T,R){for(var Z=R.length;!R.reading&&!R.flowing&&!R.ended&&R.length<R.highWaterMark&&(L("maybeReadMore read 0"),T.read(0),Z!==R.length);)Z=R.length;R.readingMore=!1}B.prototype._read=function(T){this.emit("error",new Error("_read() is not implemented"))},B.prototype.pipe=function(T,R){var Z=this,it=this._readableState;switch(it.pipesCount){case 0:it.pipes=T;break;case 1:it.pipes=[it.pipes,T];break;default:it.pipes.push(T);break}it.pipesCount+=1,L("pipe count=%d opts=%j",it.pipesCount,R);var pt=(!R||R.end!==!1)&&T!==g.stdout&&T!==g.stderr,bt=pt?ne:le;it.endEmitted?x(bt):Z.once("end",bt),T.on("unpipe",Q);function Q(G){L("onunpipe"),G===Z&&le()}function ne(){L("onend"),T.end()}var vt=Lt(Z);T.on("drain",vt);var oe=!1;function le(){L("cleanup"),T.removeListener("close",h),T.removeListener("finish",I),T.removeListener("drain",vt),T.removeListener("error",f),T.removeListener("unpipe",Q),Z.removeListener("end",ne),Z.removeListener("end",le),Z.removeListener("data",k),oe=!0,it.awaitDrain&&(!T._writableState||T._writableState.needDrain)&&vt()}var be=!1;Z.on("data",k);function k(G){L("ondata"),be=!1;var V=T.write(G);V===!1&&!be&&((it.pipesCount===1&&it.pipes===T||it.pipesCount>1&&Mt(it.pipes,T)!==-1)&&!oe&&(L("false write response, pause",Z._readableState.awaitDrain),Z._readableState.awaitDrain++,be=!0),Z.pause())}function f(G){L("onerror",G),P(),T.removeListener("error",f),S(T,"error")===0&&T.emit("error",G)}A(T,"error",f);function h(){T.removeListener("finish",I),P()}T.once("close",h);function I(){L("onfinish"),T.removeListener("close",h),P()}T.once("finish",I);function P(){L("unpipe"),Z.unpipe(T)}return T.emit("pipe",Z),it.flowing||(L("pipe resume"),Z.resume()),T};function Lt(T){return function(){var R=T._readableState;L("pipeOnDrain",R.awaitDrain),R.awaitDrain&&R.awaitDrain--,R.awaitDrain===0&&S(T,"data")&&(R.flowing=!0,z(T))}}B.prototype.unpipe=function(T){var R=this._readableState;if(R.pipesCount===0)return this;if(R.pipesCount===1)return T&&T!==R.pipes?this:(T||(T=R.pipes),R.pipes=null,R.pipesCount=0,R.flowing=!1,T&&T.emit("unpipe",this),this);if(!T){var Z=R.pipes,it=R.pipesCount;R.pipes=null,R.pipesCount=0,R.flowing=!1;for(var pt=0;pt<it;pt++)Z[pt].emit("unpipe",this);return this}var bt=Mt(R.pipes,T);return bt===-1?this:(R.pipes.splice(bt,1),R.pipesCount-=1,R.pipesCount===1&&(R.pipes=R.pipes[0]),T.emit("unpipe",this),this)},B.prototype.on=function(T,R){var Z=m.prototype.on.call(this,T,R);if(T==="data")this._readableState.flowing!==!1&&this.resume();else if(T==="readable"){var it=this._readableState;!it.endEmitted&&!it.readableListening&&(it.readableListening=it.needReadable=!0,it.emittedReadable=!1,it.reading?it.length&&lt(this):x(Et,this))}return Z},B.prototype.addListener=B.prototype.on;function Et(T){L("readable nexttick read 0"),T.read(0)}B.prototype.resume=function(){var T=this._readableState;return T.flowing||(L("resume"),T.flowing=!0,Zt(this,T)),this};function Zt(T,R){R.resumeScheduled||(R.resumeScheduled=!0,x(j,T,R))}function j(T,R){R.reading||(L("resume read 0"),T.read(0)),R.resumeScheduled=!1,R.awaitDrain=0,T.emit("resume"),z(T),R.flowing&&!R.reading&&T.read(0)}B.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function z(T){var R=T._readableState;for(L("flow",R.flowing);R.flowing&&T.read()!==null;);}B.prototype.wrap=function(T){var R=this._readableState,Z=!1,it=this;T.on("end",function(){if(L("wrapped end"),R.decoder&&!R.ended){var Q=R.decoder.end();Q&&Q.length&&it.push(Q)}it.push(null)}),T.on("data",function(Q){if(L("wrapped data"),R.decoder&&(Q=R.decoder.write(Q)),!(R.objectMode&&Q==null)&&!(!R.objectMode&&(!Q||!Q.length))){var ne=it.push(Q);ne||(Z=!0,T.pause())}});for(var pt in T)this[pt]===void 0&&typeof T[pt]=="function"&&(this[pt]=(function(Q){return function(){return T[Q].apply(T,arguments)}})(pt));var bt=["error","close","destroy","pause","resume"];return Wt(bt,function(Q){T.on(Q,it.emit.bind(it,Q))}),it._read=function(Q){L("wrapped _read",Q),Z&&(Z=!1,T.resume())},it},B._fromList=J;function J(T,R){if(R.length===0)return null;var Z;return R.objectMode?Z=R.buffer.shift():!T||T>=R.length?(R.decoder?Z=R.buffer.join(""):R.buffer.length===1?Z=R.buffer.head.data:Z=R.buffer.concat(R.length),R.buffer.clear()):Z=ft(T,R.buffer,R.decoder),Z}function ft(T,R,Z){var it;return T<R.head.data.length?(it=R.head.data.slice(0,T),R.head.data=R.head.data.slice(T)):T===R.head.data.length?it=R.shift():it=Z?Ft(T,R):gt(T,R),it}function Ft(T,R){var Z=R.head,it=1,pt=Z.data;for(T-=pt.length;Z=Z.next;){var bt=Z.data,Q=T>bt.length?bt.length:T;if(Q===bt.length?pt+=bt:pt+=bt.slice(0,T),T-=Q,T===0){Q===bt.length?(++it,Z.next?R.head=Z.next:R.head=R.tail=null):(R.head=Z,Z.data=bt.slice(Q));break}++it}return R.length-=it,pt}function gt(T,R){var Z=_.allocUnsafe(T),it=R.head,pt=1;for(it.data.copy(Z),T-=it.data.length;it=it.next;){var bt=it.data,Q=T>bt.length?bt.length:T;if(bt.copy(Z,Z.length-T,0,Q),T-=Q,T===0){Q===bt.length?(++pt,it.next?R.head=it.next:R.head=R.tail=null):(R.head=it,it.data=bt.slice(Q));break}++pt}return R.length-=pt,Z}function _t(T){var R=T._readableState;if(R.length>0)throw new Error('"endReadable()" called on non-empty stream');R.endEmitted||(R.ended=!0,x(Rt,R,T))}function Rt(T,R){!T.endEmitted&&T.length===0&&(T.endEmitted=!0,R.readable=!1,R.emit("end"))}function Wt(T,R){for(var Z=0,it=T.length;Z<it;Z++)R(T[Z],Z)}function Mt(T,R){for(var Z=0,it=T.length;Z<it;Z++)if(T[Z]===R)return Z;return-1}}).call(y,v(6))},function(p,y,v){(function(g){!g.version||g.version.indexOf("v0.")===0||g.version.indexOf("v1.")===0&&g.version.indexOf("v1.8.")!==0?p.exports=x:p.exports=g.nextTick;function x(b,F,S,m){if(typeof b!="function")throw new TypeError('"callback" argument must be a function');var a=arguments.length,_,u;switch(a){case 0:case 1:return g.nextTick(b);case 2:return g.nextTick(function(){b.call(null,F)});case 3:return g.nextTick(function(){b.call(null,F,S)});case 4:return g.nextTick(function(){b.call(null,F,S,m)});default:for(_=new Array(a-1),u=0;u<_.length;)_[u++]=arguments[u];return g.nextTick(function(){b.apply(null,_)})}}}).call(y,v(6))},function(p,y){var v={}.toString;p.exports=Array.isArray||function(g){return v.call(g)=="[object Array]"}},function(p,y,v){(function(g){var x=v(2),b=x.Buffer,F=x.SlowBuffer,S=x.kMaxLength||2147483647;y.alloc=function(a,_,u){if(typeof b.alloc=="function")return b.alloc(a,_,u);if(typeof u=="number")throw new TypeError("encoding must not be number");if(typeof a!="number")throw new TypeError("size must be a number");if(a>S)throw new RangeError("size is too large");var D=u,L=_;L===void 0&&(D=void 0,L=0);var O=new b(a);if(typeof L=="string")for(var C=new b(L,D),A=C.length,K=-1;++K<a;)O[K]=C[K%A];else O.fill(L);return O},y.allocUnsafe=function(a){if(typeof b.allocUnsafe=="function")return b.allocUnsafe(a);if(typeof a!="number")throw new TypeError("size must be a number");if(a>S)throw new RangeError("size is too large");return new b(a)},y.from=function(a,_,u){if(typeof b.from=="function"&&(!g.Uint8Array||Uint8Array.from!==b.from))return b.from(a,_,u);if(typeof a=="number")throw new TypeError('"value" argument must not be a number');if(typeof a=="string")return new b(a,_);if(typeof ArrayBuffer<"u"&&a instanceof ArrayBuffer){var D=_;if(arguments.length===1)return new b(a);typeof D>"u"&&(D=0);var L=u;if(typeof L>"u"&&(L=a.byteLength-D),D>=a.byteLength)throw new RangeError("'offset' is out of bounds");if(L>a.byteLength-D)throw new RangeError("'length' is out of bounds");return new b(a.slice(D,D+L))}if(b.isBuffer(a)){var O=new b(a.length);return a.copy(O,0,0,a.length),O}if(a){if(Array.isArray(a)||typeof ArrayBuffer<"u"&&a.buffer instanceof ArrayBuffer||"length"in a)return new b(a);if(a.type==="Buffer"&&Array.isArray(a.data))return new b(a.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},y.allocUnsafeSlow=function(a){if(typeof b.allocUnsafeSlow=="function")return b.allocUnsafeSlow(a);if(typeof a!="number")throw new TypeError("size must be a number");if(a>=S)throw new RangeError("size is too large");return new F(a)}}).call(y,(function(){return this})())},function(p,y,v){(function(g){function x(H){return Array.isArray?Array.isArray(H):B(H)==="[object Array]"}y.isArray=x;function b(H){return typeof H=="boolean"}y.isBoolean=b;function F(H){return H===null}y.isNull=F;function S(H){return H==null}y.isNullOrUndefined=S;function m(H){return typeof H=="number"}y.isNumber=m;function a(H){return typeof H=="string"}y.isString=a;function _(H){return typeof H=="symbol"}y.isSymbol=_;function u(H){return H===void 0}y.isUndefined=u;function D(H){return B(H)==="[object RegExp]"}y.isRegExp=D;function L(H){return typeof H=="object"&&H!==null}y.isObject=L;function O(H){return B(H)==="[object Date]"}y.isDate=O;function C(H){return B(H)==="[object Error]"||H instanceof Error}y.isError=C;function A(H){return typeof H=="function"}y.isFunction=A;function K(H){return H===null||typeof H=="boolean"||typeof H=="number"||typeof H=="string"||typeof H=="symbol"||typeof H>"u"}y.isPrimitive=K,y.isBuffer=g.isBuffer;function B(H){return Object.prototype.toString.call(H)}}).call(y,v(1))},function(p,y){},function(p,y,v){v(2).Buffer;var g=v(17);p.exports=x;function x(){this.head=null,this.tail=null,this.length=0}x.prototype.push=function(b){var F={data:b,next:null};this.length>0?this.tail.next=F:this.head=F,this.tail=F,++this.length},x.prototype.unshift=function(b){var F={data:b,next:this.head};this.length===0&&(this.tail=F),this.head=F,++this.length},x.prototype.shift=function(){if(this.length!==0){var b=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,b}},x.prototype.clear=function(){this.head=this.tail=null,this.length=0},x.prototype.join=function(b){if(this.length===0)return"";for(var F=this.head,S=""+F.data;F=F.next;)S+=b+F.data;return S},x.prototype.concat=function(b){if(this.length===0)return g.alloc(0);if(this.length===1)return this.head.data;for(var F=g.allocUnsafe(b>>>0),S=this.head,m=0;S;)S.data.copy(F,m),m+=S.data.length,S=S.next;return F}},function(p,y,v){var g=Object.keys||function(O){var C=[];for(var A in O)C.push(A);return C};p.exports=u;var x=v(15),b=v(18);b.inherits=v(12);var F=v(14),S=v(22);b.inherits(u,F);for(var m=g(S.prototype),a=0;a<m.length;a++){var _=m[a];u.prototype[_]||(u.prototype[_]=S.prototype[_])}function u(O){if(!(this instanceof u))return new u(O);F.call(this,O),S.call(this,O),O&&O.readable===!1&&(this.readable=!1),O&&O.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,O&&O.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",D)}function D(){this.allowHalfOpen||this._writableState.ended||x(L,this)}function L(O){O.end()}},function(p,y,v){(function(g){p.exports=A;var x=v(15),b=!g.browser&&["v0.10","v0.9."].indexOf(g.version.slice(0,5))>-1?setImmediate:x,F;A.WritableState=O;var S=v(18);S.inherits=v(12);var m={deprecate:v(23)},a;(function(){try{a=v(11)}catch{}finally{a||(a=v(8).EventEmitter)}})();var _=v(2).Buffer,u=v(17);S.inherits(A,a);function D(){}function L(j,z,J){this.chunk=j,this.encoding=z,this.callback=J,this.next=null}function O(j,z){F=F||v(21),j=j||{},this.objectMode=!!j.objectMode,z instanceof F&&(this.objectMode=this.objectMode||!!j.writableObjectMode);var J=j.highWaterMark,ft=this.objectMode?16:16*1024;this.highWaterMark=J||J===0?J:ft,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var Ft=j.decodeStrings===!1;this.decodeStrings=!Ft,this.defaultEncoding=j.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(gt){U(z,gt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Zt(this)}O.prototype.getBuffer=function(){for(var z=this.bufferedRequest,J=[];z;)J.push(z),z=z.next;return J},(function(){try{Object.defineProperty(O.prototype,"buffer",{get:m.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch{}})();var C;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(C=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(j){return C.call(this,j)?!0:j&&j._writableState instanceof O}})):C=function(j){return j instanceof this};function A(j){if(F=F||v(21),!C.call(A,this)&&!(this instanceof F))return new A(j);this._writableState=new O(j,this),this.writable=!0,j&&(typeof j.write=="function"&&(this._write=j.write),typeof j.writev=="function"&&(this._writev=j.writev)),a.call(this)}A.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function K(j,z){var J=new Error("write after end");j.emit("error",J),x(z,J)}function B(j,z,J,ft){var Ft=!0,gt=!1;return J===null?gt=new TypeError("May not write null values to stream"):typeof J!="string"&&J!==void 0&&!z.objectMode&&(gt=new TypeError("Invalid non-string/buffer chunk")),gt&&(j.emit("error",gt),x(ft,gt),Ft=!1),Ft}A.prototype.write=function(j,z,J){var ft=this._writableState,Ft=!1,gt=_.isBuffer(j);return typeof z=="function"&&(J=z,z=null),gt?z="buffer":z||(z=ft.defaultEncoding),typeof J!="function"&&(J=D),ft.ended?K(this,J):(gt||B(this,ft,j,J))&&(ft.pendingcb++,Ft=St(this,ft,gt,j,z,J)),Ft},A.prototype.cork=function(){var j=this._writableState;j.corked++},A.prototype.uncork=function(){var j=this._writableState;j.corked&&(j.corked--,!j.writing&&!j.corked&&!j.finished&&!j.bufferProcessing&&j.bufferedRequest&&xt(this,j))},A.prototype.setDefaultEncoding=function(z){if(typeof z=="string"&&(z=z.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((z+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+z);return this._writableState.defaultEncoding=z,this};function H(j,z,J){return!j.objectMode&&j.decodeStrings!==!1&&typeof z=="string"&&(z=u.from(z,J)),z}function St(j,z,J,ft,Ft,gt){J||(ft=H(z,ft,Ft),_.isBuffer(ft)&&(Ft="buffer"));var _t=z.objectMode?1:ft.length;z.length+=_t;var Rt=z.length<z.highWaterMark;if(Rt||(z.needDrain=!0),z.writing||z.corked){var Wt=z.lastBufferedRequest;z.lastBufferedRequest=new L(ft,Ft,gt),Wt?Wt.next=z.lastBufferedRequest:z.bufferedRequest=z.lastBufferedRequest,z.bufferedRequestCount+=1}else tt(j,z,!1,_t,ft,Ft,gt);return Rt}function tt(j,z,J,ft,Ft,gt,_t){z.writelen=ft,z.writecb=_t,z.writing=!0,z.sync=!0,J?j._writev(Ft,z.onwrite):j._write(Ft,gt,z.onwrite),z.sync=!1}function kt(j,z,J,ft,Ft){--z.pendingcb,J?x(Ft,ft):Ft(ft),j._writableState.errorEmitted=!0,j.emit("error",ft)}function dt(j){j.writing=!1,j.writecb=null,j.length-=j.writelen,j.writelen=0}function U(j,z){var J=j._writableState,ft=J.sync,Ft=J.writecb;if(dt(J),z)kt(j,J,ft,z,Ft);else{var gt=mt(J);!gt&&!J.corked&&!J.bufferProcessing&&J.bufferedRequest&&xt(j,J),ft?b(et,j,J,gt,Ft):et(j,J,gt,Ft)}}function et(j,z,J,ft){J||lt(j,z),z.pendingcb--,ft(),Lt(j,z)}function lt(j,z){z.length===0&&z.needDrain&&(z.needDrain=!1,j.emit("drain"))}function xt(j,z){z.bufferProcessing=!0;var J=z.bufferedRequest;if(j._writev&&J&&J.next){var ft=z.bufferedRequestCount,Ft=new Array(ft),gt=z.corkedRequestsFree;gt.entry=J;for(var _t=0;J;)Ft[_t]=J,J=J.next,_t+=1;tt(j,z,!0,z.length,Ft,"",gt.finish),z.pendingcb++,z.lastBufferedRequest=null,gt.next?(z.corkedRequestsFree=gt.next,gt.next=null):z.corkedRequestsFree=new Zt(z)}else{for(;J;){var Rt=J.chunk,Wt=J.encoding,Mt=J.callback,T=z.objectMode?1:Rt.length;if(tt(j,z,!1,T,Rt,Wt,Mt),J=J.next,z.writing)break}J===null&&(z.lastBufferedRequest=null)}z.bufferedRequestCount=0,z.bufferedRequest=J,z.bufferProcessing=!1}A.prototype._write=function(j,z,J){J(new Error("_write() is not implemented"))},A.prototype._writev=null,A.prototype.end=function(j,z,J){var ft=this._writableState;typeof j=="function"?(J=j,j=null,z=null):typeof z=="function"&&(J=z,z=null),j!=null&&this.write(j,z),ft.corked&&(ft.corked=1,this.uncork()),!ft.ending&&!ft.finished&&Et(this,ft,J)};function mt(j){return j.ending&&j.length===0&&j.bufferedRequest===null&&!j.finished&&!j.writing}function Ct(j,z){z.prefinished||(z.prefinished=!0,j.emit("prefinish"))}function Lt(j,z){var J=mt(z);return J&&(z.pendingcb===0?(Ct(j,z),z.finished=!0,j.emit("finish")):Ct(j,z)),J}function Et(j,z,J){z.ending=!0,Lt(j,z),J&&(z.finished?x(J):j.once("finish",J)),z.ended=!0,j.writable=!1}function Zt(j){var z=this;this.next=null,this.entry=null,this.finish=function(J){var ft=z.entry;for(z.entry=null;ft;){var Ft=ft.callback;j.pendingcb--,Ft(J),ft=ft.next}j.corkedRequestsFree?j.corkedRequestsFree.next=z:j.corkedRequestsFree=z}}}).call(y,v(6))},function(p,y){(function(v){p.exports=g;function g(b,F){if(x("noDeprecation"))return b;var S=!1;function m(){if(!S){if(x("throwDeprecation"))throw new Error(F);x("traceDeprecation")?console.trace(F):console.warn(F),S=!0}return b.apply(this,arguments)}return m}function x(b){try{if(!v.localStorage)return!1}catch{return!1}var F=v.localStorage[b];return F==null?!1:String(F).toLowerCase()==="true"}}).call(y,(function(){return this})())},function(p,y,v){var g=v(2).Buffer,x=g.isEncoding||function(_){switch(_&&_.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function b(_){if(_&&!x(_))throw new Error("Unknown encoding: "+_)}var F=y.StringDecoder=function(_){switch(this.encoding=(_||"utf8").toLowerCase().replace(/[-_]/,""),b(_),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=m;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:this.write=S;return}this.charBuffer=new g(6),this.charReceived=0,this.charLength=0};F.prototype.write=function(_){for(var u="";this.charLength;){var D=_.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:_.length;if(_.copy(this.charBuffer,this.charReceived,0,D),this.charReceived+=D,this.charReceived<this.charLength)return"";_=_.slice(D,_.length),u=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var O=u.charCodeAt(u.length-1);if(O>=55296&&O<=56319){this.charLength+=this.surrogateSize,u="";continue}if(this.charReceived=this.charLength=0,_.length===0)return u;break}this.detectIncompleteChar(_);var L=_.length;this.charLength&&(_.copy(this.charBuffer,0,_.length-this.charReceived,L),L-=this.charReceived),u+=_.toString(this.encoding,0,L);var L=u.length-1,O=u.charCodeAt(L);if(O>=55296&&O<=56319){var C=this.surrogateSize;return this.charLength+=C,this.charReceived+=C,this.charBuffer.copy(this.charBuffer,C,0,C),_.copy(this.charBuffer,0,0,C),u.substring(0,L)}return u},F.prototype.detectIncompleteChar=function(_){for(var u=_.length>=3?3:_.length;u>0;u--){var D=_[_.length-u];if(u==1&&D>>5==6){this.charLength=2;break}if(u<=2&&D>>4==14){this.charLength=3;break}if(u<=3&&D>>3==30){this.charLength=4;break}}this.charReceived=u},F.prototype.end=function(_){var u="";if(_&&_.length&&(u=this.write(_)),this.charReceived){var D=this.charReceived,L=this.charBuffer,O=this.encoding;u+=L.slice(0,D).toString(O)}return u};function S(_){return _.toString(this.encoding)}function m(_){this.charReceived=_.length%2,this.charLength=this.charReceived?2:0}function a(_){this.charReceived=_.length%3,this.charLength=this.charReceived?3:0}},function(p,y,v){p.exports=S;var g=v(21),x=v(18);x.inherits=v(12),x.inherits(S,g);function b(a){this.afterTransform=function(_,u){return F(a,_,u)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function F(a,_,u){var D=a._transformState;D.transforming=!1;var L=D.writecb;if(!L)return a.emit("error",new Error("no writecb in Transform class"));D.writechunk=null,D.writecb=null,u!=null&&a.push(u),L(_);var O=a._readableState;O.reading=!1,(O.needReadable||O.length<O.highWaterMark)&&a._read(O.highWaterMark)}function S(a){if(!(this instanceof S))return new S(a);g.call(this,a),this._transformState=new b(this);var _=this;this._readableState.needReadable=!0,this._readableState.sync=!1,a&&(typeof a.transform=="function"&&(this._transform=a.transform),typeof a.flush=="function"&&(this._flush=a.flush)),this.once("prefinish",function(){typeof this._flush=="function"?this._flush(function(u,D){m(_,u,D)}):m(_)})}S.prototype.push=function(a,_){return this._transformState.needTransform=!1,g.prototype.push.call(this,a,_)},S.prototype._transform=function(a,_,u){throw new Error("_transform() is not implemented")},S.prototype._write=function(a,_,u){var D=this._transformState;if(D.writecb=u,D.writechunk=a,D.writeencoding=_,!D.transforming){var L=this._readableState;(D.needTransform||L.needReadable||L.length<L.highWaterMark)&&this._read(L.highWaterMark)}},S.prototype._read=function(a){var _=this._transformState;_.writechunk!==null&&_.writecb&&!_.transforming?(_.transforming=!0,this._transform(_.writechunk,_.writeencoding,_.afterTransform)):_.needTransform=!0};function m(a,_,u){if(_)return a.emit("error",_);u!=null&&a.push(u);var D=a._writableState,L=a._transformState;if(D.length)throw new Error("Calling transform done when ws.length != 0");if(L.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}},function(p,y,v){p.exports=b;var g=v(25),x=v(18);x.inherits=v(12),x.inherits(b,g);function b(F){if(!(this instanceof b))return new b(F);g.call(this,F)}b.prototype._transform=function(F,S,m){m(null,F)}},function(p,y,v){p.exports=v(22)},function(p,y,v){p.exports=v(21)},function(p,y,v){p.exports=v(25)},function(p,y,v){p.exports=v(26)},function(p,y,v){var g=v(32),x=v(33),b=v(38),F=v(39),S=v(40),m=v(41),a=v(42),_=Object.prototype.toString;function u(O){if(!(this instanceof u))return new u(O);this.options=x.assign({chunkSize:16384,windowBits:0,to:""},O||{});var C=this.options;C.raw&&C.windowBits>=0&&C.windowBits<16&&(C.windowBits=-C.windowBits,C.windowBits===0&&(C.windowBits=-15)),C.windowBits>=0&&C.windowBits<16&&!(O&&O.windowBits)&&(C.windowBits+=32),C.windowBits>15&&C.windowBits<48&&(C.windowBits&15)===0&&(C.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var A=g.inflateInit2(this.strm,C.windowBits);if(A!==F.Z_OK)throw new Error(S[A]);this.header=new a,g.inflateGetHeader(this.strm,this.header)}u.prototype.push=function(O,C){var A=this.strm,K=this.options.chunkSize,B=this.options.dictionary,H,St,tt,kt,dt,U,et=!1;if(this.ended)return!1;St=C===~~C?C:C===!0?F.Z_FINISH:F.Z_NO_FLUSH,typeof O=="string"?A.input=b.binstring2buf(O):_.call(O)==="[object ArrayBuffer]"?A.input=new Uint8Array(O):A.input=O,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new x.Buf8(K),A.next_out=0,A.avail_out=K),H=g.inflate(A,F.Z_NO_FLUSH),H===F.Z_NEED_DICT&&B&&(typeof B=="string"?U=b.string2buf(B):_.call(B)==="[object ArrayBuffer]"?U=new Uint8Array(B):U=B,H=g.inflateSetDictionary(this.strm,U)),H===F.Z_BUF_ERROR&&et===!0&&(H=F.Z_OK,et=!1),H!==F.Z_STREAM_END&&H!==F.Z_OK)return this.onEnd(H),this.ended=!0,!1;A.next_out&&(A.avail_out===0||H===F.Z_STREAM_END||A.avail_in===0&&(St===F.Z_FINISH||St===F.Z_SYNC_FLUSH))&&(this.options.to==="string"?(tt=b.utf8border(A.output,A.next_out),kt=A.next_out-tt,dt=b.buf2string(A.output,tt),A.next_out=kt,A.avail_out=K-kt,kt&&x.arraySet(A.output,A.output,tt,kt,0),this.onData(dt)):this.onData(x.shrinkBuf(A.output,A.next_out))),A.avail_in===0&&A.avail_out===0&&(et=!0)}while((A.avail_in>0||A.avail_out===0)&&H!==F.Z_STREAM_END);return H===F.Z_STREAM_END&&(St=F.Z_FINISH),St===F.Z_FINISH?(H=g.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===F.Z_OK):(St===F.Z_SYNC_FLUSH&&(this.onEnd(F.Z_OK),A.avail_out=0),!0)},u.prototype.onData=function(O){this.chunks.push(O)},u.prototype.onEnd=function(O){O===F.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg};function D(O,C){var A=new u(C);if(A.push(O,!0),A.err)throw A.msg||S[A.err];return A.result}function L(O,C){return C=C||{},C.raw=!0,D(O,C)}y.Inflate=u,y.inflate=D,y.inflateRaw=L,y.ungzip=D},function(p,y,v){var g=v(33),x=v(34),b=v(35),F=v(36),S=v(37),m=0,a=1,_=2,u=4,D=5,L=6,O=0,C=1,A=2,K=-2,B=-3,H=-4,St=-5,tt=8,kt=1,dt=2,U=3,et=4,lt=5,xt=6,mt=7,Ct=8,Lt=9,Et=10,Zt=11,j=12,z=13,J=14,ft=15,Ft=16,gt=17,_t=18,Rt=19,Wt=20,Mt=21,T=22,R=23,Z=24,it=25,pt=26,bt=27,Q=28,ne=29,vt=30,oe=31,le=32,be=852,k=592,f=15,h=f;function I(W){return(W>>>24&255)+(W>>>8&65280)+((W&65280)<<8)+((W&255)<<24)}function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function G(W){var st;return!W||!W.state?K:(st=W.state,W.total_in=W.total_out=st.total=0,W.msg="",st.wrap&&(W.adler=st.wrap&1),st.mode=kt,st.last=0,st.havedict=0,st.dmax=32768,st.head=null,st.hold=0,st.bits=0,st.lencode=st.lendyn=new g.Buf32(be),st.distcode=st.distdyn=new g.Buf32(k),st.sane=1,st.back=-1,O)}function V(W){var st;return!W||!W.state?K:(st=W.state,st.wsize=0,st.whave=0,st.wnext=0,G(W))}function Tt(W,st){var E,ct;return!W||!W.state||(ct=W.state,st<0?(E=0,st=-st):(E=(st>>4)+1,st<48&&(st&=15)),st&&(st<8||st>15))?K:(ct.window!==null&&ct.wbits!==st&&(ct.window=null),ct.wrap=E,ct.wbits=st,V(W))}function Dt(W,st){var E,ct;return W?(ct=new P,W.state=ct,ct.window=null,E=Tt(W,st),E!==O&&(W.state=null),E):K}function Pt(W){return Dt(W,h)}var Vt=!0,At,ke;function Je(W){if(Vt){var st;for(At=new g.Buf32(512),ke=new g.Buf32(32),st=0;st<144;)W.lens[st++]=8;for(;st<256;)W.lens[st++]=9;for(;st<280;)W.lens[st++]=7;for(;st<288;)W.lens[st++]=8;for(S(a,W.lens,0,288,At,0,W.work,{bits:9}),st=0;st<32;)W.lens[st++]=5;S(_,W.lens,0,32,ke,0,W.work,{bits:5}),Vt=!1}W.lencode=At,W.lenbits=9,W.distcode=ke,W.distbits=5}function Ue(W,st,E,ct){var Bt,ot=W.state;return ot.window===null&&(ot.wsize=1<<ot.wbits,ot.wnext=0,ot.whave=0,ot.window=new g.Buf8(ot.wsize)),ct>=ot.wsize?(g.arraySet(ot.window,st,E-ot.wsize,ot.wsize,0),ot.wnext=0,ot.whave=ot.wsize):(Bt=ot.wsize-ot.wnext,Bt>ct&&(Bt=ct),g.arraySet(ot.window,st,E-ct,Bt,ot.wnext),ct-=Bt,ct?(g.arraySet(ot.window,st,E-ct,ct,0),ot.wnext=ct,ot.whave=ot.wsize):(ot.wnext+=Bt,ot.wnext===ot.wsize&&(ot.wnext=0),ot.whave<ot.wsize&&(ot.whave+=Bt))),0}function je(W,st){var E,ct,Bt,ot,fe,at,Kt,Y,X,Qe,zt,ht,We,Oe,Ht=0,Ot,ie,ue,re,$e,He,Xt,he,te=new g.Buf8(4),Ie,Se,kn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!W||!W.state||!W.output||!W.input&&W.avail_in!==0)return K;E=W.state,E.mode===j&&(E.mode=z),fe=W.next_out,Bt=W.output,Kt=W.avail_out,ot=W.next_in,ct=W.input,at=W.avail_in,Y=E.hold,X=E.bits,Qe=at,zt=Kt,he=O;t:for(;;)switch(E.mode){case kt:if(E.wrap===0){E.mode=z;break}for(;X<16;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(E.wrap&2&&Y===35615){E.check=0,te[0]=Y&255,te[1]=Y>>>8&255,E.check=b(E.check,te,2,0),Y=0,X=0,E.mode=dt;break}if(E.flags=0,E.head&&(E.head.done=!1),!(E.wrap&1)||(((Y&255)<<8)+(Y>>8))%31){W.msg="incorrect header check",E.mode=vt;break}if((Y&15)!==tt){W.msg="unknown compression method",E.mode=vt;break}if(Y>>>=4,X-=4,Xt=(Y&15)+8,E.wbits===0)E.wbits=Xt;else if(Xt>E.wbits){W.msg="invalid window size",E.mode=vt;break}E.dmax=1<<Xt,W.adler=E.check=1,E.mode=Y&512?Et:j,Y=0,X=0;break;case dt:for(;X<16;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(E.flags=Y,(E.flags&255)!==tt){W.msg="unknown compression method",E.mode=vt;break}if(E.flags&57344){W.msg="unknown header flags set",E.mode=vt;break}E.head&&(E.head.text=Y>>8&1),E.flags&512&&(te[0]=Y&255,te[1]=Y>>>8&255,E.check=b(E.check,te,2,0)),Y=0,X=0,E.mode=U;case U:for(;X<32;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.head&&(E.head.time=Y),E.flags&512&&(te[0]=Y&255,te[1]=Y>>>8&255,te[2]=Y>>>16&255,te[3]=Y>>>24&255,E.check=b(E.check,te,4,0)),Y=0,X=0,E.mode=et;case et:for(;X<16;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.head&&(E.head.xflags=Y&255,E.head.os=Y>>8),E.flags&512&&(te[0]=Y&255,te[1]=Y>>>8&255,E.check=b(E.check,te,2,0)),Y=0,X=0,E.mode=lt;case lt:if(E.flags&1024){for(;X<16;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.length=Y,E.head&&(E.head.extra_len=Y),E.flags&512&&(te[0]=Y&255,te[1]=Y>>>8&255,E.check=b(E.check,te,2,0)),Y=0,X=0}else E.head&&(E.head.extra=null);E.mode=xt;case xt:if(E.flags&1024&&(ht=E.length,ht>at&&(ht=at),ht&&(E.head&&(Xt=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),g.arraySet(E.head.extra,ct,ot,ht,Xt)),E.flags&512&&(E.check=b(E.check,ct,ht,ot)),at-=ht,ot+=ht,E.length-=ht),E.length))break t;E.length=0,E.mode=mt;case mt:if(E.flags&2048){if(at===0)break t;ht=0;do Xt=ct[ot+ht++],E.head&&Xt&&E.length<65536&&(E.head.name+=String.fromCharCode(Xt));while(Xt&&ht<at);if(E.flags&512&&(E.check=b(E.check,ct,ht,ot)),at-=ht,ot+=ht,Xt)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=Ct;case Ct:if(E.flags&4096){if(at===0)break t;ht=0;do Xt=ct[ot+ht++],E.head&&Xt&&E.length<65536&&(E.head.comment+=String.fromCharCode(Xt));while(Xt&&ht<at);if(E.flags&512&&(E.check=b(E.check,ct,ht,ot)),at-=ht,ot+=ht,Xt)break t}else E.head&&(E.head.comment=null);E.mode=Lt;case Lt:if(E.flags&512){for(;X<16;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(Y!==(E.check&65535)){W.msg="header crc mismatch",E.mode=vt;break}Y=0,X=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),W.adler=E.check=0,E.mode=j;break;case Et:for(;X<32;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}W.adler=E.check=I(Y),Y=0,X=0,E.mode=Zt;case Zt:if(E.havedict===0)return W.next_out=fe,W.avail_out=Kt,W.next_in=ot,W.avail_in=at,E.hold=Y,E.bits=X,A;W.adler=E.check=1,E.mode=j;case j:if(st===D||st===L)break t;case z:if(E.last){Y>>>=X&7,X-=X&7,E.mode=bt;break}for(;X<3;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}switch(E.last=Y&1,Y>>>=1,X-=1,Y&3){case 0:E.mode=J;break;case 1:if(Je(E),E.mode=Wt,st===L){Y>>>=2,X-=2;break t}break;case 2:E.mode=gt;break;case 3:W.msg="invalid block type",E.mode=vt}Y>>>=2,X-=2;break;case J:for(Y>>>=X&7,X-=X&7;X<32;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if((Y&65535)!==(Y>>>16^65535)){W.msg="invalid stored block lengths",E.mode=vt;break}if(E.length=Y&65535,Y=0,X=0,E.mode=ft,st===L)break t;case ft:E.mode=Ft;case Ft:if(ht=E.length,ht){if(ht>at&&(ht=at),ht>Kt&&(ht=Kt),ht===0)break t;g.arraySet(Bt,ct,ot,ht,fe),at-=ht,ot+=ht,Kt-=ht,fe+=ht,E.length-=ht;break}E.mode=j;break;case gt:for(;X<14;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(E.nlen=(Y&31)+257,Y>>>=5,X-=5,E.ndist=(Y&31)+1,Y>>>=5,X-=5,E.ncode=(Y&15)+4,Y>>>=4,X-=4,E.nlen>286||E.ndist>30){W.msg="too many length or distance symbols",E.mode=vt;break}E.have=0,E.mode=_t;case _t:for(;E.have<E.ncode;){for(;X<3;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.lens[kn[E.have++]]=Y&7,Y>>>=3,X-=3}for(;E.have<19;)E.lens[kn[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,Ie={bits:E.lenbits},he=S(m,E.lens,0,19,E.lencode,0,E.work,Ie),E.lenbits=Ie.bits,he){W.msg="invalid code lengths set",E.mode=vt;break}E.have=0,E.mode=Rt;case Rt:for(;E.have<E.nlen+E.ndist;){for(;Ht=E.lencode[Y&(1<<E.lenbits)-1],Ot=Ht>>>24,ie=Ht>>>16&255,ue=Ht&65535,!(Ot<=X);){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(ue<16)Y>>>=Ot,X-=Ot,E.lens[E.have++]=ue;else{if(ue===16){for(Se=Ot+2;X<Se;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(Y>>>=Ot,X-=Ot,E.have===0){W.msg="invalid bit length repeat",E.mode=vt;break}Xt=E.lens[E.have-1],ht=3+(Y&3),Y>>>=2,X-=2}else if(ue===17){for(Se=Ot+3;X<Se;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}Y>>>=Ot,X-=Ot,Xt=0,ht=3+(Y&7),Y>>>=3,X-=3}else{for(Se=Ot+7;X<Se;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}Y>>>=Ot,X-=Ot,Xt=0,ht=11+(Y&127),Y>>>=7,X-=7}if(E.have+ht>E.nlen+E.ndist){W.msg="invalid bit length repeat",E.mode=vt;break}for(;ht--;)E.lens[E.have++]=Xt}}if(E.mode===vt)break;if(E.lens[256]===0){W.msg="invalid code -- missing end-of-block",E.mode=vt;break}if(E.lenbits=9,Ie={bits:E.lenbits},he=S(a,E.lens,0,E.nlen,E.lencode,0,E.work,Ie),E.lenbits=Ie.bits,he){W.msg="invalid literal/lengths set",E.mode=vt;break}if(E.distbits=6,E.distcode=E.distdyn,Ie={bits:E.distbits},he=S(_,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,Ie),E.distbits=Ie.bits,he){W.msg="invalid distances set",E.mode=vt;break}if(E.mode=Wt,st===L)break t;case Wt:E.mode=Mt;case Mt:if(at>=6&&Kt>=258){W.next_out=fe,W.avail_out=Kt,W.next_in=ot,W.avail_in=at,E.hold=Y,E.bits=X,F(W,zt),fe=W.next_out,Bt=W.output,Kt=W.avail_out,ot=W.next_in,ct=W.input,at=W.avail_in,Y=E.hold,X=E.bits,E.mode===j&&(E.back=-1);break}for(E.back=0;Ht=E.lencode[Y&(1<<E.lenbits)-1],Ot=Ht>>>24,ie=Ht>>>16&255,ue=Ht&65535,!(Ot<=X);){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(ie&&(ie&240)===0){for(re=Ot,$e=ie,He=ue;Ht=E.lencode[He+((Y&(1<<re+$e)-1)>>re)],Ot=Ht>>>24,ie=Ht>>>16&255,ue=Ht&65535,!(re+Ot<=X);){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}Y>>>=re,X-=re,E.back+=re}if(Y>>>=Ot,X-=Ot,E.back+=Ot,E.length=ue,ie===0){E.mode=pt;break}if(ie&32){E.back=-1,E.mode=j;break}if(ie&64){W.msg="invalid literal/length code",E.mode=vt;break}E.extra=ie&15,E.mode=T;case T:if(E.extra){for(Se=E.extra;X<Se;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.length+=Y&(1<<E.extra)-1,Y>>>=E.extra,X-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=R;case R:for(;Ht=E.distcode[Y&(1<<E.distbits)-1],Ot=Ht>>>24,ie=Ht>>>16&255,ue=Ht&65535,!(Ot<=X);){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if((ie&240)===0){for(re=Ot,$e=ie,He=ue;Ht=E.distcode[He+((Y&(1<<re+$e)-1)>>re)],Ot=Ht>>>24,ie=Ht>>>16&255,ue=Ht&65535,!(re+Ot<=X);){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}Y>>>=re,X-=re,E.back+=re}if(Y>>>=Ot,X-=Ot,E.back+=Ot,ie&64){W.msg="invalid distance code",E.mode=vt;break}E.offset=ue,E.extra=ie&15,E.mode=Z;case Z:if(E.extra){for(Se=E.extra;X<Se;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}E.offset+=Y&(1<<E.extra)-1,Y>>>=E.extra,X-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){W.msg="invalid distance too far back",E.mode=vt;break}E.mode=it;case it:if(Kt===0)break t;if(ht=zt-Kt,E.offset>ht){if(ht=E.offset-ht,ht>E.whave&&E.sane){W.msg="invalid distance too far back",E.mode=vt;break}ht>E.wnext?(ht-=E.wnext,We=E.wsize-ht):We=E.wnext-ht,ht>E.length&&(ht=E.length),Oe=E.window}else Oe=Bt,We=fe-E.offset,ht=E.length;ht>Kt&&(ht=Kt),Kt-=ht,E.length-=ht;do Bt[fe++]=Oe[We++];while(--ht);E.length===0&&(E.mode=Mt);break;case pt:if(Kt===0)break t;Bt[fe++]=E.length,Kt--,E.mode=Mt;break;case bt:if(E.wrap){for(;X<32;){if(at===0)break t;at--,Y|=ct[ot++]<<X,X+=8}if(zt-=Kt,W.total_out+=zt,E.total+=zt,zt&&(W.adler=E.check=E.flags?b(E.check,Bt,zt,fe-zt):x(E.check,Bt,zt,fe-zt)),zt=Kt,(E.flags?Y:I(Y))!==E.check){W.msg="incorrect data check",E.mode=vt;break}Y=0,X=0}E.mode=Q;case Q:if(E.wrap&&E.flags){for(;X<32;){if(at===0)break t;at--,Y+=ct[ot++]<<X,X+=8}if(Y!==(E.total&4294967295)){W.msg="incorrect length check",E.mode=vt;break}Y=0,X=0}E.mode=ne;case ne:he=C;break t;case vt:he=B;break t;case oe:return H;case le:default:return K}return W.next_out=fe,W.avail_out=Kt,W.next_in=ot,W.avail_in=at,E.hold=Y,E.bits=X,(E.wsize||zt!==W.avail_out&&E.mode<vt&&(E.mode<bt||st!==u))&&Ue(W,W.output,W.next_out,zt-W.avail_out),Qe-=W.avail_in,zt-=W.avail_out,W.total_in+=Qe,W.total_out+=zt,E.total+=zt,E.wrap&&zt&&(W.adler=E.check=E.flags?b(E.check,Bt,zt,W.next_out-zt):x(E.check,Bt,zt,W.next_out-zt)),W.data_type=E.bits+(E.last?64:0)+(E.mode===j?128:0)+(E.mode===Wt||E.mode===ft?256:0),(Qe===0&&zt===0||st===u)&&he===O&&(he=St),he}function Xn(W){if(!W||!W.state)return K;var st=W.state;return st.window&&(st.window=null),W.state=null,O}function Yn(W,st){var E;return!W||!W.state||(E=W.state,(E.wrap&2)===0)?K:(E.head=st,st.done=!1,O)}function Zn(W,st){var E=st.length,ct,Bt,ot;return!W||!W.state||(ct=W.state,ct.wrap!==0&&ct.mode!==Zt)?K:ct.mode===Zt&&(Bt=1,Bt=x(Bt,st,E,0),Bt!==ct.check)?B:(ot=Ue(W,st,E,E),ot?(ct.mode=oe,H):(ct.havedict=1,O))}y.inflateReset=V,y.inflateReset2=Tt,y.inflateResetKeep=G,y.inflateInit=Pt,y.inflateInit2=Dt,y.inflate=je,y.inflateEnd=Xn,y.inflateGetHeader=Yn,y.inflateSetDictionary=Zn,y.inflateInfo="pako inflate (from Nodeca project)"},function(p,y){var v=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";y.assign=function(b){for(var F=Array.prototype.slice.call(arguments,1);F.length;){var S=F.shift();if(S){if(typeof S!="object")throw new TypeError(S+"must be non-object");for(var m in S)S.hasOwnProperty(m)&&(b[m]=S[m])}}return b},y.shrinkBuf=function(b,F){return b.length===F?b:b.subarray?b.subarray(0,F):(b.length=F,b)};var g={arraySet:function(b,F,S,m,a){if(F.subarray&&b.subarray){b.set(F.subarray(S,S+m),a);return}for(var _=0;_<m;_++)b[a+_]=F[S+_]},flattenChunks:function(b){var F,S,m,a,_,u;for(m=0,F=0,S=b.length;F<S;F++)m+=b[F].length;for(u=new Uint8Array(m),a=0,F=0,S=b.length;F<S;F++)_=b[F],u.set(_,a),a+=_.length;return u}},x={arraySet:function(b,F,S,m,a){for(var _=0;_<m;_++)b[a+_]=F[S+_]},flattenChunks:function(b){return[].concat.apply([],b)}};y.setTyped=function(b){b?(y.Buf8=Uint8Array,y.Buf16=Uint16Array,y.Buf32=Int32Array,y.assign(y,g)):(y.Buf8=Array,y.Buf16=Array,y.Buf32=Array,y.assign(y,x))},y.setTyped(v)},function(p,y){function v(g,x,b,F){for(var S=g&65535|0,m=g>>>16&65535|0,a=0;b!==0;){a=b>2e3?2e3:b,b-=a;do S=S+x[F++]|0,m=m+S|0;while(--a);S%=65521,m%=65521}return S|m<<16|0}p.exports=v},function(p,y){function v(){for(var b,F=[],S=0;S<256;S++){b=S;for(var m=0;m<8;m++)b=b&1?3988292384^b>>>1:b>>>1;F[S]=b}return F}var g=v();function x(b,F,S,m){var a=g,_=m+S;b^=-1;for(var u=m;u<_;u++)b=b>>>8^a[(b^F[u])&255];return b^-1}p.exports=x},function(p,y){var v=30,g=12;p.exports=function(b,F){var S,m,a,_,u,D,L,O,C,A,K,B,H,St,tt,kt,dt,U,et,lt,xt,mt,Ct,Lt,Et;S=b.state,m=b.next_in,Lt=b.input,a=m+(b.avail_in-5),_=b.next_out,Et=b.output,u=_-(F-b.avail_out),D=_+(b.avail_out-257),L=S.dmax,O=S.wsize,C=S.whave,A=S.wnext,K=S.window,B=S.hold,H=S.bits,St=S.lencode,tt=S.distcode,kt=(1<<S.lenbits)-1,dt=(1<<S.distbits)-1;t:do{H<15&&(B+=Lt[m++]<<H,H+=8,B+=Lt[m++]<<H,H+=8),U=St[B&kt];e:for(;;){if(et=U>>>24,B>>>=et,H-=et,et=U>>>16&255,et===0)Et[_++]=U&65535;else if(et&16){lt=U&65535,et&=15,et&&(H<et&&(B+=Lt[m++]<<H,H+=8),lt+=B&(1<<et)-1,B>>>=et,H-=et),H<15&&(B+=Lt[m++]<<H,H+=8,B+=Lt[m++]<<H,H+=8),U=tt[B&dt];n:for(;;){if(et=U>>>24,B>>>=et,H-=et,et=U>>>16&255,et&16){if(xt=U&65535,et&=15,H<et&&(B+=Lt[m++]<<H,H+=8,H<et&&(B+=Lt[m++]<<H,H+=8)),xt+=B&(1<<et)-1,xt>L){b.msg="invalid distance too far back",S.mode=v;break t}if(B>>>=et,H-=et,et=_-u,xt>et){if(et=xt-et,et>C&&S.sane){b.msg="invalid distance too far back",S.mode=v;break t}if(mt=0,Ct=K,A===0){if(mt+=O-et,et<lt){lt-=et;do Et[_++]=K[mt++];while(--et);mt=_-xt,Ct=Et}}else if(A<et){if(mt+=O+A-et,et-=A,et<lt){lt-=et;do Et[_++]=K[mt++];while(--et);if(mt=0,A<lt){et=A,lt-=et;do Et[_++]=K[mt++];while(--et);mt=_-xt,Ct=Et}}}else if(mt+=A-et,et<lt){lt-=et;do Et[_++]=K[mt++];while(--et);mt=_-xt,Ct=Et}for(;lt>2;)Et[_++]=Ct[mt++],Et[_++]=Ct[mt++],Et[_++]=Ct[mt++],lt-=3;lt&&(Et[_++]=Ct[mt++],lt>1&&(Et[_++]=Ct[mt++]))}else{mt=_-xt;do Et[_++]=Et[mt++],Et[_++]=Et[mt++],Et[_++]=Et[mt++],lt-=3;while(lt>2);lt&&(Et[_++]=Et[mt++],lt>1&&(Et[_++]=Et[mt++]))}}else if((et&64)===0){U=tt[(U&65535)+(B&(1<<et)-1)];continue n}else{b.msg="invalid distance code",S.mode=v;break t}break}}else if((et&64)===0){U=St[(U&65535)+(B&(1<<et)-1)];continue e}else if(et&32){S.mode=g;break t}else{b.msg="invalid literal/length code",S.mode=v;break t}break}}while(m<a&&_<D);lt=H>>3,m-=lt,H-=lt<<3,B&=(1<<H)-1,b.next_in=m,b.next_out=_,b.avail_in=m<a?5+(a-m):5-(m-a),b.avail_out=_<D?257+(D-_):257-(_-D),S.hold=B,S.bits=H}},function(p,y,v){var g=v(33),x=15,b=852,F=592,S=0,m=1,a=2,_=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],D=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],L=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];p.exports=function(C,A,K,B,H,St,tt,kt){var dt=kt.bits,U=0,et=0,lt=0,xt=0,mt=0,Ct=0,Lt=0,Et=0,Zt=0,j=0,z,J,ft,Ft,gt,_t=null,Rt=0,Wt,Mt=new g.Buf16(x+1),T=new g.Buf16(x+1),R=null,Z=0,it,pt,bt;for(U=0;U<=x;U++)Mt[U]=0;for(et=0;et<B;et++)Mt[A[K+et]]++;for(mt=dt,xt=x;xt>=1&&Mt[xt]===0;xt--);if(mt>xt&&(mt=xt),xt===0)return H[St++]=1<<24|64<<16|0,H[St++]=1<<24|64<<16|0,kt.bits=1,0;for(lt=1;lt<xt&&Mt[lt]===0;lt++);for(mt<lt&&(mt=lt),Et=1,U=1;U<=x;U++)if(Et<<=1,Et-=Mt[U],Et<0)return-1;if(Et>0&&(C===S||xt!==1))return-1;for(T[1]=0,U=1;U<x;U++)T[U+1]=T[U]+Mt[U];for(et=0;et<B;et++)A[K+et]!==0&&(tt[T[A[K+et]]++]=et);if(C===S?(_t=R=tt,Wt=19):C===m?(_t=_,Rt-=257,R=u,Z-=257,Wt=256):(_t=D,R=L,Wt=-1),j=0,et=0,U=lt,gt=St,Ct=mt,Lt=0,ft=-1,Zt=1<<mt,Ft=Zt-1,C===m&&Zt>b||C===a&&Zt>F)return 1;for(;;){it=U-Lt,tt[et]<Wt?(pt=0,bt=tt[et]):tt[et]>Wt?(pt=R[Z+tt[et]],bt=_t[Rt+tt[et]]):(pt=96,bt=0),z=1<<U-Lt,J=1<<Ct,lt=J;do J-=z,H[gt+(j>>Lt)+J]=it<<24|pt<<16|bt|0;while(J!==0);for(z=1<<U-1;j&z;)z>>=1;if(z!==0?(j&=z-1,j+=z):j=0,et++,--Mt[U]===0){if(U===xt)break;U=A[K+tt[et]]}if(U>mt&&(j&Ft)!==ft){for(Lt===0&&(Lt=mt),gt+=lt,Ct=U-Lt,Et=1<<Ct;Ct+Lt<xt&&(Et-=Mt[Ct+Lt],!(Et<=0));)Ct++,Et<<=1;if(Zt+=1<<Ct,C===m&&Zt>b||C===a&&Zt>F)return 1;ft=j&Ft,H[ft]=mt<<24|Ct<<16|gt-St|0}}return j!==0&&(H[gt+j]=U-Lt<<24|64<<16|0),kt.bits=mt,0}},function(p,y,v){var g=v(33),x=!0,b=!0;try{String.fromCharCode.apply(null,[0])}catch{x=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{b=!1}for(var F=new g.Buf8(256),S=0;S<256;S++)F[S]=S>=252?6:S>=248?5:S>=240?4:S>=224?3:S>=192?2:1;F[254]=F[254]=1,y.string2buf=function(a){var _,u,D,L,O,C=a.length,A=0;for(L=0;L<C;L++)u=a.charCodeAt(L),(u&64512)===55296&&L+1<C&&(D=a.charCodeAt(L+1),(D&64512)===56320&&(u=65536+(u-55296<<10)+(D-56320),L++)),A+=u<128?1:u<2048?2:u<65536?3:4;for(_=new g.Buf8(A),O=0,L=0;O<A;L++)u=a.charCodeAt(L),(u&64512)===55296&&L+1<C&&(D=a.charCodeAt(L+1),(D&64512)===56320&&(u=65536+(u-55296<<10)+(D-56320),L++)),u<128?_[O++]=u:u<2048?(_[O++]=192|u>>>6,_[O++]=128|u&63):u<65536?(_[O++]=224|u>>>12,_[O++]=128|u>>>6&63,_[O++]=128|u&63):(_[O++]=240|u>>>18,_[O++]=128|u>>>12&63,_[O++]=128|u>>>6&63,_[O++]=128|u&63);return _};function m(a,_){if(_<65537&&(a.subarray&&b||!a.subarray&&x))return String.fromCharCode.apply(null,g.shrinkBuf(a,_));for(var u="",D=0;D<_;D++)u+=String.fromCharCode(a[D]);return u}y.buf2binstring=function(a){return m(a,a.length)},y.binstring2buf=function(a){for(var _=new g.Buf8(a.length),u=0,D=_.length;u<D;u++)_[u]=a.charCodeAt(u);return _},y.buf2string=function(a,_){var u,D,L,O,C=_||a.length,A=new Array(C*2);for(D=0,u=0;u<C;){if(L=a[u++],L<128){A[D++]=L;continue}if(O=F[L],O>4){A[D++]=65533,u+=O-1;continue}for(L&=O===2?31:O===3?15:7;O>1&&u<C;)L=L<<6|a[u++]&63,O--;if(O>1){A[D++]=65533;continue}L<65536?A[D++]=L:(L-=65536,A[D++]=55296|L>>10&1023,A[D++]=56320|L&1023)}return m(A,D)},y.utf8border=function(a,_){var u;for(_=_||a.length,_>a.length&&(_=a.length),u=_-1;u>=0&&(a[u]&192)===128;)u--;return u<0||u===0?_:u+F[a[u]]>_?u:_}},function(p,y){p.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(p,y){p.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(p,y){function v(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}p.exports=v},function(p,y){function v(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}p.exports=v}])})})(Wn)),Wn.exports}var Cs=Ds();const kr=Os(Cs),jn={STORAGE_KEY:"desktopOS_fileSystem"},ee={IMAGE:"image",TEXT:"text",OTHER:"other"},Hn={home:{reeyuki:{Documents:{"INFO.txt":{type:"file",content:"Files you saved in notepad get saved in your browser session.",kind:ee.TEXT,icon:"/static/icons/notepad.webp"}},Pictures:{"wallpaper1.webp":{type:"file",content:"/static/wallpapers/wallpaper1.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper1.webp"},"wallpaper2.webp":{type:"file",content:"/static/wallpapers/wallpaper2.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper2.webp"},"wallpaper3.webp":{type:"file",content:"/static/wallpapers/wallpaper3.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper3.webp"},"wallpaper4.webp":{type:"file",content:"/static/wallpapers/wallpaper4.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper4.webp"},"wallpaper5.webp":{type:"file",content:"/static/wallpapers/wallpaper5.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper5.webp"},"wallpaper6.webp":{type:"file",content:"/static/wallpapers/wallpaper6.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper6.webp"},"wallpaper7.webp":{type:"file",content:"/static/wallpapers/wallpaper7.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper7.webp"},"wallpaper8.webp":{type:"file",content:"/static/wallpapers/wallpaper8.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper8.webp"},"wallpaper9.webp":{type:"file",content:"/static/wallpapers/wallpaper9.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper9.webp"},"wallpaper10.webp":{type:"file",content:"/static/wallpapers/wallpaper10.webp",kind:ee.IMAGE,icon:"/static/wallpapers/wallpaper10.webp"}},Music:{}}}};function Lr(rt,l){for(const p in rt)p in l?typeof rt[p]=="object"&&rt[p]!==null&&!Array.isArray(rt[p])&&Lr(rt[p],l[p]):l[p]=rt[p];return l}class As{constructor(){this.fsReady=this.initFS()}async initFS(){return new Promise(l=>{kr.configure({fs:"IndexedDB",options:{}},()=>{this.fs=kr.BFSRequire("fs"),this.loadFromStorage(),l()})})}async loadFromStorage(){if(!await this.exists(jn.STORAGE_KEY))await this.writeFile(jn.STORAGE_KEY,JSON.stringify(Hn)),this.fileSystem=JSON.parse(JSON.stringify(Hn));else{const p=await this.readFile(jn.STORAGE_KEY),y=JSON.parse(p);this.fileSystem=Lr(Hn,y),await this.saveToStorage()}}async saveToStorage(){await this.writeFile(jn.STORAGE_KEY,JSON.stringify(this.fileSystem))}normalizePath(l){return typeof l=="string"?l.split("/").filter(p=>p):Array.isArray(l)?l.filter(p=>p):[]}getFolder(l){return this.normalizePath(l).reduce((y,v)=>{if(!y[v])throw new Error(`Invalid path: ${v}`);return y[v]},this.fileSystem)}inferKind(l){const p=l.split(".").pop().toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(p)?ee.IMAGE:["txt","js","json","md","html","css"].includes(p)?ee.TEXT:ee.OTHER}async createFile(l,p,y="",v=null,g=null){await this.fsReady;const x=this.getFolder(l),b=v||this.inferKind(p),F=g||(b===ee.TEXT?"/static/icons/notepad.webp":"/static/icons/file.png");x[p]={type:"file",content:y,kind:b,icon:F},await this.saveToStorage()}async createFolder(l,p){await this.fsReady;const y=this.getFolder(l);y[p]={},await this.saveToStorage()}async deleteItem(l,p){await this.fsReady;const y=this.getFolder(l);delete y[p],await this.saveToStorage()}async renameItem(l,p,y){await this.fsReady;const v=this.getFolder(l);v[y]=v[p],delete v[p],await this.saveToStorage()}async updateFile(l,p,y){await this.fsReady;const v=this.getFolder(l);if(v[p]?.type==="file")v[p].content=y;else{const g=this.inferKind(p),x=g===ee.TEXT?"/static/icons/notepad.webp":"/static/icons/file.png";v[p]={type:"file",content:y,kind:g,icon:x}}await this.saveToStorage()}async getFileContent(l,p){await this.fsReady;const y=this.getFolder(l);return y[p]?.type==="file"?y[p].content:""}async getFileKind(l,p){await this.fsReady;const y=this.getFolder(l);return y[p]?.type==="file"?y[p].kind:null}async getFileIcon(l,p){await this.fsReady;const y=this.getFolder(l);return y[p]?.type==="file"?y[p].icon:null}async isFile(l,p){return await this.fsReady,this.getFolder(l)[p]?.type==="file"}async writeFile(l,p){return new Promise((y,v)=>{this.fs.writeFile(l,p,g=>{g?v(g):y()})})}async readFile(l){return new Promise((p,y)=>{this.fs.readFile(l,"utf8",(v,g)=>{v?y(v):p(g)})})}async exists(l){return new Promise(p=>{this.fs.exists(l,y=>p(y))})}}const Ir="desktopOS_selectedWallpaper";class ui{static startClock(){const l=()=>{const p=new Date;document.getElementById("clock").textContent=p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),document.getElementById("date").textContent=p.toLocaleDateString()};setInterval(l,1e3),l()}static setRandomWallpaper(){const l=Hn.home.reeyuki.Pictures,p=Object.values(l).filter(v=>v.kind==="image").map(v=>v.content);if(!p.length)return;const y=p[Math.floor(Math.random()*p.length)];this.setWallpaper(y)}static setWallpaper(l){let p=document.getElementById("wallpaper-img");p||(p=document.createElement("img"),p.id="wallpaper-img",Object.assign(p.style,{position:"fixed",inset:"0",width:"100vw",height:"100vh",objectFit:"cover",zIndex:"-1",pointerEvents:"none",userSelect:"none"}),p.addEventListener("contextmenu",y=>y.preventDefault()),document.body.appendChild(p)),p.src=l,localStorage.setItem(Ir,l)}static loadWallpaper(){const l=localStorage.getItem(Ir);l?this.setWallpaper(l):this.setRandomWallpaper()}}const ce=document.getElementById("context-menu");class Ms{constructor(l,p,y){this.fs=l,this.wm=p,this.notepadApp=y,this.currentPath=["home","reeyuki"],this.fileSelectCallback=null,this.open=this.open.bind(this)}async open(l=null){if(this.fileSelectCallback=l,document.getElementById("explorer-win")){this.wm.bringToFront(document.getElementById("explorer-win"));return}const p=document.createElement("div");p.className="window",p.id="explorer-win",p.dataset.fullscreen="false",p.innerHTML=`
      <div class="window-header">
        <span>File Explorer</span>
        ${this.wm.getWindowControls()}
      </div>
      <div class="explorer-nav">
        <div class="back-btn" id="exp-back">← Back</div>
        <div id="exp-path" style="color:#555"></div>
      </div>
      <div class="explorer-container">
        <div class="explorer-sidebar">
          <div class="start-item" data-path="home/reeyuki/Documents">Documents</div>
          <div class="start-item" data-path="home/reeyuki/Pictures">Pictures</div>
          <div class="start-item" data-path="home/reeyuki/Music">Music</div>
        </div>
        <div class="explorer-main" id="explorer-view"></div>
      </div>
    `,desktop.appendChild(p);const y=p.querySelector("#explorer-view");y.style.width="600px",y.style.height="300px",this.wm.makeDraggable(p),this.wm.makeResizable(p),this.wm.setupWindowControls(p),setTimeout(()=>this.wm.bringToFront(p),0),this.wm.addToTaskbar(p.id,"File Explorer","/static/icons/file.png"),this.setupExplorerControls(p),await this.render()}setupExplorerControls(l){l.querySelector("#exp-back").onclick=async()=>{this.currentPath.length>1&&(this.currentPath.pop(),await this.render())},l.querySelectorAll(".explorer-sidebar .start-item").forEach(y=>{y.onclick=async()=>{const v=y.dataset.path.split("/").filter(g=>g);this.currentPath=v,await this.render()}});const p=l.querySelector("#explorer-view");p.addEventListener("contextmenu",y=>{y.target===p&&this.showBackgroundContextMenu(y)})}async renderMusicPage(l){l&&(l.innerHTML=`
      <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <iframe src="https://open.spotify.com/embed/playlist/6oK6F4LglYBr4mYLSRDJOa" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        <iframe src="https://open.spotify.com/embed/playlist/1q7zv2ScwtR2jIxaIRj9iG" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        <iframe src="https://open.spotify.com/embed/playlist/6q8mgrJZ5L4YxabVQoAZZf" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
      </div>
    `)}async render(){const l=document.getElementById("explorer-view"),p=document.getElementById("exp-path");if(!l)return;if(l.innerHTML="",p.textContent="/"+this.currentPath.join("/"),this.currentPath[2]==="Music"){await this.renderMusicPage(l);return}const y=this.fs.getFolder(this.currentPath);for(const[v,g]of Object.entries(y)){const x=g?.type==="file";let b;x?g.icon?b=g.icon.startsWith("/")?g.icon:`data:image/*;base64,${g.icon}`:b=g.kind===ee.IMAGE?g.content.startsWith("/")?g.content:`data:image/*;base64,${g.content}`:"/static/icons/notepad.webp":b="/static/icons/file.png";const F=document.createElement("div");F.className="file-item",F.innerHTML=`
        <img src="${b}" style="width:64px;height:64px;object-fit:cover">
        <span>${v}</span>
      `,F.ondblclick=async()=>this.openItem(v,x),F.oncontextmenu=async S=>this.showFileContextMenu(S,v,x),l.appendChild(F)}}async openItem(l,p){if(p){if(this.fileSelectCallback){this.fileSelectCallback(this.currentPath,l),this.fileSelectCallback=null;return}const y=await this.fs.getFileContent(this.currentPath,l);await this.fs.getFileKind(this.currentPath,l)===ee.IMAGE?this.openImageViewer(l,y):this.notepadApp.open(l,y,this.currentPath)}else this.currentPath.push(l),await this.render()}openImageViewer(l,p){const y=document.createElement("div");y.className="window",Object.assign(y.style,{width:"500px",height:"400px",left:"150px",top:"150px",zIndex:2e3}),y.innerHTML=`
      <div class="window-header">
        <span>${l}</span>
        ${this.wm.getWindowControls()}
      </div>
      <div style="display:flex;justify-content:center;align-items:center;height:calc(100% - 30px);background:#222">
        <img src="${p}" style="max-width:100%; max-height:100%">
      </div>
    `,desktop.appendChild(y),this.wm.makeDraggable(y),this.wm.makeResizable(y),this.wm.setupWindowControls(y),this.wm.addToTaskbar(y.id,l,"/static/icons/file.png")}async showFileContextMenu(l,p,y){l.preventDefault(),l.stopPropagation(),ce.innerHTML="";const v=(S,m)=>{const a=document.createElement("div");return a.textContent=S,a.onclick=()=>m(),a},g=y?"Open":"Open Folder",x=async()=>{ce.style.display="none",await this.openItem(p,y)};ce.appendChild(v(g,x)),y&&(ce.appendChild(document.createElement("hr")),ce.appendChild(v("Delete",async()=>{ce.style.display="none",await this.fs.deleteItem(this.currentPath,p),await this.render()})),ce.appendChild(v("Rename",async()=>{ce.style.display="none";const S=prompt("Enter new name:",p);S&&S!==p&&(await this.fs.renameItem(this.currentPath,p,S),await this.render())})));const b=y?await this.fs.getFileKind(this.currentPath,p):null,F=y?await this.fs.getFileContent(this.currentPath,p):null;b===ee.IMAGE&&ce.appendChild(v("Set Wallpaper",()=>{ce.style.display="none",ui.setWallpaper(F)})),ce.appendChild(v("Properties",()=>{ce.style.display="none",this.wm.showPopup(`Name: ${p}
Type: ${y?"File":"Folder"}`)})),Object.assign(ce.style,{left:`${l.pageX}px`,top:`${l.pageY}px`,display:"block"})}showBackgroundContextMenu(l){l.preventDefault(),l.stopPropagation(),ce.innerHTML=`
      <div id="ctx-new-file">New File</div>
      <div id="ctx-new-folder">New Folder</div>
      <hr>
      <div id="ctx-refresh">Refresh</div>
    `;const p=(y,v)=>{document.getElementById(y).onclick=async()=>{ce.style.display="none",await v()}};p("ctx-new-file",async()=>{const y=prompt("Enter file name:","NewFile.txt");y&&(await this.fs.createFile(this.currentPath,y),await this.render())}),p("ctx-new-folder",async()=>{const y=prompt("Enter folder name:","NewFolder");y&&(await this.fs.createFolder(this.currentPath,y),await this.render())}),p("ctx-refresh",async()=>await this.render()),Object.assign(ce.style,{left:`${l.pageX}px`,top:`${l.pageY}px`,display:"block"})}}const _n=document.getElementById("window-style");let Tr=_n.parentNode;function Ps(){_n.parentNode&&Tr.removeChild(_n)}function Bs(){_n.parentNode||Tr.appendChild(_n)}class zs{constructor(){this.openWindows=new Map,this.zIndexCounter=1e3,this.gameWindowCount=0}updateTransparency(){this.gameWindowCount>0?Ps():Bs()}createWindow(l,p,y="80vw",v="80vh",g=!1){const x=document.createElement("div");x.className="window",x.id=l,x.dataset.fullscreen="false";const b=y!=null?String(y):"80vw",F=v!=null?String(v):"80vh",S=b.includes("vw")?window.innerWidth*parseFloat(b)/100:parseInt(b),m=F.includes("vh")?window.innerHeight*parseFloat(F)/100:parseInt(F);return Object.assign(x.style,{width:`${S}px`,height:`${m}px`,left:`${(window.innerWidth-S)/2}px`,top:`${(window.innerHeight-m)/2}px`,position:"absolute",zIndex:this.zIndexCounter++}),g&&this.gameWindowCount++,this.updateTransparency(),x}addToTaskbar(l,p,y){if(document.getElementById(`taskbar-${l}`))return;const v=document.createElement("div");if(v.id=`taskbar-${l}`,v.className="taskbar-item",y){const b=document.createElement("img");b.src=y,v.appendChild(b)}const g=document.createElement("span");g.textContent=p,v.appendChild(g),v.onclick=()=>{const b=document.getElementById(l);b&&(b.style.display==="none"?(b.style.display="block",v.classList.add("active")):this.bringToFront(b))},v.oncontextmenu=b=>{b.preventDefault();const F=document.getElementById("taskbar-context-menu");F&&F.remove();const S=document.createElement("div");S.id="taskbar-context-menu",S.className="kde-menu";const m=document.getElementById(l),a=(L,O)=>{const C=document.createElement("div");C.textContent=L,C.className="kde-item",C.onclick=()=>{O(),S.remove()},S.appendChild(C)};a(m.style.display==="none"?"Restore":"Minimize",()=>{m.style.display==="none"?m.style.display="block":this.minimizeWindow(m),this.bringToFront(m)}),a(m.dataset.fullscreen==="true"?"Restore Size":"Maximize",()=>{this.toggleFullscreen(m),this.bringToFront(m)}),a("Bring to Front",()=>this.bringToFront(m)),a("Properties",()=>{const L=this.openWindows.get(l);if(!L)return;const O=document.getElementById(l);if(!O)return;const C=O.dataset,A=O.getBoundingClientRect(),B=[`Window ID: ${l}`,`Title: ${L.title}`,C.appType?`Type: ${C.appType}`:"",C.appId?`App ID: ${C.appId}`:"",C.swf?`SWF Path: ${C.swf}`:"",C.rom?`ROM: ${C.rom}`:"",C.core?`Core: ${C.core}`:"",C.externalUrl?`URL: ${C.externalUrl}`:"",`Width: ${Math.round(A.width)}px`,`Height: ${Math.round(A.height)}px`,`Left: ${Math.round(A.left)}px`,`Top: ${Math.round(A.top)}px`,`Z-Index: ${O.style.zIndex}`,`Fullscreen: ${C.fullscreen==="true"?"Yes":"No"}`].filter(Boolean).map(St=>`<div style="margin:2px 0;">${St}</div>`).join(""),H=this.createWindow(`${l}-props`,`Properties: ${L.title}`,"40vw","40vh");H.innerHTML=`
          <div class="window-header">
            <span>Properties: ${L.title}</span>
            ${this.wm.getWindowControls()}
          </div>
          <div class="window-content" style="width:100%; height:100%; overflow:auto; user-select:text;">
            ${B}
          </div>
        `,desktop.appendChild(H),this.makeDraggable(H),this.makeResizable(H),this.setupWindowControls(H)}),a("Close Window",()=>{this.removeFromTaskbar(l),m&&m.remove()}),document.body.appendChild(S);const _=S.getBoundingClientRect();let u=b.pageX,D=window.innerHeight-b.pageY;u+_.width>window.innerWidth&&(u=window.innerWidth-_.width-10),D+_.height>window.innerHeight&&(D=10),S.style.setProperty("--ctx-left",`${u}px`),S.style.setProperty("--ctx-bottom",`${D}px`),document.addEventListener("click",function L(){S.remove(),document.removeEventListener("click",L)})},document.getElementById("taskbar-windows").appendChild(v),this.openWindows.set(l,{taskbarItem:v,title:p})}registerCloseWindow(l,p){l.addEventListener("click",()=>{const y=document.getElementById(p);if(y)y.remove();else return;this.removeFromTaskbar(p)})}removeFromTaskbar(l){const p=document.getElementById(`taskbar-${l}`);p&&p.remove(),this.openWindows.delete(l)}bringToFront(l){l&&(l.style.zIndex=this.zIndexCounter++)}minimizeWindow(l){l.style.display="none";const p=document.getElementById(`taskbar-${l.id}`);p&&(p.style.background="#1a1a1a")}toggleFullscreen(l){const p=l.dataset.fullscreen==="true",y=l.querySelector(".window-header");if(p)document.fullscreenElement===l&&document.exitFullscreen(),Object.assign(l.style,{width:l.dataset.prevWidth,height:l.dataset.prevHeight,left:l.dataset.prevLeft,top:l.dataset.prevTop}),y&&(y.style.display=""),l.dataset.fullscreen="false";else{Object.assign(l.dataset,{prevWidth:l.style.width,prevHeight:l.style.height,prevLeft:l.style.left,prevTop:l.style.top});const v=()=>{Object.assign(l.style,{width:"100vw",height:"100vh",left:"0",top:"0"}),y&&(y.style.display="none")};l.requestFullscreen?l.requestFullscreen().then(v).catch(v):v(),l.dataset.fullscreen="true";const g=()=>{document.fullscreenElement||(y&&(y.style.display=""),l.dataset.fullscreen="false",document.removeEventListener("fullscreenchange",g))};document.addEventListener("fullscreenchange",g)}}setupWindowControls(l){l.querySelector(".close-btn").onclick=()=>{this.removeFromTaskbar(l.id),l.remove(),l.dataset.isGame==="true"&&(this.gameWindowCount=Math.max(0,this.gameWindowCount-1)),this.updateTransparency()},l.querySelector(".minimize-btn").onclick=()=>this.minimizeWindow(l),l.querySelector(".maximize-btn").onclick=()=>this.toggleFullscreen(l);const p=l.querySelector(".close-btn");p&&this.registerCloseWindow(p),l.addEventListener("mousedown",()=>this.bringToFront(l))}makeDraggable(l){const p=l.querySelector(".window-header");p.onmousedown=y=>{if(y.target.tagName==="BUTTON")return;const v=y.clientX-l.offsetLeft,g=y.clientY-l.offsetTop;document.onmousemove=x=>{l.style.left=`${x.clientX-v}px`,l.style.top=`${x.clientY-g}px`},document.onmouseup=()=>document.onmousemove=null}}makeResizable(l){const y=v=>{const g=l.getBoundingClientRect();let x="";return v.clientY-g.top<10?x+="n":g.bottom-v.clientY<10&&(x+="s"),v.clientX-g.left<10?x+="w":g.right-v.clientX<10&&(x+="e"),x};l.addEventListener("mousemove",v=>{const g=y(v),x={n:"n-resize",s:"s-resize",w:"w-resize",e:"e-resize",nw:"nw-resize",ne:"ne-resize",sw:"sw-resize",se:"se-resize","":"default"};l.style.cursor=x[g]||"default"}),l.addEventListener("mousedown",v=>{const g=y(v);if(!g)return;v.preventDefault();const x=v.clientX,b=v.clientY,F=l.getBoundingClientRect(),S=F.width,m=F.height,a=F.left,_=F.top,u=L=>{let O=S,C=m,A=a,K=_;g.includes("e")&&(O=S+(L.clientX-x)),g.includes("s")&&(C=m+(L.clientY-b)),g.includes("w")&&(O=S-(L.clientX-x),A=a+(L.clientX-x)),g.includes("n")&&(C=m-(L.clientY-b),K=_+(L.clientY-b));const B=300;O>B&&(l.style.width=`${O}px`,l.style.left=`${A}px`),C>B&&(l.style.height=`${C}px`,l.style.top=`${K}px`)},D=()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",D)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",D)})}getWindowControls(){return`<div class="window-controls">
              <button class="minimize-btn" title="Minimize">−</button>
              <button class="maximize-btn" title="Maximize">□</button>
              <button class="close-btn" title="Close">X</button>
            </div>
    `}showPopup(l){const p=document.createElement("div");p.textContent=l,Object.assign(p.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"20px 40px",backgroundColor:"rgba(0,0,0,0.8)",color:"#fff",fontSize:"18px",borderRadius:"10px",textAlign:"center",zIndex:9999,cursor:"pointer",boxShadow:"0 4px 15px rgba(0,0,0,0.3)"}),p.addEventListener("click",()=>{p.remove()}),document.body.appendChild(p)}}class Us{constructor(l){this.wm=l,this.history=[],this.historyIndex=-1,this.currentURL="https://www.google.com/webhp?igu=1"}open(){if(document.getElementById("browser-win")){this.wm.bringToFront(document.getElementById("browser-win"));return}const l=document.createElement("div");l.className="window",l.id="browser-win",l.dataset.fullscreen="false",l.innerHTML=`
      <div class="window-header">
        <span>Browser</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <nav class="browser-nav">
        <div>
          <button id="back-btn" disabled aria-label="Click to go back" title="Click to go back">
            ←
          </button>
          <button id="forward-btn" disabled aria-label="Click to go forward" title="Click to go forward">
            →
          </button>
          <button id="reload-btn" aria-label="Reload this page" title="Reload this page">
            ⟳
          </button>
        </div>
        <input id="address-bar" type="url" value="${this.currentURL}" aria-label="Address" enterkeyhint="go">
      </nav>
      <nav class="bookmark-bar">
      <button data-url="https://www.google.com/webhp?igu=1">Google</button>
      <button data-url="https://reeyuki.github.io">Reeyuki Site</button>
      <button data-url="https://liventcord.github.io">LiventCord</button>
      <button data-url="https://www.wikipedia.org">Wikipedia</button>
      <button data-url="https://www.mixconvert.com">Mix Convert</button>
      <button data-url="https://dustinbrett.com/Program%20Files/Browser/dino/index.html">T-Rex Dino</button>
      <button onclick="window.open('https://dn721809.ca.archive.org/0/items/youtube-xvFZjo5PgG0/xvFZjo5PgG0.mp4','_blank')">Click me</button>
      <button data-url="https://bluemaxima.org/flashpoint">Flashpoint Archive</button>
      <button data-url="https://jsfiddle.net">JS Fiddle</button>
      <a href="https://emupedia.net/beta/emuos/">EmuOS</a>
      </nav>
      <iframe id="browser-frame" src="${this.currentURL}" style="width:100%;height:calc(100% - 88px);border:none"></iframe>
    `,desktop.appendChild(l),this.wm.makeDraggable(l),this.wm.makeResizable(l),this.wm.setupWindowControls(l),this.wm.addToTaskbar(l.id,"Browser","/static/icons/chromium.webp"),l.querySelector(".close-btn").onclick=()=>l.remove(),this.frame=l.querySelector("#browser-frame"),this.addressInput=l.querySelector("#address-bar"),this.backBtn=l.querySelector("#back-btn"),this.forwardBtn=l.querySelector("#forward-btn"),this.reloadBtn=l.querySelector("#reload-btn"),l.style.width="70vw",l.style.height="70vh",l.style.left="15vw",l.style.top="15vh",this.setupControls(l)}setupControls(l){this.backBtn.onclick=()=>this.goBack(),this.forwardBtn.onclick=()=>this.goForward(),this.reloadBtn.onclick=()=>this.frame.src=this.currentURL,this.addressInput.addEventListener("keydown",p=>{p.key==="Enter"&&this.navigate(this.addressInput.value)}),l.querySelectorAll(".bookmark-bar button").forEach(p=>{p.addEventListener("click",()=>{this.navigate(p.dataset.url)})})}navigate(l){if(!l){console.error("No url found");return}!l.startsWith("http")&&!l.startsWith("chrome")&&(l="https://"+l),this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push(l),this.historyIndex++,this.updateNavigation()}goBack(){this.historyIndex>0&&(this.historyIndex--,this.updateNavigation())}goForward(){this.historyIndex<this.history.length-1&&(this.historyIndex++,this.updateNavigation())}updateNavigation(){this.currentURL=this.history[this.historyIndex],this.frame.src=this.currentURL,this.addressInput.value=this.currentURL,this.backBtn.disabled=this.historyIndex<=0,this.forwardBtn.disabled=this.historyIndex>=this.history.length-1}}const xr="kdeFavorites";function ln(){return JSON.parse(localStorage.getItem(xr))||[]}function Rr(rt){localStorage.setItem(xr,JSON.stringify(rt))}function js(rt){let l=ln();l.includes(rt)||(l.push(rt),Rr(l),fi(),Nr(rt,!0))}function Ws(rt){let l=ln();l=l.filter(p=>p!==rt),Rr(l),fi(),Nr(rt,!1)}function Or(rt){const l=document.createElement("span");return l.textContent="★",l.className="star",l.style.color=ln().includes(rt)?"gold":"#ccc",l.addEventListener("click",p=>{p.stopPropagation(),ln().includes(rt)?Ws(rt):js(rt)}),l.dataset.app=rt,l}function Nr(rt,l){document.querySelectorAll(`.kde-item[data-app="${rt}"] span`).forEach(y=>{y.textContent==="★"&&(y.style.color=l?"gold":"#ccc")});const p=document.querySelector(`.kde-item[data-app="${rt}"]`);p&&(p.style.background=l?"rgba(255, 215, 0, 0.1)":"transparent")}function fi(rt){if(!rt){console.error("No app launcher");return}const l=document.querySelector('.kde-page[data-page="favorites"]');l.innerHTML="";const p=ln();if(p.length===0){const y=document.createElement("div");y.textContent="No favorite apps",y.style.padding="10px",y.style.color="#888",l.appendChild(y);return}p.forEach(y=>{const v=document.querySelector(`.kde-item[data-app="${y}"]`);if(!v)return;const g=v.cloneNode(!0);g.style.position="relative",g.style.background="rgba(255, 215, 0, 0.1)",g.onclick=()=>rt.launch(y);const x=g.querySelector(".star");x&&x.remove(),g.appendChild(Or(y)),l.appendChild(g)})}function Hs(){document.querySelectorAll(".kde-page:not([data-page='favorites']) .kde-item").forEach(rt=>{const l=rt.dataset.app;rt.style.position="relative";const p=Or(l);p.style.opacity="0",p.style.transition="opacity 0.2s",rt.appendChild(p),rt.addEventListener("mouseenter",()=>p.style.opacity="1"),rt.addEventListener("mouseleave",()=>p.style.opacity="0"),ln().includes(l)&&(rt.style.background="rgba(255, 215, 0, 0.1)")})}function qs(){document.querySelectorAll(".kde-cat").forEach(rt=>{rt.onclick=()=>{document.querySelectorAll(".kde-cat").forEach(l=>l.classList.remove("active")),document.querySelectorAll(".kde-page").forEach(l=>l.classList.remove("active")),rt.classList.add("active"),document.querySelector(`.kde-page[data-page="${rt.dataset.cat}"]`).classList.add("active")}}),document.getElementById("kde-search").addEventListener("input",rt=>{const l=rt.target.value.toLowerCase();document.querySelectorAll(".kde-item").forEach(p=>{p.style.display=p.textContent.toLowerCase().includes(l)?"":"none"})}),Hs()}function Gs(rt){return rt.replace(/(?:^\w|[A-Z]|\b\w)/g,function(l,p){return p===0?l.toLowerCase():l.toUpperCase()}).replace(/\s+/g,"")}function Dr(rt){if(rt=Gs(rt),console.log("Trying get icon : ",rt),rt==="explorer")return"/static/icons/file.png";if(rt==="computer")return"/static/icons/pc.webp";try{return document.querySelector(`#desktop div[data-app="${rt}"]`)?.querySelector("img")?.src||null}catch{return null}}function Xs(rt){const l={system:document.querySelector('.kde-page[data-page="system"]'),apps:document.querySelector('.kde-page[data-page="apps"]'),games:document.querySelector('.kde-page[data-page="games"]'),favorites:document.querySelector('.kde-page[data-page="favorites"]')};["system","apps","games"].forEach(p=>{l[p]&&(l[p].innerHTML="")}),Object.entries(rt.appMap).forEach(([p,y])=>{const v=document.createElement("div");v.classList.add("kde-item"),v.dataset.app=p;const g=Dr(p),x=document.createElement("img");x.classList.add("kde-item-icon"),g?(x.src=g,x.alt=""):x.style.display="none";const b=p.charAt(0).toUpperCase()+p.slice(1),F=document.createElement("span");F.textContent=b,v.appendChild(x),v.appendChild(F),v.addEventListener("click",()=>rt.launch(p)),y.type==="system"?l.system?.appendChild(v):y.type==="game"||y.type==="swf"?l.games?.appendChild(v):l.apps?.appendChild(v)})}class Ys{constructor(l,p,y,v,g,x,b,F){this.wm=l,this.fs=p,this.musicPlayer=y,this.explorerApp=v,this.terminalApp=g,this.notepadApp=x,this.browserApp=b,this.cameraApp=F,this.pageLoadTime=Date.now(),this.TRANSPARENCY_ALLOWED_APP_IDS=new Set(["paint","vscode","liventcord"]);const S=this._getAnalyticsBase("hit-page");this.sendAnalytics({...S,event:"start"}),this.appMap={return:{type:"system",action:()=>window.location.href="/"},explorer:{type:"system",action:()=>this.explorerApp.open()},computer:{type:"system",action:()=>this.explorerApp.open()},terminal:{type:"system",action:()=>this.terminalApp.open()},notepad:{type:"system",action:()=>this.notepadApp.open()},browser:{type:"system",action:()=>this.browserApp.open()},cameraApp:{type:"system",action:()=>this.cameraApp.open()},music:{type:"system",action:()=>this.musicPlayer.open(this.wm)},photopea:{type:"game",url:"https://www.photopea.com"},sonic:{type:"swf",swf:"/static/games/swfGames/sonic.swf"},flight:{type:"swf",swf:"/static/games/swfGames/flight.swf"},swarmQueen:{type:"swf",swf:"/static/games/swfGames/swarmQueen.swf"},paint:{type:"game",url:"https://paint.js.org/"},pacman:{type:"game",url:"https://pacman-e281c.firebaseapp.com"},pvz:{type:"game",url:"https://emupedia.net/emupedia-game-pvz"},pvz2:{type:"remote",url:"https://play.pvzge.com"},pvzHybrid:{type:"remote",url:"https://www.miniplay.com/embed/plants-vs-zombies-hybrid-story"},tetris:{type:"game",url:"https://turbowarp.org/embed.html?autoplay#31651654"},roads:{type:"game",url:"https://slowroads.io"},vscode:{type:"game",url:"https://emupedia.net/emupedia-app-vscode"},isaac:{type:"game",url:"https://emupedia.net/emupedia-game-binding-of-isaac"},mario:{type:"game",url:"https://emupedia.net/emupedia-game-mario"},papaGames:{type:"game",url:"https://papasgamesfree.io"},zombieTd:{type:"swf",swf:"/static/games/swfGames/zombietd.swf"},zombotron:{type:"swf",swf:"/static/games/zombotron/zombotron.swf"},zombotron2:{type:"swf",swf:"/static/games/zombotron/zombotron2.swf"},zombotron2Time:{type:"game",url:"/static/rfiv.html?game=zombotron"},breach:{type:"swf",swf:"/static/games/swfGames/breach.swf"},fancyPants:{type:"swf",swf:"/static/games/swfGames/fancypantsadventure.swf"},fancyPants2:{type:"swf",swf:"/static/games/swfGames/fancypantsadventure2.swf"},fancyPants3:{type:"swf",swf:"/static/games/swfGames/fancypantsadventure3.swf"},strikeForce:{type:"swf",swf:"https://cache.armorgames.com/files/games/strikeforce-kitty-16008.swf?v=1404201513"},strikeForce2:{type:"swf",swf:"https://cache.armorgames.com/files/games/strikeforce-kitty-2-17643.swf?v=1423725280"},baloonsTd5:{type:"swf",swf:"/static/games/swfGames/baloonstd5.swf"},baloonsTd6:{type:"swf",swf:"https://truffled.lol/iframe.html?url=%2Fgames%2Fbtd6%2Findex.html"},trinitas:{type:"game",url:"/static/games/trinitas"},jojo:{type:"game",url:"https://www.retrogames.cc/embed/8843-jojos-bizarre-adventure%3A-heritage-for-the-future-jojo-no-kimyou-na-bouken%3A-mirai-e-no-isan-japan-990927-no-cd.html"},gtaVc:{type:"game",url:"/static/vciframe.html"},subwaySurfers:{type:"game",url:"https://g.igroutka.ru/games/164/Xm2W5MIcPqrF1Y90/12/subway_surfers_easter_edinburgh"},mutantFighting:{type:"swf",swf:"https://cache.armorgames.com/files/games/mutant-fighting-cup-14425.swf?v=1373587528"},mutantFighting2:{type:"swf",swf:"/static/games/swfGames/mutantfightingcup2.swf"},finnAndBones:{type:"game",url:"/static/flashpointarchive.html?fpGameName=finnAndBones"},obama:{type:"game",url:"/static/flashpointarchive.html?fpGameName=obama-alien-defense"},intrusion2:{type:"swf",swf:"/static/games/swfGames/intrusion2.swf"},dan:{type:"game",url:"https://www.silvergames.com/en/dan-the-man/gameframe"},infectonator:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-5020.swf?v=1373587522"},infectonator2:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-2-13150.swf?v=1373587527"},newyorkShark:{type:"swf",swf:"https://cache.armorgames.com/files/games/new-york-shark-12969.swf?v=1373587527"},swordsSouls:{type:"swf",swf:"https://cache.armorgames.com/files/games/swordssouls-17817.swf?v=1464609285"},corporationInc:{type:"swf",swf:"https://cache.armorgames.com/files/games/corporation-inc-7348.swf?v=1373587524"},aground:{type:"game",url:"https://cache.armorgames.com/files/games/aground-18245/index.html?v=1591832301"},mobyDick:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-the-video--7199.swf?v=1373587524"},mobyDick2:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-2-12662.swf?v=1373587526"},elfStory:{type:"swf",swf:"https://cache.armorgames.com/files/games/elf-story-14680.swf?v=1373587528"},frogDares:{type:"swf",swf:"https://cache.armorgames.com/files/games/frog-dares-12672.swf?v=1373587526"},kamikazePigs:{type:"swf",swf:"https://cache.armorgames.com/files/games/kamikaze-pigs-13545.swf?v=1373587527"},icyFishes:{type:"swf",swf:"https://cache.armorgames.com/files/games/icy-fishes-12977.swf?v=1373587527"},feedUs6:{type:"swf",swf:"/static/games/swfGames/feeduslostisland.swf"},superrobotwar:{type:"game",url:"/static/flashpointarchive.html?fpGameName=super-robot-war"},feedUsPirates:{type:"swf",swf:"/static/games/swfGames/feeduspirates.swf"},epicbossfighter2:{type:"swf",swf:"/static/games/swfGames/EpicBossFighter2.swf"},avatarFortressFight2:{type:"swf",swf:"/static/games/swfGames/avatarFortressFight2.swf"},incredibles:{type:"swf",swf:"/static/games/swfGames/incredibles.swf"},cactusMcCoy:{type:"game",url:"https://papasgamesfree.io/cactus-mccoy-1"},jackSmith:{type:"game",url:"https://papasgamesfree.io/jacksmith"},pokemonRed:{type:"gba",url:"pokemon-red.gba"},pokemonEmerald:{type:"gba",url:"pokemon-emerald.gba"},pokemonPlatinum:{type:"nds",url:"pokemon-platinum.nds"},pokemonHeartgold:{type:"nds",url:"pokemon-heartgold.nds"},pokemonWhite:{type:"nds",url:"pokemon-white.nds"},pokemonWhite2:{type:"nds",url:"pokemon-white-2.zip"},minecraft:{type:"remote",url:"https://eaglercraft.com/play"},liventcord:{type:"game",url:"https://liventcord.github.io"},fnaf:{type:"game",url:"/static/games/fnaf"},geometryDash:{type:"game",url:"https://emupedia.net/emupedia-game-geometry-dash"},cutTheRope:{type:"game",url:"https://emupedia.net/emupedia-game-cut-the-rope2"},game2048:{type:"game",url:"https://emupedia.net/emupedia-game-2048"},pinball:{type:"game",url:"https://emupedia.net/emupedia-game-space-cadet-pinball"},flappyBird:{type:"game",url:"https://emupedia.net/emupedia-game-flappy-bird"},jetpack:{type:"game",url:"https://emupedia.net/emupedia-game-jetpack-joyride"},happyWheels:{type:"game",url:"https://emupedia.net/emupedia-game-happy-wheels/flash"},fistPunch:{type:"game",url:"/static/flashpointarchive.html?fpGameName=fistPunch"},hollowKnight:{type:"game",url:"/static/hollowknight.html"},slimeRancher:{type:"game",url:"https://dev.snubby.top"},kindergarten:{type:"game",url:"https://truffled.lol/games/kindergarten/1/index.html"},kindergarten2:{type:"game",url:"https://truffled.lol/games/kindergarten/2/index.html"},cuphead:{type:"game",url:"https://truffled.lol/games/Cuphead/index.html"},raft:{type:"game",url:"https://truffled.lol/games/raft/index.html"},celeste:{type:"game",url:"https://truffled.lol/games/celeste/index.html"},terraria:{type:"game",url:"https://truffled.lol/games/terraria/terraria-wrapper.html"},yandereSim:{type:"game",url:"https://truffled.lol/gamefile/yandere.html"},undertale:{type:"game",url:"https://truffled.lol/games/bts"},balatro:{type:"game",url:"https://truffled.lol/games/balatro/index.html"},granny:{type:"game",url:"https://truffled.lol/gamefile/Granny.html"},bendy:{type:"game",url:"https://truffled.lol/games/BATIM/BATIM/index.html"},tattletail:{type:"game",url:"https://truffled.lol/games/tattletail/index.html"}},Xs(this)}launch(l){const p=this.appMap[l];if(!p){console.error(`App ${l} not found.`);return}console.log("Starting app : ",l);const y=this._getAnalyticsBase(l);this.sendAnalytics({...y,event:"launch"}),{system:()=>p.action(),swf:()=>this.openRuffleApp(l,p.swf,y),gba:()=>this.openEmulatorApp(l,p.url,"gba",y),nds:()=>this.openEmulatorApp(l,p.url,"nds",y),game:()=>this.openGameApp(l,p.url,y),html:()=>this.openHtmlApp(l,p.html,y,p),remote:()=>this.openRemoteApp(p.url)}[p.type]?.()}_getAnalyticsBase(l){let p="Unknown";try{const F=document.createElement("canvas"),S=F.getContext("webgl")||F.getContext("experimental-webgl");if(S){const m=RENDERER||S.getExtension("WEBGL_debug_renderer_info");p=m?S.getParameter(m.UNMASKED_RENDERER_WEBGL):S.getParameter(S.RENDERER)}}catch{}const y=Date.now()-this.pageLoadTime,v=Math.floor(y/36e5),g=Math.floor(y%36e5/6e4),x=`${v}h, ${g}m`,b=/Brave\//.test(navigator.userAgent)||window.navigator.brave&&typeof window.navigator.brave.isBrave=="function";return{app:l,timestamp:Date.now(),browser:{userAgent:navigator.userAgent,isBrave:b,language:navigator.language,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,uptime:x,gpu:p,ram:navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",cpuCores:navigator.hardwareConcurrency||"Unknown",dnt:navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled"}}}sendAnalytics(l){window.location.hostname!=="localhost"&&fetch("https://analytics.liventcord-a60.workers.dev/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}recordUsage(l,p){const y=Date.now(),v=document.getElementById(l),g=()=>{const x=Date.now()-y;this.sendAnalytics({...p,event:"usage",durationMs:x})};v.querySelector(".close-btn").addEventListener("click",g),v.addEventListener("blur",g)}openRemoteApp(l){const p=this._getAnalyticsBase(l);this.sendAnalytics({...p,event:"launch"}),window.open(l,"_blank","noopener,noreferrer")}openHtmlApp(l,p,y){if(document.getElementById(`${l}-win`)){this.wm.bringToFront(document.getElementById(`${l}-win`));return}this.createWindow(l,l.replace(/([A-Z])/g," $1").replace(/^./,v=>v.toUpperCase()),p,null,l,y)}openRuffleApp(l,p){if(!p)return;const y=document.querySelector(`[data-app="${l}"] div`);y&&(l=y.textContent);const v=p.replace(/[^a-zA-Z0-9]/g,"");if(document.getElementById(`${v}-win`)){this.wm.bringToFront(document.getElementById(`${v}-win`));return}const g=`<embed src="${p}" width="100%" height="100%">`;this.createWindow(v,l.toUpperCase(),g,null,l,{type:"swf",swf:p})}openEmulatorApp(l,p,y){const v=document.querySelector(`[data-app="${l}"] div`);v&&(l=v.textContent);const g=`${y}-${p.replace(/\W/g,"")}-${Date.now()}`;if(document.getElementById(g)){this.wm.bringToFront(document.getElementById(g));return}const x=`/static/emulatorjs.html?rom=${encodeURIComponent(p)}&core=${encodeURIComponent(y)}&color=%230064ff`,b=`<iframe src="${x}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`;this.createWindow(g,l,b,x,l,{type:y,rom:p,core:y})}openGameApp(l,p){let y;const v=document.querySelector(`[data-app="${l}"] div`);if(v&&(y=v.textContent),document.getElementById(`${l}-win`)){this.wm.bringToFront(document.getElementById(`${l}-win`));return}const g=`<iframe src="${p}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`;this.createWindow(l,y,g,p,l,{type:"game"})}isTransparencyBlocked(l,p){return!(p.type==="system"||this.TRANSPARENCY_ALLOWED_APP_IDS.has(l))}createWindow(l,p,y,v=null,g=null,x={}){const b=this.isTransparencyBlocked(g,x),F=this.wm.createWindow(`${l}-win`,p,"80vw","80vh",b);F.dataset.appType=x.type||"",F.dataset.externalUrl=v||"",F.dataset.appId=g||"",F.dataset.swf=x.swf||"",F.dataset.isGame=b,F.dataset.rom=x.rom||"",F.dataset.core=x.core||"",console.log(`Id: ${l}, ${g}, appMeta ${x.toString()}, title: ${p}`),F.innerHTML=`
      <div class="window-header">
        <span>${p}</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          ${v?'<button class="external-btn" title="Open in External">↗</button>':""}
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="width:100%; height:100%;">
        ${y}
      </div>
    `,desktop.appendChild(F),this.wm.makeDraggable(F),this.wm.makeResizable(F),this.wm.setupWindowControls(F),this.wm.bringToFront(F),v&&F.querySelector(".external-btn").addEventListener("click",()=>this.openRemoteApp(v));const S=Dr(g||l);this.wm.addToTaskbar(F.id,p,S),this.recordUsage(`${l}-win`)}}class Zs{constructor(l,p){this.fs=l,this.wm=p}setExplorer(l){this.explorerApp=l}open(l="Untitled",p="",y=null){const v=`notepad-${l.replace(/\s/g,"")}`;if(document.getElementById(v)){this.wm.bringToFront(document.getElementById(v));return}const g=this.wm.createWindow(v,`${l} - Notepad`,"600px","400px");Object.assign(g.style,{left:"250px",top:"150px"}),g.innerHTML=`
      <div class="window-header">
        <span>${l} - Notepad</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="notepad-menu">
        <button class="notepad-btn" data-action="save">Save</button>
        <button class="notepad-btn" data-action="saveAs">Save As</button>
        <button class="notepad-btn" data-action="open">Open</button>
      </div>
      <div class="window-content">
        <textarea class="notepad-textarea" style="width:100%; height:calc(100% - 40px); border:none; padding:10px; font-family:monospace;">${p}</textarea>
      </div>
    `,desktop.appendChild(g),this.wm.makeDraggable(g),this.wm.makeResizable(g),this.wm.setupWindowControls(g),this.wm.addToTaskbar(g.id,`${l} - Notepad`,"/static/icons/music.png"),this.setupNotepadControls(g,l,y)}setupNotepadControls(l,p,y){const v=l.querySelector(".notepad-textarea");l.querySelectorAll(".notepad-btn").forEach(x=>{x.onclick=()=>{const b=x.dataset.action;b==="save"?this.saveFile(l,v,p,y):b==="saveAs"?this.saveAsFile(v):b==="open"&&this.openFileDialog()}})}saveFile(l,p,y,v){if(!v){this.saveAsFile(p);return}const g=p.value;this.fs.updateFile(v,y,g),alert(`File saved: ${y}`)}saveAsFile(l){const p=prompt("Enter file name:","NewFile.txt");if(!p)return;const y=prompt("Enter path (e.g., home/reeyuki/Documents):","home/reeyuki/Documents");if(!y)return;const v=y.split("/").filter(x=>x),g=l.value;try{this.fs.createFile(v,p,g),alert(`File saved: ${p} at /${y}`)}catch{alert("Error saving file. Please check the path.")}}openFileDialog(){this.explorerApp.open(async(l,p)=>{const y=await this.fs.getFileContent(l,p);this.open(p,y,l)})}}class Vs{constructor(l){this.wm=l,this.stream=null,this.mediaRecorder=null,this.recordedChunks=[],this.recordings=[],this.recordingInterval=null,this.historyWin=null}open(){if(document.getElementById("camera-win")){this.wm.bringToFront(document.getElementById("camera-win"));return}const l=document.createElement("div");l.className="window",l.id="camera-win",l.dataset.fullscreen="false",l.innerHTML=`
      <div class="window-header">
        <span>Camera</span>
        ${this.wm.getWindowControls()}
      </div>
      <div style="padding:10px; display:flex; flex-direction:column; align-items:center; position:relative;">
        <div style="position:relative; width:100%; max-width:600px;">
          <video id="camera-video" autoplay playsinline style="width:100%; border:1px solid #ccc; border-radius:8px;"></video>
          <span id="recording-icon" style="position:absolute; top:10px; left:10px; width:15px; height:15px; border-radius:50%; background:red; display:none;"></span>
          <span id="recording-timer" style="position:absolute; top:10px; right:10px; font-weight:bold;"></span>
        </div>
        <div style="margin-top:10px; display:flex; gap:10px;">
          <button id="take-photo-btn" style="padding:5px 15px;">Take Photo</button>
          <button id="start-record-btn" style="padding:5px 15px;">Start Recording</button>
          <button id="stop-record-btn" style="padding:5px 15px;" disabled>Stop Recording</button>
          <button id="open-history-btn" style="padding:5px 15px;">History</button>
        </div>
        <a id="download-link" style="display:none; margin-top:10px;"></a>
      </div>
    `,desktop.appendChild(l),this.wm.makeDraggable(l),this.wm.makeResizable(l),this.wm.setupWindowControls(l),this.wm.addToTaskbar(l.id,"Camera","/static/icons/camera.svg"),l.querySelector(".close-btn").onclick=()=>{this.stopCamera(),l.remove(),this.historyWin&&this.historyWin.remove()},this.video=l.querySelector("#camera-video"),this.takePhotoBtn=l.querySelector("#take-photo-btn"),this.startRecordBtn=l.querySelector("#start-record-btn"),this.stopRecordBtn=l.querySelector("#stop-record-btn"),this.downloadLink=l.querySelector("#download-link"),this.recordingIcon=l.querySelector("#recording-icon"),this.recordingTimer=l.querySelector("#recording-timer"),this.historyBtn=l.querySelector("#open-history-btn"),l.style.width="50vw",l.style.height="70vh",l.style.left="25vw",l.style.top="15vh",this.startCamera(),this.takePhotoBtn.onclick=()=>this.takePhoto(),this.startRecordBtn.onclick=()=>this.startRecording(),this.stopRecordBtn.onclick=()=>this.stopRecording(),this.historyBtn.onclick=()=>this.openHistoryWindow()}async startCamera(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.video.srcObject=this.stream}catch(l){alert("Camera access denied or not available."),console.error(l)}}takePhoto(){const l=document.createElement("canvas");l.width=this.video.videoWidth,l.height=this.video.videoHeight,l.getContext("2d").drawImage(this.video,0,0);const p=l.toDataURL("image/png");this.downloadLink.href=p,this.downloadLink.download="photo.png",this.downloadLink.textContent="Download Photo",this.downloadLink.style.display="block"}startRecording(){this.stream&&(this.recordedChunks=[],this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.ondataavailable=l=>{l.data.size>0&&this.recordedChunks.push(l.data)},this.mediaRecorder.onstop=()=>{const l=new Blob(this.recordedChunks,{type:"video/webm"}),p=URL.createObjectURL(l);this.addRecording(p),this.downloadLink.href=p,this.downloadLink.download=`video-${Date.now()}.webm`,this.downloadLink.textContent="Download Video",this.downloadLink.style.display="block",this.historyWin&&this.renderHistory()},this.mediaRecorder.start(),this.startRecordBtn.disabled=!0,this.stopRecordBtn.disabled=!1,this.recordingIcon.style.display="block",this.startTimer())}stopRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.startRecordBtn.disabled=!1,this.stopRecordBtn.disabled=!0,this.recordingIcon.style.display="none",this.stopTimer())}startTimer(){let l=0;this.recordingTimer.textContent="00:00",this.recordingInterval=setInterval(()=>{l++;const p=String(Math.floor(l/60)).padStart(2,"0"),y=String(l%60).padStart(2,"0");this.recordingTimer.textContent=`${p}:${y}`},1e3)}stopTimer(){clearInterval(this.recordingInterval),this.recordingTimer.textContent=""}addRecording(l){this.recordings.unshift(l),this.recordings.length>5&&this.recordings.pop()}openHistoryWindow(){if(this.historyWin){this.wm.bringToFront(this.historyWin);return}this.historyWin=document.createElement("div"),this.historyWin.className="window",this.historyWin.id="history-win",this.historyWin.innerHTML=`
      <div class="window-header">
        <span>Recordings History</span>
        ${this.wm.getWindowControls()}
      </div>
      <div id="history-list" style="padding:10px; display:flex; flex-direction:column; gap:5px; overflow-y:auto; height:calc(100% - 30px);"></div>
    `,desktop.appendChild(this.historyWin),this.wm.makeDraggable(this.historyWin),this.wm.makeResizable(this.historyWin),this.wm.setupWindowControls(this.historyWin),this.wm.bringToFront(this.historyWin),this.historyWin.querySelector(".close-btn").onclick=()=>{this.historyWin.remove(),this.historyWin=null},this.historyWin.style.width="30vw",this.historyWin.style.height="50vh",this.historyWin.style.left="60vw",this.historyWin.style.top="20vh",this.renderHistory()}renderHistory(){if(!this.historyWin)return;const l=this.historyWin.querySelector("#history-list");l.innerHTML="",this.recordings.forEach((p,y)=>{const v=document.createElement("div");v.textContent=`Recording ${this.recordings.length-y}`,v.style.cursor="pointer",v.style.padding="5px",v.style.borderBottom="1px solid #ccc",v.onclick=()=>this.playRecording(p),l.appendChild(v)})}playRecording(l){const p=document.createElement("div");p.className="window",p.innerHTML=`
      <div class="window-header">
        <span>Playback</span>
        <div class="window-controls">
          <button class="close-btn">X</button>
        </div>
      </div>
      <video controls autoplay style="width:100%; height:90%;"></video>
    `,desktop.appendChild(p),this.wm.makeDraggable(p),this.wm.makeResizable(p),this.wm.bringToFront(p),p.querySelector(".close-btn").onclick=()=>p.remove();const y=p.querySelector("video");y.src=l,p.style.width="50vw",p.style.height="50vh",p.style.left="30vw",p.style.top="25vh"}stopCamera(){this.stream&&this.stream.getTracks().forEach(l=>l.stop())}}class Ks{constructor(){}open(l){if(document.getElementById("music-win")){console.log("bringing window to front"),l.bringToFront(document.getElementById("music-win"));return}console.log("Creating window");const p=l.createWindow("music-win","MUSIC");p.innerHTML=`
    <div class="window-header">
      <span>MUSIC</span>
      ${l.getWindowControls()}
    </div>
    <div class="window-content" style="width:100%; height:100%;">
      <div id="player-container" style="display:flex; flex-direction:column; align-items:center; gap:10px; padding:10px;"></div>
      </div>
    </div>`,qn.appendChild(p),ze.renderMusicPage(document.getElementById("player-container")),l.makeDraggable(p),l.makeResizable(p),l.setupWindowControls(p),l.addToTaskbar(p.id,"MUSIC","/static/icons/music.png")}}class Js{constructor(l){this.appLauncher=l,this.desktop=document.getElementById("desktop"),this.startButton=document.getElementById("start-button"),this.startMenu=document.getElementById("start-menu"),this.contextMenu=document.getElementById("context-menu"),this.selectionBox=document.getElementById("selection-box"),this.clipboardCurrentCopied=null,this.isDragging=!1,this.draggedIcons=[],this.dragOffsets=[],this.setupEventListeners()}setupEventListeners(){this.startButton.addEventListener("click",l=>{l.stopPropagation(),this.startMenu.style.display=this.startMenu.style.display==="flex"?"none":"flex",fi(this.appLauncher)}),this.startMenu.addEventListener("click",l=>l.stopPropagation()),document.addEventListener("click",()=>{this.startMenu.style.display="none",this.contextMenu.style.display="none"}),this.desktop.addEventListener("contextmenu",l=>{l.target.classList.contains("selectable")?(l.preventDefault(),this.showIconContextMenu(l,l.target)):l.target===this.desktop&&(l.preventDefault(),this.showDesktopContextMenu(l))}),this.setupIconHandlers(),this.setupSelectionBox(),this.setupStartMenu()}setupIconHandlers(){document.querySelectorAll(".icon.selectable").forEach(l=>{this.makeIconDraggable(l)})}makeIconDraggable(l){l.draggable=!1,Object.assign(l.style,{userSelect:"none",webkitUserDrag:"none"}),l.addEventListener("dblclick",y=>{y.stopPropagation(),this.appLauncher.launch(l.dataset.app,l)});let p={x:0,y:0};l.addEventListener("mousedown",y=>{p={x:y.clientX,y:y.clientY},y.ctrlKey?l.classList.toggle("selected"):l.classList.contains("selected")||(document.querySelectorAll(".icon.selectable").forEach(b=>b.classList.remove("selected")),l.classList.add("selected"));const v=Array.from(document.querySelectorAll(".icon.selectable.selected"));this.draggedIcons=v,this.dragOffsets=v.map(b=>({x:y.clientX-b.offsetLeft,y:y.clientY-b.offsetTop}));const g=b=>{Math.sqrt(Math.pow(b.clientX-p.x,2)+Math.pow(b.clientY-p.y,2))>5&&!this.isDragging&&(this.isDragging=!0,this.draggedIcons.forEach(S=>{S.style.opacity="0.7",S.style.zIndex="1000"})),this.isDragging&&this.draggedIcons.forEach((S,m)=>{const a=b.clientX-this.dragOffsets[m].x,_=b.clientY-this.dragOffsets[m].y;S.style.left=`${Math.max(0,a)}px`,S.style.top=`${Math.max(0,_)}px`})},x=b=>{this.isDragging&&(this.draggedIcons.forEach(a=>{const _=parseInt(a.style.left),u=parseInt(a.style.top),D=85,L=105;let O=Math.round(_/D)*D+5,C=Math.round(u/L)*L+5;for(;this.isPositionOccupied(O,C,a);){const A=this.desktop.clientHeight;C+=L,C+100>A&&(C=5,O+=D)}a.style.left=`${O}px`,a.style.top=`${C}px`,a.style.opacity="1",a.style.zIndex="1"}),this.isDragging=!1),this.draggedIcons=[],this.dragOffsets=[],document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)})}isPositionOccupied(l,p,y){const v=Array.from(document.querySelectorAll(".icon.selectable")),g=10;return v.some(x=>{if(x===y)return!1;const b=parseInt(x.style.left)||0,F=parseInt(x.style.top)||0;return Math.abs(b-l)<g&&Math.abs(F-p)<g})}showIconContextMenu(l,p){const y=Array.from(document.querySelectorAll(".icon.selectable.selected"));y.includes(p)||(document.querySelectorAll(".icon.selectable").forEach(g=>g.classList.remove("selected")),p.classList.add("selected"));const v=Array.from(document.querySelectorAll(".icon.selectable.selected")).pop();this.contextMenu.innerHTML=`
      <div id="ctx-open">Open</div>
      <div id="ctx-cut">Cut</div>
      <div id="ctx-copy">Copy</div>
      <div id="ctx-delete">Delete</div>
      <div id="ctx-properties">Properties</div>
    `,document.getElementById("ctx-open").onclick=()=>{this.contextMenu.style.display="none",this.appLauncher.launch(v.dataset.app,v)},document.getElementById("ctx-cut").onclick=()=>{this.clipboardCurrentCopied={action:"cut",icons:y.map(g=>({element:g,data:{app:g.dataset.app,name:g.dataset.name,path:g.dataset.path,innerHTML:g.innerHTML,className:g.className}}))},this.contextMenu.style.display="none"},document.getElementById("ctx-copy").onclick=()=>{this.clipboardCurrentCopied={action:"copy",icons:y.map(g=>({data:{app:g.dataset.app,name:g.dataset.name,path:g.dataset.path,innerHTML:g.innerHTML,className:g.className}}))},this.contextMenu.style.display="none"},document.getElementById("ctx-delete").onclick=()=>{y.forEach(g=>{g.remove()}),this.contextMenu.style.display="none"},document.getElementById("ctx-properties").onclick=()=>{this.showPropertiesDialog(v),this.contextMenu.style.display="none"},Object.assign(this.contextMenu.style,{left:`${l.pageX}px`,top:`${l.pageY}px`,display:"block"})}showPropertiesDialog(l){const p=l.id||`icon-${Date.now()}`,y=l.dataset,v=l.getBoundingClientRect(),g=y.app,x=this.appLauncher?.appMap?.[g]||{},F=[`Name: ${y.name||"Unknown"}`,`Type: ${y.app||"Application"}`,y.path?`Path: ${y.path}`:"",x.type?`App Type: ${x.type}`:"",x.swf?`SWF Path: ${x.swf}`:"",x.url?`URL: ${x.url}`:"",y.core?`Core: ${y.core}`:"",`Width: ${Math.round(v.width)}px`,`Height: ${Math.round(v.height)}px`,`Left: ${Math.round(v.left)}px`,`Top: ${Math.round(v.top)}px`,`Z-Index: ${l.style.zIndex||"0"}`].filter(Boolean).map(m=>`<div style="margin:2px 0;">${m}</div>`).join(""),S=this.appLauncher.wm.createWindow(`${p}-props`,`Properties: ${y.name||"Unknown"}`,"300px","auto");S.innerHTML=`
        <div class="window-header">
            <span>Properties: ${y.name||"Unknown"}</span>
            <div class="window-controls">
                <button class="minimize-btn" title="Minimize">−</button>
                <button class="maximize-btn" title="Maximize">□</button>
                <button class="close-btn" title="Close">X</button>
            </div>
        </div>
        <div class="window-content" style="width:100%; height:100%; overflow:auto; user-select:text; padding:10px;">
            ${F}
        </div>
    `,qn.appendChild(S),this.appLauncher.wm.makeDraggable(S),this.appLauncher.wm.makeResizable(S),this.appLauncher.wm.setupWindowControls(S)}showDesktopContextMenu(l){const p=['<div id="ctx-new-notepad">New Notepad</div>','<div id="ctx-open-explorer">Open File Explorer</div>'];this.clipboardCurrentCopied&&p.push('<div id="ctx-paste">Paste</div>'),p.push("<hr>",'<div id="ctx-refresh">Refresh</div>'),this.contextMenu.innerHTML=p.join(""),document.getElementById("ctx-new-notepad").onclick=()=>{this.contextMenu.style.display="none",bn.open()},document.getElementById("ctx-open-explorer").onclick=()=>{this.contextMenu.style.display="none",ze.open()},this.clipboardCurrentCopied&&(document.getElementById("ctx-paste").onclick=()=>{this.pasteIcons(l.pageX,l.pageY),this.contextMenu.style.display="none"}),document.getElementById("ctx-refresh").onclick=()=>{this.contextMenu.style.display="none",location.reload()},Object.assign(this.contextMenu.style,{left:`${l.pageX}px`,top:`${l.pageY}px`,display:"block"})}pasteIcons(l,p){if(!this.clipboardCurrentCopied)return;const{action:y,icons:v}=this.clipboardCurrentCopied;v.forEach((g,x)=>{const b=document.createElement("div");b.className=g.data.className,b.innerHTML=g.data.innerHTML,b.dataset.app=g.data.app,b.dataset.name=g.data.name,b.dataset.path=g.data.path,Object.assign(b.style,{position:"absolute",left:`${l+x*10}px`,top:`${p+x*10}px`,userSelect:"none",webkitUserDrag:"none"}),this.makeIconDraggable(b),this.desktop.appendChild(b),y==="cut"&&g.element&&g.element.remove()}),y==="cut"&&(this.clipboardCurrentCopied=null)}setupSelectionBox(){let l,p;this.desktop.addEventListener("mousedown",y=>{if(y.target!==this.desktop)return;l=y.pageX,p=y.pageY,Object.assign(this.selectionBox.style,{left:`${l}px`,top:`${p}px`,width:"0px",height:"0px",display:"block"});const v=document.querySelectorAll(".icon.selectable");v.forEach(b=>b.classList.remove("selected"));const g=b=>{const F=Math.abs(b.pageX-l),S=Math.abs(b.pageY-p),m=Math.min(b.pageX,l),a=Math.min(b.pageY,p);Object.assign(this.selectionBox.style,{width:`${F}px`,height:`${S}px`,left:`${m}px`,top:`${a}px`});const _=this.selectionBox.getBoundingClientRect();v.forEach(u=>{const D=u.getBoundingClientRect();!(D.right<_.left||D.left>_.right||D.bottom<_.top||D.top>_.bottom)?u.classList.add("selected"):u.classList.remove("selected")})},x=()=>{this.selectionBox.style.display="none",document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)})}setupStartMenu(){this.startMenu.querySelectorAll(".start-item").forEach(l=>{l.onclick=p=>{p.stopPropagation();const y=l.dataset.app;y==="documents"?(ze.open(),ze.navigate(["home","reeyuki","Documents"])):y==="pictures"?(ze.open(),ze.navigate(["home","reeyuki","Pictures"])):y==="notes"&&bn.open(),this.startMenu.style.display="none"}})}}const qn=document.getElementById("desktop"),Gn=new As,un=new zs,bn=new Zs(Gn,un,null),ze=new Ms(Gn,un,bn),Qs=new Us(un);bn.setExplorer(ze);const $s=new Rs(Gn,un),ta=new Ks,ea=new Vs(un),Cr=new Ys(un,Gn,ta,ze,$s,bn,Qs,ea);new Js(Cr);ui.startClock();ui.setRandomWallpaper();const na=window.location.search,ia=new URLSearchParams(na),Fr=ia.get("game");Fr&&setTimeout(()=>{Cr.launch(Fr)},100);const ra=qn.querySelectorAll(".icon");function Ar(){const rt=qn.clientHeight,l=80,p=100,y=5;let v=y,g=y;ra.forEach(x=>{(!x.style.left||!x.style.top)&&(x.style.position="absolute",x.style.left=`${v}px`,x.style.top=`${g}px`,g+=p+y,g+p>rt&&(g=y,v+=l+y))})}window.addEventListener("load",Ar);window.addEventListener("resize",Ar);console.log("Howdy, devtools user! the source of this site is available at: https://github.com/Reeyuki/reeyuki.github.io");qs();
