(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class W{constructor(e,t){this.fs=e,this.wm=t,this.currentPath=["home","reeyuki"],this.history=[],this.historyIndex=-1,this.username="reeyuki",this.hostname="desktop-os",this.printQueue=Promise.resolve(),this.commands={},this.registerDefaultCommands(),this.pageLoadTime=Date.now()}async print(e,t=null,s=!1,n=null,i=30){const o=document.createElement("div"),r=document.createElement("span");if(s){const a=document.createElement("span");a.textContent=n||this.terminalPrompt.textContent,a.style.color="white",o.appendChild(a),o.appendChild(r)}else t&&(r.style.color=t),o.appendChild(r);this.terminalOutput.appendChild(o);for(let a=0;a<e.length;a++)r.textContent+=e[a],await new Promise(c=>setTimeout(c,i)),this.terminalOutput.parentElement.scrollTop=this.terminalOutput.parentElement.scrollHeight}enqueuePrint(...e){return this.printQueue=this.printQueue.then(()=>this.print(...e)),this.printQueue}setupEventHandlers(){this.terminalInput.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();const t=this.terminalInput.value.trim();if(!t)return;this.history.push(t),this.historyIndex=this.history.length,this.terminalInput.value="",this.executeCommand(t)}else if(e.key==="ArrowUp"&&this.historyIndex>0)e.preventDefault(),this.terminalInput.value=this.history[--this.historyIndex];else if(e.key==="ArrowDown")e.preventDefault(),this.historyIndex=Math.min(this.historyIndex+1,this.history.length),this.terminalInput.value=this.historyIndex<this.history.length?this.history[this.historyIndex]:"";else if(e.key==="Tab")e.preventDefault(),this.handleTabCompletion();else if(e.ctrlKey)if(e.key==="l")e.preventDefault(),this.cmdClear();else if(e.key==="d"){e.preventDefault();const t=document.getElementById("terminal-win");t&&(this.wm.removeFromTaskbar(t.id),t.remove())}else e.key==="c"&&(e.preventDefault(),this.enqueuePrint("^C","white",!0,this.terminalPrompt.textContent),this.terminalInput.value="")}),document.getElementById("terminal-win").addEventListener("click",()=>{this.terminalInput.focus()})}executeCommand(e){this.enqueuePrint(e,null,!0,this.terminalPrompt.textContent);const[t,...s]=e.trim().split(/\s+/),n={help:()=>this.cmdHelp(),clear:()=>this.cmdClear(),ls:()=>this.cmdLs(s),pwd:()=>this.enqueuePrint(this.currentPath.length>0?"/"+this.currentPath.join("/"):"/"),cd:()=>this.cmdCd(s),mkdir:()=>this.cmdFileOp(s,"mkdir","missing operand",()=>this.fs.createFolder(this.currentPath,s[0]),"Created directory"),touch:()=>this.cmdFileOp(s,"touch","missing file operand",()=>this.fs.createFile(this.currentPath,s[0],""),"Created file"),rm:()=>this.cmdFileOp(s,"rm","missing operand",()=>this.fs.deleteItem(this.currentPath,s[0]),"Removed"),cat:()=>this.cmdCat(s),echo:()=>this.enqueuePrint(s.join(" ")),whoami:()=>this.enqueuePrint(this.username),hostname:()=>this.enqueuePrint(this.hostname),date:()=>this.enqueuePrint(new Date().toString()),history:()=>this.history.forEach((i,o)=>this.enqueuePrint(`  ${o+1}  ${i}`)),tree:()=>this.cmdTree(),uname:()=>this.enqueuePrint("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux"),neofetch:()=>this.cmdNeofetch(),ping:()=>this.cmdPing(s),curl:()=>this.cmdCurl(s),ps:()=>this.cmdPs()};n[t]?n[t]():t&&this.enqueuePrint(`bash: ${t}: command not found`),this.updatePrompt()}open(){const e=document.getElementById("terminal-win");if(e)return this.wm.bringToFront(e);const t=this.wm.createWindow("terminal-win","Terminal","700px","500px");Object.assign(t.style,{left:"200px",top:"100px"}),t.innerHTML=`
      <div class="window-header">
        <span>Terminal</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="background:#000; color:white; font-family:monospace; padding:10px; overflow-y:auto; height:calc(100% - 40px);">
        <div id="terminal-output" style="white-space: pre;"></div>
        <div id="terminal-input-line" style="display:flex;">
          <span id="terminal-prompt"></span>
          <input type="text" id="terminal-input" style="flex:1; background:transparent; border:none; color:white; font-family:monospace; outline:none; margin-left:5px;" autocomplete="off">
        </div>
      </div>
    `,desktop.appendChild(t),this.wm.makeDraggable(t),this.wm.makeResizable(t),this.wm.setupWindowControls(t),this.wm.addToTaskbar(t.id,"Terminal","/static/icons/terminal.png"),this.terminalOutput=t.querySelector("#terminal-output"),this.terminalInput=t.querySelector("#terminal-input"),this.terminalPrompt=t.querySelector("#terminal-prompt"),this.updatePrompt(),this.terminalInput.focus(),this.print("Welcome to Reeyuki's silly terminal"),this.print(`Type 'help' for available commands
`),this.setupEventHandlers()}updatePrompt(){const e=this.currentPath.length?"/"+this.currentPath.join("/"):"/";this.terminalPrompt.textContent=`${this.username}@${this.hostname}:${e}$ `}handleTabCompletion(){const e=this.terminalInput.value,t=this.terminalInput.selectionStart,s=e.slice(0,t),n=s.match(/(\S+)$/);if(!n)return;const i=n[1],o=s.slice(0,s.length-i.length);let r,a;if(i.includes("/")){const p=i.split("/");a=p.pop(),r=this.fs.resolvePath(p.join("/"),this.currentPath)}else r=[...this.currentPath],a=i;let c;try{c=Object.keys(this.fs.getFolder(r))}catch{return}const l=c.filter(p=>p.startsWith(a));if(l.length)if(l.length===1){const p=l[0]+(this.fs.isFile(r,l[0])?"":"/");this.terminalInput.value=o+p+e.slice(t),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=o.length+p.length}else{const p=l.reduce((h,m)=>{let u=0;for(;u<h.length&&u<m.length&&h[u]===m[u];)u++;return h.slice(0,u)},l[0]);p.length>a.length?(this.terminalInput.value=o+p+e.slice(t),this.terminalInput.selectionStart=this.terminalInput.selectionEnd=o.length+p.length):this.print(l.join("  "))}}registerCommand(e,t){this.commands[e]=t}registerFileCommand(e,t,s,n){this.registerCommand(e,i=>{if(!i.length)return this.print(`${e}: ${n}`);try{t(this.currentPath,i[0]),this.print(`${s}: ${i[0]}`)}catch(o){this.print(`${e}: cannot process '${i[0]}': ${o.message}`)}})}registerDefaultCommands(){this.registerCommand("help",async()=>{const e=Object.keys(this.commands).sort();await this.print("Available commands:");for(const t of e)await this.print(`  ${t}`)}),this.registerCommand("clear",()=>this.cmdClear()),this.registerCommand("pwd",()=>this.print(this.currentPath.length?"/"+this.currentPath.join("/"):"/")),this.registerCommand("ls",e=>this.cmdLs(e)),this.registerCommand("cd",e=>this.cmdCd(e)),this.registerFileCommand("mkdir",(e,t)=>this.fs.createFolder(e,t),"Created directory","missing operand"),this.registerFileCommand("touch",(e,t)=>this.fs.createFile(e,t,""),"Created file","missing file operand"),this.registerFileCommand("rm",(e,t)=>this.fs.deleteItem(e,t),"Removed","missing operand"),this.registerCommand("cat",e=>this.cmdCat(e)),this.registerCommand("echo",e=>this.print(e.join(" "))),this.registerCommand("whoami",()=>this.print(this.username)),this.registerCommand("hostname",()=>this.print(this.hostname)),this.registerCommand("date",()=>this.print(new Date().toString())),this.registerCommand("history",()=>this.history.forEach((e,t)=>this.print(`  ${t+1}  ${e}`))),this.registerCommand("tree",()=>this.cmdTree()),this.registerCommand("uname",()=>this.print("Linux reeyuki-desktop 6.1.23-arch1-1 #1 SMP PREEMPT x86_64 GNU/Linux")),this.registerCommand("ping",e=>this.cmdPing(e)),this.registerCommand("curl",e=>this.cmdCurl(e)),this.registerCommand("neofetch",()=>this.cmdNeofetch()),this.registerCommand("ps",()=>this.cmdPs())}cmdClear(){this.terminalOutput.innerHTML=""}cmdLs(e){try{const t=e.length?this.fs.resolvePath(e[0],this.currentPath):this.currentPath;Object.keys(this.fs.getFolder(t)).forEach(s=>{const n=this.fs.isFile(t,s);this.print(s+(n?"":"/"),n?null:"blue")})}catch{this.print(`ls: cannot access '${e[0]}': No such file or directory`)}}cmdCd(e){if(!e.length||e[0]==="~")this.currentPath=["home",this.username];else try{const t=this.fs.resolvePath(e[0],this.currentPath);if(!this.fs.getFolder(t))return this.print(`cd: ${e[0]}: Not a directory`);this.currentPath=t}catch{this.print(`cd: ${e[0]}: No such file or directory`)}}cmdCat(e){if(!e.length)return this.print("cat: missing file operand");const t=e[0];try{if(!this.fs.isFile(this.currentPath,t))return this.print(`cat: ${t}: Is a directory`);this.print(this.fs.getFileContent(this.currentPath,t)||"(empty file)")}catch{this.print(`cat: ${t}: No such file or directory`)}}async cmdPing(e){if(!e.length)return this.print("Usage: ping <host>");const t=e[0].startsWith("http")?e[0]:"https://"+e[0];await this.print(`PING ${e[0]} ...`);const s=performance.now();try{await fetch(t,{method:"HEAD",mode:"no-cors"})}catch{}await this.print(`Reply from ${e[0]}: time=${(performance.now()-s).toFixed(2)}ms`)}async cmdCurl(e){if(!e.length)return this.print("Usage: curl <url>");try{const t=await(await fetch(e[0])).text();await this.print(t.slice(0,1e3))}catch{await this.print(`curl: (6) Could not resolve host: ${e[0]}`)}}async cmdNeofetch(){const e=navigator.userAgent,t=/Firefox\/\d+/.test(e)?"Firefox":/Edg\/\d+/.test(e)?"Edge":/Chrome\/\d+/.test(e)?"Chrome":"Unknown",n=t==="Chrome"||t==="Edge"?"eww a chromium?!":t,i=navigator.hardwareConcurrency||"Unknown",o=i>10?`${i} (WOW ITS SO BIG!)`:i;let r="Unknown";try{const v=document.createElement("canvas"),x=v.getContext("webgl")||v.getContext("experimental-webgl");if(x){const E=x.getExtension("WEBGL_debug_renderer_info");r=E?x.getParameter(E.UNMASKED_RENDERER_WEBGL):x.getParameter(x.RENDERER)}}catch{}const a=Date.now()-this.pageLoadTime,c=Math.floor(a/36e5),l=Math.floor(a%36e5/6e4),p=`${c}h, ${l}m`;let h="Unknown";typeof InstallTrigger<"u"?h="SpiderMonkey":window.chrome&&/Google Inc/.test(navigator.vendor)?h="V8":/Apple/.test(navigator.vendor)&&(h="JavaScriptCore");let m="Unknown";/Windows NT 10/.test(e)?m="Windows 10/11":/Mac OS X/.test(e)?m="macOS":/Linux/.test(e)?m="Linux":/Android/.test(e)?m="Android":/iPhone|iPad/.test(e)&&(m="iOS");const u=m=="Windows 10/11"?"Eww a windows!":m,g=navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",y=navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled",d=["","","                     "+this.username+"@"+this.hostname,`        /\\           OWOS     ${u}`,`       /  \\          KEWNEL   ${h}wu`,`      /\\   \\         CPUWU    Cwpu Cowes: ${o}`,`     / > ω <\\        BROWSEWU  ${n}`,`    /   __   \\       GWAPHU    ${r}`,`   / __|  |__-\\      MEMOWY    ${g}`,`  /_-''    ''-_\\     DoNawtTWACKWU  ${y}`,`                     RESOWUW   ${window.innerWidth}x${window.innerHeight}`,`                     UWUPTIME  ${p}`];for(const v of d)await this.enqueuePrint(v)}cmdPs(){const e=Array.from(document.querySelectorAll(".window"));this.print("  PID   TTY          TIME CMD"),e.length?e.forEach((t,s)=>{const n=t.querySelector(".window-header span")?.textContent||"unknown";this.print(`  ${1e3+s}  pts/0      0:00 ${n}`)}):this.print("  1     pts/0        0:00 idle")}cmdTree(e=this.currentPath,t=""){t||this.print(e.length?"/"+e.join("/"):"/");try{const s=Object.keys(this.fs.getFolder(e));s.forEach((n,i)=>{const o=this.fs.isFile(e,n),r=i===s.length-1;this.print(t+(r?"└── ":"├── ")+n+(o?"":"/")),o||this.cmdTree([...e,n],t+(r?"    ":"│   "))})}catch{this.print("tree: error reading directory")}}cmdHelp(){const e=[["help","Show this help message"],["clear","Clear the terminal screen"],["ls","List directory contents"],["pwd","Print working directory"],["cd [dir]","Change directory"],["mkdir","Create a new directory"],["touch","Create a new file"],["rm","Remove file or directory"],["cat","Display file contents"],["echo","Display a line of text"],["whoami","Display current user"],["hostname","Display hostname"],["date","Display current date and time"],["history","Show command history"],["tree","Display directory tree"]];this.print("Available commands:"),e.forEach(([t,s])=>this.print(`  ${t.padEnd(10)} - ${s}`))}}const f=document.getElementById("context-menu"),b={IMAGE:"image",TEXT:"text"};class z{constructor(e,t,s){this.fs=e,this.wm=t,this.notepadApp=s,this.currentPath=["home","reeyuki"],this.fileSelectCallback=null,this.open=this.open.bind(this)}open(e=null){if(this.fileSelectCallback=e,document.getElementById("explorer-win")){this.wm.bringToFront(document.getElementById("explorer-win"));return}const t=document.createElement("div");t.className="window",t.id="explorer-win",t.dataset.fullscreen="false",t.innerHTML=`
      <div class="window-header">
        <span>File Explorer</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="explorer-nav">
        <div class="back-btn" id="exp-back">← Back</div>
        <div id="exp-path" style="color:#555"></div>
      </div>
      <div class="explorer-container">
        <div class="explorer-sidebar">
          <div class="start-item" data-path="home/reeyuki/Documents">Documents</div>
          <div class="start-item" data-path="home/reeyuki/Pictures">Pictures</div>
          <div class="start-item" data-path="home/reeyuki/Music">Music</div>
        </div>
        <div class="explorer-main" id="explorer-view"></div>
      </div>
    `,desktop.appendChild(t),document.getElementById("explorer-view").style.width="600px",this.wm.makeDraggable(t),this.wm.makeResizable(t),this.wm.setupWindowControls(t),this.wm.addToTaskbar(t.id,"File Explorer","/static/icons/file.png"),this.setupExplorerControls(t),this.render()}setupExplorerControls(e){e.querySelector("#exp-back").onclick=()=>{this.currentPath.length>1&&(this.currentPath.pop(),this.render())},e.querySelectorAll(".explorer-sidebar .start-item").forEach(s=>{s.onclick=()=>{const n=s.dataset.path.split("/").filter(i=>i);this.navigate(n)}});const t=e.querySelector("#explorer-view");t.addEventListener("contextmenu",s=>{s.target===t&&this.showBackgroundContextMenu(s)})}navigate(e){this.currentPath=[...e],this.render()}renderMusicPage(e){e&&(e.innerHTML=`
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
      <iframe 
        src="https://open.spotify.com/embed/playlist/6oK6F4LglYBr4mYLSRDJOa" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>

      <iframe 
        src="https://open.spotify.com/embed/playlist/1q7zv2ScwtR2jIxaIRj9iG" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>

      <iframe 
        src="https://open.spotify.com/embed/playlist/6q8mgrJZ5L4YxabVQoAZZf" 
        width="300" 
        height="380" 
        frameborder="0" 
        allowtransparency="true" 
        allow="encrypted-media">
      </iframe>
    </div>
  `)}render(){const e=document.getElementById("explorer-view"),t=document.getElementById("exp-path");if(!e)return;if(e.innerHTML="",t.textContent="/"+this.currentPath.join("/"),this.currentPath[2]==="Music"){this.renderMusicPage(document.getElementById("explorer-view"));return}const s=this.fs.getFolder(this.currentPath);Object.keys(s).forEach(n=>{const i=this.fs.isFile(this.currentPath,n),o=document.createElement("div");o.className="file-item";let r;i?this.fs.getFileKind(this.currentPath,n)===b.IMAGE?r=this.fs.getFileContent(this.currentPath,n)||"/static/icons/file.png":r="/static/icons/notepad.webp":r="/static/icons/file.png",o.innerHTML=`
      <img src="${r}" style="width:64px;height:64px;object-fit:cover">
      <span>${n}</span>
    `,o.ondblclick=()=>{if(i)if(this.fileSelectCallback)this.fileSelectCallback(this.currentPath,n),this.fileSelectCallback=null;else{const a=this.fs.getFileContent(this.currentPath,n);this.fs.getFileKind(this.currentPath,n)===b.IMAGE?this.openImageViewer(n,a):this.notepadApp.open(n,a,this.currentPath)}else this.currentPath.push(n),this.render()},o.oncontextmenu=a=>this.showFileContextMenu(a,n,i),e.appendChild(o)})}openImageViewer(e,t){const s=document.createElement("div");s.className="window",Object.assign(s.style,{width:"500px",height:"400px",left:"150px",top:"150px",zIndex:2e3}),s.innerHTML=`
      <div class="window-header">
        <span>${e}</span>
        <div class="window-controls">
          <button class="close-btn">X</button>
        </div>
      </div>
      <div style="display:flex;justify-content:center;align-items:center;height:calc(100% - 30px);background:#222">
        <img src="${t}" style="max-width:100%; max-height:100%">
      </div>
    `,desktop.appendChild(s),this.wm.makeDraggable(s),s.querySelector(".close-btn").onclick=()=>s.remove()}showFileContextMenu(e,t,s){e.preventDefault(),e.stopPropagation(),f.innerHTML="";const n=(a,c)=>{const l=document.createElement("div");return l.textContent=a,l.onclick=c,l},i=s?"Open":"Open Folder",o=()=>{if(f.style.display="none",s){const a=this.fs.getFileContent(this.currentPath,t);this.fs.getFileKind(this.currentPath,t)===b.IMAGE?this.openImageViewer(t,a):this.notepadApp.open(t,a,this.currentPath)}else this.currentPath.push(t),this.render()};if(f.appendChild(n(i,o)),s){f.appendChild(document.createElement("hr"));const a=()=>{f.style.display="none",this.fs.deleteItem(this.currentPath,t),this.render()};f.appendChild(n("Delete",a));const c=()=>{f.style.display="none";const l=prompt("Enter new name:",t);l&&l!==t&&(this.fs.renameItem(this.currentPath,t,l),this.render())};f.appendChild(n("Rename",c))}f.appendChild(document.createElement("hr"));const r=()=>{f.style.display="none",alert(`Name: ${t}
Type: ${s?"File":"Folder"}`)};f.appendChild(n("Properties",r)),Object.assign(f.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}showBackgroundContextMenu(e){e.preventDefault(),e.stopPropagation(),f.innerHTML=`
      <div id="ctx-new-file">New File</div>
      <div id="ctx-new-folder">New Folder</div>
      <hr>
      <div id="ctx-refresh">Refresh</div>
    `,document.getElementById("ctx-new-file").onclick=()=>{f.style.display="none";const t=prompt("Enter file name:","NewFile.txt");t&&(this.fs.createFile(this.currentPath,t),this.render())},document.getElementById("ctx-new-folder").onclick=()=>{f.style.display="none";const t=prompt("Enter folder name:","NewFolder");t&&(this.fs.createFolder(this.currentPath,t),this.render())},document.getElementById("ctx-refresh").onclick=()=>{f.style.display="none",this.render()},Object.assign(f.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}}const I=document.getElementById("window-style");function D(){console.log(I),console.log("hide transparency"),I.disabled=!0}function R(){console.log(I),console.log("restore transparency"),I.disabled=!1}class O{constructor(){this.openWindows=new Map,this.zIndexCounter=1e3,this.gameWindowCount=0}updateTransparency(){console.log("gameWindowCount is : ",this.gameWindowCount," gameWindowCount>0 is : ",this.gameWindowCount>0),this.gameWindowCount>0?D():R()}createWindow(e,t,s="80vw",n="80vh",i=!1){const o=document.createElement("div");o.className="window",o.id=e,o.dataset.fullscreen="false";const r=s!=null?String(s):"80vw",a=n!=null?String(n):"80vh",c=r.includes("vw")?window.innerWidth*parseFloat(r)/100:parseInt(r),l=a.includes("vh")?window.innerHeight*parseFloat(a)/100:parseInt(a);return Object.assign(o.style,{width:`${c}px`,height:`${l}px`,left:`${(window.innerWidth-c)/2}px`,top:`${(window.innerHeight-l)/2}px`,position:"absolute",zIndex:this.zIndexCounter++}),i&&this.gameWindowCount++,console.log("is Game: ",i,"gameWindowCount is now : ",this.gameWindowCount),this.updateTransparency(),o}addToTaskbar(e,t,s){if(document.getElementById(`taskbar-${e}`))return;const n=document.createElement("div");if(n.id=`taskbar-${e}`,n.className="taskbar-item",s){const r=document.createElement("img");r.src=s,n.appendChild(r)}const i=document.createElement("span");i.textContent=t,n.appendChild(i),n.onclick=()=>{const r=document.getElementById(e);r&&(r.style.display==="none"?(r.style.display="block",n.classList.add("active")):this.bringToFront(r))},n.oncontextmenu=r=>{r.preventDefault();const a=document.getElementById("taskbar-context-menu");a&&a.remove();const c=document.createElement("div");c.id="taskbar-context-menu",c.className="kde-menu";const l=document.getElementById(e),p=(g,y)=>{const d=document.createElement("div");d.textContent=g,d.className="kde-item",d.onclick=()=>{y(),c.remove()},c.appendChild(d)};p(l.style.display==="none"?"Restore":"Minimize",()=>{l.style.display==="none"?l.style.display="block":this.minimizeWindow(l),this.bringToFront(l)}),p(l.dataset.fullscreen==="true"?"Restore Size":"Maximize",()=>{this.toggleFullscreen(l),this.bringToFront(l)}),p("Bring to Front",()=>this.bringToFront(l)),p("Properties",()=>{const g=this.openWindows.get(e);if(!g)return;const y=document.getElementById(e);if(!y)return;const d=y.dataset,v=y.getBoundingClientRect(),E=[`Window ID: ${e}`,`Title: ${g.title}`,d.appType?`Type: ${d.appType}`:"",d.appId?`App ID: ${d.appId}`:"",d.swf?`SWF Path: ${d.swf}`:"",d.rom?`ROM: ${d.rom}`:"",d.core?`Core: ${d.core}`:"",d.externalUrl?`URL: ${d.externalUrl}`:"",`Width: ${Math.round(v.width)}px`,`Height: ${Math.round(v.height)}px`,`Left: ${Math.round(v.left)}px`,`Top: ${Math.round(v.top)}px`,`Z-Index: ${y.style.zIndex}`,`Fullscreen: ${d.fullscreen==="true"?"Yes":"No"}`].filter(Boolean).map(B=>`<div style="margin:2px 0;">${B}</div>`).join(""),C=this.createWindow(`${e}-props`,`Properties: ${g.title}`,"40vw","40vh");C.innerHTML=`
          <div class="window-header">
            <span>Properties: ${g.title}</span>
            <div class="window-controls">
              <button class="minimize-btn" title="Minimize">−</button>
              <button class="maximize-btn" title="Maximize">□</button>
              <button class="close-btn" title="Close">X</button>
            </div>
          </div>
          <div class="window-content" style="width:100%; height:100%; overflow:auto; user-select:text;">
            ${E}
          </div>
        `,desktop.appendChild(C),this.makeDraggable(C),this.makeResizable(C),this.setupWindowControls(C)}),p("Close Window",()=>{this.removeFromTaskbar(e),l&&l.remove()}),document.body.appendChild(c);const h=c.getBoundingClientRect();let m=r.pageX,u=window.innerHeight-r.pageY;m+h.width>window.innerWidth&&(m=window.innerWidth-h.width-10),u+h.height>window.innerHeight&&(u=10),c.style.setProperty("--ctx-left",`${m}px`),c.style.setProperty("--ctx-bottom",`${u}px`),document.addEventListener("click",function g(){c.remove(),document.removeEventListener("click",g)})},document.getElementById("taskbar-windows").appendChild(n),this.openWindows.set(e,{taskbarItem:n,title:t})}removeFromTaskbar(e){const t=document.getElementById(`taskbar-${e}`);t&&t.remove(),this.openWindows.delete(e)}bringToFront(e){e.style.zIndex=this.zIndexCounter++}minimizeWindow(e){e.style.display="none";const t=document.getElementById(`taskbar-${e.id}`);t&&(t.style.background="#1a1a1a")}toggleFullscreen(e){const t=e.dataset.fullscreen==="true",s=e.querySelector(".window-header");if(t)document.fullscreenElement===e&&document.exitFullscreen(),Object.assign(e.style,{width:e.dataset.prevWidth,height:e.dataset.prevHeight,left:e.dataset.prevLeft,top:e.dataset.prevTop}),s&&(s.style.display=""),e.dataset.fullscreen="false";else{Object.assign(e.dataset,{prevWidth:e.style.width,prevHeight:e.style.height,prevLeft:e.style.left,prevTop:e.style.top});const n=()=>{Object.assign(e.style,{width:"100vw",height:"100vh",left:"0",top:"0"}),s&&(s.style.display="none")};e.requestFullscreen?e.requestFullscreen().then(n).catch(n):n(),e.dataset.fullscreen="true";const i=()=>{document.fullscreenElement||(s&&(s.style.display=""),e.dataset.fullscreen="false",document.removeEventListener("fullscreenchange",i))};document.addEventListener("fullscreenchange",i)}}setupWindowControls(e){e.querySelector(".close-btn").onclick=()=>{this.removeFromTaskbar(e.id),e.remove();const t=e.dataset.isGame==="true";console.log("Removing window is game is: ",t),t&&(this.gameWindowCount=Math.max(0,this.gameWindowCount-1)),this.updateTransparency()},e.querySelector(".minimize-btn").onclick=()=>this.minimizeWindow(e),e.querySelector(".maximize-btn").onclick=()=>this.toggleFullscreen(e),e.addEventListener("mousedown",()=>this.bringToFront(e))}makeDraggable(e){const t=e.querySelector(".window-header");t.onmousedown=s=>{if(s.target.tagName==="BUTTON")return;const n=s.clientX-e.offsetLeft,i=s.clientY-e.offsetTop;document.onmousemove=o=>{e.style.left=`${o.clientX-n}px`,e.style.top=`${o.clientY-i}px`},document.onmouseup=()=>document.onmousemove=null}}makeResizable(e){const s=n=>{const i=e.getBoundingClientRect();let o="";return n.clientY-i.top<10?o+="n":i.bottom-n.clientY<10&&(o+="s"),n.clientX-i.left<10?o+="w":i.right-n.clientX<10&&(o+="e"),o};e.addEventListener("mousemove",n=>{const i=s(n),o={n:"n-resize",s:"s-resize",w:"w-resize",e:"e-resize",nw:"nw-resize",ne:"ne-resize",sw:"sw-resize",se:"se-resize","":"default"};e.style.cursor=o[i]||"default"}),e.addEventListener("mousedown",n=>{const i=s(n);if(!i)return;n.preventDefault();const o=n.clientX,r=n.clientY,a=e.getBoundingClientRect(),c=a.width,l=a.height,p=a.left,h=a.top,m=g=>{let y=c,d=l,v=p,x=h;i.includes("e")&&(y=c+(g.clientX-o)),i.includes("s")&&(d=l+(g.clientY-r)),i.includes("w")&&(y=c-(g.clientX-o),v=p+(g.clientX-o)),i.includes("n")&&(d=l-(g.clientY-r),x=h+(g.clientY-r));const E=300;y>E&&(e.style.width=`${y}px`,e.style.left=`${v}px`),d>E&&(e.style.height=`${d}px`,e.style.top=`${x}px`)},u=()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",m),document.addEventListener("mouseup",u)})}}class j{constructor(e,t,s,n,i,o){this.wm=e,this.fs=t,this.musicPlayer=s,this.explorerApp=n,this.terminalApp=i,this.notepadApp=o,this.pageLoadTime=Date.now(),this.TRANSPARENCY_ALLOWED_APP_IDS=new Set(["paint","vscode","liventcord"]);const r=this._getAnalyticsBase("hit-page");this.sendAnalytics({...r,event:"start"}),this.appMap={return:{type:"system",action:()=>window.location.href="/"},explorer:{type:"system",action:()=>this.explorerApp.open()},computer:{type:"system",action:()=>this.explorerApp.open()},terminal:{type:"system",action:()=>this.terminalApp.open()},notepad:{type:"system",action:()=>this.notepadApp.open()},music:{type:"system",action:()=>this.musicPlayer.open(this.wm)},sonic:{type:"swf",swf:"/static/games/swfGames/sonic.swf"},flight:{type:"swf",swf:"/static/games/swfGames/flight.swf"},swarmQueen:{type:"swf",swf:"/static/games/swfGames/swarmQueen.swf"},paint:{type:"game",url:"https://paint.js.org/"},pacman:{type:"game",url:"https://pacman-e281c.firebaseapp.com"},pvz:{type:"game",url:"https://emupedia.net/emupedia-game-pvz"},pvzHybrid:{type:"remote",url:"https://www.miniplay.com/embed/plants-vs-zombies-hybrid-story"},tetris:{type:"game",url:"https://turbowarp.org/embed.html?autoplay#31651654"},roads:{type:"game",url:"https://slowroads.io"},vscode:{type:"game",url:"https://emupedia.net/emupedia-app-vscode"},isaac:{type:"game",url:"https://emupedia.net/emupedia-game-binding-of-isaac"},mario:{type:"game",url:"https://emupedia.net/emupedia-game-mario"},papaGames:{type:"game",url:"https://papasgamesfree.io"},zombieTd:{type:"game",url:"https://www.gamesflow.com/jeux.php?id=2061391"},zombotron:{type:"game",url:"https://www.gameflare.com/embed/zombotron"},zombotron2:{type:"game",url:"https://www.gameflare.com/embed/zombotron-2"},zombotron2Time:{type:"game",url:"https://www.gameflare.com/embed/zombotron-2-time-machine/"},breach:{type:"game",url:"https://www.gameflare.com/embed/the-breach/"},fancyPants:{type:"game",url:"https://www.friv.com/z/games/fancypantsadventure/game.html"},fancyPants2:{type:"game",url:"https://www.friv.com/z/games/fancypantsadventure2/game.html"},fancyPants3:{type:"game",url:"https://www.gameflare.com/embed/fancy-pants-3"},strikeForce:{type:"game",url:"https://www.friv.com/z/games/strikeforcekitty/game.html"},strikeForce2:{type:"game",url:"https://www.friv.com/z/games/strikeforcekitty2/game.html"},baloonsTd5:{type:"game",url:"https://www.gameflare.com/embed/bloons-tower-defense-5"},trinitas:{type:"game",url:"/static/games/trinitas"},jojo:{type:"game",url:"https://www.retrogames.cc/embed/8843-jojos-bizarre-adventure%3A-heritage-for-the-future-jojo-no-kimyou-na-bouken%3A-mirai-e-no-isan-japan-990927-no-cd.html"},gtaVc:{type:"game",url:"/static/vciframe.html"},subwaySurfers:{type:"game",url:"https://g.igroutka.ru/games/164/Xm2W5MIcPqrF1Y90/12/subway_surfers_easter_edinburgh"},mutantFighting:{type:"game",url:"https://www.gameflare.com/embed/mutant-fighting-cup"},mutantFighting2:{type:"game",url:"https://www.gameflare.com/embed/mutant-fighting-cup-2"},finnAndBones:{type:"game",url:"/static/flashpointarchive.html?fpGameName=finnAndBones"},obama:{type:"game",url:"/static/flashpointarchive.html?fpGameName=obama-alien-defense"},intrusion:{type:"game",url:"https://www.friv.com/z/games/intrusion/game.html"},intrusion2:{type:"game",url:"https://files.silvergames.com/flash/ruffle/player.php?id=2278"},dan:{type:"game",url:"https://www.silvergames.com/en/dan-the-man/gameframe"},infectonator:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-5020.swf?v=1373587522"},infectonator2:{type:"swf",swf:"https://cache.armorgames.com/files/games/infectonator-2-13150.swf?v=1373587527"},newyorkShark:{type:"swf",swf:"https://cache.armorgames.com/files/games/new-york-shark-12969.swf?v=1373587527"},swordsSouls:{type:"swf",swf:"https://cache.armorgames.com/files/games/swordssouls-17817.swf?v=1464609285"},corporationInc:{type:"swf",swf:"https://cache.armorgames.com/files/games/corporation-inc-7348.swf?v=1373587524"},aground:{type:"game",url:"https://cache.armorgames.com/files/games/aground-18245/index.html?v=1591832301"},mobyDick:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-the-video--7199.swf?v=1373587524"},mobyDick2:{type:"swf",swf:"https://cache.armorgames.com/files/games/moby-dick-2-12662.swf?v=1373587526"},elfStory:{type:"swf",swf:"https://cache.armorgames.com/files/games/elf-story-14680.swf?v=1373587528"},frogDares:{type:"swf",swf:"https://cache.armorgames.com/files/games/frog-dares-12672.swf?v=1373587526"},kamikazePigs:{type:"swf",swf:"https://cache.armorgames.com/files/games/kamikaze-pigs-13545.swf?v=1373587527"},icyFishes:{type:"swf",swf:"https://cache.armorgames.com/files/games/icy-fishes-12977.swf?v=1373587527"},feedUs6:{type:"game",url:"https://www.gameflare.com/embed/feed-us-lost-island"},feedUsPirates:{type:"game",url:"https://www.gameflare.com/embed/feed-us-pirates"},cactusMcCoy:{type:"game",url:"https://papasgamesfree.io/cactus-mccoy-1"},jackSmith:{type:"game",url:"https://papasgamesfree.io/jacksmith"},pokemonEmerald:{type:"gba",url:"pokemon-emerald.gba"},pokemonPlatinum:{type:"nds",url:"pokemon-platinum.nds"},pokemonHeartgold:{type:"nds",url:"pokemon-heartgold.nds"},pokemonWhite:{type:"nds",url:"pokemon-white.nds"},minecraft:{type:"remote",url:"https://eaglercraft.com/play"},liventcord:{type:"game",url:"https://liventcord.github.io"}},U(this)}launch(e){const t=this.appMap[e];if(!t)return;const s=this._getAnalyticsBase(e);this.sendAnalytics({...s,event:"launch"}),{system:()=>t.action(),swf:()=>this.openRuffleApp(e,t.swf,s),gba:()=>this.openEmulatorApp(e,t.url,"gba",s),nds:()=>this.openEmulatorApp(e,t.url,"nds",s),game:()=>this.openGameApp(e,t.url,s),html:()=>this.openHtmlApp(e,t.html,s,t),remote:()=>this.openRemoteApp(t.url)}[t.type]?.()}_getAnalyticsBase(e){let t="Unknown";try{const a=document.createElement("canvas"),c=a.getContext("webgl")||a.getContext("experimental-webgl");if(c){const l=RENDERER||c.getExtension("WEBGL_debug_renderer_info");t=l?c.getParameter(l.UNMASKED_RENDERER_WEBGL):c.getParameter(c.RENDERER)}}catch{}const s=Date.now()-this.pageLoadTime,n=Math.floor(s/36e5),i=Math.floor(s%36e5/6e4),o=`${n}h, ${i}m`,r=/Brave\//.test(navigator.userAgent)||window.navigator.brave&&typeof window.navigator.brave.isBrave=="function";return{app:e,timestamp:Date.now(),browser:{userAgent:navigator.userAgent,isBrave:r,language:navigator.language,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,uptime:o,gpu:t,ram:navigator.deviceMemory?`${navigator.deviceMemory} GB`:"Unknown",cpuCores:navigator.hardwareConcurrency||"Unknown",dnt:navigator.doNotTrack==="1"||window.doNotTrack==="1"?"Enabled":"Disabled"}}}sendAnalytics(e){fetch("https://analytics.liventcord-a60.workers.dev/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}recordUsage(e,t){const s=Date.now(),n=document.getElementById(e),i=()=>{const o=Date.now()-s;this.sendAnalytics({...t,event:"usage",durationMs:o})};n.querySelector(".close-btn").addEventListener("click",i),n.addEventListener("blur",i)}openRemoteApp(e){const t=this._getAnalyticsBase(e);this.sendAnalytics({...t,event:"launch"}),window.open(e,"_blank","noopener,noreferrer")}openHtmlApp(e,t,s){if(document.getElementById(`${e}-win`)){this.wm.bringToFront(document.getElementById(`${e}-win`));return}this.createWindow(e,e.replace(/([A-Z])/g," $1").replace(/^./,n=>n.toUpperCase()),t,null,e,s)}openRuffleApp(e,t){if(!t)return;const s=t.replace(/[^a-zA-Z0-9]/g,"");if(document.getElementById(`${s}-win`)){this.wm.bringToFront(document.getElementById(`${s}-win`));return}const n=`<embed src="${t}" width="100%" height="100%">`;this.createWindow(s,e.toUpperCase(),n,null,e,{type:"swf",swf:t})}openEmulatorApp(e,t,s){const n=`${s}-${t.replace(/\W/g,"")}-${Date.now()}`;if(document.getElementById(n)){this.wm.bringToFront(document.getElementById(n));return}const i=`/static/emulatorjs.html?rom=${encodeURIComponent(t)}&core=${encodeURIComponent(s)}&color=%230064ff`,o=`<iframe src="${i}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`,r=t.replace(/\..+$/,"");this.createWindow(n,r,o,i,e,{type:s,rom:t,core:s})}openGameApp(e,t){if(document.getElementById(`${e}-win`)){this.wm.bringToFront(document.getElementById(`${e}-win`));return}const s=`<iframe src="${t}" style="width:100%; height:100%; border:none;" allow="autoplay; fullscreen; clipboard-write; encrypted-media; picture-in-picture" sandbox="allow-forms allow-downloads allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"></iframe>`,n=e.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase());this.createWindow(e,n,s,t,e,{type:"game"})}isTransparencyBlocked(e,t){return console.log("Transparency check : ",e,t,this.TRANSPARENCY_ALLOWED_APP_IDS.has(e)),!(t.type==="system"||this.TRANSPARENCY_ALLOWED_APP_IDS.has(e))}createWindow(e,t,s,n=null,i=null,o={}){const r=this.isTransparencyBlocked(i,o),a=this.wm.createWindow(`${e}-win`,t,"80vw","80vh",r);a.dataset.appType=o.type||"",a.dataset.externalUrl=n||"",a.dataset.appId=i||"",a.dataset.swf=o.swf||"",a.dataset.isGame=r,a.dataset.rom=o.rom||"",a.dataset.core=o.core||"",a.innerHTML=`
      <div class="window-header">
        <span>${t}</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          ${n?'<button class="external-btn" title="Open in External">↗</button>':""}
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="window-content" style="width:100%; height:100%;">
        ${s}
      </div>
    `,desktop.appendChild(a),this.wm.makeDraggable(a),this.wm.makeResizable(a),this.wm.setupWindowControls(a),n&&a.querySelector(".external-btn").addEventListener("click",()=>this.openRemoteApp(n));const c=q(i||e);this.wm.addToTaskbar(a.id,t,c),this.recordUsage(`${e}-win`)}}function q(w){try{return document.querySelector(`#desktop div[data-app="${w}"]`)?.querySelector("img")?.src||null}catch{return null}}function U(w){const e={system:document.querySelector('.kde-page[data-page="system"]'),apps:document.querySelector('.kde-page[data-page="apps"]'),games:document.querySelector('.kde-page[data-page="games"]'),favorites:document.querySelector('.kde-page[data-page="favorites"]')};["system","apps","games"].forEach(t=>{e[t]&&(e[t].innerHTML="")}),Object.entries(w.appMap).forEach(([t,s])=>{const n=document.createElement("div");n.classList.add("kde-item"),n.dataset.app=t;const i=t.charAt(0).toUpperCase()+t.slice(1);n.textContent=i,n.addEventListener("click",()=>w.launch(t)),s.type==="system"?e.system?.appendChild(n):s.type==="game"||s.type==="swf"?e.games?.appendChild(n):e.apps?.appendChild(n)})}class N{constructor(e,t){this.fs=e,this.wm=t}setExplorer(e){this.explorerApp=e}open(e="Untitled",t="",s=null){const n=`notepad-${e.replace(/\s/g,"")}`;if(document.getElementById(n)){this.wm.bringToFront(document.getElementById(n));return}const i=this.wm.createWindow(n,`${e} - Notepad`,"600px","400px");Object.assign(i.style,{left:"250px",top:"150px"}),i.innerHTML=`
      <div class="window-header">
        <span>${e} - Notepad</span>
        <div class="window-controls">
          <button class="minimize-btn" title="Minimize">−</button>
          <button class="maximize-btn" title="Maximize">□</button>
          <button class="close-btn" title="Close">X</button>
        </div>
      </div>
      <div class="notepad-menu">
        <button class="notepad-btn" data-action="save">Save</button>
        <button class="notepad-btn" data-action="saveAs">Save As</button>
        <button class="notepad-btn" data-action="open">Open</button>
      </div>
      <div class="window-content">
        <textarea class="notepad-textarea" style="width:100%; height:calc(100% - 40px); border:none; padding:10px; font-family:monospace;">${t}</textarea>
      </div>
    `,desktop.appendChild(i),this.wm.makeDraggable(i),this.wm.makeResizable(i),this.wm.setupWindowControls(i),this.wm.addToTaskbar(i.id,`${e} - Notepad`,"/static/icons/music.png"),this.setupNotepadControls(i,e,s)}setupNotepadControls(e,t,s){const n=e.querySelector(".notepad-textarea");e.querySelectorAll(".notepad-btn").forEach(o=>{o.onclick=()=>{const r=o.dataset.action;r==="save"?this.saveFile(e,n,t,s):r==="saveAs"?this.saveAsFile(n):r==="open"&&this.openFileDialog()}})}saveFile(e,t,s,n){if(!n){this.saveAsFile(t);return}const i=t.value;this.fs.updateFile(n,s,i),alert(`File saved: ${s}`)}saveAsFile(e){const t=prompt("Enter file name:","NewFile.txt");if(!t)return;const s=prompt("Enter path (e.g., home/reeyuki/Documents):","home/reeyuki/Documents");if(!s)return;const n=s.split("/").filter(o=>o),i=e.value;try{this.fs.createFile(n,t,i),alert(`File saved: ${t} at /${s}`)}catch{alert("Error saving file. Please check the path.")}}openFileDialog(){this.explorerApp.open((e,t)=>{const s=this.fs.getFileContent(e,t);this.open(t,s,e)})}}const S={home:{reeyuki:{Documents:{"INFO.txt":{type:"file",content:"Files you saved in notepad gets saved in your browser session.",kind:b.TEXT}},Pictures:{"wallpaper1.webp":{type:"file",content:"/static/wallpapers/wallpaper1.webp",kind:b.IMAGE},"wallpaper2.webp":{type:"file",content:"/static/wallpapers/wallpaper2.webp",kind:b.IMAGE},"wallpaper3.webp":{type:"file",content:"/static/wallpapers/wallpaper3.webp",kind:b.IMAGE},"wallpaper4.webp":{type:"file",content:"/static/wallpapers/wallpaper4.webp",kind:b.IMAGE},"wallpaper5.webp":{type:"file",content:"/static/wallpapers/wallpaper5.webp",kind:b.IMAGE},"wallpaper6.webp":{type:"file",content:"/static/wallpapers/wallpaper6.webp",kind:b.IMAGE}},Music:{}}}},M={STORAGE_KEY:"desktopOS_fileSystem"};class _{constructor(){this.loadFromStorage()}loadFromStorage(){const e=localStorage.getItem(M.STORAGE_KEY);this.fileSystem=e?JSON.parse(e):S}saveToStorage(){localStorage.setItem(M.STORAGE_KEY,JSON.stringify(this.fileSystem))}normalizePath(e){return typeof e=="string"?e.split("/").filter(t=>t):Array.isArray(e)?e.filter(t=>t):[]}resolvePath(e,t=[]){if(typeof e=="string"){if(e.startsWith("/"))return this.normalizePath(e);const s=[...t];return e.split("/").filter(n=>n).forEach(n=>{n===".."?s.pop():n!=="."&&s.push(n)}),s}return this.normalizePath(e)}getFolder(e){return this.normalizePath(e).reduce((s,n)=>{if(!s||typeof s!="object")throw new Error(`Invalid path: cannot access ${n}`);return s[n]},this.fileSystem)}inferKind(e){const t=e.split(".").pop().toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(t)?b.IMAGE:["txt","js","json","md","html","css"].includes(t)?b.TEXT:"generic"}createFile(e,t,s=""){const n=this.getFolder(e),i=this.inferKind(t);n[t]={type:"file",content:s,kind:i},this.saveToStorage()}createFolder(e,t){const s=this.getFolder(e);s[t]={},this.saveToStorage()}deleteItem(e,t){const s=this.getFolder(e);delete s[t],this.saveToStorage()}renameItem(e,t,s){const n=this.getFolder(e);n[s]=n[t],delete n[t],this.saveToStorage()}updateFile(e,t,s){const n=this.getFolder(e),i=n[t];if(i&&i.type==="file")i.content=s;else{const o=this.inferKind(t);n[t]={type:"file",content:s,kind:o}}this.saveToStorage()}getFileContent(e,t){const n=this.getFolder(e)[t];return n&&n.type==="file"&&n.content||""}getFileKind(e,t){const n=this.getFolder(e)[t];return console.log(n),n&&n.type==="file"?n.kind||"generic":null}isFile(e,t){const n=this.getFolder(e)[t];return n&&n.type==="file"}}class G{constructor(){}open(e){if(document.getElementById("music-win")){console.log("bringing window to front"),e.bringToFront(document.getElementById("music-win"));return}console.log("Creating window");const t=e.createWindow("music-win","MUSIC");t.innerHTML=`
  <div class="window-header">
    <span>MUSIC</span>
    <div class="window-controls">
      <button class="minimize-btn" title="Minimize">−</button>
      <button class="maximize-btn" title="Maximize">□</button>
      <button class="close-btn" title="Close">X</button>
    </div>
  </div>
  <div class="window-content" style="width:100%; height:100%;">
    <div id="player-container" style="display:flex; flex-direction:column; align-items:center; gap:10px; padding:10px;"></div>
    </div>
  </div>`,X.appendChild(t),k.renderMusicPage(document.getElementById("player-container")),e.makeDraggable(t),e.makeResizable(t),e.setupWindowControls(t),e.addToTaskbar(t.id,"MUSIC","/static/icons/music.png")}}class H{constructor(e){this.appLauncher=e,this.desktop=document.getElementById("desktop"),this.startButton=document.getElementById("start-button"),this.startMenu=document.getElementById("start-menu"),this.contextMenu=document.getElementById("context-menu"),this.selectionBox=document.getElementById("selection-box"),this.setupEventListeners()}setupEventListeners(){this.startButton.addEventListener("click",e=>{e.stopPropagation(),this.startMenu.style.display=this.startMenu.style.display==="flex"?"none":"flex"}),this.startMenu.addEventListener("click",e=>{e.stopPropagation()}),document.addEventListener("click",()=>{this.startMenu.style.display="none",this.contextMenu.style.display="none"}),this.desktop.addEventListener("contextmenu",e=>{e.target===this.desktop&&(e.preventDefault(),this.showDesktopContextMenu(e))}),this.setupIconHandlers(),this.setupSelectionBox(),this.setupStartMenu()}setupIconHandlers(){document.querySelectorAll(".icon.selectable").forEach(e=>{Object.assign(e.style,{userSelect:"none",webkitUserDrag:"none"}),e.draggable=!1,e.addEventListener("dblclick",t=>{t.stopPropagation();const s=e.dataset.app;s&&this.appLauncher.launch(s,e)}),e.addEventListener("mousedown",t=>{t.stopPropagation()})})}showDesktopContextMenu(e){this.contextMenu.innerHTML=`
      <div id="ctx-new-notepad">New Notepad</div>
      <div id="ctx-open-explorer">Open File Explorer</div>
      <hr>
      <div id="ctx-refresh">Refresh</div>
    `,document.getElementById("ctx-new-notepad").onclick=()=>{this.contextMenu.style.display="none",P.open()},document.getElementById("ctx-open-explorer").onclick=()=>{this.contextMenu.style.display="none",k.open()},document.getElementById("ctx-refresh").onclick=()=>{this.contextMenu.style.display="none",location.reload()},Object.assign(this.contextMenu.style,{left:`${e.pageX}px`,top:`${e.pageY}px`,display:"block"})}setupSelectionBox(){const e=document.querySelectorAll(".selectable");let t,s;this.desktop.addEventListener("mousedown",n=>{if(n.target!==this.desktop)return;t=n.pageX,s=n.pageY,Object.assign(this.selectionBox.style,{left:`${t}px`,top:`${s}px`,width:"0px",height:"0px",display:"block"}),e.forEach(r=>r.classList.remove("selected"));const i=r=>{const a=Math.abs(r.pageX-t),c=Math.abs(r.pageY-s),l=Math.min(r.pageX,t),p=Math.min(r.pageY,s);Object.assign(this.selectionBox.style,{width:`${a}px`,height:`${c}px`,left:`${l}px`,top:`${p}px`});const h=this.selectionBox.getBoundingClientRect();e.forEach(m=>{const u=m.getBoundingClientRect();!(u.right<h.left||u.left>h.right||u.bottom<h.top||u.top>h.bottom)?m.classList.add("selected"):m.classList.remove("selected")})},o=()=>{this.selectionBox.style.display="none",document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)})}setupStartMenu(){this.startMenu.querySelectorAll(".start-item").forEach(e=>{e.onclick=t=>{t.stopPropagation();const s=e.dataset.app;s==="documents"?(k.open(),k.navigate(["home","reeyuki","Documents"])):s==="pictures"?(k.open(),k.navigate(["home","reeyuki","Pictures"])):s==="notes"&&P.open(),this.startMenu.style.display="none"}})}}class A{static startClock(){const e=()=>{const t=new Date;document.getElementById("clock").textContent=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),document.getElementById("date").textContent=t.toLocaleDateString()};setInterval(e,1e3),e()}static setRandomWallpaper(){const e=S.home.reeyuki.Pictures,t=Object.values(e).filter(n=>n.kind==="image").map(n=>n.content);if(!t.length)return;const s=t[Math.floor(Math.random()*t.length)];document.body.style.background=`url('${s}') no-repeat center center fixed`,document.body.style.backgroundSize="cover"}}const X=document.getElementById("desktop"),$=new _,T=new O,P=new N($,T,null),k=new z($,T,P);P.setExplorer(k);const Y=new W($,T),K=new G,L=new j(T,$,K,k,Y,P);new H(L);A.startClock();A.setRandomWallpaper();const Z=window.location.search,Q=new URLSearchParams(Z),F=Q.get("game");F&&setTimeout(()=>{L.launch(F)},100);console.log("Howdy, devtools user! the source of this site is available at: https://github.com/Reeyuki/reeyuki.github.io");
